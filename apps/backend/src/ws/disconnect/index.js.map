{
  "version": 3,
  "sources": ["../../../node_modules/@architect/functions/src/http/session/providers/_get-idx.js", "../../../node_modules/cookie/index.js", "../../../node_modules/node-webtokens/lib/ecdsa.js", "../../../node_modules/node-webtokens/lib/common.js", "../../../node_modules/node-webtokens/lib/jws.js", "../../../node_modules/node-webtokens/lib/jwe.js", "../../../node_modules/node-webtokens/index.js", "../../../node_modules/@architect/functions/src/http/session/providers/jwe.js", "../../../node_modules/cookie-signature/index.js", "../../../node_modules/@architect/functions/src/tables/dynamo.js", "../../../node_modules/random-bytes/index.js", "../../../node_modules/uid-safe/index.js", "../../../node_modules/@architect/functions/src/http/session/providers/ddb/_week-from-now.js", "../../../node_modules/rndm/index.js", "../../../node_modules/tsscmp/lib/index.js", "../../../node_modules/csrf/index.js", "../../../node_modules/queue-microtask/index.js", "../../../node_modules/run-parallel/index.js", "../../../node_modules/@architect/functions/src/http/session/providers/ddb/create.js", "../../../node_modules/@architect/functions/src/http/session/providers/ddb/find.js", "../../../node_modules/@architect/functions/src/http/session/providers/ddb/update.js", "../../../node_modules/@architect/functions/src/http/session/providers/ddb/index.js", "../../../node_modules/@architect/functions/src/http/session/read.js", "../../../node_modules/@architect/functions/src/http/session/write.js", "../../../node_modules/@architect/functions/src/http/helpers/body-parser.js", "../../../node_modules/@architect/functions/src/http/helpers/params.js", "../../../node_modules/@architect/functions/src/http/errors/index.js", "../../../node_modules/@architect/functions/src/http/helpers/binary-types.js", "../../../node_modules/@architect/functions/src/http/_res-fmt.js", "../../../node_modules/@architect/functions/src/http/http.js", "../../../node_modules/@architect/functions/src/static/index.js", "../../../node_modules/@architect/functions/src/http/helpers/url.js", "../../../node_modules/@architect/functions/src/http/async/index.js", "../../../node_modules/binary-case/index.js", "../../../node_modules/media-typer/index.js", "../../../node_modules/mime-db/index.js", "../../../node_modules/mime-types/index.js", "../../../node_modules/type-is/index.js", "../../../node_modules/@vendia/serverless-express/src/index.js", "../../../node_modules/@vendia/serverless-express/index.js", "../../../node_modules/aws-serverless-express/src/index.js", "../../../node_modules/aws-serverless-express/index.js", "../../../node_modules/@architect/functions/src/http/express/index.js", "../../../node_modules/@architect/functions/src/http/proxy/format/transform.js", "../../../node_modules/@architect/functions/src/http/proxy/format/templatize.js", "../../../node_modules/@architect/functions/src/http/proxy/format/compress.js", "../../../node_modules/@architect/functions/src/http/proxy/format/response.js", "../../../node_modules/@architect/functions/src/http/proxy/read/_pretty.js", "../../../node_modules/@architect/functions/src/http/proxy/read/_local.js", "../../../node_modules/@architect/functions/src/http/proxy/read/_s3.js", "../../../node_modules/@architect/functions/src/http/proxy/read/index.js", "../../../node_modules/@architect/functions/src/http/proxy/index.js", "../../../node_modules/@architect/functions/src/http/index.js", "../../../node_modules/@architect/functions/src/discovery/index.js", "../../../node_modules/@architect/functions/src/ws/send-sandbox.js", "../../../node_modules/@architect/functions/src/ws/send.js", "../../../node_modules/@architect/functions/src/ws/index.js", "../../../node_modules/run-waterfall/index.js", "../../../node_modules/@architect/functions/src/tables/old.js", "../../../node_modules/@architect/functions/src/tables/promisify-object.js", "../../../node_modules/@architect/functions/src/tables/factory.js", "../../../node_modules/@architect/functions/src/tables/sandbox.js", "../../../node_modules/@architect/functions/src/tables/index.js", "../../../node_modules/@architect/functions/src/queues/publish-old.js", "../../../node_modules/@architect/functions/src/queues/subscribe.js", "../../../node_modules/@architect/functions/src/queues/publish-sandbox.js", "../../../node_modules/@architect/functions/src/queues/publish-queue.js", "../../../node_modules/@architect/functions/src/queues/publish.js", "../../../node_modules/@architect/functions/src/queues/index.js", "../../../node_modules/@architect/functions/src/events/publish-old.js", "../../../node_modules/@architect/functions/src/events/subscribe.js", "../../../node_modules/@architect/functions/src/events/publish-sandbox.js", "../../../node_modules/@architect/functions/src/events/publish-topic.js", "../../../node_modules/@architect/functions/src/events/publish.js", "../../../node_modules/@architect/functions/src/events/index.js", "../../../node_modules/@architect/functions/src/index.js", "../../../lib/architect/ws/disconnect/index.ts", "../../../lib/tables/index.ts"],
  "sourcesContent": ["// Takes a client cookie string and finds the last _idx key/value\nmodule.exports = function getIdx (cookie = '') {\n  let cookies = cookie\n    .split(';')\n    .map(c => c.trim())\n    .filter(Boolean)\n  let session = cookies.reverse().find(c => c.startsWith('_idx='))\n  return session || ''\n}\n", "/*!\n * cookie\n * Copyright(c) 2012-2014 Roman Shtylman\n * Copyright(c) 2015 Douglas Christopher Wilson\n * MIT Licensed\n */\n\n'use strict';\n\n/**\n * Module exports.\n * @public\n */\n\nexports.parse = parse;\nexports.serialize = serialize;\n\n/**\n * Module variables.\n * @private\n */\n\nvar decode = decodeURIComponent;\nvar encode = encodeURIComponent;\nvar pairSplitRegExp = /; */;\n\n/**\n * RegExp to match field-content in RFC 7230 sec 3.2\n *\n * field-content = field-vchar [ 1*( SP / HTAB ) field-vchar ]\n * field-vchar   = VCHAR / obs-text\n * obs-text      = %x80-FF\n */\n\nvar fieldContentRegExp = /^[\\u0009\\u0020-\\u007e\\u0080-\\u00ff]+$/;\n\n/**\n * Parse a cookie header.\n *\n * Parse the given cookie header string into an object\n * The object has the various cookies as keys(names) => values\n *\n * @param {string} str\n * @param {object} [options]\n * @return {object}\n * @public\n */\n\nfunction parse(str, options) {\n  if (typeof str !== 'string') {\n    throw new TypeError('argument str must be a string');\n  }\n\n  var obj = {}\n  var opt = options || {};\n  var pairs = str.split(pairSplitRegExp);\n  var dec = opt.decode || decode;\n\n  for (var i = 0; i < pairs.length; i++) {\n    var pair = pairs[i];\n    var eq_idx = pair.indexOf('=');\n\n    // skip things that don't look like key=value\n    if (eq_idx < 0) {\n      continue;\n    }\n\n    var key = pair.substr(0, eq_idx).trim()\n    var val = pair.substr(++eq_idx, pair.length).trim();\n\n    // quoted values\n    if ('\"' == val[0]) {\n      val = val.slice(1, -1);\n    }\n\n    // only assign once\n    if (undefined == obj[key]) {\n      obj[key] = tryDecode(val, dec);\n    }\n  }\n\n  return obj;\n}\n\n/**\n * Serialize data into a cookie header.\n *\n * Serialize the a name value pair into a cookie string suitable for\n * http headers. An optional options object specified cookie parameters.\n *\n * serialize('foo', 'bar', { httpOnly: true })\n *   => \"foo=bar; httpOnly\"\n *\n * @param {string} name\n * @param {string} val\n * @param {object} [options]\n * @return {string}\n * @public\n */\n\nfunction serialize(name, val, options) {\n  var opt = options || {};\n  var enc = opt.encode || encode;\n\n  if (typeof enc !== 'function') {\n    throw new TypeError('option encode is invalid');\n  }\n\n  if (!fieldContentRegExp.test(name)) {\n    throw new TypeError('argument name is invalid');\n  }\n\n  var value = enc(val);\n\n  if (value && !fieldContentRegExp.test(value)) {\n    throw new TypeError('argument val is invalid');\n  }\n\n  var str = name + '=' + value;\n\n  if (null != opt.maxAge) {\n    var maxAge = opt.maxAge - 0;\n\n    if (isNaN(maxAge) || !isFinite(maxAge)) {\n      throw new TypeError('option maxAge is invalid')\n    }\n\n    str += '; Max-Age=' + Math.floor(maxAge);\n  }\n\n  if (opt.domain) {\n    if (!fieldContentRegExp.test(opt.domain)) {\n      throw new TypeError('option domain is invalid');\n    }\n\n    str += '; Domain=' + opt.domain;\n  }\n\n  if (opt.path) {\n    if (!fieldContentRegExp.test(opt.path)) {\n      throw new TypeError('option path is invalid');\n    }\n\n    str += '; Path=' + opt.path;\n  }\n\n  if (opt.expires) {\n    if (typeof opt.expires.toUTCString !== 'function') {\n      throw new TypeError('option expires is invalid');\n    }\n\n    str += '; Expires=' + opt.expires.toUTCString();\n  }\n\n  if (opt.httpOnly) {\n    str += '; HttpOnly';\n  }\n\n  if (opt.secure) {\n    str += '; Secure';\n  }\n\n  if (opt.sameSite) {\n    var sameSite = typeof opt.sameSite === 'string'\n      ? opt.sameSite.toLowerCase() : opt.sameSite;\n\n    switch (sameSite) {\n      case true:\n        str += '; SameSite=Strict';\n        break;\n      case 'lax':\n        str += '; SameSite=Lax';\n        break;\n      case 'strict':\n        str += '; SameSite=Strict';\n        break;\n      case 'none':\n        str += '; SameSite=None';\n        break;\n      default:\n        throw new TypeError('option sameSite is invalid');\n    }\n  }\n\n  return str;\n}\n\n/**\n * Try decoding a string using a decoding function.\n *\n * @param {string} str\n * @param {function} decode\n * @private\n */\n\nfunction tryDecode(str, decode) {\n  try {\n    return decode(str);\n  } catch (e) {\n    return str;\n  }\n}\n", "const ERR_MSG = 'Could not extract parameters from DER signature';\r\n\r\nexports.derToConcat = (signature, size) => {\r\n  let offset = 0;\r\n  if (signature[offset++] !== 0x30) throw new Error(ERR_MSG);\r\n  let seqLength = signature[offset++];\r\n  if (seqLength === 0x81) seqLength = signature[offset++];\r\n  if (seqLength > signature.length - offset || signature[offset++] !== 0x02) {\r\n    throw new Error(ERR_MSG);\r\n  }\r\n  let rLength = signature[offset++];\r\n  if (rLength > signature.length - offset - 2 || rLength > size + 1) {\r\n    throw new Error(ERR_MSG);\r\n  }\r\n  let rOffset = offset;\r\n  offset += rLength;\r\n  if (signature[offset++] !== 0x02) throw new Error(ERR_MSG);\r\n  let sLength = signature[offset++];\r\n  if (sLength !== signature.length - offset || sLength > size + 1) {\r\n    throw new Error(ERR_MSG);\r\n  }\r\n  let sOffset = offset;\r\n  offset += sLength;\r\n  if (offset !== signature.length) throw new Error(ERR_MSG);\r\n  let rPadding = size - rLength;\r\n  let sPadding = size - sLength;\r\n  let dst = Buffer.allocUnsafe(rPadding + rLength + sPadding + sLength);\r\n  for (offset = 0; offset < rPadding; offset++) dst[offset] = 0;\r\n  let rPad = Math.max(-rPadding, 0);\r\n  signature.copy(dst, offset, rOffset + rPad, rOffset + rLength);\r\n  offset = size;\r\n  for (let o = offset; offset < o + sPadding; offset++) dst[offset] = 0;\r\n  let sPad = Math.max(-sPadding, 0);\r\n  signature.copy(dst, offset, sOffset + sPad, sOffset + sLength);\r\n  return dst;\r\n}\r\n\r\nexports.concatToDer = (signature, size) => {\r\n  let rPadding = countPadding(signature, 0, size);\r\n  let sPadding = countPadding(signature, size, signature.length);\r\n  let rLength = size - rPadding;\r\n  let sLength = size - sPadding;\r\n  let rsBytes = rLength + sLength + 4;\r\n  let shortLength = rsBytes < 0x80;\r\n  let dst = Buffer.allocUnsafe((shortLength ? 2 : 3) + rsBytes);\r\n  let offset = 0;\r\n  dst[offset++] = 0x30;\r\n  if (shortLength) {\r\n    dst[offset++] = rsBytes;\r\n  } else {\r\n    dst[offset++] = 0x81;\r\n    dst[offset++] = rsBytes & 0xFF;\r\n  }\r\n  dst[offset++] = 0x02;\r\n  dst[offset++] = rLength;\r\n  if (rPadding < 0) {\r\n    dst[offset++] = 0;\r\n    offset += signature.copy(dst, offset, 0, size);\r\n  } else {\r\n    offset += signature.copy(dst, offset, rPadding, size);\r\n  }\r\n  dst[offset++] = 0x02;\r\n  dst[offset++] = sLength;\r\n  if (sPadding < 0) {\r\n    dst[offset++] = 0;\r\n    signature.copy(dst, offset, size);\r\n  } else {\r\n    signature.copy(dst, offset, size + sPadding);\r\n  }\r\n  return dst;\r\n}\r\n\r\nfunction countPadding(buf, start, stop) {\r\n  let padding = 0;\r\n  while (start + padding < stop && buf[start + padding] === 0) padding++;\r\n  let needsSign = buf[start + padding] >= 0x80;\r\n  return needsSign ? --padding : padding;\r\n}\r\n", "exports.buf2b64url = (data) => {\n  return data.toString('base64')\n             .replace(/\\+/g, '-')\n             .replace(/\\//g, '_')\n             .replace(/=/g, '');\n}\n\nfunction responder(error, result, callback) {\n  if (callback) {\n    callback(error, result);\n  } else if (error) {\n    throw error;\n  } else {\n    return result;\n  }\n}\n\nexports.responder = responder;\n\nexports.payloadVerifications = (parsed, cb) => {\n  if (parsed.audList) {\n    if (parsed.payload.aud === undefined) {\n      parsed.error = { message: 'Missing aud claim in payload' };\n      return responder(null, parsed, cb);\n    } else if (!parsed.audList.includes(parsed.payload.aud)) {\n      parsed.error = { message: 'Mismatching aud claim in payload' };\n      return responder(null, parsed, cb);\n    }\n  }\n  if (parsed.issList) {\n    if (parsed.payload.iss === undefined) {\n      parsed.error = { message: 'Missing iss claim in payload' };\n      return responder(null, parsed, cb);\n    } else if (!parsed.issList.includes(parsed.payload.iss)) {\n      parsed.error = { message: 'Mismatching iss claim in payload' };\n      return responder(null, parsed, cb);\n    }\n  }\n  let iat = Number(parsed.payload.iat);\n  if (!iat) {\n    parsed.error = { message: 'Missing or invalid iat claim in payload' };\n    return responder(null, parsed, cb);\n  }\n  let expiration = Number(parsed.payload.exp);\n  if (parsed.lifetime) {\n    let iatExp = iat + parsed.lifetime;\n    if (!expiration || iatExp < expiration) expiration = iatExp;\n  }\n  if (expiration && Date.now() > expiration * 1000) {\n    parsed.expired = expiration;\n    return responder(null, parsed, cb);\n  }\n  parsed.valid = true;\n  return responder(null, parsed, cb);\n}\n", "const crypto = require('crypto');\r\nconst ecdsa = require('./ecdsa.js');\r\nconst { responder, buf2b64url, payloadVerifications } = require('./common.js');\r\n\r\nconst ALG_RE = /^(HS|RS|ES)(256|384|512)$/;\r\n\r\n// ===== JWS GENERATION =======================================================\r\n\r\nexports.generate = (alg, payload, ...rest) => {\r\n  // alg, payload, key[, cb] or alg, payload, keystore, kid[, cb]\r\n  let key;\r\n  let cb;\r\n  let header = { alg: alg };\r\n  if (rest[0].constructor !== Object) {\r\n    key = rest[0];\r\n    cb = typeof rest[1] === 'function' ? rest[1] : undefined;\r\n  } else {\r\n    header.kid = rest[1];\r\n    key = rest[0][rest[1]];\r\n    cb = typeof rest[2] === 'function' ? rest[2] : undefined;\r\n    if (!key) {\r\n      return responder(new TypeError('Invalid key identifier'), null, cb);\r\n    }\r\n  }\r\n  let match = typeof alg === 'string' ? alg.match(ALG_RE) : null;\r\n  if (!match) {\r\n    return responder(new TypeError('Unrecognized algorithm'), null, cb);\r\n  }\r\n  let generateJws;\r\n  if (match[1] === 'HS') {\r\n    generateJws = generateHsJws;\r\n  } else if (match[1] === 'RS') {\r\n    generateJws = generateRsJws;\r\n  } else {\r\n    generateJws = generateEsJws;\r\n  }\r\n  payload.iat = Math.floor(Date.now() / 1000);\r\n  let h = buf2b64url(Buffer.from(JSON.stringify(header)));\r\n  let p = buf2b64url(Buffer.from(JSON.stringify(payload)));\r\n  let token;\r\n  try {\r\n    token = generateJws(`${h}.${p}`, +match[2], key);\r\n  } catch (error) {\r\n    return responder(error, null, cb);\r\n  }\r\n  return responder(null, token, cb);\r\n}\n\n// ===== JWS VERIFICATION =====================================================\n\r\nexports.verify = (parsed, key, cb) => {\r\n  if (parsed.error) return responder(null, parsed, cb);\r\n  if (typeof parsed.header.alg !== 'string') {\r\n    parsed.error = { message: 'Missing or invalid alg claim in header' };\r\n    return responder(null, parsed, cb);\r\n  }\r\n  let match = parsed.header.alg.match(ALG_RE);\r\n  if (!match) {\r\n    parsed.error = { message: `Unrecognized algorithm ${parsed.header.alg}` };\r\n    return responder(null, parsed, cb);\r\n  }\r\n  if (parsed.algList && !parsed.algList.includes(parsed.header.alg)) {\r\n    parsed.error = { message: `Unwanted algorithm ${parsed.header.alg}` };\r\n    return responder(null, parsed, cb);\r\n  }\r\n  let protect = `${parsed.parts[0]}.${parsed.parts[1]}`;\r\n  let verifyJws;\r\n  if (match[1] === 'HS') {\r\n    verifyJws = verifyHsJws;\r\n  } else if (match[1] === 'RS') {\r\n    verifyJws = verifyRsJws;\r\n  } else {\r\n    verifyJws = verifyEsJws;\r\n  }\r\n  let integrity;\r\n  try {\r\n    integrity = verifyJws(protect, parsed.parts[2], +match[2], key);\r\n  } catch (error) {\r\n    parsed.error = { message: `Could not verify integrity. ${error.message}` };\r\n    return responder(null, parsed, cb);\r\n  }\r\n  if (!integrity) {\r\n    parsed.error = { message: 'Integrity check failed' };\r\n    return responder(null, parsed, cb);\r\n  }\r\n  return payloadVerifications(parsed, cb);\r\n}\r\n\r\n// ===== HS256, HS384, HS512 ==================================================\r\n\r\nfunction generateHsJws(protect, bits, key) {\r\n  if (typeof key === 'string') {\r\n    key = Buffer.from(key, 'base64');\r\n  } else if (!(key instanceof Buffer)) {\r\n    throw new TypeError('Key must be a buffer or a base64 string');\r\n  }\r\n  let bytes = bits >> 3;\r\n  if (key.length < bytes) {\r\n    throw new TypeError(`Key length must be at least ${bytes} bytes`);\r\n  }\r\n  let hmac = crypto.createHmac(`SHA${bits}`, key);\r\n  let mac = buf2b64url(hmac.update(protect).digest());\r\n  return `${protect}.${mac}`;\r\n}\r\n\r\nfunction verifyHsJws(protect, mac, bits, key) {\r\n  if (typeof key === 'string') {\r\n    key = Buffer.from(key, 'base64');\r\n  } else if (!(key instanceof Buffer)) {\r\n    throw new TypeError('Key must be a buffer or a base64 string');\r\n  }\r\n  let bytes = bits >> 3;\r\n  if (key.length < bytes) {\r\n    throw new TypeError(`Key length must be at least ${bytes} bytes`);\r\n  }\r\n  let hmac = crypto.createHmac(`SHA${bits}`, key);\r\n  hmac.update(protect);\r\n  return crypto.timingSafeEqual(hmac.digest(), Buffer.from(mac, 'base64'));\r\n}\r\n\r\n// ===== RS256, RS384, RS512 ==================================================\r\n\r\nfunction generateRsJws(protect, bits, key) {\r\n  if (key instanceof Buffer) {\r\n    key = key.toString();\r\n  } else if (typeof key !== 'string') {\r\n    throw new TypeError('Key must be a buffer or a UTF-8 string');\r\n  }\r\n  if (!key.includes('-----BEGIN') || !key.includes('KEY-----')) {\r\n    throw new TypeError('Key must be a PEM formatted RSA private key');\r\n  }\r\n  let signer = crypto.createSign(`SHA${bits}`);\r\n  let signature = buf2b64url(signer.update(protect).sign(key));\r\n  return `${protect}.${signature}`;\r\n}\r\n\r\nfunction verifyRsJws(protect, signature, bits, key) {\r\n  if (key instanceof Buffer) {\r\n    key = key.toString();\r\n  } else if (typeof key !== 'string') {\r\n    throw new TypeError('Key must be a buffer or a UTF-8 string');\r\n  }\r\n  if (!key.includes('-----BEGIN') ||\r\n      !(key.includes('KEY-----') || key.includes('CERTIFICATE-----'))) {\r\n    throw new TypeError('Key must be a PEM formatted RSA public key');\r\n  }\r\n  let verifier = crypto.createVerify(`SHA${bits}`);\r\n  verifier.update(protect);\r\n  return verifier.verify(key, signature, 'base64');\r\n}\r\n\r\n// ===== ES256, ES384, ES512 ==================================================\r\n\r\nfunction generateEsJws(protect, bits, key) {\r\n  if (key instanceof Buffer) {\r\n    key = key.toString();\r\n  } else if (typeof key !== 'string') {\r\n    throw new TypeError('Key must be a buffer or a UTF-8 string');\r\n  }\r\n  if (!key.includes('-----BEGIN') || !key.includes('KEY-----')) {\r\n    throw new TypeError('Key must be a PEM formatted EC private key');\r\n  }\r\n  let signer = crypto.createSign(`SHA${bits}`);\r\n  signer.update(protect);\r\n  let size = 32;\r\n  if (bits === 384) {\r\n    size = 48;\r\n  } else if (bits === 512) {\r\n    size = 66;\r\n  }\r\n  let signature = buf2b64url(ecdsa.derToConcat(signer.sign(key), size));\r\n  return `${protect}.${signature}`;\r\n}\r\n\r\nfunction verifyEsJws(protect, signature, bits, key) {\r\n  if (key instanceof Buffer) {\r\n    key = key.toString();\r\n  } else if (typeof key !== 'string') {\r\n    throw new TypeError('Key must be a buffer or a UTF-8 string');\r\n  }\r\n  if (!key.includes('-----BEGIN') ||\r\n      !(key.includes('KEY-----') || key.includes('CERTIFICATE-----'))) {\r\n    throw new TypeError('Key must be a PEM formatted EC public key');\r\n  }\r\n  signature = Buffer.from(signature, 'base64');\r\n  let size = 32;\r\n  if (bits === 384) {\r\n    size = 48;\r\n  } else if (bits === 512) {\r\n    size = 66;\r\n  }\r\n  if (signature.length !== size << 1) {\r\n    return false;\r\n  }\r\n  let verifier = crypto.createVerify(`SHA${bits}`);\r\n  verifier.update(protect);\r\n  return verifier.verify(key, ecdsa.concatToDer(signature, size));\r\n}\r\n", "const crypto = require('crypto');\r\nconst { responder, buf2b64url, payloadVerifications } = require('./common.js');\r\n\r\nconst ALG_RE = /^(PBES2-HS(256|384|512)\\053)?(RSA-OAEP|dir|A(128|192|256)KW)$/;\r\nconst ENC_RE = /^A(128|192|256)(GCM|CBC-HS(256|384|512))$/;\r\n\r\n// ===== JWE GENERATION =======================================================\r\n\r\nexports.generate = (alg, enc, payload, ...rest) => {\r\n  // alg, enc, payload, key[, cb] or alg, enc, payload, keystore, kid[, cb]\r\n  let key;\r\n  let cb;\r\n  let header = { alg: alg, enc: enc };\r\n  if (rest[0].constructor !== Object) {\r\n    key = rest[0];\r\n    cb = typeof rest[1] === 'function' ? rest[1] : undefined;\r\n  } else {\r\n    header.kid = rest[1];\r\n    key = rest[0][rest[1]];\r\n    cb = typeof rest[2] === 'function' ? rest[2] : undefined;\r\n    if (!key) {\r\n      return responder(new TypeError('Invalid key identifier'), null, cb);\r\n    }\r\n  }\r\n  let aMatch = typeof alg === 'string' ? alg.match(ALG_RE) : null;\r\n  if (!aMatch || (aMatch[2] && +aMatch[2] !== aMatch[4] * 2)) {\r\n    let error = new TypeError('Unrecognized key management algorithm');\r\n    return responder(error, null, cb);\r\n  }\r\n  let eMatch = typeof enc === 'string' ? enc.match(ENC_RE) : null;\r\n  if (!eMatch || (eMatch[3] && +eMatch[3] !== eMatch[1] * 2)) {\r\n    let error = new TypeError('Unrecognized content encryption algorithm');\r\n    return responder(error, null, cb);\r\n  }\r\n  let salt;\r\n  if (aMatch[2]) {\r\n    let p2s = crypto.randomBytes(16);\r\n    header.p2c = 1024;\r\n    header.p2s = buf2b64url(p2s);\r\n    salt = Buffer.concat([Buffer.from(alg), Buffer.from([0]), p2s]);\r\n    if (!cb) {\r\n      let bits = Number(aMatch[2]);\r\n      key = crypto.pbkdf2Sync(key, salt, header.p2c, bits >> 4, `sha${bits}`);\r\n    }\r\n  }\r\n  let aad = buf2b64url(Buffer.from(JSON.stringify(header)));\r\n  if (!aMatch[2] || !cb) {\r\n    return generateJwe(aMatch, eMatch, aad, payload, key, cb);\r\n  }\r\n  let bits = Number(aMatch[2]);\r\n  crypto.pbkdf2(key, salt, header.p2c, bits >> 4, `sha${bits}`, (err, key) => {\r\n    if (err) return cb(err);\r\n    generateJwe(aMatch, eMatch, aad, payload, key, cb);\r\n  });\r\n}\r\n\r\nfunction generateJwe(aMatch, eMatch, aad, payload, key, cb) {\r\n  let cekLen = eMatch[3] ? +eMatch[1] >> 2 : +eMatch[1] >> 3;\r\n  let contEncr = eMatch[3] ? contentEncryptCbc : contentEncryptGcm;\r\n  let cek;\r\n  let cekEnc;\r\n  if (aMatch[0] !== 'dir') {\r\n    cek = crypto.randomBytes(cekLen);\r\n    let keyEncr = aMatch[4] ? aesKeyWrap : rsaOaepEncrypt;\r\n    try {\r\n      cekEnc = keyEncr(cek, key, +aMatch[4]);\r\n    } catch (error) {\r\n      return responder(error, null, cb);\r\n    }\r\n  } else {\r\n    // Key must be directly used for content encryption\r\n    if (typeof key === 'string') {\r\n      key = Buffer.from(key, 'base64');\r\n    } else if (!(key instanceof Buffer)) {\r\n      let error = new TypeError('Key must be a buffer or a base64 string');\r\n      return responder(error, null, cb);\r\n    }\r\n    if (key.length < cekLen) {\r\n      let error = new TypeError(`Key must be at least ${cekLen} bytes`);\r\n      return responder(error, null, cb);\r\n    }\r\n    cek = key.slice(0, cekLen);\r\n    cekEnc = '';\r\n  }\r\n  payload.iat = Math.floor(Date.now() / 1000);\r\n  let token = contEncr(aad, cek, cekEnc, JSON.stringify(payload), +eMatch[1]);\r\n  return responder(null, token, cb);\r\n}\r\n\r\n// ===== JWE VERIFICATION =====================================================\r\n\r\nexports.verify = (parsed, key, cb) => {\r\n  if (parsed.error) return responder(null, parsed, cb);\r\n  if (typeof parsed.header.alg !== 'string') {\r\n    parsed.error = { message: 'Missing or invalid alg claim in header' };\r\n    return responder(null, parsed, cb);\r\n  }\r\n  if (typeof parsed.header.enc !== 'string') {\r\n    parsed.error = { message: 'Missing or invalid enc claim in header' };\r\n    return responder(null, parsed, cb);\r\n  }\r\n  let aMatch = parsed.header.alg.match(ALG_RE);\r\n  if (!aMatch || (aMatch[2] && +aMatch[2] !== aMatch[4] * 2)) {\r\n    parsed.error = {\r\n      message: `Unrecognized key management algorithm ${parsed.header.alg}`\r\n    };\r\n    return responder(null, parsed, cb);\r\n  }\r\n  if (parsed.algList && !parsed.algList.includes(parsed.header.alg)) {\r\n    parsed.error = {\r\n      message: `Unwanted key management algorithm ${parsed.header.alg}`\r\n    };\r\n    return responder(null, parsed, cb);\r\n  }\r\n  let eMatch = parsed.header.enc.match(ENC_RE);\r\n  if (!eMatch || (eMatch[3] && +eMatch[3] !== eMatch[1] * 2)) {\r\n    parsed.error = {\r\n      message: `Unrecognized content encryption algorithm ${parsed.header.enc}`\r\n    };\r\n    return responder(null, parsed, cb);\r\n  }\r\n  if (parsed.encList && !parsed.encList.includes(parsed.header.enc)) {\r\n    parsed.error = {\r\n      message: `Unwanted content encryption algorithm ${parsed.header.enc}`\r\n    };\r\n    return responder(null, parsed, cb);\r\n  }\r\n  let salt;\r\n  let iter;\r\n  if (aMatch[2]) {\r\n    iter = parsed.header.p2c;\r\n    if (!Number.isInteger(iter) || iter < 1 || iter > 16384) {\r\n      parsed.error = { message: 'Missing or invalid p2c claim in header' };\r\n      return responder(null, parsed, cb);\r\n    } else if (!cb && iter > 1024) {\r\n      parsed.error = { message: 'p2c value too large for synchronous mode' };\r\n      return responder(null, parsed, cb);\r\n    }\r\n    if (typeof parsed.header.p2s !== 'string') {\r\n      parsed.error = { message: 'Missing or invalid p2s claim in header' };\r\n      return responder(null, parsed, cb);\r\n    }\r\n    let p2s = Buffer.from(parsed.header.p2s, 'base64');\r\n    let alg = parsed.header.alg;\r\n    salt = Buffer.concat([Buffer.from(alg), Buffer.from([0]), p2s]);\r\n    if (!cb) {\r\n      let bits = Number(aMatch[2]);\r\n      key = crypto.pbkdf2Sync(key, salt, iter, bits >> 4, `sha${bits}`);\r\n    }\r\n  }\r\n  if (!aMatch[2] || !cb) {\r\n    return decryptJwe(parsed, aMatch, eMatch, key, cb);\r\n  }\r\n  let bits = Number(aMatch[2]);\r\n  crypto.pbkdf2(key, salt, iter, bits >> 4, `sha${bits}`, (error, key) => {\r\n    if (error) return cb(error);\r\n    decryptJwe(parsed, aMatch, eMatch, key, cb);\r\n  });\r\n}\r\n\r\nfunction decryptJwe(parsed, aMatch, eMatch, key, cb) {\r\n  let aad = Buffer.from(parsed.parts[0]);\r\n  let cekEnc = Buffer.from(parsed.parts[1], 'base64');\r\n  let iv = Buffer.from(parsed.parts[2], 'base64');\r\n  let content = Buffer.from(parsed.parts[3], 'base64');\r\n  let tag = Buffer.from(parsed.parts[4], 'base64');\r\n  let cekLen = eMatch[3] ? +eMatch[1] >> 2 : +eMatch[1] >> 3;\r\n  let contDecr = eMatch[3] ? contentDecryptCbc : contentDecryptGcm;\r\n  let cek;\r\n  if (aMatch[0] !== 'dir') {\r\n    let keyDecr = aMatch[4] ? aesKeyUnwrap : rsaOaepDecrypt;\r\n    try {\r\n      cek = keyDecr(cekEnc, key, +aMatch[4]);\r\n    } catch (error) {\r\n      parsed.error = { message: `Could not decrypt token. ${error.message}` };\r\n      return responder(null, parsed, cb);\r\n    }\r\n  } else {\r\n    // Key must be directly used for content decryption\r\n    if (typeof key === 'string') {\r\n      key = Buffer.from(key, 'base64');\r\n    } else if (!(key instanceof Buffer)) {\r\n      parsed.error = { message: 'Invalid key' };\r\n      return responder(null, parsed, cb);\r\n    }\r\n    if (key.length < cekLen) {\r\n      parsed.error = {\r\n        message: `Invalid key length. Must be at least ${cekLen} bytes`\r\n      };\r\n      return responder(null, parsed, cb);\r\n    }\r\n    cek = key.slice(0, cekLen);\r\n  }\r\n  let plain;\r\n  try {\r\n    plain = contDecr(content, aad, tag, cek, iv, +eMatch[1]);\r\n  } catch (error) {\r\n    parsed.error = { message: `Could not decrypt token. ${error.message}` };\r\n    return responder(null, parsed, cb);\r\n  }\r\n  try {\r\n    parsed.payload = JSON.parse(plain);\r\n  } catch (error) {\r\n    parsed.error = { message: `Non parsable payload. ${error.message}` };\r\n    return responder(null, parsed, cb);\r\n  }\r\n  return payloadVerifications(parsed, cb);\r\n}\r\n\r\n// ===== A128GCM, A192GCM, A256GCM ============================================\r\n\r\nfunction contentEncryptGcm(aad, cek, cekEnc, plain, bits) {\r\n  let iv = crypto.randomBytes(12);\r\n  let cipher = crypto.createCipheriv(`id-aes${bits}-GCM`, cek, iv);\r\n  cipher.setAutoPadding(false);\r\n  cipher.setAAD(Buffer.from(aad));\r\n  let enc = buf2b64url(Buffer.concat([cipher.update(plain), cipher.final()]));\r\n  let tag = buf2b64url(cipher.getAuthTag());\r\n  return `${aad}.${cekEnc}.${buf2b64url(iv)}.${enc}.${tag}`;\r\n}\r\n\r\nfunction contentDecryptGcm(content, aad, tag, cek, iv, bits) {\r\n  let decipher = crypto.createDecipheriv(`id-aes${bits}-GCM`, cek, iv);\r\n  decipher.setAutoPadding(false);\r\n  decipher.setAAD(aad);\r\n  decipher.setAuthTag(tag);\r\n  return Buffer.concat([decipher.update(content), decipher.final()]);\r\n}\r\n\r\n// ===== A128CBC-HS256, A192CBC-HS384, A256CBC-HS512 ==========================\r\n\r\nfunction contentEncryptCbc(aad, cek, cekEnc, plain, bits) {\r\n  let iv = crypto.randomBytes(16);\r\n  let bytes = bits >> 3;\r\n  let cipher = crypto.createCipheriv(`AES-${bits}-CBC`, cek.slice(bytes), iv);\r\n  let enc = Buffer.concat([cipher.update(plain), cipher.final()]);\r\n  let len = aad.length << 3;\r\n  let al = Buffer.from(`000000000000000${len.toString(16)}`.slice(-16), 'hex');\r\n  let hmac = crypto.createHmac(`SHA${bits << 1}`, cek.slice(0, bytes));\r\n  hmac.update(Buffer.from(aad)).update(iv).update(enc).update(al);\r\n  let tag = buf2b64url(hmac.digest().slice(0, bytes));\r\n  return `${aad}.${cekEnc}.${buf2b64url(iv)}.${buf2b64url(enc)}.${tag}`;\r\n}\r\n\r\nfunction contentDecryptCbc(content, aad, tag, cek, iv, bits) {\r\n  let bytes = bits >> 3;\r\n  let len = aad.length << 3;\r\n  let al = Buffer.from(`000000000000000${len.toString(16)}`.slice(-16), 'hex');\r\n  let hmac = crypto.createHmac(`SHA${bits << 1}`, cek.slice(0, bytes));\r\n  hmac.update(aad).update(iv).update(content).update(al);\r\n  if (!crypto.timingSafeEqual(hmac.digest().slice(0, bytes), tag)) {\r\n    throw new Error('Authentication of encrypted data failed');\r\n  }\r\n  let encKey = cek.slice(bytes);\r\n  let decipher = crypto.createDecipheriv(`AES-${bits}-CBC`, encKey, iv);\r\n  return Buffer.concat([decipher.update(content), decipher.final()]);\r\n}\r\n\r\n// ===== RSA-OAEP =============================================================\r\n\r\nfunction rsaOaepEncrypt(cek, key) {\r\n  if (key instanceof Buffer) {\r\n    key = key.toString();\r\n  } else if (typeof key !== 'string') {\r\n    throw new TypeError('Key must be a buffer or a string');\r\n  }\r\n  if (!key.includes('-----BEGIN') ||\r\n      !(key.includes('KEY-----') || key.includes('CERTIFICATE-----'))) {\r\n    throw new TypeError('Key must be a PEM formatted RSA public key');\r\n  }\r\n  let options = {key: key, padding: crypto.constants.RSA_PKCS1_OAEP_PADDING};\r\n  return buf2b64url(crypto.publicEncrypt(options, cek));\r\n}\r\n\r\nfunction rsaOaepDecrypt(cekEnc, key) {\r\n  if (key instanceof Buffer) {\r\n    key = key.toString();\r\n  }\r\n  if (typeof key !== 'string' ||\r\n      !key.includes('-----BEGIN') || !key.includes('KEY-----')) {\r\n    throw new TypeError('Key must be a PEM formatted RSA private key');\r\n  }\r\n  let options = {key: key, padding: crypto.constants.RSA_PKCS1_OAEP_PADDING};\r\n  return crypto.privateDecrypt(options, cekEnc);\r\n}\r\n\r\n// ===== A128KW, A192KW, A256KW ===============================================\r\n\r\nfunction aesKeyWrap(cek, key, bits) {\r\n  let bytes = bits >> 3;\r\n  if (typeof key === 'string') {\r\n    key = Buffer.from(key, 'base64');\r\n  } else if (!(key instanceof Buffer)) {\r\n    throw new TypeError('Key must be a buffer or a base64-encoded string');\r\n  }\r\n  if (key.length < bytes) {\r\n    throw new TypeError(`Key length must be at least ${bytes} bytes`);\r\n  }\r\n  key = key.slice(0, bytes);\r\n  let r = [];\r\n  for (let i = 0; i < cek.length; i += 8) {\r\n    r.push(cek.slice(i, i + 8));\r\n  }\r\n  let iv = Buffer.alloc(16);\r\n  let a = Buffer.from('A6A6A6A6A6A6A6A6', 'hex');\r\n  let count = 1;\r\n  for (let j = 0; j < 6; j++) {\r\n    for (let i = 0; i < r.length; i++) {\r\n      let cipher = crypto.createCipheriv(`AES${bits}`, key, iv);\r\n      let c = `000000000000000${count.toString(16)}`.slice(-16);\r\n      let b = cipher.update(Buffer.concat([a, r[i]]));\r\n      a = Buffer.from(c, 'hex');\r\n      for (let n = 0; n < 8; n++) {\r\n        a[n] ^= b[n];\r\n      }\r\n      r[i] = b.slice(8, 16);\r\n      count++;\r\n    }\r\n  }\r\n  return buf2b64url(Buffer.concat([a].concat(r)));\r\n}\r\n\r\nfunction aesKeyUnwrap(cekEnc, key, bits) {\r\n  let bytes = bits >> 3;\r\n  if (typeof key === 'string') {\r\n    key = Buffer.from(key, 'base64');\r\n  } else if (!(key instanceof Buffer)) {\r\n    throw new TypeError('Key must be a buffer or a base64 string');\r\n  }\r\n  if (key.length < bytes) {\r\n    throw new TypeError(`Key must be at least ${bytes} bytes`);\r\n  }\r\n  key = key.slice(0, bytes);\r\n  let a = cekEnc.slice(0, 8);\r\n  let r = [];\r\n  for (let i = 8; i < cekEnc.length; i += 8) {\r\n    r.push(cekEnc.slice(i, i + 8));\r\n  }\r\n  let z = Buffer.alloc(16);\r\n  let count = 6 * r.length;\r\n  for (let j = 5; j >= 0 ; j--) {\r\n    for (let i = r.length - 1; i >= 0; i--) {\r\n      let c = `000000000000000${count.toString(16)}`.slice(-16);\r\n      c = Buffer.from(c, 'hex');\r\n      for (let n = 0; n < 8; n++) {\r\n        a[n] ^= c[n];\r\n      }\r\n      let decipher = crypto.createDecipheriv(`AES${bits}`, key, z);\r\n      let b = decipher.update(Buffer.concat([a, r[i], z]));\r\n      a = b.slice(0, 8);\r\n      r[i] = b.slice(8, 16);\r\n      count--;\r\n    }\r\n  }\r\n  if (!a.equals(Buffer.from('A6A6A6A6A6A6A6A6', 'hex'))) {\r\n    throw new Error('Key unwrapping failed');\r\n  }\r\n  return Buffer.concat(r);\r\n}\r\n", "const jws = require('./lib/jws.js');\r\nconst jwe = require('./lib/jwe.js');\r\nconst { responder } = require('./lib/common.js');\r\n\r\n// ===== TOKEN GENERATION =====================================================\r\n\r\nexports.generate = (alg, ...rest) => {\r\n  // alg, payload, key[, cb] or alg, payload, keystore, kid[, cb]\r\n  if (rest[0].constructor === Object) return jws.generate(alg, ...rest);\r\n  // alg, enc, payload, key[, cb] or alg, enc, payload, keystore, kid[, cb]\r\n  if (rest[1].constructor === Object) return jwe.generate(alg, ...rest);\r\n  // There is no payload object where expected\r\n  let idx = rest.length - 1;\r\n  if (idx > 1 && idx < 5 && typeof rest[idx] === 'function') {\r\n    rest[idx](error);\r\n  } else {\r\n    throw error;\r\n  }\r\n}\r\n\r\n// ===== TOKEN PARSING ========================================================\r\n\r\nexports.parse = (token) => new ParsedToken(token);\r\n\r\nfunction ParsedToken(token) {\r\n  this.parts = typeof token === 'string' ? token.split('.') : [];\r\n  if (this.parts.length === 3) {\r\n    this.type = 'JWS';\r\n  } else if (this.parts.length === 5) {\r\n    this.type = 'JWE';\r\n  } else {\r\n    this.error = { message: 'Invalid token' };\r\n    return;\r\n  }\r\n  try {\r\n    this.header = JSON.parse(Buffer.from(this.parts[0], 'base64'));\r\n  } catch (error) {\r\n    this.error = { message: `Non parsable header. ${error.message}` };\r\n    return;\r\n  }\r\n  if (this.type === 'JWS') {\r\n    // Parsing exposes payload for JWS only; for JWE happens at verify\r\n    try {\r\n      this.payload = JSON.parse(Buffer.from(this.parts[1], 'base64'));\r\n    } catch (error) {\r\n      this.error = { message: `Non parsable payload. ${error.message}` };\r\n    }\r\n  }\r\n}\r\n\r\n// ===== POST-PARSING UTLITIES ================================================\r\n\r\nParsedToken.prototype.setAlgorithmList = function(algList, encList) {\r\n  // algList is ignored if not string or array of strings\r\n  if (typeof algList === 'string') {\r\n    this.algList = [algList];\r\n  } else if (Array.isArray(algList)) {\r\n    this.algList = algList;\r\n  }\r\n  // encList is ignored if not string or array of strings\r\n  if (typeof encList === 'string') {\r\n    this.encList = [encList];\r\n  } else if (Array.isArray(encList)) {\r\n    this.encList = encList;\r\n  }\r\n  return this;\r\n}\r\n\r\nParsedToken.prototype.setTokenLifetime = function(lifetime) {\r\n  // lifetime is ignored if not integer greater than 0\r\n  if (Number.isInteger(lifetime) && lifetime > 0) this.lifetime = lifetime;\r\n  return this;\r\n}\r\n\r\nParsedToken.prototype.setAudience = function(audList) {\r\n  // audList is ignored if not string or array of strings\r\n  if (typeof audList === 'string') {\r\n    this.audList = [audList];\r\n  } else if (Array.isArray(audList)) {\r\n    this.audList = audList;\r\n  }\r\n  return this;\r\n}\r\n\r\nParsedToken.prototype.setIssuer = function(issList) {\r\n  // issList is ignored if not string or array of strings\r\n  if (typeof issList === 'string') {\r\n    this.issList = [issList];\r\n  } else if (Array.isArray(issList)) {\r\n    this.issList = issList;\r\n  }\r\n  return this;\r\n}\r\n\r\n// ===== TOKEN VERIFICATION ===================================================\r\n\r\nParsedToken.prototype.verify = function(p0, cb) {\r\n  // key[, cb] or keystore[, cb]\r\n  cb = typeof cb === 'function' ? cb : undefined;\r\n  if (this.error) return responder(null, this, cb);\r\n  let key;\r\n  if (p0.constructor !== Object) {\r\n    key = p0;\r\n  } else if (this.header.kid === undefined) {\r\n    // Cannot extract key from keystore\r\n    this.error = { message: 'Missing kid claim in header' };\r\n    return responder(null, this, cb);\r\n  } else if (p0[this.header.kid] === undefined) {\r\n    // Key not found in keystore\r\n    this.error = { message: 'Key with id not found', kid: this.header.kid };\r\n    return responder(null, this, cb);\r\n  } else {\r\n    key = p0[this.header.kid];\r\n  }\r\n  let verify = this.type === 'JWS' ? jws.verify : jwe.verify;\r\n  return verify(this, key, cb);\r\n}\r\n", "let getIdx = require('./_get-idx')\nlet cookie = require('cookie')\nlet jwt = require('node-webtokens')\nlet alg = 'dir'\nlet enc = 'A128GCM'\n\n// 128bit key size\nlet fallback = Buffer.from('1234567890123456').toString('base64')\n\n// need to STRONGLY encourage setting ARC_APP_SECRET in the docs\nlet key = process.env.ARC_APP_SECRET || fallback\n\n// wrapper for jwe.create/jwe.parse\nlet jwe = {\n  create (payload) {\n    return jwt.generate(alg, enc, payload, key)\n  },\n  parse (token) {\n    const WEEK = 604800\n    return jwt.parse(token).setTokenLifetime(WEEK).verify(key)\n  }\n}\n\n/**\n * reads req cookie and returns token payload or an empty object\n */\nfunction read (req, callback) {\n  let promise\n  if (!callback) {\n    promise = new Promise(function argh (res, rej) {\n      callback = function errback (err, result) {\n        err ? rej(err) : res(result)\n      }\n    })\n  }\n  let rawCookie = req.headers && (req.headers.cookie || req.headers.Cookie)\n  // Lambda payload version 2 puts the cookies in an array on the request\n  if (!rawCookie && req.cookies) {\n    rawCookie = req.cookies.join(';')\n  }\n\n  let idx = getIdx(rawCookie)\n  let sesh = cookie.parse(idx)._idx\n  let token = jwe.parse(sesh)\n  callback(null, token.valid ? token.payload : {})\n  return promise\n}\n\n/**\n * creates a Set-Cookie header with token payload encrypted\n */\nfunction write (payload, callback) {\n  let promise\n  if (!callback) {\n    promise = new Promise(function ugh (res, rej) {\n      callback = function errback (err, result) {\n        err ? rej(err) : res(result)\n      }\n    })\n  }\n  let key = '_idx'\n  let val = jwe.create(payload)\n  let maxAge = process.env.SESSION_TTL || 7.884e+8\n  let sameSite = process.env.ARC_SESSION_SAME_SITE || 'lax'\n  let options = {\n    maxAge,\n    expires: new Date(Date.now() + maxAge * 1000),\n    secure: true,\n    httpOnly: true,\n    path: '/',\n    sameSite,\n  }\n  if (process.env.SESSION_DOMAIN) {\n    options.domain = process.env.SESSION_DOMAIN\n  }\n  if (process.env.NODE_ENV === 'testing') {\n    delete options.secure\n  }\n  callback(null, cookie.serialize(key, val, options))\n  return promise\n}\n\nmodule.exports = { read, write }\n", "/**\n * Module dependencies.\n */\n\nvar crypto = require('crypto');\n\n/**\n * Sign the given `val` with `secret`.\n *\n * @param {String} val\n * @param {String} secret\n * @return {String}\n * @api private\n */\n\nexports.sign = function(val, secret){\n  if ('string' != typeof val) throw new TypeError(\"Cookie value must be provided as a string.\");\n  if ('string' != typeof secret) throw new TypeError(\"Secret string must be provided.\");\n  return val + '.' + crypto\n    .createHmac('sha256', secret)\n    .update(val)\n    .digest('base64')\n    .replace(/\\=+$/, '');\n};\n\n/**\n * Unsign and decode the given `val` with `secret`,\n * returning `false` if the signature is invalid.\n *\n * @param {String} val\n * @param {String} secret\n * @return {String|Boolean}\n * @api private\n */\n\nexports.unsign = function(val, secret){\n  if ('string' != typeof val) throw new TypeError(\"Signed cookie string must be provided.\");\n  if ('string' != typeof secret) throw new TypeError(\"Secret string must be provided.\");\n  var str = val.slice(0, val.lastIndexOf('.'))\n    , mac = exports.sign(str, secret)\n    , macBuffer = Buffer.from(mac)\n    , valBuffer = Buffer.alloc(macBuffer.length);\n\n  valBuffer.write(val);\n  return crypto.timingSafeEqual(macBuffer, valBuffer) ? str : false;\n};\n", "let aws = require('aws-sdk')\nlet https = require('https')\n\n/**\n * Instantiates Dynamo service interfaces\n * - Internal APIs should use `db` + `doc` to instantiate DynamoDB interfaces\n * - Avoid using `direct.db` + `direct.doc`: as it's an issue vector for using Functions in certain test harnesses!\n */\nfunction getDynamo (type, callback) {\n  if (!type) throw ReferenceError('Must supply Dynamo service interface type')\n\n  let testing = process.env.NODE_ENV === 'testing'\n  let arcLocal = process.env.ARC_LOCAL\n  let port = process.env.ARC_TABLES_PORT || 5000\n  let local = {\n    endpoint: new aws.Endpoint(`http://localhost:${port}`),\n    region: process.env.AWS_REGION || 'us-west-2' // Do not assume region is set!\n  }\n  let DB = aws.DynamoDB\n  let Doc = aws.DynamoDB.DocumentClient\n  let dynamo // Assigned below\n\n  /**\n   * This module may be loaded by @arc/arc via repl\n   * - The `direct` interfaces will instantiate before NODE_ENV is set\n   * - Thus, unlike most other scenarios, don't assume the presence of NODE_ENV\n   * - Also: some test harnesses (ahem) will automatically populate NODE_ENV with their own values, unbidden\n   * - *Why this matters*: using https.Agent (and not http.Agent) will stall the Sandbox\n   */\n  if (!testing && !arcLocal) {\n    let agent = new https.Agent({\n      keepAlive: true,\n      maxSockets: 50, // Node can set to Infinity; AWS maxes at 50; check back on this every once in a while\n      rejectUnauthorized: true,\n    })\n    aws.config.update({\n      httpOptions: { agent }\n    })\n    // TODO? migrate to using `AWS_NODEJS_CONNECTION_REUSE_ENABLED`?\n  }\n\n  if (type === 'db') {\n    dynamo = testing\n      ? new DB(local)\n      : new DB\n  }\n\n  if (type === 'doc') {\n    dynamo = testing\n      ? new Doc(local)\n      : new Doc\n  }\n\n  if (type === 'session') {\n    // if SESSION_TABLE_NAME isn't defined we mock the client and just pass session thru\n    let passthru = !process.env.SESSION_TABLE_NAME\n    let mock = {\n      get (params, callback) {\n        callback()\n      },\n      put (params, callback) {\n        callback()\n      }\n    }\n    dynamo = testing\n      ? new Doc(local)\n      : (passthru ? mock : new Doc)\n  }\n\n  if (!callback) return dynamo\n  else callback(null, dynamo)\n}\n\nmodule.exports = {\n  db: getDynamo.bind({}, 'db'),\n  doc: getDynamo.bind({}, 'doc'),\n  session: getDynamo.bind({}, 'session'),\n  direct: {\n    db: getDynamo('db'),\n    doc: getDynamo('doc')\n  }\n}\n", "/*!\n * random-bytes\n * Copyright(c) 2016 Douglas Christopher Wilson\n * MIT Licensed\n */\n\n'use strict'\n\n/**\n * Module dependencies.\n * @private\n */\n\nvar crypto = require('crypto')\n\n/**\n * Module variables.\n * @private\n */\n\nvar generateAttempts = crypto.randomBytes === crypto.pseudoRandomBytes ? 1 : 3\n\n/**\n * Module exports.\n * @public\n */\n\nmodule.exports = randomBytes\nmodule.exports.sync = randomBytesSync\n\n/**\n * Generates strong pseudo-random bytes.\n *\n * @param {number} size\n * @param {function} [callback]\n * @return {Promise}\n * @public\n */\n\nfunction randomBytes(size, callback) {\n  // validate callback is a function, if provided\n  if (callback !== undefined && typeof callback !== 'function') {\n    throw new TypeError('argument callback must be a function')\n  }\n\n  // require the callback without promises\n  if (!callback && !global.Promise) {\n    throw new TypeError('argument callback is required')\n  }\n\n  if (callback) {\n    // classic callback style\n    return generateRandomBytes(size, generateAttempts, callback)\n  }\n\n  return new Promise(function executor(resolve, reject) {\n    generateRandomBytes(size, generateAttempts, function onRandomBytes(err, str) {\n      if (err) return reject(err)\n      resolve(str)\n    })\n  })\n}\n\n/**\n * Generates strong pseudo-random bytes sync.\n *\n * @param {number} size\n * @return {Buffer}\n * @public\n */\n\nfunction randomBytesSync(size) {\n  var err = null\n\n  for (var i = 0; i < generateAttempts; i++) {\n    try {\n      return crypto.randomBytes(size)\n    } catch (e) {\n      err = e\n    }\n  }\n\n  throw err\n}\n\n/**\n * Generates strong pseudo-random bytes.\n *\n * @param {number} size\n * @param {number} attempts\n * @param {function} callback\n * @private\n */\n\nfunction generateRandomBytes(size, attempts, callback) {\n  crypto.randomBytes(size, function onRandomBytes(err, buf) {\n    if (!err) return callback(null, buf)\n    if (!--attempts) return callback(err)\n    setTimeout(generateRandomBytes.bind(null, size, attempts, callback), 10)\n  })\n}\n", "/*!\n * uid-safe\n * Copyright(c) 2014 Jonathan Ong\n * Copyright(c) 2015-2017 Douglas Christopher Wilson\n * MIT Licensed\n */\n\n'use strict'\n\n/**\n * Module dependencies.\n * @private\n */\n\nvar randomBytes = require('random-bytes')\n\n/**\n * Module variables.\n * @private\n */\n\nvar EQUAL_END_REGEXP = /=+$/\nvar PLUS_GLOBAL_REGEXP = /\\+/g\nvar SLASH_GLOBAL_REGEXP = /\\//g\n\n/**\n * Module exports.\n * @public\n */\n\nmodule.exports = uid\nmodule.exports.sync = uidSync\n\n/**\n * Create a unique ID.\n *\n * @param {number} length\n * @param {function} [callback]\n * @return {Promise}\n * @public\n */\n\nfunction uid (length, callback) {\n  // validate callback is a function, if provided\n  if (callback !== undefined && typeof callback !== 'function') {\n    throw new TypeError('argument callback must be a function')\n  }\n\n  // require the callback without promises\n  if (!callback && !global.Promise) {\n    throw new TypeError('argument callback is required')\n  }\n\n  if (callback) {\n    // classic callback style\n    return generateUid(length, callback)\n  }\n\n  return new Promise(function executor (resolve, reject) {\n    generateUid(length, function onUid (err, str) {\n      if (err) return reject(err)\n      resolve(str)\n    })\n  })\n}\n\n/**\n * Create a unique ID sync.\n *\n * @param {number} length\n * @return {string}\n * @public\n */\n\nfunction uidSync (length) {\n  return toString(randomBytes.sync(length))\n}\n\n/**\n * Generate a unique ID string.\n *\n * @param {number} length\n * @param {function} callback\n * @private\n */\n\nfunction generateUid (length, callback) {\n  randomBytes(length, function (err, buf) {\n    if (err) return callback(err)\n    callback(null, toString(buf))\n  })\n}\n\n/**\n * Change a Buffer into a string.\n *\n * @param {Buffer} buf\n * @return {string}\n * @private\n */\n\nfunction toString (buf) {\n  return buf.toString('base64')\n    .replace(EQUAL_END_REGEXP, '')\n    .replace(PLUS_GLOBAL_REGEXP, '-')\n    .replace(SLASH_GLOBAL_REGEXP, '_')\n}\n", "// epoch + one week IN SECONDS\n// - Date.now() returns ms\n// - DynamoDB TTL is in seconds\nmodule.exports = function _weekFromNow () {\n  return (Date.now() / 1000) + 604800\n}\n", "\nvar assert = require('assert')\n\nvar base62 = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789'\nvar base36 = 'abcdefghijklmnopqrstuvwxyz0123456789'\nvar base10 = '0123456789'\n\nexports = module.exports = create(base62)\nexports.base62 = exports\nexports.base36 = create(base36)\nexports.base10 = create(base10)\n\nexports.create = create\n\nfunction create(chars) {\n  assert(typeof chars === 'string', 'the list of characters must be a string!')\n  var length = Buffer.byteLength(chars)\n  return function rndm(len) {\n    len = len || 10\n    assert(typeof len === 'number' && len >= 0, 'the length of the random string must be a number!')\n    var salt = ''\n    for (var i = 0; i < len; i++) salt += chars[Math.floor(length * Math.random())]\n    return salt\n  }\n}\n", "'use strict';\r\n\r\n// Implements Brad Hill's Double HMAC pattern from\r\n// https://www.nccgroup.trust/us/about-us/newsroom-and-events/blog/2011/february/double-hmac-verification/.\r\n// The approach is similar to the node's native implementation of timing safe buffer comparison that will be available on v6+.\r\n// https://github.com/nodejs/node/issues/3043\r\n// https://github.com/nodejs/node/pull/3073\r\n\r\nvar crypto = require('crypto');\r\n\r\nfunction bufferEqual(a, b) {\r\n  if (a.length !== b.length) {\r\n    return false;\r\n  }\r\n  // `crypto.timingSafeEqual` was introduced in Node v6.6.0\r\n  // <https://github.com/jshttp/basic-auth/issues/39>\r\n  if (crypto.timingSafeEqual) {\r\n    return crypto.timingSafeEqual(a, b);\r\n  }\r\n  for (var i = 0; i < a.length; i++) {\r\n    if (a[i] !== b[i]) {\r\n      return false;\r\n    }\r\n  }\r\n  return true;\r\n}\r\n\r\nfunction timeSafeCompare(a, b) {\r\n  var sa = String(a);\r\n  var sb = String(b);\r\n  var key = crypto.pseudoRandomBytes(32);\r\n  var ah = crypto.createHmac('sha256', key).update(sa).digest();\r\n  var bh = crypto.createHmac('sha256', key).update(sb).digest();\r\n\r\n  return bufferEqual(ah, bh) && a === b;\r\n}\r\n\r\nmodule.exports = timeSafeCompare;\r\n", "/*!\n * csrf\n * Copyright(c) 2014 Jonathan Ong\n * Copyright(c) 2015 Douglas Christopher Wilson\n * MIT Licensed\n */\n\n'use strict'\n\n/**\n * Module dependencies.\n * @private\n */\n\nvar rndm = require('rndm')\nvar uid = require('uid-safe')\nvar compare = require('tsscmp')\nvar crypto = require('crypto')\n\n/**\n * Module variables.\n * @private\n */\n\nvar EQUAL_GLOBAL_REGEXP = /=/g\nvar PLUS_GLOBAL_REGEXP = /\\+/g\nvar SLASH_GLOBAL_REGEXP = /\\//g\n\n/**\n * Module exports.\n * @public\n */\n\nmodule.exports = Tokens\n\n/**\n * Token generation/verification class.\n *\n * @param {object} [options]\n * @param {number} [options.saltLength=8] The string length of the salt\n * @param {number} [options.secretLength=18] The byte length of the secret key\n * @public\n */\n\nfunction Tokens (options) {\n  if (!(this instanceof Tokens)) {\n    return new Tokens(options)\n  }\n\n  var opts = options || {}\n\n  var saltLength = opts.saltLength !== undefined\n    ? opts.saltLength\n    : 8\n\n  if (typeof saltLength !== 'number' || !isFinite(saltLength) || saltLength < 1) {\n    throw new TypeError('option saltLength must be finite number > 1')\n  }\n\n  var secretLength = opts.secretLength !== undefined\n    ? opts.secretLength\n    : 18\n\n  if (typeof secretLength !== 'number' || !isFinite(secretLength) || secretLength < 1) {\n    throw new TypeError('option secretLength must be finite number > 1')\n  }\n\n  this.saltLength = saltLength\n  this.secretLength = secretLength\n}\n\n/**\n * Create a new CSRF token.\n *\n * @param {string} secret The secret for the token.\n * @public\n */\n\nTokens.prototype.create = function create (secret) {\n  if (!secret || typeof secret !== 'string') {\n    throw new TypeError('argument secret is required')\n  }\n\n  return this._tokenize(secret, rndm(this.saltLength))\n}\n\n/**\n * Create a new secret key.\n *\n * @param {function} [callback]\n * @public\n */\n\nTokens.prototype.secret = function secret (callback) {\n  return uid(this.secretLength, callback)\n}\n\n/**\n * Create a new secret key synchronously.\n * @public\n */\n\nTokens.prototype.secretSync = function secretSync () {\n  return uid.sync(this.secretLength)\n}\n\n/**\n * Tokenize a secret and salt.\n * @private\n */\n\nTokens.prototype._tokenize = function tokenize (secret, salt) {\n  return salt + '-' + hash(salt + '-' + secret)\n}\n\n/**\n * Verify if a given token is valid for a given secret.\n *\n * @param {string} secret\n * @param {string} token\n * @public\n */\n\nTokens.prototype.verify = function verify (secret, token) {\n  if (!secret || typeof secret !== 'string') {\n    return false\n  }\n\n  if (!token || typeof token !== 'string') {\n    return false\n  }\n\n  var index = token.indexOf('-')\n\n  if (index === -1) {\n    return false\n  }\n\n  var salt = token.substr(0, index)\n  var expected = this._tokenize(secret, salt)\n\n  return compare(token, expected)\n}\n\n/**\n * Hash a string with SHA1, returning url-safe base64\n * @param {string} str\n * @private\n */\n\nfunction hash (str) {\n  return crypto\n    .createHash('sha1')\n    .update(str, 'ascii')\n    .digest('base64')\n    .replace(PLUS_GLOBAL_REGEXP, '-')\n    .replace(SLASH_GLOBAL_REGEXP, '_')\n    .replace(EQUAL_GLOBAL_REGEXP, '')\n}\n", "/*! queue-microtask. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */\nlet promise\n\nmodule.exports = typeof queueMicrotask === 'function'\n  ? queueMicrotask.bind(typeof window !== 'undefined' ? window : global)\n  // reuse resolved promise, and allocate it lazily\n  : cb => (promise || (promise = Promise.resolve()))\n    .then(cb)\n    .catch(err => setTimeout(() => { throw err }, 0))\n", "/*! run-parallel. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */\nmodule.exports = runParallel\n\nconst queueMicrotask = require('queue-microtask')\n\nfunction runParallel (tasks, cb) {\n  let results, pending, keys\n  let isSync = true\n\n  if (Array.isArray(tasks)) {\n    results = []\n    pending = tasks.length\n  } else {\n    keys = Object.keys(tasks)\n    results = {}\n    pending = keys.length\n  }\n\n  function done (err) {\n    function end () {\n      if (cb) cb(err, results)\n      cb = null\n    }\n    if (isSync) queueMicrotask(end)\n    else end()\n  }\n\n  function each (i, err, result) {\n    results[i] = result\n    if (--pending === 0 || err) {\n      done(err)\n    }\n  }\n\n  if (!pending) {\n    // empty\n    done(null)\n  } else if (keys) {\n    // object\n    keys.forEach(function (key) {\n      tasks[key](function (err, result) { each(key, err, result) })\n    })\n  } else {\n    // array\n    tasks.forEach(function (task, i) {\n      task(function (err, result) { each(i, err, result) })\n    })\n  }\n\n  isSync = false\n}\n", "let uid = require('uid-safe')\nlet week = require('./_week-from-now')\nlet dynamo = require('../../../../tables/dynamo').session\nlet crsf = require('csrf')\nlet parallel = require('run-parallel')\n\nmodule.exports = function _create (name, payload, callback) {\n  parallel([\n    function _key (callback) {\n      uid(18, function _uid (err, val) {\n        if (err) callback(err)\n        else callback(null, { _idx: val })\n      })\n    },\n    function _secret (callback) {\n      (new crsf).secret(function _uid (err, val) {\n        if (err) callback(err)\n        else callback(null, { _secret: val })\n      })\n    }\n  ],\n  function _put (err, results) {\n    if (err) throw err\n    results.push({ _ttl: week() })\n    let keys = results.reduce((a, b) => Object.assign(a, b))\n    let session = Object.assign(payload, keys)\n    dynamo(function _gotDB (err, db) {\n      if (err) callback(err)\n      else {\n        db.put({\n          TableName: name,\n          Item: session\n        },\n        function _create (err) {\n          if (err) callback(err)\n          else callback(null, session)\n        })\n      }\n    })\n  })\n}\n", "let dynamo = require('../../../../tables/dynamo').session\nlet create = require('./create')\n\nmodule.exports = function _find (name, _idx, callback) {\n  dynamo(function _gotDB (err, db) {\n    if (err) callback(err)\n    else {\n      db.get({\n        TableName: name,\n        ConsistentRead: true,\n        Key: { _idx }\n      },\n      function _get (err, data) {\n        if (err) callback(err)\n        else {\n          let result = typeof data === 'undefined' ? false : data.Item\n          if (result && result._secret) {\n            callback(null, result)\n          }\n          else {\n            create(name, {}, callback)\n          }\n        }\n      })\n    }\n  })\n}\n", "let dynamo = require('../../../../tables/dynamo').session\nlet week = require('./_week-from-now')\n\nmodule.exports = function _update (name, payload, callback) {\n  let _ttl = week()\n  let session = Object.assign(payload, { _ttl })\n  dynamo(function _gotDB (err, db) {\n    if (err) callback(err)\n    else {\n      db.put({\n        TableName: name,\n        Item: session\n      },\n      function _create (err) {\n        if (err) callback(err)\n        else callback(null, session)\n      })\n    }\n  })\n}\n", "let cookie = require('cookie')\nlet getIdx = require('../_get-idx')\nlet { unsign, sign } = require('cookie-signature')\n\nlet find = require('./find')\nlet create = require('./create')\nlet update = require('./update')\n\nmodule.exports = { read, write }\n\n/**\n * reads request for session cookie and looks it up in dynamo\n */\nfunction read (request, callback) {\n\n  // be async/await friendly\n  let promise\n  if (!callback) {\n    promise = new Promise(function (res, rej) {\n      callback = function (err, result) {\n        err ? rej(err) : res(result)\n      }\n    })\n  }\n\n  // read dynamo session table\n  let name = process.env.SESSION_TABLE_NAME || tableLogicalId('arc-sessions')\n  let secret = process.env.ARC_APP_SECRET || process.env.ARC_APP_NAME || 'fallback'\n  // TODO: uppercase 'Cookie' is not the header name on AWS Lambda; it's\n  // lowercase 'cookie' on lambda...\n  let rawCookie = request.headers && (request.headers.Cookie || request.headers.cookie)\n  // Lambda payload version 2 puts the cookies in an array on the request\n  if (!rawCookie && request.cookies) {\n    rawCookie = request.cookies.join(';')\n  }\n\n  let idx = getIdx(rawCookie)\n  let sesh = cookie.parse(idx)._idx\n  let valid = unsign(sesh || '', secret)\n\n  // find or create a new session\n  let exec = sesh && valid ? find.bind({}, name) : create.bind({}, name)\n  let params = sesh && valid ? valid : {}\n\n  exec(params, callback)\n  return promise\n}\n\n/**\n * expect params to be\n * - _idx\n * - _secret\n */\nfunction write (params, callback) {\n  // be async/await friendly\n  let promise\n  if (!callback) {\n    promise = new Promise(function (res, rej) {\n      callback = function (err, result) {\n        err ? rej(err) : res(result)\n      }\n    })\n  }\n\n  // read dynamo session table\n  let name = process.env.SESSION_TABLE_NAME || tableLogicalId('arc-sessions')\n  let secret = process.env.ARC_APP_SECRET || process.env.ARC_APP_NAME || 'fallback'\n\n  update(name, params, function _update (err) {\n    if (err) {\n      callback(err)\n    }\n    else {\n      let maxAge = process.env.SESSION_TTL || 7.884e+8\n      let options = {\n        maxAge,\n        expires: new Date(Date.now() + maxAge * 1000),\n        secure: true,\n        httpOnly: true,\n        path: '/',\n        sameSite: 'lax',\n      }\n      if (process.env.SESSION_DOMAIN) {\n        options.domain = process.env.SESSION_DOMAIN\n      }\n      if (process.env.NODE_ENV === 'testing')\n        delete options.secure\n      let result = cookie.serialize('_idx', sign(params._idx, secret), options)\n      callback(null, result)\n    }\n  })\n\n  return promise\n}\n\nfunction tableLogicalId (name) {\n  let env = process.env.NODE_ENV === 'production' ? 'production' : 'staging'\n  return `${process.env.ARC_APP_NAME}-${env}-${name}`\n}\n", "let jwe = require('./providers/jwe')\nlet ddb = require('./providers/ddb')\n\nmodule.exports = function read (request, callback) {\n\n  if (process.env.SESSION_TABLE_NAME === 'jwe')\n    return jwe.read(request, callback)\n\n  return ddb.read(request, callback)\n}\n", "let jwe = require('./providers/jwe')\nlet ddb = require('./providers/ddb')\n\nmodule.exports = function write (params, callback) {\n\n  if (process.env.SESSION_TABLE_NAME === 'jwe')\n    return jwe.write(params, callback)\n\n  return ddb.write(params, callback)\n}\n", "let qs = require('querystring')\n\n/**\n * Arc 6 bodies are always base64 encoded strings with req.isBase64Encoded = true (or null, which we interpolate into `{}`)\n * <Arc 6 bodies are always objects\n */\nmodule.exports = function parseBody (req) {\n  let ctype = req.headers['Content-Type'] || req.headers['content-type']\n  let passthru = !req.body || !req.headers || !ctype || !Object.getOwnPropertyNames(req.body).length\n  if (passthru) {\n    return req.body\n  }\n  else {\n    // Paranoid deep copy\n    let request = JSON.parse(JSON.stringify(req))\n    let headers = request.headers\n    let contentType = type => headers && headers['Content-Type'] && headers['Content-Type'].includes(type) || headers && headers['content-type'] && headers['content-type'].includes(type)\n\n    let isString = typeof request.body === 'string'\n    let isBase64 = request.isBase64Encoded\n    let isParsing = isString && isBase64\n    let isJSON = (contentType('application/json') || contentType('application/vnd.api+json')) && isString\n    let isFormURLEncoded = contentType('application/x-www-form-urlencoded') && isParsing\n    let isMultiPartFormData = contentType('multipart/form-data') && isParsing\n    let isOctetStream = contentType('application/octet-stream') && isParsing\n\n    if (isJSON) {\n      try {\n        let data = isBase64\n          // Base64 + JSON-encoded payloads (>Arc 6 REST)\n          ? Buffer.from(request.body, 'base64').toString()\n          // Raw JSON (HTTP API + Lambda v2.0 payload)\n          : request.body\n        request.body = JSON.parse(data) || {}\n      }\n      catch (e) {\n        throw Error('Invalid request body encoding or invalid JSON')\n      }\n    }\n\n    if (isFormURLEncoded) {\n      let data = new Buffer.from(request.body, 'base64').toString()\n      request.body = qs.parse(data)\n    }\n\n    if (isMultiPartFormData || isOctetStream) {\n      request.body = request.body.base64\n        ? request.body\n        : { base64: request.body }\n    }\n\n    return request.body\n  }\n}\n", "module.exports = function interpolateParams (req) {\n  // Handle HTTP API v2.0 payload scenarios, which omit params instead of passing them as null\n  if (req.version && req.version === '2.0') {\n    let { requestContext: context } = req\n    if (context && context.http && context.http.method) {\n      req.httpMethod = context.http.method\n    }\n    let unUndefined = [ 'body', 'pathParameters', 'queryStringParameters' ]\n    unUndefined.forEach(i => {\n      if (req[i] === undefined) req[i] = {}\n    })\n    // Expect 'GET /foo' or '$default'\n    req.resource = req.routeKey.split(' ')[1] || req.routeKey\n    // Backfill `req.path`\n    req.path = req.rawPath\n  }\n\n  // Un-null APIG-proxy-Lambda params in 6+\n  let unNulled = [ 'body', 'pathParameters', 'queryStringParameters', 'multiValueQueryStringParameters' ]\n  unNulled.forEach(i => {\n    if (req[i] === null) req[i] = {}\n  })\n\n  // Backfill params generated by <6 VTL\n  if (!req.method) req.method = req.httpMethod\n  if (!req.params) req.params = req.pathParameters\n  if (!req.query)  req.query  = req.queryStringParameters\n\n  // Legacy path parameter interpolation; 6+ REST gets this for free in `req.path`\n  let params = /\\{\\w+\\}/g\n  if (params.test(req.path)) {\n    let matches = req.path.match(params)\n    let vars = matches.map(a => a.replace(/\\{|\\}/g, ''))\n    let idx = 0\n    matches.forEach(m => {\n      req.path = req.path.replace(m, req.params[vars[idx]])\n      idx += 1\n    })\n  }\n  return req\n}\n", "/**\n * HTTP error response generator and template\n */\nmodule.exports = {\n  httpError,\n  proxyConfig: proxyConfig()\n}\n\nfunction proxyConfig () {\n  let title = 'Index not found'\n  let message = `No static asset bucket or <code>get /</code> function found in your project. Possible solutions:<br?\n<ul>\n  <li>Add <code>@static</code> to your project manifest</li>\n  <li>Add <code>get /</code> to the <code>@http</code> pragma of your project manifest</li>\n  <li>Manually specify an S3 bucket (containing an <code>index.html</code> file) with the <code>ARC_STATIC_BUCKET</code> env var</li>\n  <li>If using <code>arc.http.proxy</code>, pass in a valid config object</li>\n</ul>\n<a href=\"https://arc.codes/primitives/static\" target=\"_blank\">Learn more</a>`\n  return httpError({ title, message })\n}\n\nfunction httpError ({ statusCode = 502, title = 'Unknown error', message = '' }) {\n  title = title === 'Error'\n    ? `${statusCode} error`\n    : `${statusCode} error: ${title}`\n  return {\n    statusCode,\n    headers: {\n      'Content-Type': 'text/html; charset=utf8;',\n      'Cache-Control': 'no-cache, no-store, must-revalidate, max-age=0, s-maxage=0'\n    },\n    body: `\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n  <title>${title}</title>\n  <style>\n    * {\n      margin: 0;\n      padding: 0;\n      box-sizing: border-box;\n    }\n    body {\n      font-family: -apple-system, BlinkMacSystemFont, sans-serif;\n    }\n    code {\n      font-size: 1.25rem;\n      color: #00c26e;\n    }\n    .max-width-320 {\n      max-width: 20rem;\n    }\n    .margin-left-8 {\n      margin-left: 0.5rem;\n    }\n    .margin-bottom-16 {\n      margin-bottom: 1rem;\n    }\n    .margin-bottom-8 {\n      margin-bottom: 0.5rem;\n    }\n    .padding-32 {\n      padding: 2rem;\n    }\n    .padding-top-16 {\n      padding-top: 1rem;\n    }\n    a, a:hover {\n      color: #333;\n    }\n    p, li {\n      padding-bottom: 0.5rem;\n    }\n  </style>\n</head>\n<body class=\"padding-32\">\n  <div>\n    <div class=\"margin-left-8\">\n      <div class=\"margin-bottom-16\">\n        <h1 class=\"margin-bottom-16\">\n          ${title}\n        </h1>\n        <p>\n          ${message}\n        </p>\n      </div>\n      <div class=\"padding-top-16\">\n        <p>\n          View Architect documentation at:\n        </p>\n        <a href=\"https://arc.codes\">https://arc.codes</a>\n      </div>\n    </div>\n  </div>\n</body>\n</html>\n`\n  }\n}\n", "/**\n * Common binary MIME types\n */\nmodule.exports = [\n  'application/octet-stream',\n  // Docs\n  'application/epub+zip',\n  'application/msword',\n  'application/pdf',\n  'application/rtf',\n  'application/vnd.amazon.ebook',\n  'application/vnd.ms-excel',\n  'application/vnd.ms-powerpoint',\n  'application/vnd.openxmlformats-officedocument.presentationml.presentation',\n  'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',\n  'application/vnd.openxmlformats-officedocument.wordprocessingml.document',\n  // Fonts\n  'font/otf',\n  'font/woff',\n  'font/woff2',\n  // Images\n  'image/bmp',\n  'image/gif',\n  'image/jpeg',\n  'image/png',\n  'image/tiff',\n  'image/vnd.microsoft.icon',\n  'image/webp',\n  // Audio\n  'audio/3gpp',\n  'audio/aac',\n  'audio/basic',\n  'audio/mpeg',\n  'audio/ogg',\n  'audio/wavaudio/webm',\n  'audio/x-aiff',\n  'audio/x-midi',\n  'audio/x-wav',\n  // Video\n  'video/3gpp',\n  'video/mp2t',\n  'video/mpeg',\n  'video/ogg',\n  'video/quicktime',\n  'video/webm',\n  'video/x-msvideo',\n  // Archives\n  'application/java-archive',\n  'application/vnd.apple.installer+xml',\n  'application/x-7z-compressed',\n  'application/x-apple-diskimage',\n  'application/x-bzip',\n  'application/x-bzip2',\n  'application/x-gzip',\n  'application/x-java-archive',\n  'application/x-rar-compressed',\n  'application/x-tar',\n  'application/x-zip',\n  'application/zip'\n]\n", "let { httpError } = require('./errors')\nlet binaryTypes = require('./helpers/binary-types')\n\nmodule.exports = function responseFormatter (req, params) {\n  // Handle HTTP API v2.0 payload scenarios, which have some very strange edges\n  if (req.version && req.version === '2.0') {\n    // New school AWS\n    let knownParams = [ 'statusCode', 'body', 'headers', 'isBase64Encoded', 'cookies' ]\n    let hasKnownParams = p => knownParams.some(k => k === p)\n    // Old school Arc\n    let tidyParams = [ 'code', 'cookie', 'cors', 'location', 'session', 'status' ]\n    let hasTidyParams = p => tidyParams.some(k => k === p)\n    // Older school Arc\n    let staticallyBound = [ 'html', 'css', 'js', 'text', 'json', 'xml' ]\n    let isStaticallyBound = p => staticallyBound.some(k => k === p)\n\n    let is = t => typeof params === t\n    // Handle scenarios where we have a known parameter returned\n    if (is('object') &&\n        (params !== null) &&\n        !Array.isArray(params) &&\n        Object.keys.length === 1 &&\n        (Object.keys(params).some(hasKnownParams) ||\n         Object.keys(params).some(hasTidyParams) ||\n         Object.keys(params).some(isStaticallyBound))) {\n      params // noop\n    }\n    // Handle scenarios where arbitrary stuff is returned to be JSONified\n    else if (is('number') ||\n             (is('object') && params !== null) ||\n             (is('string') && params) ||\n             Array.isArray(params) ||\n             params instanceof Buffer) {\n      params = { body: JSON.stringify(params) }\n    }\n    // Not returning is actually valid now lolnothingmatters\n    else if (!params) params = {}\n  }\n\n  let isError = params instanceof Error // Doesn't really pertain to async\n  let buffer\n  let bodyIsBuffer = params.body && params.body instanceof Buffer\n  if (bodyIsBuffer) buffer = params.body // Back up buffer\n  if (!isError) params = JSON.parse(JSON.stringify(params)) // Deep copy to aid testing mutation\n  if (bodyIsBuffer) params.body = buffer // Restore non-JSON-encoded buffer\n\n  /**\n   * Response defaults\n   *   where possible, normalize headers to pascal-kebab case (lolsigh)\n   */\n  // Body\n  let body = params.body || ''\n\n  // Headers: Cache-Control\n  let cacheControl = params.cacheControl ||\n                     params.headers && params.headers['Cache-Control'] ||\n                     params.headers && params.headers['cache-control'] || ''\n  if (params.headers && params.headers['cache-control']) {\n    delete params.headers['cache-control'] // Clean up improper casing\n  }\n\n  // Headers: Content-Type\n  let type = params.type ||\n             params.headers && params.headers['Content-Type'] ||\n             params.headers && params.headers['content-type'] ||\n             'application/json; charset=utf8'\n  if (params.headers && params.headers['content-type']) {\n    delete params.headers['content-type'] // Clean up improper casing\n  }\n\n  // Cross-origin ritual sacrifice\n  let cors = params.cors\n\n  if (params.html) {\n    type = 'text/html; charset=utf8'\n    body = params.html\n  }\n  else if (params.css) {\n    type = 'text/css; charset=utf8'\n    body = params.css\n  }\n  else if (params.js) {\n    type = 'text/javascript; charset=utf8'\n    body = params.js\n  }\n  else if (params.text) {\n    type = 'text/plain; charset=utf8'\n    body = params.text\n  }\n  else if (params.json) {\n    type = 'application/json; charset=utf8'\n    body = JSON.stringify(params.json)\n  }\n  else if (params.xml) {\n    type = 'application/xml; charset=utf8'\n    body = params.xml\n  }\n\n  // Status\n  let providedStatus = params.status || params.code || params.statusCode\n  let statusCode = providedStatus || 200\n\n  let res = {\n    headers: Object.assign({}, { 'Content-Type': type }, params.headers || {}),\n    statusCode,\n    body\n  }\n\n  // REST API stuff\n  if (params.multiValueHeaders) {\n    res.multiValueHeaders = params.multiValueHeaders\n  }\n  // HTTP API stuff\n  if (params.cookies) {\n    res.cookies = params.cookies\n  }\n\n  // Error override\n  if (isError) {\n    let statusCode = providedStatus || 500\n    let title = params.name\n    let message = `\n      ${params.message}<br>\n      <pre>${params.stack}<pre>\n    `\n    res = httpError({ statusCode, title, message })\n  }\n\n  /**\n   * Only send res.type for non-proxy responses in Arc 5; attributes of each env:\n   * Arc 6:\n   * - ARC_CLOUDFORMATION\n   * - ARC_HTTP === 'aws_proxy'\n   * Arc 5:\n   * - !ARC_CLOUDFORMATION\n   * - !ARC_HTTP || ARC_HTTP === 'aws'\n   */\n  let notArcSix = !process.env.ARC_CLOUDFORMATION\n  let notArcProxy = !process.env.ARC_HTTP || process.env.ARC_HTTP === 'aws'\n  let isArcFive = notArcSix && notArcProxy\n  let notProxyReq = !req.resource || req.resource && req.resource !== '/{proxy+}'\n  if (isArcFive && notProxyReq) {\n    // This is a deprecated code path that may be removed when Arc 5 exits LTS status\n    // Fixes backwards compatibility: Arc vtl needs this param\n    res.type = type\n  }\n\n  // Set and/or update headers\n  let headers = res.headers\n  if (cacheControl) headers['Cache-Control'] = cacheControl\n  let antiCache = type.includes('text/html') ||\n                  type.includes('application/json') ||\n                  type.includes('application/vnd.api+json')\n  if (headers && !headers['Cache-Control'] && antiCache) {\n    headers['Cache-Control'] = 'no-cache, no-store, must-revalidate, max-age=0, s-maxage=0'\n  }\n  else if (headers && !headers['Cache-Control']) {\n    headers['Cache-Control'] = 'max-age=86400' // Default cache to one day unless otherwise specified\n  }\n  if (cors) headers['Access-Control-Allow-Origin'] = '*'\n  if (params.isBase64Encoded) res.isBase64Encoded = true\n  if (params.location) {\n    res.statusCode = providedStatus || 302\n    res.headers.Location = params.location\n  }\n\n  // Handle body encoding (if necessary)\n  let isBinary = binaryTypes.some(t => res.headers['Content-Type'].includes(t))\n  let bodyIsString = typeof res.body === 'string'\n  let b64enc = i => new Buffer.from(i).toString('base64')\n  // Encode (and flag) outbound buffers\n  if (bodyIsBuffer) {\n    res.body = b64enc(res.body)\n    res.isBase64Encoded = true\n  }\n  // Body is likely base64 & has binary MIME type, so flag it\n  if (bodyIsString && isBinary) res.isBase64Encoded = true\n\n  return res\n}\n", "let read = require('./session/read')\nlet write = require('./session/write')\nlet bodyParser = require('./helpers/body-parser')\nlet interpolate = require('./helpers/params')\nlet responseFormatter = require('./_res-fmt')\n\n/**\n * `arc.http` accepts one or more functions with an express-style sig\n */\nmodule.exports = function http (...fns) {\n\n  // Ensure we've been passed only functions\n  fns.forEach(f => {\n    if (typeof f != 'function')\n      throw TypeError(f + ' not a function')\n  })\n\n  // Return an AWS Lambda continuation passing function signature\n  return function lambda (request, context, callback) {\n\n    // Verify the request is configured by arc\n    if (!request.headers)\n      request.headers = {}\n\n    // Cache the functions\n    let cache = fns.slice()\n\n    // read the session\n    read(request, function _read (err, session) {\n      // Fail loudly if the session isn't set up correctly\n      if (err) throw err\n\n      // construct a response function\n      let req = interpolate(Object.assign({}, request, { session }))\n      req.body = bodyParser(req)\n      let res = response.bind({}, req, callback)\n\n      // loop thru middleware\n      ;(function iterator (fun) {\n        function fail () {throw Error('next() called from last function')}\n        let next = iterator.bind({}, cache.shift() || fail)\n        fun.call({}, req, res, next)\n      })(cache.shift())\n    })\n  }\n}\n\n/**\n * req is bound so we have a ref to req.session\n * callback is raw lambda callback\n */\nfunction response (req, callback, params) {\n  // Format the response\n  let res = responseFormatter(req, params)\n\n  // Legacy 'cookie' parameter, used after direct session writes\n  if (params && params.cookie) {\n    res.headers['Set-Cookie'] = params.cookie\n  }\n\n  // Save the passed session\n  if (params && params.session) {\n    // Tag the session data with _idx, secret, ttl, from req.session\n    let { _idx, _secret, _ttl } = req.session\n    let session = { _idx, _secret, _ttl, ...params.session }\n    write(session, function _write (err, cookie) {\n      if (err) callback(err)\n      else {\n        res.headers['Set-Cookie'] = cookie\n        callback(null, res)\n      }\n    })\n  }\n  else {\n    // Just pass it through\n    callback(null, res)\n  }\n}\n", "const { readFileSync, existsSync } = require('fs')\nconst { join } = require('path')\n\n/**\n * Architect static asset helper\n * - Returns the live asset path and filename\n *\n * In order to keep this method sync, it does not use reflection to get fingerprint status\n * - Not checking @static fingerprint true (which we used to read from the .arc file) is possibly dangerous, so ensure asset path is valid\n * - ? TODO: add fingerprint state to env vars in Arc 6 to restore config safety?\n * @param {string} path - the path to the asset (eg. /index.js)\n * @returns {string} path - the resolved asset path (eg. /_static/index-xxx.js)\n */\nmodule.exports = function _static (asset, options = {}) {\n  let key = asset[0] === '/' ? asset.substring(1) : asset\n  let isIndex = asset === '/'\n  let manifest = join(process.cwd(), 'node_modules', '@architect', 'shared', 'static.json')\n  let exists = existsSync(manifest)\n  let local = process.env.NODE_ENV === 'testing' || process.env.ARC_LOCAL\n  let stagePath = options.stagePath && !local ? '/' + process.env.NODE_ENV : ''\n  let path = `${stagePath}/_static`\n  if (!local && exists && !isIndex) {\n    let read = p => readFileSync(p).toString()\n    let pkg = JSON.parse(read(manifest))\n    let asset = pkg[key]\n    if (!asset)\n      throw ReferenceError(`Could not find asset in static.json (asset fingerprint manifest): ${key}`)\n    return `${path}/${asset}`\n  }\n  return `${path}/${isIndex ? '' : key}`\n}\n", "/**\n * no magic url helper\n *\n * given a path / returns\n *\n * - / if NODE_ENV === testing\n * - /staging if NODE_ENV === staging\n * - /production if NODE_ENV === production\n */\nmodule.exports = function url (url) {\n  let staging = process.env.NODE_ENV === 'staging'\n  let production = process.env.NODE_ENV === 'production'\n  if (!process.env.ARC_LOCAL && (staging || production))\n    return `/${process.env.NODE_ENV}${url}`\n  return url // fallthru for NODE_ENV=testing\n}\n", "let read = require('../session/read')\nlet write = require('../session/write')\nlet bodyParser = require('../helpers/body-parser')\nlet interpolate = require('../helpers/params')\nlet responseFormatter = require('../_res-fmt')\n\n/**\n * `arc.http.async` accepts one or more async functions\n *\n * Each function is a regular Arc 4+ async/await route function, that may return:\n * - A falsy value .......... move onto the next function\n * - A modified `request` ... move onto the next function, passing the mutated `request` on to any subsequent functions\n * - A `response` ........... end execution and respond to the client\n */\nmodule.exports = function httpAsync (...fns) {\n\n  // Ensure we've been passed only functions\n  fns.forEach(f => {\n    if (typeof f != 'function')\n      throw TypeError(f + ' not a function')\n  })\n\n  // Return an AWS Lambda async function signature\n  async function combined (request, context) {\n    let params\n    let first = true\n    for (let fn of fns) {\n      // Only parse the request obj of the first function\n      if (first) {\n        first = false\n        let session = await read(request)\n        let req = interpolate(Object.assign({}, request, { session }))\n        req.body = bodyParser(req)\n        request = req\n      }\n      // Run the function\n      let result = await fn(request, context)\n      let isRequest = result && result.httpMethod\n      if (isRequest) {\n        // Function returned a modified request, continuing...\n        request = result\n      }\n      else {\n        if (result) {\n          params = result\n          // Got a response, finishing...\n          break\n        }\n        // Did not get a result from, continuing...\n      }\n    }\n    let isHTTPv2 = request.version && request.version === '2.0'\n    // Finished combined function!\n    if (!params && !isHTTPv2) {\n      throw new Error(`Finished all functions without returning a response.`)\n    }\n    return response(request, params)\n  }\n  return combined\n}\n\nasync function response (req, params) {\n  // Format the response\n  let res = responseFormatter(req, params)\n\n  // Legacy 'cookie' parameter, used after direct session writes\n  if (params && params.cookie) {\n    res.headers['Set-Cookie'] = params.cookie\n  }\n\n  // Save the passed session\n  if (params && params.session) {\n    // Tag the session data with _idx, secret, ttl, from req.session\n    let { _idx, _secret, _ttl } = req.session\n    let session = { _idx, _secret, _ttl, ...params.session }\n    let cookie = await write(session)\n    res.headers['Set-Cookie'] = cookie\n  }\n  return res\n}\n", "/**\n *  @license\n *    Copyright 2018 Brigham Young University\n *\n *    Licensed under the Apache License, Version 2.0 (the \"License\");\n *    you may not use this file except in compliance with the License.\n *    You may obtain a copy of the License at\n *\n *        http://www.apache.org/licenses/LICENSE-2.0\n *\n *    Unless required by applicable law or agreed to in writing, software\n *    distributed under the License is distributed on an \"AS IS\" BASIS,\n *    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *    See the License for the specific language governing permissions and\n *    limitations under the License.\n **/\n'use strict';\n\n/**\n * Toggle the case of a string based on the number value passed in.\n * @param {string} string\n * @param {number} number\n * @param {object} [options={allowOverflow: true}]\n * @returns {string|boolean}\n */\nmodule.exports = binaryCase;\n\nfunction binaryCase(string, number, options) {\n    if (!options || typeof options !== 'object') options = {};\n    if (!options.hasOwnProperty('allowOverflow')) options.allowOverflow = true;\n\n    if (number > binaryCase.maxNumber(string) && !options.allowOverflow) return false;\n\n    return getBinaryCase(string, number);\n}\n\nbinaryCase.iterator = function(string, options) {\n    const max = binaryCase.maxNumber(string);\n\n    if (!options || typeof options !== 'object') options = {};\n    if (!options.hasOwnProperty('startIndex')) options.startIndex = 0;\n    if (typeof options.startIndex !== 'number' || !Number.isInteger(options.startIndex) || options.startIndex < 0) throw Error('Option startIndex must be a non-negative integer.');\n\n    let index = options.startIndex;\n    return {\n        next: function() {\n            return index > max\n                ? { done: true }\n                : { done: false, value: getBinaryCase(string, index++) };\n        }\n    };\n};\n\n/**\n * Get the maximum number that can be used before causing overflow.\n * @param {string} string\n * @returns {number}\n */\nbinaryCase.maxNumber = function(string) {\n    const pow = string.match(/[a-z]/ig).length;\n    return Math.pow(2, pow) - 1;\n};\n\n/**\n * Get an array of all possible variations.\n * @param {string} string\n * @returns {string[]}\n */\nbinaryCase.variations = function(string) {\n    const results = [];\n    const max = binaryCase.maxNumber(string);\n    for (let i = 0; i <= max; i++) {\n        results.push(binaryCase(string, i));\n    }\n    return results;\n};\n\n/**\n * A performance improved method for acquiring the binary case, provided by Blake Embrey with very minor modification by James Speirs.\n * @author Blake Embrey | https://github.com/blakeembrey\n * @author James Speirs | https://github.com/gi60s\n * @param {string} str\n * @param {number} val\n * @returns {string}\n */\nfunction getBinaryCase (str, val) {\n    let res = '';\n\n    for (let i = 0; i < str.length; i++) {\n        const code = str.charCodeAt(i);\n\n        if (code >= 65 && code <= 90) {\n            res += val & 1 ? String.fromCharCode(code + 32) : String.fromCharCode(code);\n            val >>>= 1;\n        } else if (code >= 97 && code <= 122) {\n            res += val & 1 ? String.fromCharCode(code - 32) : String.fromCharCode(code);\n            val >>>= 1;\n        } else {\n            res += String.fromCharCode(code);\n        }\n\n        if (val === 0) {\n            return res + str.substr(i + 1);\n        }\n    }\n\n    return res;\n}", "/*!\n * media-typer\n * Copyright(c) 2014 Douglas Christopher Wilson\n * MIT Licensed\n */\n\n/**\n * RegExp to match *( \";\" parameter ) in RFC 2616 sec 3.7\n *\n * parameter     = token \"=\" ( token | quoted-string )\n * token         = 1*<any CHAR except CTLs or separators>\n * separators    = \"(\" | \")\" | \"<\" | \">\" | \"@\"\n *               | \",\" | \";\" | \":\" | \"\\\" | <\">\n *               | \"/\" | \"[\" | \"]\" | \"?\" | \"=\"\n *               | \"{\" | \"}\" | SP | HT\n * quoted-string = ( <\"> *(qdtext | quoted-pair ) <\"> )\n * qdtext        = <any TEXT except <\">>\n * quoted-pair   = \"\\\" CHAR\n * CHAR          = <any US-ASCII character (octets 0 - 127)>\n * TEXT          = <any OCTET except CTLs, but including LWS>\n * LWS           = [CRLF] 1*( SP | HT )\n * CRLF          = CR LF\n * CR            = <US-ASCII CR, carriage return (13)>\n * LF            = <US-ASCII LF, linefeed (10)>\n * SP            = <US-ASCII SP, space (32)>\n * SHT           = <US-ASCII HT, horizontal-tab (9)>\n * CTL           = <any US-ASCII control character (octets 0 - 31) and DEL (127)>\n * OCTET         = <any 8-bit sequence of data>\n */\nvar paramRegExp = /; *([!#$%&'\\*\\+\\-\\.0-9A-Z\\^_`a-z\\|~]+) *= *(\"(?:[ !\\u0023-\\u005b\\u005d-\\u007e\\u0080-\\u00ff]|\\\\[\\u0020-\\u007e])*\"|[!#$%&'\\*\\+\\-\\.0-9A-Z\\^_`a-z\\|~]+) */g;\nvar textRegExp = /^[\\u0020-\\u007e\\u0080-\\u00ff]+$/\nvar tokenRegExp = /^[!#$%&'\\*\\+\\-\\.0-9A-Z\\^_`a-z\\|~]+$/\n\n/**\n * RegExp to match quoted-pair in RFC 2616\n *\n * quoted-pair = \"\\\" CHAR\n * CHAR        = <any US-ASCII character (octets 0 - 127)>\n */\nvar qescRegExp = /\\\\([\\u0000-\\u007f])/g;\n\n/**\n * RegExp to match chars that must be quoted-pair in RFC 2616\n */\nvar quoteRegExp = /([\\\\\"])/g;\n\n/**\n * RegExp to match type in RFC 6838\n *\n * type-name = restricted-name\n * subtype-name = restricted-name\n * restricted-name = restricted-name-first *126restricted-name-chars\n * restricted-name-first  = ALPHA / DIGIT\n * restricted-name-chars  = ALPHA / DIGIT / \"!\" / \"#\" /\n *                          \"$\" / \"&\" / \"-\" / \"^\" / \"_\"\n * restricted-name-chars =/ \".\" ; Characters before first dot always\n *                              ; specify a facet name\n * restricted-name-chars =/ \"+\" ; Characters after last plus always\n *                              ; specify a structured syntax suffix\n * ALPHA =  %x41-5A / %x61-7A   ; A-Z / a-z\n * DIGIT =  %x30-39             ; 0-9\n */\nvar subtypeNameRegExp = /^[A-Za-z0-9][A-Za-z0-9!#$&^_.-]{0,126}$/\nvar typeNameRegExp = /^[A-Za-z0-9][A-Za-z0-9!#$&^_-]{0,126}$/\nvar typeRegExp = /^ *([A-Za-z0-9][A-Za-z0-9!#$&^_-]{0,126})\\/([A-Za-z0-9][A-Za-z0-9!#$&^_.+-]{0,126}) *$/;\n\n/**\n * Module exports.\n */\n\nexports.format = format\nexports.parse = parse\n\n/**\n * Format object to media type.\n *\n * @param {object} obj\n * @return {string}\n * @api public\n */\n\nfunction format(obj) {\n  if (!obj || typeof obj !== 'object') {\n    throw new TypeError('argument obj is required')\n  }\n\n  var parameters = obj.parameters\n  var subtype = obj.subtype\n  var suffix = obj.suffix\n  var type = obj.type\n\n  if (!type || !typeNameRegExp.test(type)) {\n    throw new TypeError('invalid type')\n  }\n\n  if (!subtype || !subtypeNameRegExp.test(subtype)) {\n    throw new TypeError('invalid subtype')\n  }\n\n  // format as type/subtype\n  var string = type + '/' + subtype\n\n  // append +suffix\n  if (suffix) {\n    if (!typeNameRegExp.test(suffix)) {\n      throw new TypeError('invalid suffix')\n    }\n\n    string += '+' + suffix\n  }\n\n  // append parameters\n  if (parameters && typeof parameters === 'object') {\n    var param\n    var params = Object.keys(parameters).sort()\n\n    for (var i = 0; i < params.length; i++) {\n      param = params[i]\n\n      if (!tokenRegExp.test(param)) {\n        throw new TypeError('invalid parameter name')\n      }\n\n      string += '; ' + param + '=' + qstring(parameters[param])\n    }\n  }\n\n  return string\n}\n\n/**\n * Parse media type to object.\n *\n * @param {string|object} string\n * @return {Object}\n * @api public\n */\n\nfunction parse(string) {\n  if (!string) {\n    throw new TypeError('argument string is required')\n  }\n\n  // support req/res-like objects as argument\n  if (typeof string === 'object') {\n    string = getcontenttype(string)\n  }\n\n  if (typeof string !== 'string') {\n    throw new TypeError('argument string is required to be a string')\n  }\n\n  var index = string.indexOf(';')\n  var type = index !== -1\n    ? string.substr(0, index)\n    : string\n\n  var key\n  var match\n  var obj = splitType(type)\n  var params = {}\n  var value\n\n  paramRegExp.lastIndex = index\n\n  while (match = paramRegExp.exec(string)) {\n    if (match.index !== index) {\n      throw new TypeError('invalid parameter format')\n    }\n\n    index += match[0].length\n    key = match[1].toLowerCase()\n    value = match[2]\n\n    if (value[0] === '\"') {\n      // remove quotes and escapes\n      value = value\n        .substr(1, value.length - 2)\n        .replace(qescRegExp, '$1')\n    }\n\n    params[key] = value\n  }\n\n  if (index !== -1 && index !== string.length) {\n    throw new TypeError('invalid parameter format')\n  }\n\n  obj.parameters = params\n\n  return obj\n}\n\n/**\n * Get content-type from req/res objects.\n *\n * @param {object}\n * @return {Object}\n * @api private\n */\n\nfunction getcontenttype(obj) {\n  if (typeof obj.getHeader === 'function') {\n    // res-like\n    return obj.getHeader('content-type')\n  }\n\n  if (typeof obj.headers === 'object') {\n    // req-like\n    return obj.headers && obj.headers['content-type']\n  }\n}\n\n/**\n * Quote a string if necessary.\n *\n * @param {string} val\n * @return {string}\n * @api private\n */\n\nfunction qstring(val) {\n  var str = String(val)\n\n  // no need to quote tokens\n  if (tokenRegExp.test(str)) {\n    return str\n  }\n\n  if (str.length > 0 && !textRegExp.test(str)) {\n    throw new TypeError('invalid parameter value')\n  }\n\n  return '\"' + str.replace(quoteRegExp, '\\\\$1') + '\"'\n}\n\n/**\n * Simply \"type/subtype+siffx\" into parts.\n *\n * @param {string} string\n * @return {Object}\n * @api private\n */\n\nfunction splitType(string) {\n  var match = typeRegExp.exec(string.toLowerCase())\n\n  if (!match) {\n    throw new TypeError('invalid media type')\n  }\n\n  var type = match[1]\n  var subtype = match[2]\n  var suffix\n\n  // suffix after last +\n  var index = subtype.lastIndexOf('+')\n  if (index !== -1) {\n    suffix = subtype.substr(index + 1)\n    subtype = subtype.substr(0, index)\n  }\n\n  var obj = {\n    type: type,\n    subtype: subtype,\n    suffix: suffix\n  }\n\n  return obj\n}\n", "/*!\n * mime-db\n * Copyright(c) 2014 Jonathan Ong\n * MIT Licensed\n */\n\n/**\n * Module exports.\n */\n\nmodule.exports = require('./db.json')\n", "/*!\n * mime-types\n * Copyright(c) 2014 Jonathan Ong\n * Copyright(c) 2015 Douglas Christopher Wilson\n * MIT Licensed\n */\n\n'use strict'\n\n/**\n * Module dependencies.\n * @private\n */\n\nvar db = require('mime-db')\nvar extname = require('path').extname\n\n/**\n * Module variables.\n * @private\n */\n\nvar EXTRACT_TYPE_REGEXP = /^\\s*([^;\\s]*)(?:;|\\s|$)/\nvar TEXT_TYPE_REGEXP = /^text\\//i\n\n/**\n * Module exports.\n * @public\n */\n\nexports.charset = charset\nexports.charsets = { lookup: charset }\nexports.contentType = contentType\nexports.extension = extension\nexports.extensions = Object.create(null)\nexports.lookup = lookup\nexports.types = Object.create(null)\n\n// Populate the extensions/types maps\npopulateMaps(exports.extensions, exports.types)\n\n/**\n * Get the default charset for a MIME type.\n *\n * @param {string} type\n * @return {boolean|string}\n */\n\nfunction charset (type) {\n  if (!type || typeof type !== 'string') {\n    return false\n  }\n\n  // TODO: use media-typer\n  var match = EXTRACT_TYPE_REGEXP.exec(type)\n  var mime = match && db[match[1].toLowerCase()]\n\n  if (mime && mime.charset) {\n    return mime.charset\n  }\n\n  // default text/* to utf-8\n  if (match && TEXT_TYPE_REGEXP.test(match[1])) {\n    return 'UTF-8'\n  }\n\n  return false\n}\n\n/**\n * Create a full Content-Type header given a MIME type or extension.\n *\n * @param {string} str\n * @return {boolean|string}\n */\n\nfunction contentType (str) {\n  // TODO: should this even be in this module?\n  if (!str || typeof str !== 'string') {\n    return false\n  }\n\n  var mime = str.indexOf('/') === -1\n    ? exports.lookup(str)\n    : str\n\n  if (!mime) {\n    return false\n  }\n\n  // TODO: use content-type or other module\n  if (mime.indexOf('charset') === -1) {\n    var charset = exports.charset(mime)\n    if (charset) mime += '; charset=' + charset.toLowerCase()\n  }\n\n  return mime\n}\n\n/**\n * Get the default extension for a MIME type.\n *\n * @param {string} type\n * @return {boolean|string}\n */\n\nfunction extension (type) {\n  if (!type || typeof type !== 'string') {\n    return false\n  }\n\n  // TODO: use media-typer\n  var match = EXTRACT_TYPE_REGEXP.exec(type)\n\n  // get extensions\n  var exts = match && exports.extensions[match[1].toLowerCase()]\n\n  if (!exts || !exts.length) {\n    return false\n  }\n\n  return exts[0]\n}\n\n/**\n * Lookup the MIME type for a file path/extension.\n *\n * @param {string} path\n * @return {boolean|string}\n */\n\nfunction lookup (path) {\n  if (!path || typeof path !== 'string') {\n    return false\n  }\n\n  // get the extension (\"ext\" or \".ext\" or full path)\n  var extension = extname('x.' + path)\n    .toLowerCase()\n    .substr(1)\n\n  if (!extension) {\n    return false\n  }\n\n  return exports.types[extension] || false\n}\n\n/**\n * Populate the extensions and types maps.\n * @private\n */\n\nfunction populateMaps (extensions, types) {\n  // source preference (least -> most)\n  var preference = ['nginx', 'apache', undefined, 'iana']\n\n  Object.keys(db).forEach(function forEachMimeType (type) {\n    var mime = db[type]\n    var exts = mime.extensions\n\n    if (!exts || !exts.length) {\n      return\n    }\n\n    // mime -> extensions\n    extensions[type] = exts\n\n    // extension -> mime\n    for (var i = 0; i < exts.length; i++) {\n      var extension = exts[i]\n\n      if (types[extension]) {\n        var from = preference.indexOf(db[types[extension]].source)\n        var to = preference.indexOf(mime.source)\n\n        if (types[extension] !== 'application/octet-stream' &&\n          (from > to || (from === to && types[extension].substr(0, 12) === 'application/'))) {\n          // skip the remapping\n          continue\n        }\n      }\n\n      // set the extension -> mime\n      types[extension] = type\n    }\n  })\n}\n", "/*!\n * type-is\n * Copyright(c) 2014 Jonathan Ong\n * Copyright(c) 2014-2015 Douglas Christopher Wilson\n * MIT Licensed\n */\n\n'use strict'\n\n/**\n * Module dependencies.\n * @private\n */\n\nvar typer = require('media-typer')\nvar mime = require('mime-types')\n\n/**\n * Module exports.\n * @public\n */\n\nmodule.exports = typeofrequest\nmodule.exports.is = typeis\nmodule.exports.hasBody = hasbody\nmodule.exports.normalize = normalize\nmodule.exports.match = mimeMatch\n\n/**\n * Compare a `value` content-type with `types`.\n * Each `type` can be an extension like `html`,\n * a special shortcut like `multipart` or `urlencoded`,\n * or a mime type.\n *\n * If no types match, `false` is returned.\n * Otherwise, the first `type` that matches is returned.\n *\n * @param {String} value\n * @param {Array} types\n * @public\n */\n\nfunction typeis (value, types_) {\n  var i\n  var types = types_\n\n  // remove parameters and normalize\n  var val = tryNormalizeType(value)\n\n  // no type or invalid\n  if (!val) {\n    return false\n  }\n\n  // support flattened arguments\n  if (types && !Array.isArray(types)) {\n    types = new Array(arguments.length - 1)\n    for (i = 0; i < types.length; i++) {\n      types[i] = arguments[i + 1]\n    }\n  }\n\n  // no types, return the content type\n  if (!types || !types.length) {\n    return val\n  }\n\n  var type\n  for (i = 0; i < types.length; i++) {\n    if (mimeMatch(normalize(type = types[i]), val)) {\n      return type[0] === '+' || type.indexOf('*') !== -1\n        ? val\n        : type\n    }\n  }\n\n  // no matches\n  return false\n}\n\n/**\n * Check if a request has a request body.\n * A request with a body __must__ either have `transfer-encoding`\n * or `content-length` headers set.\n * http://www.w3.org/Protocols/rfc2616/rfc2616-sec4.html#sec4.3\n *\n * @param {Object} request\n * @return {Boolean}\n * @public\n */\n\nfunction hasbody (req) {\n  return req.headers['transfer-encoding'] !== undefined ||\n    !isNaN(req.headers['content-length'])\n}\n\n/**\n * Check if the incoming request contains the \"Content-Type\"\n * header field, and it contains any of the give mime `type`s.\n * If there is no request body, `null` is returned.\n * If there is no content type, `false` is returned.\n * Otherwise, it returns the first `type` that matches.\n *\n * Examples:\n *\n *     // With Content-Type: text/html; charset=utf-8\n *     this.is('html'); // => 'html'\n *     this.is('text/html'); // => 'text/html'\n *     this.is('text/*', 'application/json'); // => 'text/html'\n *\n *     // When Content-Type is application/json\n *     this.is('json', 'urlencoded'); // => 'json'\n *     this.is('application/json'); // => 'application/json'\n *     this.is('html', 'application/*'); // => 'application/json'\n *\n *     this.is('html'); // => false\n *\n * @param {String|Array} types...\n * @return {String|false|null}\n * @public\n */\n\nfunction typeofrequest (req, types_) {\n  var types = types_\n\n  // no body\n  if (!hasbody(req)) {\n    return null\n  }\n\n  // support flattened arguments\n  if (arguments.length > 2) {\n    types = new Array(arguments.length - 1)\n    for (var i = 0; i < types.length; i++) {\n      types[i] = arguments[i + 1]\n    }\n  }\n\n  // request content type\n  var value = req.headers['content-type']\n\n  return typeis(value, types)\n}\n\n/**\n * Normalize a mime type.\n * If it's a shorthand, expand it to a valid mime type.\n *\n * In general, you probably want:\n *\n *   var type = is(req, ['urlencoded', 'json', 'multipart']);\n *\n * Then use the appropriate body parsers.\n * These three are the most common request body types\n * and are thus ensured to work.\n *\n * @param {String} type\n * @private\n */\n\nfunction normalize (type) {\n  if (typeof type !== 'string') {\n    // invalid type\n    return false\n  }\n\n  switch (type) {\n    case 'urlencoded':\n      return 'application/x-www-form-urlencoded'\n    case 'multipart':\n      return 'multipart/*'\n  }\n\n  if (type[0] === '+') {\n    // \"+json\" -> \"*/*+json\" expando\n    return '*/*' + type\n  }\n\n  return type.indexOf('/') === -1\n    ? mime.lookup(type)\n    : type\n}\n\n/**\n * Check if `expected` mime type\n * matches `actual` mime type with\n * wildcard and +suffix support.\n *\n * @param {String} expected\n * @param {String} actual\n * @return {Boolean}\n * @private\n */\n\nfunction mimeMatch (expected, actual) {\n  // invalid type\n  if (expected === false) {\n    return false\n  }\n\n  // split types\n  var actualParts = actual.split('/')\n  var expectedParts = expected.split('/')\n\n  // invalid format\n  if (actualParts.length !== 2 || expectedParts.length !== 2) {\n    return false\n  }\n\n  // validate type\n  if (expectedParts[0] !== '*' && expectedParts[0] !== actualParts[0]) {\n    return false\n  }\n\n  // validate suffix wildcard\n  if (expectedParts[1].substr(0, 2) === '*+') {\n    return expectedParts[1].length <= actualParts[1].length + 1 &&\n      expectedParts[1].substr(1) === actualParts[1].substr(1 - expectedParts[1].length)\n  }\n\n  // validate subtype\n  if (expectedParts[1] !== '*' && expectedParts[1] !== actualParts[1]) {\n    return false\n  }\n\n  return true\n}\n\n/**\n * Normalize a type and remove parameters.\n *\n * @param {string} value\n * @return {string}\n * @private\n */\n\nfunction normalizeType (value) {\n  // parse the type\n  var type = typer.parse(value)\n\n  // remove the parameters\n  type.parameters = undefined\n\n  // reformat it\n  return typer.format(type)\n}\n\n/**\n * Try to normalize a type and remove parameters.\n *\n * @param {string} value\n * @return {string}\n * @private\n */\n\nfunction tryNormalizeType (value) {\n  if (!value) {\n    return null\n  }\n\n  try {\n    return normalizeType(value)\n  } catch (err) {\n    return null\n  }\n}\n", "'use strict'\nconst http = require('http')\nconst url = require('url')\nconst binarycase = require('binary-case')\nconst isType = require('type-is')\n\nfunction getPathWithQueryStringParams (event) {\n  return url.format({ pathname: event.path, query: event.queryStringParameters })\n}\nfunction getEventBody (event) {\n  return Buffer.from(event.body, event.isBase64Encoded ? 'base64' : 'utf8')\n}\n\nfunction clone (json) {\n  return JSON.parse(JSON.stringify(json))\n}\n\nfunction getContentType (params) {\n  // only compare mime type; ignore encoding part\n  return params.contentTypeHeader ? params.contentTypeHeader.split(';')[0] : ''\n}\n\nfunction isContentTypeBinaryMimeType (params) {\n  return params.binaryMimeTypes.length > 0 && !!isType.is(params.contentType, params.binaryMimeTypes)\n}\n\nfunction mapApiGatewayEventToHttpRequest (event, context, socketPath) {\n  const headers = Object.assign({}, event.headers)\n\n  // NOTE: API Gateway is not setting Content-Length header on requests even when they have a body\n  if (event.body && !headers['Content-Length']) {\n    const body = getEventBody(event)\n    headers['Content-Length'] = Buffer.byteLength(body)\n  }\n\n  const clonedEventWithoutBody = clone(event)\n  delete clonedEventWithoutBody.body\n\n  headers['x-apigateway-event'] = encodeURIComponent(JSON.stringify(clonedEventWithoutBody))\n  headers['x-apigateway-context'] = encodeURIComponent(JSON.stringify(context))\n\n  return {\n    method: event.httpMethod,\n    path: getPathWithQueryStringParams(event),\n    headers,\n    socketPath\n    // protocol: `${headers['X-Forwarded-Proto']}:`,\n    // host: headers.Host,\n    // hostname: headers.Host, // Alias for host\n    // port: headers['X-Forwarded-Port']\n  }\n}\n\nfunction forwardResponseToApiGateway (server, response, resolver) {\n  const buf = []\n\n  response\n    .on('data', (chunk) => buf.push(chunk))\n    .on('end', () => {\n      const bodyBuffer = Buffer.concat(buf)\n      const statusCode = response.statusCode\n      const headers = response.headers\n\n      // chunked transfer not currently supported by API Gateway\n      /* istanbul ignore else */\n      if (headers['transfer-encoding'] === 'chunked') {\n        delete headers['transfer-encoding']\n      }\n\n      // HACK: modifies header casing to get around API Gateway's limitation of not allowing multiple\n      // headers with the same name, as discussed on the AWS Forum https://forums.aws.amazon.com/message.jspa?messageID=725953#725953\n      Object.keys(headers)\n        .forEach(h => {\n          if (Array.isArray(headers[h])) {\n            if (h.toLowerCase() === 'set-cookie') {\n              headers[h].forEach((value, i) => {\n                headers[binarycase(h, i + 1)] = value\n              })\n              delete headers[h]\n            } else {\n              headers[h] = headers[h].join(',')\n            }\n          }\n        })\n\n      const contentType = getContentType({ contentTypeHeader: headers['content-type'] })\n      const isBase64Encoded = isContentTypeBinaryMimeType({ contentType, binaryMimeTypes: server._binaryTypes })\n      const body = bodyBuffer.toString(isBase64Encoded ? 'base64' : 'utf8')\n      const successResponse = { statusCode, body, headers, isBase64Encoded }\n\n      resolver.succeed({ response: successResponse })\n    })\n}\n\nfunction forwardConnectionErrorResponseToApiGateway (error, resolver) {\n  console.log('ERROR: @vendia/serverless-express connection error')\n  console.error(error)\n  const errorResponse = {\n    statusCode: 502, // \"DNS resolution, TCP level errors, or actual HTTP parse errors\" - https://nodejs.org/api/http.html#http_http_request_options_callback\n    body: '',\n    headers: {}\n  }\n\n  resolver.succeed({ response: errorResponse })\n}\n\nfunction forwardLibraryErrorResponseToApiGateway (error, resolver) {\n  console.log('ERROR: @vendia/serverless-express error')\n  console.error(error)\n  const errorResponse = {\n    statusCode: 500,\n    body: '',\n    headers: {}\n  }\n\n  resolver.succeed({ response: errorResponse })\n}\n\nfunction forwardRequestToNodeServer (server, event, context, resolver) {\n  try {\n    const requestOptions = mapApiGatewayEventToHttpRequest(event, context, getSocketPath(server._socketPathSuffix))\n    const req = http.request(requestOptions, (response) => forwardResponseToApiGateway(server, response, resolver))\n    if (event.body) {\n      const body = getEventBody(event)\n\n      req.write(body)\n    }\n\n    req.on('error', (error) => forwardConnectionErrorResponseToApiGateway(error, resolver))\n      .end()\n  } catch (error) {\n    forwardLibraryErrorResponseToApiGateway(error, resolver)\n    return server\n  }\n}\n\nfunction startServer (server) {\n  return server.listen(getSocketPath(server._socketPathSuffix))\n}\n\nfunction getSocketPath (socketPathSuffix) {\n  /* istanbul ignore if */ /* only running tests on Linux; Window support is for local dev only */\n  if (/^win/.test(process.platform)) {\n    const path = require('path')\n    return path.join('\\\\\\\\?\\\\pipe', process.cwd(), `server-${socketPathSuffix}`)\n  } else {\n    return `/tmp/server-${socketPathSuffix}.sock`\n  }\n}\n\nfunction getRandomString () {\n  return Math.random().toString(36).substring(2, 15)\n}\n\nfunction createServer (requestListener, serverListenCallback, binaryTypes) {\n  const server = http.createServer(requestListener)\n\n  server._socketPathSuffix = getRandomString()\n  server._binaryTypes = binaryTypes ? binaryTypes.slice() : []\n  server.on('listening', () => {\n    server._isListening = true\n\n    if (serverListenCallback) serverListenCallback()\n  })\n  server.on('close', () => {\n    server._isListening = false\n  })\n    .on('error', (error) => {\n      /* istanbul ignore else */\n      if (error.code === 'EADDRINUSE') {\n        console.warn(`WARNING: Attempting to listen on socket ${getSocketPath(server._socketPathSuffix)}, but it is already in use. This is likely as a result of a previous invocation error or timeout. Check the logs for the invocation(s) immediately prior to this for root cause, and consider increasing the timeout and/or cpu/memory allocation if this is purely as a result of a timeout. @vendia/serverless-express will restart the Node.js server listening on a new port and continue with this request.`)\n        server._socketPathSuffix = getRandomString()\n        return server.close(() => startServer(server))\n      } else {\n        console.log('ERROR: server error')\n        console.error(error)\n      }\n    })\n\n  return server\n}\n\nfunction proxy (server, event, context, resolutionMode, callback) {\n  // DEPRECATED: Legacy support\n  if (!resolutionMode) {\n    const resolver = makeResolver({ context, resolutionMode: 'CONTEXT_SUCCEED' })\n    if (server._isListening) {\n      forwardRequestToNodeServer(server, event, context, resolver)\n      return server\n    } else {\n      return startServer(server)\n        .on('listening', () => proxy(server, event, context))\n    }\n  }\n\n  return {\n    promise: new Promise((resolve, reject) => {\n      const promise = {\n        resolve,\n        reject\n      }\n      const resolver = makeResolver({\n        context,\n        callback,\n        promise,\n        resolutionMode\n      })\n\n      if (server._isListening) {\n        forwardRequestToNodeServer(server, event, context, resolver)\n      } else {\n        startServer(server)\n          .on('listening', () => forwardRequestToNodeServer(server, event, context, resolver))\n      }\n    })\n  }\n}\n\nfunction makeResolver (params/* {\n  context,\n  callback,\n  promise,\n  resolutionMode\n} */) {\n  return {\n    succeed: (params2/* {\n      response\n    } */) => {\n      if (params.resolutionMode === 'CONTEXT_SUCCEED') return params.context.succeed(params2.response)\n      if (params.resolutionMode === 'CALLBACK') return params.callback(null, params2.response)\n      if (params.resolutionMode === 'PROMISE') return params.promise.resolve(params2.response)\n    }\n  }\n}\n\nexports.createServer = createServer\nexports.proxy = proxy\n\n/* istanbul ignore else */\nif (process.env.NODE_ENV === 'test') {\n  exports.getPathWithQueryStringParams = getPathWithQueryStringParams\n  exports.mapApiGatewayEventToHttpRequest = mapApiGatewayEventToHttpRequest\n  exports.forwardResponseToApiGateway = forwardResponseToApiGateway\n  exports.forwardConnectionErrorResponseToApiGateway = forwardConnectionErrorResponseToApiGateway\n  exports.forwardLibraryErrorResponseToApiGateway = forwardLibraryErrorResponseToApiGateway\n  exports.forwardRequestToNodeServer = forwardRequestToNodeServer\n  exports.startServer = startServer\n  exports.getSocketPath = getSocketPath\n  exports.makeResolver = makeResolver\n}\n", "'use strict'\n\nmodule.exports = require('./src/index')\n", "const serverlessExpress = require('@vendia/serverless-express')\n\nexports.createServer = serverlessExpress.createServer\nexports.proxy = serverlessExpress.proxy\n\n/* istanbul ignore else */\nif (process.env.NODE_ENV === 'test') {\n  exports.getPathWithQueryStringParams = serverlessExpress.getPathWithQueryStringParams\n  exports.mapApiGatewayEventToHttpRequest = serverlessExpress.mapApiGatewayEventToHttpRequest\n  exports.forwardResponseToApiGateway = serverlessExpress.forwardResponseToApiGateway\n  exports.forwardConnectionErrorResponseToApiGateway = serverlessExpress.forwardConnectionErrorResponseToApiGateway\n  exports.forwardLibraryErrorResponseToApiGateway = serverlessExpress.forwardLibraryErrorResponseToApiGateway\n  exports.forwardRequestToNodeServer = serverlessExpress.forwardRequestToNodeServer\n  exports.startServer = serverlessExpress.startServer\n  exports.getSocketPath = serverlessExpress.getSocketPath\n  exports.makeResolver = serverlessExpress.makeResolver\n}\n", "'use strict'\n\nmodule.exports = require('./src/index')\n", "const aws = require('aws-serverless-express')\n\nmodule.exports = function unexpress (app) {\n  let server = aws.createServer(app)\n  return function http (event, context, callback) {\n    if (process.env.NODE_ENV === 'testing' || process.env.ARC_LOCAL) {\n      return aws.proxy(server, event, context, 'CALLBACK', callback)\n    }\n    else {\n      return aws.proxy(server, event, context)\n    }\n  }\n}\n", "/**\n * transform reduces {headers, body} with given plugins\n *\n * @param args - arguments obj\n * @param args.Key - the origin S3 bucket Key requested\n * @param args.config - the entire arc.proxy.public config obj\n * @param args.defaults - the default {headers, body} in the transform pipeline\n */\nmodule.exports = function transform ({ Key, config, isBinary, defaults }) {\n  let filetype = Key.split('.').pop()\n  let plugins = config.plugins ? config.plugins[filetype] || [] : []\n  // early return if there's no processing to do\n  if (plugins.length === 0 || isBinary)\n    return defaults\n  else {\n    defaults.body = defaults.body.toString() // Convert non-binary files to strings for mutation\n    // otherwise walk the supplied plugins\n    return plugins.reduce(function run (response, plugin) {\n      /* eslint global-require: 'off' */\n      let transformer = typeof plugin === 'function' ? plugin : require(plugin)\n      return transformer(Key, response, config)\n    }, defaults)\n  }\n}\n", "module.exports = function templatizeResponse (params) {\n  let { isBinary, assets, response, isLocal = false } = params\n\n  // Bail early\n  if (isBinary) {\n    return response\n  }\n  else {\n    // Find: ${STATIC('path/filename.ext')}\n    //   or: ${arc.static('path/filename.ext')}\n    let staticRegex = /\\${(STATIC|arc\\.static)\\(.*\\)}/g\n    // Maybe stringify jic previous steps passed a buffer; perhaps we can remove this step if/when proxy plugins is retired\n    let body = response.body instanceof Buffer ? response.body.toString() : response.body\n    response.body = body.replace(staticRegex, function fingerprint (match) {\n      let start = match.startsWith(`\\${STATIC(`) ? 10 : 14\n      let Key = match.slice(start, match.length - 3)\n      // Normalize around no leading slash for static manifest lookups\n      let startsWithSlash = Key.startsWith('/')\n      let lookup = startsWithSlash ? Key.substr(1) : Key\n      if (assets && assets[lookup] && !isLocal) {\n        Key = assets[lookup]\n        Key = startsWithSlash ? `/${Key}` : Key\n      }\n      return Key\n    })\n    response.body = Buffer.from(response.body) // Re-enbufferize\n    return response\n  }\n}\n", "let {\n  gzipSync,\n  gunzipSync,\n  brotliCompressSync,\n  brotliDecompressSync,\n  deflateSync,\n  inflateSync,\n} = require('zlib')\n\nfunction compressor (direction, type, data) {\n  let compress = direction === 'compress'\n  let exec = {\n    gzip: compress ? gzipSync : gunzipSync,\n    br: compress ? brotliCompressSync : brotliDecompressSync,\n    deflate: compress ? deflateSync : inflateSync\n  }\n  if (!exec[type]) throw ReferenceError('Invalid compression type specified, must be gzip, br, or deflate')\n\n  return exec[type](data)\n}\n\nmodule.exports = {\n  compress: compressor.bind({}, 'compress'),\n  decompress: compressor.bind({}, 'decompress')\n}\n", "let mime = require('mime-types')\nlet path = require('path')\nlet { compress } = require('./compress')\n\n/**\n * Normalizes response shape\n */\nmodule.exports = function normalizeResponse (params) {\n  let { response, result, Key, isProxy, contentEncoding, config } = params\n\n  let noCache = [\n    'text/html',\n    'application/json',\n    'application/vnd.api+json'\n  ]\n  response.headers = response.headers || {}\n\n  // Establish Content-Type\n  let contentType =\n    response.headers['Content-Type'] || // Possibly get content-type passed via proxy plugins\n    response.headers['content-type'] || // ...\n    result && result.ContentType ||     // Fall back to what came down from S3's metadata\n    mime.contentType(path.extname(Key)) // Finally, fall back to the mime type database\n\n  // Set Content-Type\n  response.headers['Content-Type'] = contentType\n\n  // Set caching headers\n  let neverCache = noCache.some(n => contentType.includes(n))\n  if (config.cacheControl) {\n    response.headers['Cache-Control'] = config.cacheControl\n  }\n  else if (neverCache) {\n    response.headers['Cache-Control'] = 'no-cache, no-store, must-revalidate, max-age=0, s-maxage=0'\n  }\n  else if (result && result.CacheControl) {\n    response.headers['Cache-Control'] = result.CacheControl\n  }\n  else {\n    response.headers['Cache-Control'] = 'public, max-age=0, must-revalidate'\n  }\n\n  // Populate optional userland headers\n  if (config.headers) {\n    Object.keys(config.headers).forEach(h => response.headers[h] = config.headers[h])\n  }\n\n  // Normalize important common header casings to prevent dupes\n  if (response.headers['content-type']) {\n    response.headers['Content-Type'] = response.headers['content-type']\n    delete response.headers['content-type']\n  }\n  // Probably unable to be set via this code path, but normalize jic\n  if (response.headers['cache-control']) {\n    response.headers['Cache-Control'] = response.headers['cache-control']\n    delete response.headers['cache-control']\n  }\n\n  let notArcSix = !process.env.ARC_CLOUDFORMATION\n  let notArcProxy = !process.env.ARC_HTTP || process.env.ARC_HTTP === 'aws'\n  let isArcFive = notArcSix && notArcProxy\n  let isHTML = response.headers['Content-Type'].includes('text/html')\n  if (isArcFive && isHTML && !isProxy) {\n    // This is a deprecated code path that may be removed when Arc 5 exits LTS status\n    // Only return string bodies for certain types, and ONLY in Arc 5\n    response.body = Buffer.from(response.body).toString()\n    response.type = response.headers['Content-Type'] // Re-set type or it will fall back to JSON\n  }\n  else {\n    if (contentEncoding) {\n      response.body = compress(contentEncoding, response.body)\n      response.headers['Content-Encoding'] = contentEncoding\n    }\n    // Base64 everything else on the way out to enable text + binary support\n    response.body = Buffer.from(response.body).toString('base64')\n    response.isBase64Encoded = true\n  }\n\n  // Add ETag\n  response.headers.ETag = result.ETag\n\n  return response\n}\n", "let aws = require('aws-sdk')\nlet { existsSync, readFileSync } = require('fs')\nlet { join } = require('path')\nlet { httpError } = require('../../errors')\n\n/**\n * Peek into a dir without a trailing slash to see if it's got an index.html file\n *   If not, look for a custom 404.html\n *   Finally, return the default 404\n */\nmodule.exports = async function pretty (params) {\n  let { Bucket, Key, assets, headers, isFolder, prefix } = params\n  let { ARC_LOCAL, ARC_SANDBOX_PATH_TO_STATIC, NODE_ENV } = process.env\n  let local = NODE_ENV === 'testing' || ARC_LOCAL\n  let s3 = new aws.S3\n\n  function getKey (Key) {\n    let lookup = Key.replace(prefix + '/', '')\n    if (assets && assets[lookup]) {\n      Key = assets[lookup]\n      Key = prefix ? `${prefix}/${Key}` : Key\n    }\n    return Key\n  }\n\n  // eslint-disable-next-line\n  async function getLocal (file) {\n    let basepath = ARC_SANDBOX_PATH_TO_STATIC\n    if (!file.startsWith(basepath)) {\n      file = join(basepath, file)\n    }\n    if (!existsSync(file)) {\n      let err = ReferenceError(`NoSuchKey: ${Key} not found`)\n      err.name = 'NoSuchKey'\n      throw err\n    }\n    else return {\n      Body: readFileSync(file)\n    }\n  }\n\n  async function getS3 (Key) {\n    return await s3.getObject({ Bucket, Key }).promise()\n  }\n\n  async function get (file) {\n    let getter = local ? getLocal : getS3\n    try {\n      return await getter(file)\n    }\n    catch (err) {\n      if (err.name === 'NoSuchKey') {\n        err.statusCode = 404\n        return err\n      }\n      else {\n        err.statusCode = 500\n        return err\n      }\n    }\n  }\n\n  /**\n   * Enable pretty urls\n   *   Peek into a dir without trailing slash to see if it contains index.html\n   */\n  if (isFolder && !Key.endsWith('/')) {\n    let peek = getKey(`${Key}/index.html`)\n    let result = await get(peek)\n    if (result.Body) {\n      let body = result.Body.toString()\n      return { headers, statusCode: 200, body }\n    }\n  }\n\n  /**\n   * Enable custom 404s\n   *   Check to see if user defined a custom 404 page\n   */\n  let notFound = getKey(`404.html`)\n  let result = await get(notFound)\n  if (result.Body) {\n    let body = result.Body.toString()\n    return {\n      headers: {\n        'Content-Type': 'text/html; charset=utf8;',\n        'Cache-Control': 'no-cache, no-store, must-revalidate, max-age=0, s-maxage=0'\n      },\n      statusCode: 404,\n      body\n    }\n  }\n  else {\n    let err = result\n    let { statusCode } = err\n    let title = err.name\n    let message = `\n      ${err.message} <pre><b>${Key}</b></pre><br>\n      <pre>${err.stack}</pre>\n    `\n    return httpError({ statusCode, title, message })\n  }\n}\n", "let { existsSync, readFileSync } = require('fs')\nlet { extname, join, sep } = require('path')\nlet mime = require('mime-types')\nlet crypto = require('crypto')\n\nlet binaryTypes = require('../../helpers/binary-types')\nlet { httpError } = require('../../errors')\nlet transform = require('../format/transform') // Soon to be deprecated\nlet templatizeResponse = require('../format/templatize')\nlet normalizeResponse = require('../format/response')\nlet pretty = require('./_pretty')\n\n/**\n * arc.http.proxy.read\n *\n * Reads a file from the local filesystem, resolving an HTTP Lambda friendly payload\n *\n * @param {Object} params\n * @param {String} params.Key\n * @param {String} params.IfNoneMatch\n * @param {String} params.isFolder\n * @param {String} params.isProxy\n * @param {Object} params.config\n * @returns {Object} {statusCode, headers, body}\n */\nmodule.exports = async function readLocal (params) {\n\n  let { ARC_SANDBOX_PATH_TO_STATIC, ARC_STATIC_PREFIX, ARC_STATIC_FOLDER } = process.env\n  let { Key, IfNoneMatch, isFolder, isProxy, config } = params\n  let headers = {}\n  let response = {}\n\n  // Unlike S3, handle basePath and assets inside the function as Sandbox is long-lived\n  let staticAssets\n  // After 6.x we can rely on this env var in sandbox\n  let basePath = ARC_SANDBOX_PATH_TO_STATIC || join(process.cwd(), '..', '..', '..', 'public')\n  let staticManifest = join(basePath, 'static.json')\n  if (existsSync(staticManifest)) {\n    staticAssets = JSON.parse(readFileSync(staticManifest))\n  }\n  let assets = config.assets || staticAssets\n\n  // Look up the blob\n  // Assume we're running from a lambda in src/**/* OR from vendored node_modules/@architect/sandbox\n  let filePath = join(basePath, Key)\n  // Denormalize static folder for local paths (not something we'd do in S3)\n  let staticPrefix = ARC_STATIC_PREFIX || ARC_STATIC_FOLDER\n  if (filePath.includes(staticPrefix)) {\n    filePath = filePath.replace(`${staticPrefix}${sep}`, '')\n  }\n\n  try {\n    // If client sends If-None-Match, use it in S3 getObject params\n    let matchedETag = false\n\n    // If the static asset manifest has the key, use that, otherwise fall back to the original Key\n    let contentType = mime.contentType(extname(Key))\n\n    if (!existsSync(filePath)) {\n      return await pretty({ Key: filePath, config, isFolder })\n    }\n\n    let body = readFileSync(filePath)\n    let ETag = crypto.createHash('sha256').update(body).digest('hex')\n    let result = {\n      ContentType: contentType,\n      ETag\n    }\n    if (IfNoneMatch === ETag) {\n      matchedETag = true\n      headers.ETag = IfNoneMatch\n      response = {\n        statusCode: 304,\n        headers\n      }\n    }\n\n    // No ETag found, return the blob\n    if (!matchedETag) {\n      let isBinary = binaryTypes.some(type => result.ContentType.includes(type) || contentType.includes(type))\n\n      // Transform first to allow for any proxy plugin mutations\n      response = transform({\n        Key,\n        config,\n        isBinary,\n        defaults: {\n          headers,\n          body\n        }\n      })\n\n      // Handle templating\n      response = templatizeResponse({\n        isBinary,\n        assets,\n        response,\n        isLocal: true\n      })\n\n      // Normalize response\n      response = normalizeResponse({\n        response,\n        result,\n        Key,\n        isProxy,\n        config\n      })\n\n      // Add ETag\n      response.headers.ETag = result.ETag\n    }\n\n    if (!response.statusCode) {\n      response.statusCode = 200\n    }\n\n    return response\n  }\n  catch (err) {\n    let notFound = err.name === 'NoSuchKey'\n    if (notFound) {\n      return await pretty({ Key: filePath, config, isFolder })\n    }\n    else {\n      let title = err.name\n      let message = `\n        ${err.message}<br>\n        <pre>${err.stack}</pre>\n      `\n      return httpError({ statusCode: 500, title, message })\n    }\n  }\n}\n", "let { existsSync, readFileSync } = require('fs')\nlet { extname, join } = require('path')\nlet mime = require('mime-types')\nlet aws = require('aws-sdk')\n\nlet binaryTypes = require('../../helpers/binary-types')\nlet { httpError } = require('../../errors')\nlet transform = require('../format/transform') // Soon to be deprecated\nlet templatizeResponse = require('../format/templatize')\nlet normalizeResponse = require('../format/response')\nlet pretty = require('./_pretty')\nlet { decompress } = require('../format/compress')\n\n/**\n * arc.http.proxy.read\n *\n * Reads a file from S3, resolving an HTTP Lambda friendly payload\n *\n * @param {Object} params\n * @param {String} params.Key\n * @param {String} params.Bucket\n * @param {String} params.IfNoneMatch\n * @param {String} params.isFolder\n * @param {String} params.isProxy\n * @param {Object} params.config\n * @returns {Object} {statusCode, headers, body}\n */\nmodule.exports = async function readS3 (params) {\n\n  let { Bucket, Key, IfNoneMatch, isFolder, isProxy, config, rootPath } = params\n  let { ARC_STATIC_PREFIX, ARC_STATIC_FOLDER } = process.env\n  let prefix = ARC_STATIC_PREFIX || ARC_STATIC_FOLDER || config.bucket && config.bucket.folder\n  let assets = config.assets || staticAssets\n  let headers = {}\n  let response = {}\n\n  try {\n    // If client sends If-None-Match, use it in S3 getObject params\n    let matchedETag = false\n    let s3 = new aws.S3\n\n    // Try to interpolate HTML/JSON requests to fingerprinted filenames\n    let contentType = mime.contentType(extname(Key))\n    let capture = [ 'text/html', 'application/json' ]\n    let isCaptured = capture.some(type => contentType.includes(type))\n    if (assets && assets[Key] && isCaptured) {\n      // Not necessary to flag response formatter for anti-caching\n      // Those headers are already set in S3 file metadata\n      Key = assets[Key]\n    }\n\n    /**\n     * Check for possible fingerprint upgrades and forward valid requests\n     */\n    if (assets && assets[Key] && !isCaptured) {\n      let location = rootPath\n        ? `/${rootPath}/_static/${assets[Key]}`\n        : `/_static/${assets[Key]}`\n      return {\n        statusCode: 302,\n        headers: {\n          location,\n          'Cache-Control': 'no-cache, no-store, must-revalidate, max-age=0, s-maxage=0'\n        }\n      }\n    }\n\n    /**\n     * Folder prefix\n     *   Enables a bucket folder at root to be specified\n     */\n    if (prefix) {\n      Key = `${prefix}/${Key}`\n    }\n\n    let options = { Bucket, Key }\n    if (IfNoneMatch) {\n      options.IfNoneMatch = IfNoneMatch\n    }\n\n    let result = await s3.getObject(options).promise().catch(err => {\n      // ETag matches (getObject error code of NotModified), so don't transit the whole file\n      if (err.code === 'NotModified') {\n        matchedETag = true\n        headers.ETag = IfNoneMatch\n        response = {\n          statusCode: 304,\n          headers\n        }\n      }\n      else {\n        // Important: do not swallow this error otherwise!\n        throw err\n      }\n    })\n\n    // No ETag found, return the blob\n    if (!matchedETag) {\n      let contentEncoding = result.ContentEncoding\n      if (contentEncoding) {\n        result.Body = decompress(contentEncoding, result.Body)\n      }\n\n      let isBinary = binaryTypes.some(type => result.ContentType.includes(type) || contentType.includes(type))\n\n      // Transform first to allow for any proxy plugin mutations\n      response = transform({\n        Key,\n        config,\n        isBinary,\n        defaults: {\n          headers,\n          body: result.Body\n        }\n      })\n\n      // Handle templating\n      response = templatizeResponse({\n        isBinary,\n        assets,\n        response\n      })\n\n      // Normalize response\n      response = normalizeResponse({\n        response,\n        result,\n        Key,\n        isProxy,\n        contentEncoding,\n        config\n      })\n    }\n\n    if (!response.statusCode) {\n      response.statusCode = 200\n    }\n\n    return response\n  }\n  catch (err) {\n    let notFound = err.name === 'NoSuchKey'\n    if (notFound) {\n      return await pretty({ Bucket, Key, assets, headers, isFolder, prefix })\n    }\n    else {\n      let title = err.name\n      let message = `\n        ${err.message}<br>\n        <pre>${err.stack}</pre>\n      `\n      return httpError({ statusCode: 500, title, message })\n    }\n  }\n}\n\n/**\n * Fingerprinting manifest\n *   Load the manifest, try to hit the disk as infrequently as possible across invocations\n */\nlet staticAssets\nlet staticManifest = join(process.cwd(), 'node_modules', '@architect', 'shared', 'static.json')\nif (staticAssets === false) {\n  null /* noop*/\n}\nelse if (existsSync(staticManifest) && !staticAssets) {\n  staticAssets = JSON.parse(readFileSync(staticManifest))\n}\nelse {\n  staticAssets = false\n}\n", "let readLocal = require('./_local')\nlet readS3 = require('./_s3')\n\nfunction read () {\n  let { ARC_LOCAL, NODE_ENV } = process.env\n  let local = NODE_ENV === 'testing' || ARC_LOCAL\n  return local ? readLocal : readS3\n}\n\nmodule.exports = read()\n", "let read = require('./read')\nlet errors = require('../errors')\n\n/**\n * arc.http.proxy\n *\n * Primary interface for reading static assets out of S3\n *\n * @param config - object, for configuration\n * @param config.alias - object, map of root rel URLs to map to fully qualified root rel URLs\n * @param config.assets - object, map of local, unfingerprinted filenames to fingerprinted filenames\n * @param config.bucket - object, {staging, production} override the s3 bucket names\n * @param config.bucket.staging - object, {staging, production} override the s3 bucket names\n * @param config.bucket.production - object, {staging, production} override the s3 bucket names\n * @param config.bucket.folder - string, bucket folder\n * @param config.cacheControl - string, set a custom Cache-Control max-age header value\n * @param config.plugins - object, configure proxy-plugin-* transforms per file extension\n * @param config.spa - boolean, forces index.html no matter the folder depth\n *\n * @returns HTTPLambda - an HTTP Lambda function that proxies calls to S3\n */\nfunction proxy (config = {}) {\n  return async function httpProxy (req) {\n    let { ARC_STATIC_BUCKET, ARC_STATIC_SPA, NODE_ENV } = process.env\n    let deprecated = req.version === undefined || req.version === '1.0'\n\n    let isProduction = NODE_ENV === 'production'\n    let path = deprecated ? req.path : req.rawPath\n    let isFolder = path.split('/').pop().indexOf('.') === -1\n    let Key // Assigned below\n\n    /**\n     * Bucket config\n     */\n    let configBucket = config.bucket\n    let bucketSetting = isProduction\n      ? configBucket && configBucket['production']\n      : configBucket && configBucket['staging']\n    // Ok, all that out of the way, let's set the actual bucket, eh?\n    let Bucket = ARC_STATIC_BUCKET || bucketSetting\n    if (!Bucket) {\n      return errors.proxyConfig\n    }\n\n    /**\n     * Configure SPA + set up the file to be requested\n     */\n    let spa = ARC_STATIC_SPA === 'false'\n      ? false\n      : config && config.spa\n    if (!spa) config.spa = false\n    if (spa) {\n      // If SPA: force index.html\n      Key = isFolder ? 'index.html' : path.substring(1)\n    }\n    else {\n      // Return index.html for root, otherwise pass the path\n      let last = path.split('/').filter(Boolean).pop()\n      let isFile = last ? last.includes('.') : false\n      let isRoot = path === '/'\n\n      Key = isRoot ? 'index.html' : path.substring(1) // Always remove leading slash\n\n      // Append default index.html to requests to folder paths\n      if (isRoot === false && isFile === false) {\n        Key = `${Key.replace(/\\/$/, '')}/index.html`\n      }\n    }\n\n    /**\n     * Alias\n     *   Allows a Key to be manually overridden\n     */\n    let aliasing = config && config.alias && config.alias[path]\n    if (aliasing) {\n      Key = config.alias[path].substring(1) // Always remove leading slash\n    }\n\n    /**\n     * REST API [very deprecated]: strip `staging/`, `production/` path parts\n     * - Post Architect 5.5 (2019-02-03) which added /{proxy+} this would be an edge case\n     * - e.g. you'd see this if someone put up a proxy in not-`get /`\n     */\n    if (Key.startsWith('staging/'))     Key = Key.replace('staging/', '')\n    if (Key.startsWith('production/'))  Key = Key.replace('production/', '')\n\n    /**\n     * REST API [deprecated]: flag `staging/`, `production/` requests\n     */\n    let rootPath\n    let reqPath = req.requestContext && req.requestContext.path\n    if (deprecated && reqPath) {\n      if (reqPath && reqPath.startsWith('/staging/')) rootPath = 'staging'\n      if (reqPath && reqPath.startsWith('/production/')) rootPath = 'production'\n    }\n\n    // Normalize if-none-match header to lower case; it differs between environments\n    let find = k => k.toLowerCase() === 'if-none-match'\n    let IfNoneMatch = req.headers && req.headers[Object.keys(req.headers).find(find)]\n\n    // Ensure response shape is correct for proxy SPA responses\n    let isProxy = req.resource === '/{proxy+}' || !!req.rawPath\n\n    return await read({ Key, Bucket, IfNoneMatch, isFolder, isProxy, config, rootPath })\n  }\n}\n\nmodule.exports = {\n  proxy,  // Default\n  read    // Read a specific file\n}\n", "// HTTP\nlet http = require('./http')\n\n// HTTP helpers\nlet bodyParser = require('./helpers/body-parser')\nlet interpolate = require('./helpers/params')\nlet _static = require('../static')\nlet url = require('./helpers/url')\n\n// Session\nlet read = require('./session/read')\nlet write = require('./session/write')\n\n// Middleware\nlet _async = require('./async')\nlet express = require('./express')\n\n// Proxy\nlet proxy = require('./proxy')\n\nhttp.helpers = {\n  bodyParser,\n  interpolate,\n  static: _static,\n  url\n}\nhttp.session = { read, write }\nhttp.async = _async\nhttp.express = express\nhttp.proxy = proxy.proxy\n\n// Legacy methods\nhttp.proxy.public = proxy.proxy\nhttp.proxy.read = proxy.read\nhttp.middleware = _async\n\nmodule.exports = http\n", "let aws = require('aws-sdk')\nlet http = require('http')\n/**\n * @param {string} type - events, queues, or tables\n * @returns {object} {name: value}\n */\nmodule.exports = function lookup (callback) {\n  let Path = `/${process.env.ARC_CLOUDFORMATION}`\n  let Recursive = true\n  let values = []\n  let isLocal = process.env.NODE_ENV === 'testing'\n  let config\n  if (isLocal) {\n    // if running in sandbox, sandbox has an SSM mock, use that\n    let port = process.env.ARC_INTERNAL || 3332\n    let region = process.env.AWS_REGION || 'us-west-2'\n    config = {\n      endpoint: new aws.Endpoint(`http://localhost:${port}/_arc/ssm`),\n      region,\n      httpOptions: { agent: new http.Agent() }\n    }\n  }\n  let ssm = new aws.SSM(config)\n\n  function getParams (params) {\n    ssm.getParametersByPath(params, function done (err, result) {\n      if (err) {\n        callback(err)\n      }\n      else if (result.NextToken) {\n        values = values.concat(result.Parameters)\n        getParams({ Path, Recursive, NextToken: result.NextToken })\n      }\n      else {\n        values = values.concat(result.Parameters)\n        callback(null, values.reduce((a, b) => {\n          let hierarchy = b.Name.split('/')\n          hierarchy.shift() // leading slash\n          hierarchy.shift() // stack name\n          let type = hierarchy.shift() // i.e. tables, events, queues, plugins\n          if (!a[type]) a[type] = {}\n          let parent = a[type]\n          let child, lastChild, lastParent\n          /* eslint-disable-next-line */\n          while (child = hierarchy.shift()) {\n            if (!parent[child]) parent[child] = {}\n            lastParent = parent\n            parent = parent[child]\n            lastChild = child\n          }\n          lastParent[lastChild] = b.Value\n          return a\n        }, {}))\n      }\n    })\n  }\n\n  getParams({ Path, Recursive })\n}\n", "let http = require('http')\n\nmodule.exports = function send ({ id, payload }, callback) {\n  let port = process.env.PORT || 3333\n  let body = JSON.stringify({ id, payload })\n  let req = http.request({\n    method: 'POST',\n    port,\n    path: '/__arc',\n    headers: {\n      'Content-Type': 'application/json',\n      'Content-Length': Buffer.byteLength(body)\n    }\n  })\n  req.on('error', callback)\n  req.on('close', () => callback())\n  req.write(body)\n  req.end()\n}\n", "let aws = require('aws-sdk')\n\nmodule.exports = function send ({ id, payload }, callback) {\n  let endpoint\n  let ARC_WSS_URL = process.env.ARC_WSS_URL\n  if (!ARC_WSS_URL.startsWith('wss://')) {\n    // This format of env was only alive for a few weeks, can prob safely retire by mid 2020\n    endpoint = `https://${ARC_WSS_URL}/${process.env.NODE_ENV}`\n  }\n  else {\n    endpoint = `https://${ARC_WSS_URL.replace('wss://', '')}`\n  }\n  let api = new aws.ApiGatewayManagementApi({\n    apiVersion: '2018-11-29',\n    endpoint\n  })\n  api.postToConnection({\n    ConnectionId: id,\n    Data: JSON.stringify(payload)\n  },\n  function postToConnection (err) {\n    if (err) callback(err)\n    else callback()\n  })\n}\n", "let sandbox = require('./send-sandbox')\nlet run = require('./send')\n\n/**\n * arc.ws.send\n *\n * publish web socket events\n *\n * @param {Object} params\n * @param {String} params.id - the ws connecton id (required)\n * @param {Object} params.payload - an event payload (required)\n * @param {Function} callback - a node style errback (optional)\n * @returns {Promise} - returned if no callback is supplied\n */\nmodule.exports = function send ({ id, payload }, callback) {\n\n  // create a promise if no callback is defined\n  let promise\n  if (!callback) {\n    promise = new Promise(function (res, rej) {\n      callback = function (err, result) {\n        err ? rej(err) : res(result)\n      }\n    })\n  }\n\n  let local = process.env.NODE_ENV === 'testing' || process.env.ARC_LOCAL\n  let exec = local ? sandbox : run\n\n  exec({\n    id,\n    payload\n  }, callback)\n\n  return promise\n}\n", "/*! run-waterfall. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */\nmodule.exports = runWaterfall\n\nfunction runWaterfall (tasks, cb) {\n  var current = 0\n  var isSync = true\n\n  function done (err, args) {\n    function end () {\n      args = args ? [].concat(err, args) : [err]\n      if (cb) cb.apply(undefined, args)\n    }\n    if (isSync) process.nextTick(end)\n    else end()\n  }\n\n  function each (err) {\n    var args = Array.prototype.slice.call(arguments, 1)\n    if (++current >= tasks.length || err) {\n      done(err, args)\n    } else {\n      tasks[current].apply(undefined, [].concat(args, each))\n    }\n  }\n\n  if (tasks.length) {\n    tasks[0](each)\n  } else {\n    done(null)\n  }\n\n  isSync = false\n}\n", "var parallel = require('run-parallel')\n/**\n * var trigger = require('aws-dynamodb-lambda-trigger/lambda')\n *\n * function onInsert(record, callback) {\n *   console.log(record)\n *   callback(null, record) // errback style; results passed to context.succeed\n * }\n *\n * module.exports = trigger.insert(onInsert)\n */\n\nfunction __trigger (types, handler) {\n  return function __lambdaSignature (evt, ctx) {\n    // dynamo triggers send batches of records so we're going to create a handler for each one\n    var handlers = evt.Records.map(function (record) {\n      // for each record we construct a handler function\n      return function __actualHandler (callback) {\n        // if isInvoking we invoke the handler with the record\n        var isInvoking = types.indexOf(record.eventName) > -1\n        if (isInvoking) {\n          handler(record, callback)\n        }\n        else {\n          callback() // if not we just call the continuation (callback)\n        }\n      }\n    })\n    // executes the handlers in parallel\n    parallel(handlers, function __processedRecords (err, results) {\n      if (err) {\n        ctx.fail(err)\n      }\n      else {\n        ctx.succeed(results)\n      }\n    })\n  }\n}\n\n/* eslint indent: 0 */\nmodule.exports = {\n  insert: __trigger.bind({}, [ 'INSERT' ]),\n  modify: __trigger.bind({}, [ 'MODIFY' ]),\n  update: __trigger.bind({}, [ 'MODIFY' ]),\n  remove: __trigger.bind({}, [ 'REMOVE' ]),\n destroy: __trigger.bind({}, [ 'REMOVE' ]),\n     all: __trigger.bind({}, [ 'INSERT', 'MODIFY', 'REMOVE' ]),\n    save: __trigger.bind({}, [ 'INSERT', 'MODIFY' ]),\n  change: __trigger.bind({}, [ 'INSERT', 'REMOVE' ])\n}\n", "// accepts an object and promisifies all keys\nmodule.exports = function pfy (obj) {\n  var copy = {}\n  Object.keys(obj).forEach(k => {\n    copy[k] = promised(obj[k])\n  })\n  return copy\n}\n\n// accepts an errback style fn and returns a promisified fn\nfunction promised (fn) {\n  return function _promisified (params, callback) {\n    if (!callback) {\n      return new Promise(function (res, rej) {\n        fn(params, function (err, result) {\n          err ? rej(err) : res(result)\n        })\n      })\n    }\n    else {\n      fn(params, callback)\n    }\n  }\n}\n", "let dynamo = require('./dynamo')\nlet promisify = require('./promisify-object')\nlet parallel = require('run-parallel')\n\n/**\n * returns a data client\n */\nmodule.exports = function reflectFactory (tables, callback) {\n  let { db, doc } = dynamo\n  parallel({ db, doc }, function done (err, { db, doc }) {\n    if (err) throw err\n    else {\n\n      let data = Object.keys(tables).reduce((client, tablename) => {\n        client[tablename] = factory(tables[tablename])\n        return client\n      }, {})\n\n      Object.defineProperty(data, '_db', {\n        enumerable: false,\n        value: db\n      })\n\n      Object.defineProperty(data, '_doc', {\n        enumerable: false,\n        value: doc\n      })\n\n      // async jic for later\n      // eslint-disable-next-line\n      data.reflect = async function reflect () {\n        return tables\n      }\n\n      let _name = name => tables[name]\n      data.name = _name\n      data._name = _name\n\n      function factory (TableName) {\n        return promisify({\n          delete (key, callback) {\n            let params = {}\n            params.TableName = TableName\n            params.Key = key\n            doc.delete(params, callback)\n          },\n          get (key, callback) {\n            let params = {}\n            params.TableName = TableName\n            params.Key = key\n            doc.get(params, function _get (err, result) {\n              if (err) callback(err)\n              else callback(null, result.Item)\n            })\n          },\n          put (item, callback) {\n            let params = {}\n            params.TableName = TableName\n            params.Item = item\n            doc.put(params, function _put (err) {\n              if (err) callback(err)\n              else callback(null, item)\n            })\n          },\n          query (params, callback) {\n            params.TableName = TableName\n            doc.query(params, callback)\n          },\n          scan (params, callback) {\n            params.TableName = TableName\n            doc.scan(params, callback)\n          },\n          update (params, callback) {\n            params.TableName = TableName\n            doc.update(params, callback)\n          }\n        })\n      }\n\n      callback(null, data)\n    }\n  })\n}\n", "const promisifyObject = require('./promisify-object')\nconst parallel = require('run-parallel')\n\nconst stagingTables = tbl => !tbl.includes('-production-')\n\nfunction client (doc, TableName) {\n  let client = {\n    delete (key, callback) {\n      let params = {}\n      params.TableName = TableName\n      params.Key = key\n      doc.delete(params, callback)\n    },\n    get (key, callback) {\n      let params = {}\n      params.TableName = TableName\n      params.Key = key\n      doc.get(params, function _get (err, result) {\n        if (err) {\n          callback(err)\n        }\n        else {\n          callback(null, result.Item)\n        }\n      })\n    },\n    put (item, callback) {\n      let params = {}\n      params.TableName = TableName\n      params.Item = item\n      doc.put(params, function _put (err) {\n        if (err) {\n          callback(err)\n        }\n        else {\n          callback(null, item)\n        }\n      })\n    },\n    query (params, callback) {\n      params.TableName = TableName\n      doc.query(params, callback)\n    },\n    scan (params, callback) {\n      params.TableName = TableName\n      doc.scan(params, callback)\n    },\n    update (params, callback) {\n      params.TableName = TableName\n      doc.update(params, callback)\n    }\n  }\n  return promisifyObject(client)\n}\n\n/**\n * returns a data client\n */\nmodule.exports = function sandbox (dynamo, callback) {\n  function done (err, results) {\n    if (err) {\n      return callback(err)\n    }\n\n    const db = results[0]\n    const doc = results[1]\n\n    db.listTables({}, function listed (err, result) {\n      if (err) {\n        return callback(err)\n      }\n      const tables = result.TableNames.filter(stagingTables)\n      const data = {}\n      const tableMap = {}\n      tables.forEach(fullTableName => {\n        const tableName = fullTableName.replace(/.+-staging-/, '')\n        tableMap[tableName] = fullTableName\n        data[tableName] = client(doc, fullTableName)\n      })\n\n      Object.defineProperty(data, '_db', {\n        enumerable: false,\n        value: db\n      })\n\n      Object.defineProperty(data, '_doc', {\n        enumerable: false,\n        value: doc\n      })\n\n      // async jic for later\n      // eslint-disable-next-line\n      data.reflect = async () => tableMap\n\n      let _name = tableName => tableMap[tableName]\n      data.name = _name\n      data._name = _name\n\n      callback(null, data)\n    })\n  }\n\n  parallel([ dynamo.db, dynamo.doc ], done)\n}\n", "let waterfall = require('run-waterfall')\nlet old = require('./old')\nlet factory = require('./factory')\nlet sandbox = require('./sandbox')\nlet dynamo = require('./dynamo')\n\n// cheap client cache\nlet client = false\n\n/**\n * // example usage:\n * let arc = require('architect/functions')\n *\n * exports.handler = async function http(req) {\n *  let data = await arc.tables()\n *  await data.tacos.put({taco: 'pollo'})\n *  return {statusCode: 200}\n * }\n */\nfunction tables (arc) {\n  function api (callback) {\n    let promise\n    if (!callback) {\n      promise = new Promise(function ugh (res, rej) {\n        callback = function errback (err, result) {\n          if (err) rej(err)\n          else res(result)\n        }\n      })\n    }\n    /**\n     * Read Architect manifest if local / sandbox, otherwise use service reflection\n     */\n    let runningLocally = process.env.NODE_ENV === 'testing'\n    if (runningLocally) {\n      sandbox(dynamo, callback)\n    }\n    else if (client) {\n      callback(null, client)\n    }\n    else {\n      waterfall([\n        function (callback) {\n          arc.services().then(function (serviceMap) {\n            callback(null, serviceMap.tables)\n          }).catch(callback)\n        },\n        factory,\n        function (created, callback) {\n          client = created\n          callback(null, client)\n        }\n      ], callback)\n    }\n    return promise\n  }\n  // Export directly for fast use\n  api.doc = dynamo.direct.doc\n  api.db = dynamo.direct.db\n\n  // Legacy compat methods\n  api.insert = old.insert\n  api.modify = old.modify\n  api.update = old.update\n  api.remove = old.remove\n  api.destroy = old.destroy\n  api.all = old.all\n  api.save = old.save\n  api.change = old.change\n  return api\n}\n\nmodule.exports = tables\n", "let http = require('http')\nlet waterfall = require('run-waterfall')\nlet aws = require('aws-sdk')\n\n/**\n * invoke an sqs lambda by name\n *\n * usage\n *\n *   let arc = require('@architect/functions')\n *\n *   arc.queues.publish({\n *     name: 'queue-name-here',\n *     payload: {hello: 'world'},\n *   }, console.log)\n *\n */\nmodule.exports = function _publish (params, callback) {\n\n  // ensure required input\n  if (!params.name)\n    throw ReferenceError('missing params.name')\n  if (!params.payload)\n    throw ReferenceError('missing params.payload')\n\n  // queue name normalized with appname and env\n  let name = `${process.env.ARC_APP_NAME}-${process.env.NODE_ENV}-${params.name}`\n  let payload = params.payload\n\n  let promise\n  if (!callback) {\n    promise = new Promise((resolve, reject) => {\n      callback = function errback (err, result) {\n        err ? reject(err) : resolve(result)\n      }\n    })\n  }\n\n  // check if we're running locally\n  let local = process.env.NODE_ENV === 'testing' || process.env.ARC_LOCAL\n  if (local) {\n    let port = process.env.ARC_EVENTS_PORT || 3334\n\n    // if so send the mock request\n    let req = http.request({\n      method: 'POST',\n      port,\n      path: '/queues',\n    },\n    function done (res) {\n      let data = []\n      res.resume()\n      res.on('data', chunk => data.push(chunk))\n      res.on('end', () => {\n        let body = Buffer.concat(data).toString()\n        let code = `${res.statusCode}`\n        if (!code.startsWith(2)) callback(Error(`${body} (${code})`))\n        else callback(null, body)\n      })\n    })\n    req.write(JSON.stringify(params))\n    req.end('\\n')\n  }\n  else {\n    // otherwise attempt to sqs.sendMessage\n    let sqs = new aws.SQS\n    waterfall([\n      function reads (callback) {\n        sqs.getQueueUrl({\n          QueueName: name,\n        }, callback)\n      },\n      function publishes (result, callback) {\n        let QueueUrl = result.QueueUrl\n        let DelaySeconds = params.delaySeconds || 0\n        sqs.sendMessage({\n          QueueUrl,\n          DelaySeconds,\n          MessageBody: JSON.stringify(payload)\n        }, callback)\n      }\n    ],\n    function _published (err, result) {\n      if (err) throw err\n      callback(null, result)\n    })\n  }\n  return promise\n}\n", "let parallel = require('run-parallel')\n/**\n * // Exmaple usage:\n *\n * var arc = require('@architect/functions')\n *\n * function signup(record, callback) {\n *   console.log(record)\n *   callback()\n * }\n *\n * // or\n * async function signup(event) {\n *   console.log(event)\n *   return true\n * }\n *\n * exports.handler = arc.queues.subscribe(signup)\n *\n */\nmodule.exports = function _subscribe (fn) {\n  if (fn.constructor.name === 'AsyncFunction') {\n    return async function lambda (event) {\n      return await Promise.all(event.Records.map(async record => {\n        try {\n          let result = JSON.parse(record.body)\n          return await fn(result)\n        }\n        catch (e) {\n          console.log('Queue subscribe error:', e)\n          throw e\n        }\n      }))\n    }\n  }\n  else {\n    return function _lambdaSignature (evt, ctx, callback) {\n      // sqs triggers send batches of records\n      // so we're going to create a handler for each one\n      // and execute them in parallel\n      parallel(evt.Records.map(function _iterator (record) {\n        // for each record we construct a handler function that assumes body is JSON\n        return function _actualHandler (callback) {\n          try {\n            fn(JSON.parse(record.body), callback)\n          }\n          catch (e) {\n            callback(e)\n          }\n        }\n      }), callback)\n    }\n  }\n}\n", "let http = require('http')\n\nmodule.exports = function sandbox (params, callback) {\n  let port = process.env.ARC_EVENTS_PORT || 3334\n  let req = http.request({\n    method: 'POST',\n    port,\n    path: '/queues',\n  },\n  function done (res) {\n    let data = []\n    res.resume()\n    res.on('data', chunk => data.push(chunk))\n    res.on('end', () => {\n      let body = Buffer.concat(data).toString()\n      let code = `${res.statusCode}`\n      if (!code.startsWith(2)) callback(Error(`${body} (${code})`))\n      else callback(null, body)\n    })\n  })\n  req.write(JSON.stringify(params))\n  req.end('\\n')\n}\n", "let aws = require('aws-sdk')\nlet ledger = {}\n\nmodule.exports = function liveFactory (arc) {\n  return function live ({ name, payload, delaySeconds, groupID }, callback) {\n\n    function publish (QueueUrl, payload, callback) {\n      let sqs = new aws.SQS\n      let params = {\n        QueueUrl,\n        DelaySeconds: delaySeconds || 0,\n        MessageBody: JSON.stringify(payload)\n      }\n      if (QueueUrl.endsWith('.fifo')) {\n        params.MessageGroupId = groupID || name\n      }\n      sqs.sendMessage(params, callback)\n    }\n\n    function cacheLedgerAndPublish (serviceMap) {\n      ledger = serviceMap.queues\n      if (!ledger[name]) callback(ReferenceError(`${name} queue not found`))\n      else publish(ledger[name], payload, callback)\n    }\n\n    let arn = ledger[name]\n    if (arn) {\n      publish(ledger[name], payload, callback)\n    }\n    else {\n      arc.services().then(cacheLedgerAndPublish).catch(callback)\n    }\n  }\n}\n", "let sandbox = require('./publish-sandbox')\nlet queueFactory = require('./publish-queue')\n\n/**\n * invoke a queue lambda by sqs queue name\n */\nmodule.exports = function publishFactory (arc) {\n  let queue = queueFactory(arc)\n  return function publish (params, callback) {\n\n    if (!params.name)\n      throw ReferenceError('missing params.name')\n\n    if (!params.payload)\n      throw ReferenceError('missing params.payload')\n\n    let promise\n    if (!callback) {\n      promise = new Promise((resolve, reject) => {\n        callback = function errback (err, result) {\n          err ? reject(err) : resolve(result)\n        }\n      })\n    }\n\n    let isLocal = process.env.NODE_ENV === 'testing' || process.env.ARC_LOCAL\n    let exec = isLocal ? sandbox : queue\n    exec(params, callback)\n    return promise\n  }\n}\n", "let oldPublish = require('./publish-old')\nlet subscribe = require('./subscribe')\nlet publishFactory = require('./publish')\n\nmodule.exports = function queueFactory (arc) {\n  let publish = publishFactory(arc)\n  return {\n    /**\n     * arc.queues.publish\n     *\n     * publish to an sqs queue\n     *\n     * @param {Object} params\n     * @param {String} params.name - the queue name (required)\n     * @param {String} params.payload - a json event payload (required)\n     * @param {Function} callback - a node style errback (optional)\n     * @returns {Promise} - returned if no callback is supplied\n     */\n    publish (params, callback) {\n      if (process.env.ARC_CLOUDFORMATION) {\n        return publish(params, callback)\n      }\n      else {\n        return oldPublish(params, callback)\n      }\n    },\n\n    /**\n     * arc.queues.subscribe\n     *\n     * handle payloads published to the queue\n     *\n     * @param {Function} handler - a single queue handler function\n     * @returns {Lambda} - a Lambda function sig: (event, context, callback)=>\n     */\n    subscribe,\n  }\n}\n", "/* eslint global-require: \"off\" */\nlet http = require('http')\nlet aws = require('aws-sdk')\nlet sns = new aws.SNS\nlet ledger = {}\n\n// priv publish\n// blindly publishes to sns topic json stringified record\n// throws if fails so lambda errors are noticible\nfunction __publish (arn, payload, callback) {\n  sns.publish({\n    TopicArn: arn,\n    Message: JSON.stringify(payload)\n  },\n  function _published (err, result) {\n    if (err) throw err\n    callback(null, result)\n  })\n}\n\n/**\n * invoke an event lambda by name\n *\n * usage\n *\n *   let arc = require('@smallwins/arc-prototype')\n *\n *   arc.events.publish({\n *     name: 'eventname',\n *     payload: {hello: 'world'},\n *   }, console.log)\n *\n * this will invoke appname-staging-eventname (or appname-production-eventname)\n *\n * you can invoke events for other arc apps in the same region by overriding appname with app param like so:\n *\n *   arc.events.publish({\n *     app: 'otherappname',\n *     name: 'eventname',\n *     payload: {hello: 'world2'},\n *   }, console.log)\n */\nmodule.exports = function _publish (params, callback) {\n  if (!params.name)\n    throw ReferenceError('missing params.name')\n\n  if (!params.payload)\n    throw ReferenceError('missing params.payload')\n\n  let promise\n  if (!callback) {\n    promise = new Promise((resolve, reject) => {\n      callback = function errback (err, result) {\n        err ? reject(err) : resolve(result)\n      }\n    })\n  }\n\n  let isLocal = process.env.NODE_ENV === 'testing' || process.env.ARC_LOCAL\n  let exec = isLocal ? _local : _live\n  exec(params, callback)\n  return promise\n}\n\nfunction _live (params, callback) {\n  let { name, payload } = params\n  let arn = ledger[name]\n\n  if (arn) {\n    __publish(ledger[name], payload, callback)\n  }\n  else {\n    let override = params.app\n    let eventName = `${override ? params.app : process.env.ARC_APP_NAME}-${process.env.NODE_ENV}-${name}`\n    _scan({ eventName }, function _scan (err, found) {\n      if (err) throw err\n      // cache the arn here\n      ledger[name] = found\n      // and continue\n      __publish(ledger[name], payload, callback)\n    })\n  }\n}\n\nfunction _local (params, callback) {\n  let port = process.env.ARC_EVENTS_PORT || 3334\n  let req = http.request({\n    method: 'POST',\n    port,\n    path: '/events',\n  },\n  function done (res) {\n    let data = []\n    res.resume()\n    res.on('data', chunk => data.push(chunk))\n    res.on('end', () => {\n      let body = Buffer.concat(data).toString()\n      let code = `${res.statusCode}`\n      if (!code.startsWith(2)) callback(Error(`${body} (${code})`))\n      else callback(null, body)\n    })\n  })\n  req.write(JSON.stringify(params))\n  req.end('\\n')\n}\n\nfunction _scan ({ eventName }, callback) {\n  let sns = new aws.SNS()\n  ;(function __scanner (params = {}, callback) {\n    sns.listTopics(params, function _listTopics (err, results) {\n      if (err) throw err\n      let found = results.Topics.find(t => {\n        let bits = t.TopicArn.split(':')\n        let it = bits[bits.length - 1]\n        return it === eventName\n      })\n      if (found) {\n        callback(null, found.TopicArn)\n      }\n      else if (results.NextToken) {\n        setTimeout(() => {\n          // 30tps on sns.listTopics, so let's give just a bit of buffer\n          __scanner({ NextToken: results.NextToken }, callback)\n        }, 50)\n      }\n      else {\n        callback(Error(`topic ${eventName} not found`))\n      }\n    })\n  })({}, callback)\n}\n", "let parallel = require('run-parallel')\n\nlet fallback = {\n  Records: [\n    { Sns: { Message: JSON.stringify({}) } }\n  ]\n}\n\n/**\n * // Example usage:\n *\n * var arc = require('@architect/functions')\n *\n * function signup(record, callback) {\n *   console.log(record)\n *   callback()\n * }\n *\n * exports.handler = arc.events.subscribe(signup)\n */\nmodule.exports = function _subscribe (fn) {\n  if (fn.constructor.name === 'AsyncFunction') {\n    return async function lambda (event) {\n      event = event && Object.keys(event).length ? event : fallback\n      return await Promise.all(event.Records.map(async record => {\n        try {\n          let result = JSON.parse(record.Sns.Message)\n          return await fn(result)\n        }\n        catch (e) {\n          console.log('Event subscribe error:', e)\n          throw e\n        }\n      }))\n    }\n  }\n  else {\n    // callback interface\n    return function _lambdaSignature (event, context, callback) {\n      event = event && Object.keys(event).length ? event : fallback\n      // sns triggers send batches of records\n      // so we're going to create a handler for each one\n      // and execute them in parallel\n      parallel(event.Records.map(function _iterator (record) {\n        // for each record we construct a handler function\n        return function _actualHandler (callback) {\n          try {\n            fn(JSON.parse(record.Sns.Message), callback)\n          }\n          catch (e) {\n            callback(e)\n          }\n        }\n      }), callback)\n    }\n  }\n}\n", "let http = require('http')\n\nmodule.exports = function publishLocal (params, callback) {\n  let port = process.env.ARC_EVENTS_PORT || 3334\n  let req = http.request({\n    method: 'POST',\n    port,\n    path: '/events',\n  },\n  function done (res) {\n    let data = []\n    res.resume()\n    res.on('data', chunk => data.push(chunk))\n    res.on('end', () => {\n      let body = Buffer.concat(data).toString()\n      let code = `${res.statusCode}`\n      if (!code.startsWith(2)) callback(Error(`${body} (${code})`))\n      else callback(null, body)\n    })\n  })\n  req.write(JSON.stringify(params))\n  req.end('\\n')\n}\n", "let aws = require('aws-sdk')\nlet ledger = {}\n\nmodule.exports = function liveFactory (arc) {\n  return function live ({ name, payload }, callback) {\n\n    function publish (arn, payload, callback) {\n      let sns = new aws.SNS\n      sns.publish({\n        TopicArn: arn,\n        Message: JSON.stringify(payload)\n      }, callback)\n    }\n\n    function cacheLedgerAndPublish (serviceMap) {\n      ledger = serviceMap.events\n      if (!ledger[name]) callback(ReferenceError(`${name} event not found`))\n      else publish(ledger[name], payload, callback)\n    }\n\n    let arn = ledger[name]\n    if (arn) {\n      publish(ledger[name], payload, callback)\n    }\n    else {\n      arc.services().then(cacheLedgerAndPublish).catch(callback)\n    }\n  }\n}\n", "let sandbox = require('./publish-sandbox')\nlet topicFactory = require('./publish-topic')\n\n/**\n * invoke an event lambda by sns topic name\n */\nmodule.exports = function publishFactory (arc) {\n  let topic = topicFactory(arc)\n  return function publish (params, callback) {\n    if (!params.name)\n      throw ReferenceError('missing params.name')\n\n    if (!params.payload)\n      throw ReferenceError('missing params.payload')\n\n    let promise\n    if (!callback) {\n      promise = new Promise((resolve, reject) => {\n        callback = function errback (err, result) {\n          err ? reject(err) : resolve(result)\n        }\n      })\n    }\n\n    let isLocal = process.env.NODE_ENV === 'testing' || process.env.ARC_LOCAL\n    let exec = isLocal ? sandbox : topic\n    exec(params, callback)\n    return promise\n  }\n}\n", "let oldPublish = require('./publish-old')\nlet subscribe = require('./subscribe')\nlet publishFactory = require('./publish')\n\nmodule.exports = function eventFactory (arc) {\n  let publish = publishFactory(arc)\n  return {\n    /**\n     * arc.events.publish\n     *\n     * publish events (sns topics)\n     *\n     * @param {Object} params\n     * @param {String} params.name - the event name (required)\n     * @param {String} params.payload - a json event payload (required)\n     * @param {Function} callback - a node style errback (optional)\n     * @returns {Promise} - returned if no callback is supplied\n     */\n    publish (params, callback) {\n      if (process.env.ARC_CLOUDFORMATION) {\n        return publish(params, callback)\n      }\n      else {\n        return oldPublish(params, callback)\n      }\n    },\n\n    /**\n     * arc.events.subscribe\n     *\n     * listen for events (sns topics)\n     *\n     * @param {Function} handler - a single event handler function\n     * @returns {Lambda} - a Lambda function sig: (event, context, callback)=>\n     */\n    subscribe\n  }\n}\n", "/**\n * Ensure env is one of: 'testing', 'staging', or 'production'\n * - Some test harnesses (ahem) will automatically populate NODE_ENV with their own values, unbidden\n * - Due to tables.direct auto initializing, always set (or override) default NODE_ENV to 'testing'\n */\nlet env = process.env.NODE_ENV\nlet isNotStagingOrProd = env !== 'staging' && env !== 'production'\nif (!env || isNotStagingOrProd) {\n  process.env.NODE_ENV = 'testing'\n}\n\n\nlet http = require('./http')\nlet _static = require('./static')\nlet serviceDiscovery = require('./discovery')\nlet services\n\nlet send = require('./ws')\nlet arc = {\n  http,\n  static: _static,\n  ws: { send },\n  services: function () {\n    return new Promise(function (resolve, reject) {\n      if (services) resolve(services)\n      else serviceDiscovery(function (err, serviceMap) {\n        if (err) reject(err)\n        else {\n          services = serviceMap\n          resolve(services)\n        }\n      })\n    })\n  }\n}\narc.tables = require('./tables')(arc)\narc.queues = require('./queues')(arc)\narc.events = require('./events')(arc)\n\n// backwards compat\narc.proxy = {}\narc.proxy.public = http.proxy.public\narc.middleware = http.middleware\n// backwards compat\n\nmodule.exports = arc\n", "import { HttpResponse } from '@architect/functions';\nimport tables from '../../../tables';\n\nexport const handler = async function ws(event: WSRequest): Promise<HttpResponse> {\n  const data = await tables();\n\n  const collabs = await data.collabs.query({\n    IndexName: 'conn-index',\n    KeyConditionExpression: 'conn = :conn',\n    ExpressionAttributeValues: {\n      ':conn': event.requestContext.connectionId,\n    },\n  });\n\n  for (const collab of collabs.Items) {\n    await data.collabs.delete({ id: collab.id });\n  }\n\n  await data.connections.delete({\n    id: event.requestContext.connectionId,\n  });\n\n  const subscriptions = await data.subscriptions.query({\n    IndexName: 'byConnection',\n    KeyConditionExpression: 'connection_id = :connection_id',\n    ExpressionAttributeValues: {\n      ':connection_id': event.requestContext.connectionId,\n    },\n  });\n\n  for (const subscription of subscriptions.Items) {\n    await data.subscriptions.delete({ id: subscription.id });\n    console.log('removed 1 subscription for %s for user %s', subscription.gqltype, subscription.user_id);\n  }\n\n\n  return { statusCode: 200 };\n};\n", "import arc from '@architect/functions';\n\nconst observedTables = [\n  'userkeys',\n  'permissions',\n  'tags',\n  'usertaggedresources',\n];\n\nlet tablesPromise: Promise<DataTables>;\n\nexport default async function tables(): Promise<DataTables> {\n  if (tablesPromise) {\n    return tablesPromise;\n  }\n\n  const p = new Promise<DataTables>((resolve, reject) => {\n    arc\n      .tables()\n      .then((_tables) => {\n        const tables = _tables as unknown as DataTables;\n        for (const observedTable of observedTables) {\n          observe(tables, observedTable);\n        }\n        resolve(tables);\n      })\n      .catch(reject);\n  });\n\n  return p;\n}\n\nasync function observe(tables: DataTables, tableName: string) {\n  const table = tables[tableName];\n  if (!table) {\n    throw new Error('No table named ' + tableName);\n  }\n  if (table.__deci_observed__) {\n    return;\n  }\n  table.__deci_observed__ = true;\n\n  for (const methodName of ['put', 'delete']) {\n    const method = methodName === 'put' ? table.put : table.delete;\n    const replaceMethod = async (args: any) => {\n      const ret = await method.call(table, args);\n\n      await arc.queues.publish({\n        name: `${tableName}-changes`,\n        payload: {\n          table: tableName,\n          action: methodName,\n          args,\n        },\n      });\n\n      return ret;\n    };\n\n    if (methodName === 'put') {\n      table['put'] = replaceMethod;\n    } else {\n      table['delete'] = replaceMethod;\n    }\n  }\n}\n"],
  "mappings": "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",
  "names": []
}
