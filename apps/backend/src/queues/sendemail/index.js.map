{
  "version": 3,
  "sources": ["../../../lib/architect/queues/sendemail/index.ts", "../../../lib/email-templates/team-invite.ts", "../../../lib/email-templates/email-validation.ts", "../../../lib/email-templates/auth-magiclink.ts", "../../../lib/email-templates/utils/salutation.ts", "../../../lib/email-templates/workspace-invite.ts", "../../../lib/email-templates/generic-invite.ts", "../../../lib/email-templates/index.ts", "../../../lib/services/send-email.ts", "../../../lib/queues/handler.ts"],
  "sourcesContent": ["import templates from '../../../email-templates';\nimport sendEmail from '../../../services/send-email';\nimport handle from '../../../queues/handler';\n\ntype SendEmailArgs = {\n  template: keyof typeof templates;\n} & Record<string, any>;\n\nexport const handler = handle(handleSendEmail);\n\nconst inTesting = !!process.env.JEST_WORKER_ID;\n\nasync function handleSendEmail({\n  template: templateName,\n  ...params\n}: SendEmailArgs) {\n  if (inTesting) {\n    return;\n  }\n\n  const template = templates[templateName];\n  if (!template) {\n    throw new Error(`Could not find template with name ${templateName}`);\n  }\n\n  const { subject, body } = template(params);\n\n  await sendEmail({\n    to: params.email || params.to.email,\n    body,\n    subject,\n  });\n}\n", "export default ({ from, to, team, inviteAcceptLink }: Record<string, any>) => ({\n  subject: `${from.name} invites you to team ${team.name}`,\n  body: `Dear ${to.name},\n\n${from.name} has invited you to join the team ${team.name}.\n\nYou can accept it by clicking on the following link:\n\n${inviteAcceptLink}\n\nIf you don't want to accept this invitation you can safely ignore this email.\n\nSincerely,\n\nThe Deci team.\n`,\n});\n", "export default ({ name, validationLink }: Record<string, any>) => ({\n  subject: `Validate your e-mail address`,\n  body: `${name ? `Dear ${name}` : 'Hi'},\n\nYou have recently created an account in Deci.\n\nTo activate it you need to validate your email address by clicking in this link:\n\n${validationLink}\n\nIf it wasn't you that created the account, you can safely ignore this e-mail.\n\nSincerely,\n\nThe Deci team.\n`,\n});\n", "export default ({ url }: Record<string, any>) => ({\n  subject: `Deci: Sign in`,\n  body: `Hello,\n\nYou have recently asked to sign into Deci.\n\nTo be able to do that, you can click on this link:\n\n${url}\n\nIf it wasn't you that initiated this, you can safely ignore this e-mail.\n\nWhatever you do, please don't forward this e-mail to anyone.\n\nSincerely,\n\nThe Deci team.\n`,\n});\n", "export default function salutation(user: User) {\n  if (!user.name) {\n    return 'Hi,';\n  }\n  return `Dear ${user.name}`;\n};\n", "import salutation from './utils/salutation';\n\nexport default ({ from, to, workspace, inviteAcceptLink }: Record<string, any>) => ({\n  subject: `${from.name} invites you to workspace \"${workspace.name}\"`,\n  body: `${salutation(to)},\n\n${from.name} has invited you to join the workspace \"${workspace.name}\".\n\nYou can accept it by clicking on the following link:\n\n${inviteAcceptLink}\n\nIf you don't want to accept this invitation you can safely ignore this email.\n\nSincerely,\n\nThe Deci team.\n`,\n});\n", "import salutation from './utils/salutation';\n\nexport default ({ from, to, resource, resourceName, inviteAcceptLink }: Record<string, any>) => ({\n  subject: `${from.name} invites you to a ${resource.type}`,\n  body: `${salutation(to)},\n\n${from.name} has shared a ${resource.type} named \"${resourceName}\".\n\nYou can accept it by clicking on the following link:\n\n${inviteAcceptLink}\n\nIf you don't want to accept this invitation you can safely ignore this email.\n\nSincerely,\n\nThe Deci team.\n`,\n});\n", "import teamInvite from './team-invite';\nimport emailValidation from './email-validation';\nimport authMagiclink from './auth-magiclink';\nimport workspaceInvite from './workspace-invite';\nimport genericInvite from './generic-invite';\n\nexport default {\n  'team-invite': teamInvite,\n  'email-validation': emailValidation,\n  'auth-magiclink': authMagiclink,\n  'workspace-invite': workspaceInvite,\n  'generic-invite': genericInvite,\n};", "import { SESV2 } from 'aws-sdk';\n\ntype SendEmailParams = {\n  to: string\n  body: string\n  subject:string\n}\n\nconst serviceOptions = {\n  apiVersion: '2019-09-27',\n  accessKeyId: process.env.DECI_SES_ACCESS_KEY_ID,\n  secretAccessKey: process.env.DECI_SES_SECRET_ACCESS_KEY,\n  region: 'eu-west-2',\n};\n\nconst service = new SESV2(serviceOptions);\n\nconst senderEmailAddress = process.env.DECI_FROM_EMAIL_ADDRESS;\nif (!senderEmailAddress) {\n  throw new Error('Environment variable DECI_FROM_EMAIL_ADDRESS is not defined');\n}\n\nexport default function sendEmail({ to, body, subject }: SendEmailParams): Promise<void> {\n  return new Promise((resolve, reject) => {\n    const params = {\n      Content: {\n        Simple: {\n          Body: {\n            Text: {\n              Data: body,\n              Charset: 'UTF-8',\n            },\n          },\n          Subject: {\n            Data: subject,\n            Charset: 'UTF-8',\n          },\n        },\n      },\n      Destination: {\n        ToAddresses: [to],\n      },\n      FromEmailAddress: senderEmailAddress!,\n      ReplyToAddresses: [senderEmailAddress!],\n    };\n\n    service.sendEmail(params, (err) => {\n      if (err) {\n        return reject(err);\n      }\n      resolve();\n    });\n  });\n};\n", "type Handler = (payload: any) => Promise<void>;\n\ntype Event = {\n  Records: Array<{\n    body: string;\n  }>;\n};\n\nexport default function queueHandler(handler: Handler) {\n  return async (event: Event) => {\n    for (const record of event.Records) {\n      const message = JSON.parse(record.body);\n      try {\n        await handler(message);\n      } catch (err) {\n        console.error('Error processing queue element: %j', message);\n        console.error(err);\n        // do not throw\n      }\n    }\n    return {};\n  };\n}\n"],
  "mappings": "k2BAAA,sCCAA,GAAO,GAAQ,GAAC,CAAE,OAAM,KAAI,OAAM,sBAA6C,EAC7E,QAAS,GAAG,EAAK,4BAA4B,EAAK,OAClD,KAAM,QAAQ,EAAG;AAAA;AAAA,EAEjB,EAAK,yCAAyC,EAAK;AAAA;AAAA;AAAA;AAAA,EAInD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IARa,WCAf,GAAO,GAAQ,GAAC,CAAE,OAAM,oBAA2C,EACjE,QAAS,+BACT,KAAM,GAAG,EAAO,QAAQ,IAAS;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAMjC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IARa,WCAf,GAAO,GAAQ,GAAC,CAAE,SAAgC,EAChD,QAAS,gBACT,KAAM;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAMN;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IARa,WCAA,WAAoB,EAAY,CAC7C,MAAK,GAAK,KAGH,QAAQ,EAAK,OAFX,MAFa,kBCExB,GAAO,GAAQ,GAAC,CAAE,OAAM,KAAI,YAAW,sBAA6C,EAClF,QAAS,GAAG,EAAK,kCAAkC,EAAU,QAC7D,KAAM,GAAG,EAAW;AAAA;AAAA,EAEpB,EAAK,+CAA+C,EAAU;AAAA;AAAA;AAAA;AAAA,EAI9D;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IARa,WCAf,GAAO,GAAQ,GAAC,CAAE,OAAM,KAAI,WAAU,eAAc,sBAA6C,EAC/F,QAAS,GAAG,EAAK,yBAAyB,EAAS,OACnD,KAAM,GAAG,EAAW;AAAA;AAAA,EAEpB,EAAK,qBAAqB,EAAS,eAAe;AAAA;AAAA;AAAA;AAAA,EAIlD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IARa,WCIf,GAAO,GAAQ,CACb,cAAe,EACf,mBAAoB,EACpB,iBAAkB,EAClB,mBAAoB,EACpB,iBAAkB,GCXpB,MAAsB,sBAQhB,EAAiB,CACrB,WAAY,aACZ,YAAa,QAAQ,IAAI,uBACzB,gBAAiB,QAAQ,IAAI,2BAC7B,OAAQ,aAGJ,EAAU,GAAI,SAAM,GAEpB,EAAqB,QAAQ,IAAI,wBACvC,GAAI,CAAC,EACH,KAAM,IAAI,OAAM,+DAGH,WAAmB,CAAE,KAAI,OAAM,WAA2C,CACvF,MAAO,IAAI,SAAQ,CAAC,EAAS,IAAW,CACtC,GAAM,GAAS,CACb,QAAS,CACP,OAAQ,CACN,KAAM,CACJ,KAAM,CACJ,KAAM,EACN,QAAS,UAGb,QAAS,CACP,KAAM,EACN,QAAS,WAIf,YAAa,CACX,YAAa,CAAC,IAEhB,iBAAkB,EAClB,iBAAkB,CAAC,IAGrB,EAAQ,UAAU,EAAQ,AAAC,GAAQ,CACjC,GAAI,EACF,MAAO,GAAO,GAEhB,QA5BkB,iBCdT,WAAsB,EAAkB,CACrD,MAAO,MAAO,IAAiB,CAC7B,OAAW,KAAU,GAAM,QAAS,CAClC,GAAM,GAAU,KAAK,MAAM,EAAO,MAClC,GAAI,CACF,KAAM,GAAQ,SACP,EAAP,CACA,QAAQ,MAAM,qCAAsC,GACpD,QAAQ,MAAM,IAIlB,MAAO,IAZa,oBTAjB,GAAM,GAAU,EAAO,GAExB,EAAY,CAAC,CAAC,QAAQ,IAAI,eAEhC,iBAA+B,EAGb,CAHa,QAC7B,UAAU,GADmB,EAE1B,IAF0B,EAE1B,CADH,aAGA,GAAI,EACF,OAGF,GAAM,GAAW,EAAU,GAC3B,GAAI,CAAC,EACH,KAAM,IAAI,OAAM,qCAAqC,KAGvD,GAAM,CAAE,UAAS,QAAS,EAAS,GAEnC,KAAM,GAAU,CACd,GAAI,EAAO,OAAS,EAAO,GAAG,MAC9B,OACA,YAlBW",
  "names": []
}
