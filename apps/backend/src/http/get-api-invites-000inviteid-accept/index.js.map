{
  "version": 3,
  "sources": ["../../../node_modules/@architect/functions/src/http/session/providers/_get-idx.js", "../../../node_modules/cookie/index.js", "../../../node_modules/node-webtokens/lib/ecdsa.js", "../../../node_modules/node-webtokens/lib/common.js", "../../../node_modules/node-webtokens/lib/jws.js", "../../../node_modules/node-webtokens/lib/jwe.js", "../../../node_modules/node-webtokens/index.js", "../../../node_modules/@architect/functions/src/http/session/providers/jwe.js", "../../../node_modules/cookie-signature/index.js", "../../../node_modules/@architect/functions/src/tables/dynamo.js", "../../../node_modules/random-bytes/index.js", "../../../node_modules/uid-safe/index.js", "../../../node_modules/@architect/functions/src/http/session/providers/ddb/_week-from-now.js", "../../../node_modules/rndm/index.js", "../../../node_modules/tsscmp/lib/index.js", "../../../node_modules/csrf/index.js", "../../../node_modules/queue-microtask/index.js", "../../../node_modules/run-parallel/index.js", "../../../node_modules/@architect/functions/src/http/session/providers/ddb/create.js", "../../../node_modules/@architect/functions/src/http/session/providers/ddb/find.js", "../../../node_modules/@architect/functions/src/http/session/providers/ddb/update.js", "../../../node_modules/@architect/functions/src/http/session/providers/ddb/index.js", "../../../node_modules/@architect/functions/src/http/session/read.js", "../../../node_modules/@architect/functions/src/http/session/write.js", "../../../node_modules/@architect/functions/src/http/helpers/body-parser.js", "../../../node_modules/@architect/functions/src/http/helpers/params.js", "../../../node_modules/@architect/functions/src/http/errors/index.js", "../../../node_modules/@architect/functions/src/http/helpers/binary-types.js", "../../../node_modules/@architect/functions/src/http/_res-fmt.js", "../../../node_modules/@architect/functions/src/http/http.js", "../../../node_modules/@architect/functions/src/static/index.js", "../../../node_modules/@architect/functions/src/http/helpers/url.js", "../../../node_modules/@architect/functions/src/http/async/index.js", "../../../node_modules/binary-case/index.js", "../../../node_modules/media-typer/index.js", "../../../node_modules/mime-db/index.js", "../../../node_modules/mime-types/index.js", "../../../node_modules/type-is/index.js", "../../../node_modules/@vendia/serverless-express/src/index.js", "../../../node_modules/@vendia/serverless-express/index.js", "../../../node_modules/aws-serverless-express/src/index.js", "../../../node_modules/aws-serverless-express/index.js", "../../../node_modules/@architect/functions/src/http/express/index.js", "../../../node_modules/@architect/functions/src/http/proxy/format/transform.js", "../../../node_modules/@architect/functions/src/http/proxy/format/templatize.js", "../../../node_modules/@architect/functions/src/http/proxy/format/compress.js", "../../../node_modules/@architect/functions/src/http/proxy/format/response.js", "../../../node_modules/@architect/functions/src/http/proxy/read/_pretty.js", "../../../node_modules/@architect/functions/src/http/proxy/read/_local.js", "../../../node_modules/@architect/functions/src/http/proxy/read/_s3.js", "../../../node_modules/@architect/functions/src/http/proxy/read/index.js", "../../../node_modules/@architect/functions/src/http/proxy/index.js", "../../../node_modules/@architect/functions/src/http/index.js", "../../../node_modules/@architect/functions/src/discovery/index.js", "../../../node_modules/@architect/functions/src/ws/send-sandbox.js", "../../../node_modules/@architect/functions/src/ws/send.js", "../../../node_modules/@architect/functions/src/ws/index.js", "../../../node_modules/run-waterfall/index.js", "../../../node_modules/@architect/functions/src/tables/old.js", "../../../node_modules/@architect/functions/src/tables/promisify-object.js", "../../../node_modules/@architect/functions/src/tables/factory.js", "../../../node_modules/@architect/functions/src/tables/sandbox.js", "../../../node_modules/@architect/functions/src/tables/index.js", "../../../node_modules/@architect/functions/src/queues/publish-old.js", "../../../node_modules/@architect/functions/src/queues/subscribe.js", "../../../node_modules/@architect/functions/src/queues/publish-sandbox.js", "../../../node_modules/@architect/functions/src/queues/publish-queue.js", "../../../node_modules/@architect/functions/src/queues/publish.js", "../../../node_modules/@architect/functions/src/queues/index.js", "../../../node_modules/@architect/functions/src/events/publish-old.js", "../../../node_modules/@architect/functions/src/events/subscribe.js", "../../../node_modules/@architect/functions/src/events/publish-sandbox.js", "../../../node_modules/@architect/functions/src/events/publish-topic.js", "../../../node_modules/@architect/functions/src/events/publish.js", "../../../node_modules/@architect/functions/src/events/index.js", "../../../node_modules/@architect/functions/src/index.js", "../../../node_modules/simple-cookie/index.js", "../../../node_modules/@babel/runtime/helpers/interopRequireDefault.js", "../../../node_modules/jose/lib/help/consts.js", "../../../node_modules/jose/lib/jwk/key/secp256k1_crv.js", "../../../node_modules/jose/lib/registry/ec_curves.js", "../../../node_modules/jose/lib/registry/iv_lengths.js", "../../../node_modules/jose/lib/registry/jwa.js", "../../../node_modules/jose/lib/registry/jwk.js", "../../../node_modules/jose/lib/registry/key_lengths.js", "../../../node_modules/jose/lib/registry/okp_curves.js", "../../../node_modules/jose/lib/registry/ecdh_derive_lengths.js", "../../../node_modules/jose/lib/registry/index.js", "../../../node_modules/jose/lib/help/generate_iv.js", "../../../node_modules/jose/lib/help/base64url.js", "../../../node_modules/jose/lib/errors.js", "../../../node_modules/jose/lib/help/runtime_support.js", "../../../node_modules/jose/lib/help/is_object.js", "../../../node_modules/@panva/asn1.js/lib/asn1/base/reporter.js", "../../../node_modules/@panva/asn1.js/lib/asn1/base/buffer.js", "../../../node_modules/@panva/asn1.js/lib/asn1/base/node.js", "../../../node_modules/@panva/asn1.js/lib/asn1/constants/der.js", "../../../node_modules/@panva/asn1.js/lib/asn1/encoders/der.js", "../../../node_modules/@panva/asn1.js/lib/asn1/encoders/pem.js", "../../../node_modules/@panva/asn1.js/lib/asn1/encoders/index.js", "../../../node_modules/@panva/asn1.js/lib/asn1/decoders/der.js", "../../../node_modules/@panva/asn1.js/lib/asn1/decoders/pem.js", "../../../node_modules/@panva/asn1.js/lib/asn1/decoders/index.js", "../../../node_modules/@panva/asn1.js/lib/asn1/api.js", "../../../node_modules/@panva/asn1.js/lib/asn1/base/index.js", "../../../node_modules/@panva/asn1.js/lib/asn1/constants/index.js", "../../../node_modules/@panva/asn1.js/lib/asn1.js", "../../../node_modules/jose/lib/help/asn1/oids.js", "../../../node_modules/jose/lib/help/asn1/algorithm_identifier.js", "../../../node_modules/jose/lib/help/asn1/ec_private_key.js", "../../../node_modules/jose/lib/help/asn1/private_key_info.js", "../../../node_modules/jose/lib/help/asn1/public_key_info.js", "../../../node_modules/jose/lib/help/asn1/private_key.js", "../../../node_modules/jose/lib/help/asn1/one_asymmetric_key.js", "../../../node_modules/jose/lib/help/asn1/rsa_private_key.js", "../../../node_modules/jose/lib/help/asn1/rsa_public_key.js", "../../../node_modules/jose/lib/help/asn1/index.js", "../../../node_modules/jose/lib/help/key_object.js", "../../../node_modules/jose/lib/help/rsa_primes.js", "../../../node_modules/jose/lib/help/key_utils.js", "../../../node_modules/jose/lib/jwk/thumbprint.js", "../../../node_modules/jose/lib/jwk/key/base.js", "../../../node_modules/jose/lib/jwk/key/rsa.js", "../../../node_modules/jose/lib/jwk/key/ec.js", "../../../node_modules/jose/lib/jwk/key/okp.js", "../../../node_modules/jose/lib/jwk/key/oct.js", "../../../node_modules/jose/lib/jwk/import.js", "../../../node_modules/jose/lib/jwk/generate.js", "../../../node_modules/jose/lib/jwk/key/none.js", "../../../node_modules/jose/lib/jwk/key/embedded.jwk.js", "../../../node_modules/jose/lib/jwk/key/embedded.x5c.js", "../../../node_modules/jose/lib/jwk/index.js", "../../../node_modules/jose/lib/jwks/keystore.js", "../../../node_modules/jose/lib/help/get_key.js", "../../../node_modules/jose/lib/help/deep_clone.js", "../../../node_modules/jose/lib/help/timing_safe_equal.js", "../../../node_modules/jose/lib/help/node_alg.js", "../../../node_modules/jose/lib/jwa/hmac.js", "../../../node_modules/jose/lib/help/ecdsa_signatures.js", "../../../node_modules/jose/lib/jwa/ecdsa.js", "../../../node_modules/jose/lib/jwa/eddsa.js", "../../../node_modules/jose/lib/jwa/rsassa_pss.js", "../../../node_modules/jose/lib/jwa/rsassa.js", "../../../node_modules/jose/lib/jwa/none.js", "../../../node_modules/jose/lib/help/uint64be.js", "../../../node_modules/jose/lib/jwa/aes_cbc_hmac_sha2.js", "../../../node_modules/jose/lib/jwa/aes_gcm.js", "../../../node_modules/jose/lib/jwa/rsaes.js", "../../../node_modules/jose/lib/jwa/aes_kw.js", "../../../node_modules/jose/lib/jwa/aes_gcm_kw.js", "../../../node_modules/jose/lib/jwa/pbes2.js", "../../../node_modules/jose/lib/jwa/ecdh/compute_secret.js", "../../../node_modules/jose/lib/jwa/ecdh/derive.js", "../../../node_modules/jose/lib/jwa/ecdh/dir.js", "../../../node_modules/jose/lib/jwa/ecdh/kw.js", "../../../node_modules/jose/lib/jwa/index.js", "../../../node_modules/jose/lib/help/validate_crit.js", "../../../node_modules/jose/lib/jwe/serializers.js", "../../../node_modules/jose/lib/jwe/generate_cek.js", "../../../node_modules/jose/lib/help/is_disjoint.js", "../../../node_modules/jose/lib/jwe/validate_headers.js", "../../../node_modules/jose/lib/jwe/encrypt.js", "../../../node_modules/jose/lib/jwks/index.js", "../../../node_modules/jose/lib/jwe/decrypt.js", "../../../node_modules/jose/lib/jwe/index.js", "../../../node_modules/jose/lib/jws/serializers.js", "../../../node_modules/jose/lib/jws/sign.js", "../../../node_modules/jose/lib/jws/verify.js", "../../../node_modules/jose/lib/jws/index.js", "../../../node_modules/jose/lib/jwt/decode.js", "../../../node_modules/jose/lib/help/secs.js", "../../../node_modules/jose/lib/help/epoch.js", "../../../node_modules/jose/lib/jwt/shared_validations.js", "../../../node_modules/jose/lib/jwt/sign.js", "../../../node_modules/jose/lib/jwt/verify.js", "../../../node_modules/jose/lib/jwt/profiles.js", "../../../node_modules/jose/lib/jwt/index.js", "../../../node_modules/jose/lib/index.js", "../../../node_modules/next-auth/dist/lib/logger.js", "../../../node_modules/futoin-hkdf/hkdf.js", "../../../node_modules/next-auth/dist/lib/jwt.js", "../../../lib/architect/http/get-api-invites-000inviteid-accept/index.ts", "../../../lib/tables/index.ts", "../../../lib/handle.ts", "../../../lib/auth.ts", "../../../lib/auth-flow/jwt.ts"],
  "sourcesContent": ["// Takes a client cookie string and finds the last _idx key/value\nmodule.exports = function getIdx (cookie = '') {\n  let cookies = cookie\n    .split(';')\n    .map(c => c.trim())\n    .filter(Boolean)\n  let session = cookies.reverse().find(c => c.startsWith('_idx='))\n  return session || ''\n}\n", "/*!\n * cookie\n * Copyright(c) 2012-2014 Roman Shtylman\n * Copyright(c) 2015 Douglas Christopher Wilson\n * MIT Licensed\n */\n\n'use strict';\n\n/**\n * Module exports.\n * @public\n */\n\nexports.parse = parse;\nexports.serialize = serialize;\n\n/**\n * Module variables.\n * @private\n */\n\nvar decode = decodeURIComponent;\nvar encode = encodeURIComponent;\nvar pairSplitRegExp = /; */;\n\n/**\n * RegExp to match field-content in RFC 7230 sec 3.2\n *\n * field-content = field-vchar [ 1*( SP / HTAB ) field-vchar ]\n * field-vchar   = VCHAR / obs-text\n * obs-text      = %x80-FF\n */\n\nvar fieldContentRegExp = /^[\\u0009\\u0020-\\u007e\\u0080-\\u00ff]+$/;\n\n/**\n * Parse a cookie header.\n *\n * Parse the given cookie header string into an object\n * The object has the various cookies as keys(names) => values\n *\n * @param {string} str\n * @param {object} [options]\n * @return {object}\n * @public\n */\n\nfunction parse(str, options) {\n  if (typeof str !== 'string') {\n    throw new TypeError('argument str must be a string');\n  }\n\n  var obj = {}\n  var opt = options || {};\n  var pairs = str.split(pairSplitRegExp);\n  var dec = opt.decode || decode;\n\n  for (var i = 0; i < pairs.length; i++) {\n    var pair = pairs[i];\n    var eq_idx = pair.indexOf('=');\n\n    // skip things that don't look like key=value\n    if (eq_idx < 0) {\n      continue;\n    }\n\n    var key = pair.substr(0, eq_idx).trim()\n    var val = pair.substr(++eq_idx, pair.length).trim();\n\n    // quoted values\n    if ('\"' == val[0]) {\n      val = val.slice(1, -1);\n    }\n\n    // only assign once\n    if (undefined == obj[key]) {\n      obj[key] = tryDecode(val, dec);\n    }\n  }\n\n  return obj;\n}\n\n/**\n * Serialize data into a cookie header.\n *\n * Serialize the a name value pair into a cookie string suitable for\n * http headers. An optional options object specified cookie parameters.\n *\n * serialize('foo', 'bar', { httpOnly: true })\n *   => \"foo=bar; httpOnly\"\n *\n * @param {string} name\n * @param {string} val\n * @param {object} [options]\n * @return {string}\n * @public\n */\n\nfunction serialize(name, val, options) {\n  var opt = options || {};\n  var enc = opt.encode || encode;\n\n  if (typeof enc !== 'function') {\n    throw new TypeError('option encode is invalid');\n  }\n\n  if (!fieldContentRegExp.test(name)) {\n    throw new TypeError('argument name is invalid');\n  }\n\n  var value = enc(val);\n\n  if (value && !fieldContentRegExp.test(value)) {\n    throw new TypeError('argument val is invalid');\n  }\n\n  var str = name + '=' + value;\n\n  if (null != opt.maxAge) {\n    var maxAge = opt.maxAge - 0;\n\n    if (isNaN(maxAge) || !isFinite(maxAge)) {\n      throw new TypeError('option maxAge is invalid')\n    }\n\n    str += '; Max-Age=' + Math.floor(maxAge);\n  }\n\n  if (opt.domain) {\n    if (!fieldContentRegExp.test(opt.domain)) {\n      throw new TypeError('option domain is invalid');\n    }\n\n    str += '; Domain=' + opt.domain;\n  }\n\n  if (opt.path) {\n    if (!fieldContentRegExp.test(opt.path)) {\n      throw new TypeError('option path is invalid');\n    }\n\n    str += '; Path=' + opt.path;\n  }\n\n  if (opt.expires) {\n    if (typeof opt.expires.toUTCString !== 'function') {\n      throw new TypeError('option expires is invalid');\n    }\n\n    str += '; Expires=' + opt.expires.toUTCString();\n  }\n\n  if (opt.httpOnly) {\n    str += '; HttpOnly';\n  }\n\n  if (opt.secure) {\n    str += '; Secure';\n  }\n\n  if (opt.sameSite) {\n    var sameSite = typeof opt.sameSite === 'string'\n      ? opt.sameSite.toLowerCase() : opt.sameSite;\n\n    switch (sameSite) {\n      case true:\n        str += '; SameSite=Strict';\n        break;\n      case 'lax':\n        str += '; SameSite=Lax';\n        break;\n      case 'strict':\n        str += '; SameSite=Strict';\n        break;\n      case 'none':\n        str += '; SameSite=None';\n        break;\n      default:\n        throw new TypeError('option sameSite is invalid');\n    }\n  }\n\n  return str;\n}\n\n/**\n * Try decoding a string using a decoding function.\n *\n * @param {string} str\n * @param {function} decode\n * @private\n */\n\nfunction tryDecode(str, decode) {\n  try {\n    return decode(str);\n  } catch (e) {\n    return str;\n  }\n}\n", "const ERR_MSG = 'Could not extract parameters from DER signature';\r\n\r\nexports.derToConcat = (signature, size) => {\r\n  let offset = 0;\r\n  if (signature[offset++] !== 0x30) throw new Error(ERR_MSG);\r\n  let seqLength = signature[offset++];\r\n  if (seqLength === 0x81) seqLength = signature[offset++];\r\n  if (seqLength > signature.length - offset || signature[offset++] !== 0x02) {\r\n    throw new Error(ERR_MSG);\r\n  }\r\n  let rLength = signature[offset++];\r\n  if (rLength > signature.length - offset - 2 || rLength > size + 1) {\r\n    throw new Error(ERR_MSG);\r\n  }\r\n  let rOffset = offset;\r\n  offset += rLength;\r\n  if (signature[offset++] !== 0x02) throw new Error(ERR_MSG);\r\n  let sLength = signature[offset++];\r\n  if (sLength !== signature.length - offset || sLength > size + 1) {\r\n    throw new Error(ERR_MSG);\r\n  }\r\n  let sOffset = offset;\r\n  offset += sLength;\r\n  if (offset !== signature.length) throw new Error(ERR_MSG);\r\n  let rPadding = size - rLength;\r\n  let sPadding = size - sLength;\r\n  let dst = Buffer.allocUnsafe(rPadding + rLength + sPadding + sLength);\r\n  for (offset = 0; offset < rPadding; offset++) dst[offset] = 0;\r\n  let rPad = Math.max(-rPadding, 0);\r\n  signature.copy(dst, offset, rOffset + rPad, rOffset + rLength);\r\n  offset = size;\r\n  for (let o = offset; offset < o + sPadding; offset++) dst[offset] = 0;\r\n  let sPad = Math.max(-sPadding, 0);\r\n  signature.copy(dst, offset, sOffset + sPad, sOffset + sLength);\r\n  return dst;\r\n}\r\n\r\nexports.concatToDer = (signature, size) => {\r\n  let rPadding = countPadding(signature, 0, size);\r\n  let sPadding = countPadding(signature, size, signature.length);\r\n  let rLength = size - rPadding;\r\n  let sLength = size - sPadding;\r\n  let rsBytes = rLength + sLength + 4;\r\n  let shortLength = rsBytes < 0x80;\r\n  let dst = Buffer.allocUnsafe((shortLength ? 2 : 3) + rsBytes);\r\n  let offset = 0;\r\n  dst[offset++] = 0x30;\r\n  if (shortLength) {\r\n    dst[offset++] = rsBytes;\r\n  } else {\r\n    dst[offset++] = 0x81;\r\n    dst[offset++] = rsBytes & 0xFF;\r\n  }\r\n  dst[offset++] = 0x02;\r\n  dst[offset++] = rLength;\r\n  if (rPadding < 0) {\r\n    dst[offset++] = 0;\r\n    offset += signature.copy(dst, offset, 0, size);\r\n  } else {\r\n    offset += signature.copy(dst, offset, rPadding, size);\r\n  }\r\n  dst[offset++] = 0x02;\r\n  dst[offset++] = sLength;\r\n  if (sPadding < 0) {\r\n    dst[offset++] = 0;\r\n    signature.copy(dst, offset, size);\r\n  } else {\r\n    signature.copy(dst, offset, size + sPadding);\r\n  }\r\n  return dst;\r\n}\r\n\r\nfunction countPadding(buf, start, stop) {\r\n  let padding = 0;\r\n  while (start + padding < stop && buf[start + padding] === 0) padding++;\r\n  let needsSign = buf[start + padding] >= 0x80;\r\n  return needsSign ? --padding : padding;\r\n}\r\n", "exports.buf2b64url = (data) => {\n  return data.toString('base64')\n             .replace(/\\+/g, '-')\n             .replace(/\\//g, '_')\n             .replace(/=/g, '');\n}\n\nfunction responder(error, result, callback) {\n  if (callback) {\n    callback(error, result);\n  } else if (error) {\n    throw error;\n  } else {\n    return result;\n  }\n}\n\nexports.responder = responder;\n\nexports.payloadVerifications = (parsed, cb) => {\n  if (parsed.audList) {\n    if (parsed.payload.aud === undefined) {\n      parsed.error = { message: 'Missing aud claim in payload' };\n      return responder(null, parsed, cb);\n    } else if (!parsed.audList.includes(parsed.payload.aud)) {\n      parsed.error = { message: 'Mismatching aud claim in payload' };\n      return responder(null, parsed, cb);\n    }\n  }\n  if (parsed.issList) {\n    if (parsed.payload.iss === undefined) {\n      parsed.error = { message: 'Missing iss claim in payload' };\n      return responder(null, parsed, cb);\n    } else if (!parsed.issList.includes(parsed.payload.iss)) {\n      parsed.error = { message: 'Mismatching iss claim in payload' };\n      return responder(null, parsed, cb);\n    }\n  }\n  let iat = Number(parsed.payload.iat);\n  if (!iat) {\n    parsed.error = { message: 'Missing or invalid iat claim in payload' };\n    return responder(null, parsed, cb);\n  }\n  let expiration = Number(parsed.payload.exp);\n  if (parsed.lifetime) {\n    let iatExp = iat + parsed.lifetime;\n    if (!expiration || iatExp < expiration) expiration = iatExp;\n  }\n  if (expiration && Date.now() > expiration * 1000) {\n    parsed.expired = expiration;\n    return responder(null, parsed, cb);\n  }\n  parsed.valid = true;\n  return responder(null, parsed, cb);\n}\n", "const crypto = require('crypto');\r\nconst ecdsa = require('./ecdsa.js');\r\nconst { responder, buf2b64url, payloadVerifications } = require('./common.js');\r\n\r\nconst ALG_RE = /^(HS|RS|ES)(256|384|512)$/;\r\n\r\n// ===== JWS GENERATION =======================================================\r\n\r\nexports.generate = (alg, payload, ...rest) => {\r\n  // alg, payload, key[, cb] or alg, payload, keystore, kid[, cb]\r\n  let key;\r\n  let cb;\r\n  let header = { alg: alg };\r\n  if (rest[0].constructor !== Object) {\r\n    key = rest[0];\r\n    cb = typeof rest[1] === 'function' ? rest[1] : undefined;\r\n  } else {\r\n    header.kid = rest[1];\r\n    key = rest[0][rest[1]];\r\n    cb = typeof rest[2] === 'function' ? rest[2] : undefined;\r\n    if (!key) {\r\n      return responder(new TypeError('Invalid key identifier'), null, cb);\r\n    }\r\n  }\r\n  let match = typeof alg === 'string' ? alg.match(ALG_RE) : null;\r\n  if (!match) {\r\n    return responder(new TypeError('Unrecognized algorithm'), null, cb);\r\n  }\r\n  let generateJws;\r\n  if (match[1] === 'HS') {\r\n    generateJws = generateHsJws;\r\n  } else if (match[1] === 'RS') {\r\n    generateJws = generateRsJws;\r\n  } else {\r\n    generateJws = generateEsJws;\r\n  }\r\n  payload.iat = Math.floor(Date.now() / 1000);\r\n  let h = buf2b64url(Buffer.from(JSON.stringify(header)));\r\n  let p = buf2b64url(Buffer.from(JSON.stringify(payload)));\r\n  let token;\r\n  try {\r\n    token = generateJws(`${h}.${p}`, +match[2], key);\r\n  } catch (error) {\r\n    return responder(error, null, cb);\r\n  }\r\n  return responder(null, token, cb);\r\n}\n\n// ===== JWS VERIFICATION =====================================================\n\r\nexports.verify = (parsed, key, cb) => {\r\n  if (parsed.error) return responder(null, parsed, cb);\r\n  if (typeof parsed.header.alg !== 'string') {\r\n    parsed.error = { message: 'Missing or invalid alg claim in header' };\r\n    return responder(null, parsed, cb);\r\n  }\r\n  let match = parsed.header.alg.match(ALG_RE);\r\n  if (!match) {\r\n    parsed.error = { message: `Unrecognized algorithm ${parsed.header.alg}` };\r\n    return responder(null, parsed, cb);\r\n  }\r\n  if (parsed.algList && !parsed.algList.includes(parsed.header.alg)) {\r\n    parsed.error = { message: `Unwanted algorithm ${parsed.header.alg}` };\r\n    return responder(null, parsed, cb);\r\n  }\r\n  let protect = `${parsed.parts[0]}.${parsed.parts[1]}`;\r\n  let verifyJws;\r\n  if (match[1] === 'HS') {\r\n    verifyJws = verifyHsJws;\r\n  } else if (match[1] === 'RS') {\r\n    verifyJws = verifyRsJws;\r\n  } else {\r\n    verifyJws = verifyEsJws;\r\n  }\r\n  let integrity;\r\n  try {\r\n    integrity = verifyJws(protect, parsed.parts[2], +match[2], key);\r\n  } catch (error) {\r\n    parsed.error = { message: `Could not verify integrity. ${error.message}` };\r\n    return responder(null, parsed, cb);\r\n  }\r\n  if (!integrity) {\r\n    parsed.error = { message: 'Integrity check failed' };\r\n    return responder(null, parsed, cb);\r\n  }\r\n  return payloadVerifications(parsed, cb);\r\n}\r\n\r\n// ===== HS256, HS384, HS512 ==================================================\r\n\r\nfunction generateHsJws(protect, bits, key) {\r\n  if (typeof key === 'string') {\r\n    key = Buffer.from(key, 'base64');\r\n  } else if (!(key instanceof Buffer)) {\r\n    throw new TypeError('Key must be a buffer or a base64 string');\r\n  }\r\n  let bytes = bits >> 3;\r\n  if (key.length < bytes) {\r\n    throw new TypeError(`Key length must be at least ${bytes} bytes`);\r\n  }\r\n  let hmac = crypto.createHmac(`SHA${bits}`, key);\r\n  let mac = buf2b64url(hmac.update(protect).digest());\r\n  return `${protect}.${mac}`;\r\n}\r\n\r\nfunction verifyHsJws(protect, mac, bits, key) {\r\n  if (typeof key === 'string') {\r\n    key = Buffer.from(key, 'base64');\r\n  } else if (!(key instanceof Buffer)) {\r\n    throw new TypeError('Key must be a buffer or a base64 string');\r\n  }\r\n  let bytes = bits >> 3;\r\n  if (key.length < bytes) {\r\n    throw new TypeError(`Key length must be at least ${bytes} bytes`);\r\n  }\r\n  let hmac = crypto.createHmac(`SHA${bits}`, key);\r\n  hmac.update(protect);\r\n  return crypto.timingSafeEqual(hmac.digest(), Buffer.from(mac, 'base64'));\r\n}\r\n\r\n// ===== RS256, RS384, RS512 ==================================================\r\n\r\nfunction generateRsJws(protect, bits, key) {\r\n  if (key instanceof Buffer) {\r\n    key = key.toString();\r\n  } else if (typeof key !== 'string') {\r\n    throw new TypeError('Key must be a buffer or a UTF-8 string');\r\n  }\r\n  if (!key.includes('-----BEGIN') || !key.includes('KEY-----')) {\r\n    throw new TypeError('Key must be a PEM formatted RSA private key');\r\n  }\r\n  let signer = crypto.createSign(`SHA${bits}`);\r\n  let signature = buf2b64url(signer.update(protect).sign(key));\r\n  return `${protect}.${signature}`;\r\n}\r\n\r\nfunction verifyRsJws(protect, signature, bits, key) {\r\n  if (key instanceof Buffer) {\r\n    key = key.toString();\r\n  } else if (typeof key !== 'string') {\r\n    throw new TypeError('Key must be a buffer or a UTF-8 string');\r\n  }\r\n  if (!key.includes('-----BEGIN') ||\r\n      !(key.includes('KEY-----') || key.includes('CERTIFICATE-----'))) {\r\n    throw new TypeError('Key must be a PEM formatted RSA public key');\r\n  }\r\n  let verifier = crypto.createVerify(`SHA${bits}`);\r\n  verifier.update(protect);\r\n  return verifier.verify(key, signature, 'base64');\r\n}\r\n\r\n// ===== ES256, ES384, ES512 ==================================================\r\n\r\nfunction generateEsJws(protect, bits, key) {\r\n  if (key instanceof Buffer) {\r\n    key = key.toString();\r\n  } else if (typeof key !== 'string') {\r\n    throw new TypeError('Key must be a buffer or a UTF-8 string');\r\n  }\r\n  if (!key.includes('-----BEGIN') || !key.includes('KEY-----')) {\r\n    throw new TypeError('Key must be a PEM formatted EC private key');\r\n  }\r\n  let signer = crypto.createSign(`SHA${bits}`);\r\n  signer.update(protect);\r\n  let size = 32;\r\n  if (bits === 384) {\r\n    size = 48;\r\n  } else if (bits === 512) {\r\n    size = 66;\r\n  }\r\n  let signature = buf2b64url(ecdsa.derToConcat(signer.sign(key), size));\r\n  return `${protect}.${signature}`;\r\n}\r\n\r\nfunction verifyEsJws(protect, signature, bits, key) {\r\n  if (key instanceof Buffer) {\r\n    key = key.toString();\r\n  } else if (typeof key !== 'string') {\r\n    throw new TypeError('Key must be a buffer or a UTF-8 string');\r\n  }\r\n  if (!key.includes('-----BEGIN') ||\r\n      !(key.includes('KEY-----') || key.includes('CERTIFICATE-----'))) {\r\n    throw new TypeError('Key must be a PEM formatted EC public key');\r\n  }\r\n  signature = Buffer.from(signature, 'base64');\r\n  let size = 32;\r\n  if (bits === 384) {\r\n    size = 48;\r\n  } else if (bits === 512) {\r\n    size = 66;\r\n  }\r\n  if (signature.length !== size << 1) {\r\n    return false;\r\n  }\r\n  let verifier = crypto.createVerify(`SHA${bits}`);\r\n  verifier.update(protect);\r\n  return verifier.verify(key, ecdsa.concatToDer(signature, size));\r\n}\r\n", "const crypto = require('crypto');\r\nconst { responder, buf2b64url, payloadVerifications } = require('./common.js');\r\n\r\nconst ALG_RE = /^(PBES2-HS(256|384|512)\\053)?(RSA-OAEP|dir|A(128|192|256)KW)$/;\r\nconst ENC_RE = /^A(128|192|256)(GCM|CBC-HS(256|384|512))$/;\r\n\r\n// ===== JWE GENERATION =======================================================\r\n\r\nexports.generate = (alg, enc, payload, ...rest) => {\r\n  // alg, enc, payload, key[, cb] or alg, enc, payload, keystore, kid[, cb]\r\n  let key;\r\n  let cb;\r\n  let header = { alg: alg, enc: enc };\r\n  if (rest[0].constructor !== Object) {\r\n    key = rest[0];\r\n    cb = typeof rest[1] === 'function' ? rest[1] : undefined;\r\n  } else {\r\n    header.kid = rest[1];\r\n    key = rest[0][rest[1]];\r\n    cb = typeof rest[2] === 'function' ? rest[2] : undefined;\r\n    if (!key) {\r\n      return responder(new TypeError('Invalid key identifier'), null, cb);\r\n    }\r\n  }\r\n  let aMatch = typeof alg === 'string' ? alg.match(ALG_RE) : null;\r\n  if (!aMatch || (aMatch[2] && +aMatch[2] !== aMatch[4] * 2)) {\r\n    let error = new TypeError('Unrecognized key management algorithm');\r\n    return responder(error, null, cb);\r\n  }\r\n  let eMatch = typeof enc === 'string' ? enc.match(ENC_RE) : null;\r\n  if (!eMatch || (eMatch[3] && +eMatch[3] !== eMatch[1] * 2)) {\r\n    let error = new TypeError('Unrecognized content encryption algorithm');\r\n    return responder(error, null, cb);\r\n  }\r\n  let salt;\r\n  if (aMatch[2]) {\r\n    let p2s = crypto.randomBytes(16);\r\n    header.p2c = 1024;\r\n    header.p2s = buf2b64url(p2s);\r\n    salt = Buffer.concat([Buffer.from(alg), Buffer.from([0]), p2s]);\r\n    if (!cb) {\r\n      let bits = Number(aMatch[2]);\r\n      key = crypto.pbkdf2Sync(key, salt, header.p2c, bits >> 4, `sha${bits}`);\r\n    }\r\n  }\r\n  let aad = buf2b64url(Buffer.from(JSON.stringify(header)));\r\n  if (!aMatch[2] || !cb) {\r\n    return generateJwe(aMatch, eMatch, aad, payload, key, cb);\r\n  }\r\n  let bits = Number(aMatch[2]);\r\n  crypto.pbkdf2(key, salt, header.p2c, bits >> 4, `sha${bits}`, (err, key) => {\r\n    if (err) return cb(err);\r\n    generateJwe(aMatch, eMatch, aad, payload, key, cb);\r\n  });\r\n}\r\n\r\nfunction generateJwe(aMatch, eMatch, aad, payload, key, cb) {\r\n  let cekLen = eMatch[3] ? +eMatch[1] >> 2 : +eMatch[1] >> 3;\r\n  let contEncr = eMatch[3] ? contentEncryptCbc : contentEncryptGcm;\r\n  let cek;\r\n  let cekEnc;\r\n  if (aMatch[0] !== 'dir') {\r\n    cek = crypto.randomBytes(cekLen);\r\n    let keyEncr = aMatch[4] ? aesKeyWrap : rsaOaepEncrypt;\r\n    try {\r\n      cekEnc = keyEncr(cek, key, +aMatch[4]);\r\n    } catch (error) {\r\n      return responder(error, null, cb);\r\n    }\r\n  } else {\r\n    // Key must be directly used for content encryption\r\n    if (typeof key === 'string') {\r\n      key = Buffer.from(key, 'base64');\r\n    } else if (!(key instanceof Buffer)) {\r\n      let error = new TypeError('Key must be a buffer or a base64 string');\r\n      return responder(error, null, cb);\r\n    }\r\n    if (key.length < cekLen) {\r\n      let error = new TypeError(`Key must be at least ${cekLen} bytes`);\r\n      return responder(error, null, cb);\r\n    }\r\n    cek = key.slice(0, cekLen);\r\n    cekEnc = '';\r\n  }\r\n  payload.iat = Math.floor(Date.now() / 1000);\r\n  let token = contEncr(aad, cek, cekEnc, JSON.stringify(payload), +eMatch[1]);\r\n  return responder(null, token, cb);\r\n}\r\n\r\n// ===== JWE VERIFICATION =====================================================\r\n\r\nexports.verify = (parsed, key, cb) => {\r\n  if (parsed.error) return responder(null, parsed, cb);\r\n  if (typeof parsed.header.alg !== 'string') {\r\n    parsed.error = { message: 'Missing or invalid alg claim in header' };\r\n    return responder(null, parsed, cb);\r\n  }\r\n  if (typeof parsed.header.enc !== 'string') {\r\n    parsed.error = { message: 'Missing or invalid enc claim in header' };\r\n    return responder(null, parsed, cb);\r\n  }\r\n  let aMatch = parsed.header.alg.match(ALG_RE);\r\n  if (!aMatch || (aMatch[2] && +aMatch[2] !== aMatch[4] * 2)) {\r\n    parsed.error = {\r\n      message: `Unrecognized key management algorithm ${parsed.header.alg}`\r\n    };\r\n    return responder(null, parsed, cb);\r\n  }\r\n  if (parsed.algList && !parsed.algList.includes(parsed.header.alg)) {\r\n    parsed.error = {\r\n      message: `Unwanted key management algorithm ${parsed.header.alg}`\r\n    };\r\n    return responder(null, parsed, cb);\r\n  }\r\n  let eMatch = parsed.header.enc.match(ENC_RE);\r\n  if (!eMatch || (eMatch[3] && +eMatch[3] !== eMatch[1] * 2)) {\r\n    parsed.error = {\r\n      message: `Unrecognized content encryption algorithm ${parsed.header.enc}`\r\n    };\r\n    return responder(null, parsed, cb);\r\n  }\r\n  if (parsed.encList && !parsed.encList.includes(parsed.header.enc)) {\r\n    parsed.error = {\r\n      message: `Unwanted content encryption algorithm ${parsed.header.enc}`\r\n    };\r\n    return responder(null, parsed, cb);\r\n  }\r\n  let salt;\r\n  let iter;\r\n  if (aMatch[2]) {\r\n    iter = parsed.header.p2c;\r\n    if (!Number.isInteger(iter) || iter < 1 || iter > 16384) {\r\n      parsed.error = { message: 'Missing or invalid p2c claim in header' };\r\n      return responder(null, parsed, cb);\r\n    } else if (!cb && iter > 1024) {\r\n      parsed.error = { message: 'p2c value too large for synchronous mode' };\r\n      return responder(null, parsed, cb);\r\n    }\r\n    if (typeof parsed.header.p2s !== 'string') {\r\n      parsed.error = { message: 'Missing or invalid p2s claim in header' };\r\n      return responder(null, parsed, cb);\r\n    }\r\n    let p2s = Buffer.from(parsed.header.p2s, 'base64');\r\n    let alg = parsed.header.alg;\r\n    salt = Buffer.concat([Buffer.from(alg), Buffer.from([0]), p2s]);\r\n    if (!cb) {\r\n      let bits = Number(aMatch[2]);\r\n      key = crypto.pbkdf2Sync(key, salt, iter, bits >> 4, `sha${bits}`);\r\n    }\r\n  }\r\n  if (!aMatch[2] || !cb) {\r\n    return decryptJwe(parsed, aMatch, eMatch, key, cb);\r\n  }\r\n  let bits = Number(aMatch[2]);\r\n  crypto.pbkdf2(key, salt, iter, bits >> 4, `sha${bits}`, (error, key) => {\r\n    if (error) return cb(error);\r\n    decryptJwe(parsed, aMatch, eMatch, key, cb);\r\n  });\r\n}\r\n\r\nfunction decryptJwe(parsed, aMatch, eMatch, key, cb) {\r\n  let aad = Buffer.from(parsed.parts[0]);\r\n  let cekEnc = Buffer.from(parsed.parts[1], 'base64');\r\n  let iv = Buffer.from(parsed.parts[2], 'base64');\r\n  let content = Buffer.from(parsed.parts[3], 'base64');\r\n  let tag = Buffer.from(parsed.parts[4], 'base64');\r\n  let cekLen = eMatch[3] ? +eMatch[1] >> 2 : +eMatch[1] >> 3;\r\n  let contDecr = eMatch[3] ? contentDecryptCbc : contentDecryptGcm;\r\n  let cek;\r\n  if (aMatch[0] !== 'dir') {\r\n    let keyDecr = aMatch[4] ? aesKeyUnwrap : rsaOaepDecrypt;\r\n    try {\r\n      cek = keyDecr(cekEnc, key, +aMatch[4]);\r\n    } catch (error) {\r\n      parsed.error = { message: `Could not decrypt token. ${error.message}` };\r\n      return responder(null, parsed, cb);\r\n    }\r\n  } else {\r\n    // Key must be directly used for content decryption\r\n    if (typeof key === 'string') {\r\n      key = Buffer.from(key, 'base64');\r\n    } else if (!(key instanceof Buffer)) {\r\n      parsed.error = { message: 'Invalid key' };\r\n      return responder(null, parsed, cb);\r\n    }\r\n    if (key.length < cekLen) {\r\n      parsed.error = {\r\n        message: `Invalid key length. Must be at least ${cekLen} bytes`\r\n      };\r\n      return responder(null, parsed, cb);\r\n    }\r\n    cek = key.slice(0, cekLen);\r\n  }\r\n  let plain;\r\n  try {\r\n    plain = contDecr(content, aad, tag, cek, iv, +eMatch[1]);\r\n  } catch (error) {\r\n    parsed.error = { message: `Could not decrypt token. ${error.message}` };\r\n    return responder(null, parsed, cb);\r\n  }\r\n  try {\r\n    parsed.payload = JSON.parse(plain);\r\n  } catch (error) {\r\n    parsed.error = { message: `Non parsable payload. ${error.message}` };\r\n    return responder(null, parsed, cb);\r\n  }\r\n  return payloadVerifications(parsed, cb);\r\n}\r\n\r\n// ===== A128GCM, A192GCM, A256GCM ============================================\r\n\r\nfunction contentEncryptGcm(aad, cek, cekEnc, plain, bits) {\r\n  let iv = crypto.randomBytes(12);\r\n  let cipher = crypto.createCipheriv(`id-aes${bits}-GCM`, cek, iv);\r\n  cipher.setAutoPadding(false);\r\n  cipher.setAAD(Buffer.from(aad));\r\n  let enc = buf2b64url(Buffer.concat([cipher.update(plain), cipher.final()]));\r\n  let tag = buf2b64url(cipher.getAuthTag());\r\n  return `${aad}.${cekEnc}.${buf2b64url(iv)}.${enc}.${tag}`;\r\n}\r\n\r\nfunction contentDecryptGcm(content, aad, tag, cek, iv, bits) {\r\n  let decipher = crypto.createDecipheriv(`id-aes${bits}-GCM`, cek, iv);\r\n  decipher.setAutoPadding(false);\r\n  decipher.setAAD(aad);\r\n  decipher.setAuthTag(tag);\r\n  return Buffer.concat([decipher.update(content), decipher.final()]);\r\n}\r\n\r\n// ===== A128CBC-HS256, A192CBC-HS384, A256CBC-HS512 ==========================\r\n\r\nfunction contentEncryptCbc(aad, cek, cekEnc, plain, bits) {\r\n  let iv = crypto.randomBytes(16);\r\n  let bytes = bits >> 3;\r\n  let cipher = crypto.createCipheriv(`AES-${bits}-CBC`, cek.slice(bytes), iv);\r\n  let enc = Buffer.concat([cipher.update(plain), cipher.final()]);\r\n  let len = aad.length << 3;\r\n  let al = Buffer.from(`000000000000000${len.toString(16)}`.slice(-16), 'hex');\r\n  let hmac = crypto.createHmac(`SHA${bits << 1}`, cek.slice(0, bytes));\r\n  hmac.update(Buffer.from(aad)).update(iv).update(enc).update(al);\r\n  let tag = buf2b64url(hmac.digest().slice(0, bytes));\r\n  return `${aad}.${cekEnc}.${buf2b64url(iv)}.${buf2b64url(enc)}.${tag}`;\r\n}\r\n\r\nfunction contentDecryptCbc(content, aad, tag, cek, iv, bits) {\r\n  let bytes = bits >> 3;\r\n  let len = aad.length << 3;\r\n  let al = Buffer.from(`000000000000000${len.toString(16)}`.slice(-16), 'hex');\r\n  let hmac = crypto.createHmac(`SHA${bits << 1}`, cek.slice(0, bytes));\r\n  hmac.update(aad).update(iv).update(content).update(al);\r\n  if (!crypto.timingSafeEqual(hmac.digest().slice(0, bytes), tag)) {\r\n    throw new Error('Authentication of encrypted data failed');\r\n  }\r\n  let encKey = cek.slice(bytes);\r\n  let decipher = crypto.createDecipheriv(`AES-${bits}-CBC`, encKey, iv);\r\n  return Buffer.concat([decipher.update(content), decipher.final()]);\r\n}\r\n\r\n// ===== RSA-OAEP =============================================================\r\n\r\nfunction rsaOaepEncrypt(cek, key) {\r\n  if (key instanceof Buffer) {\r\n    key = key.toString();\r\n  } else if (typeof key !== 'string') {\r\n    throw new TypeError('Key must be a buffer or a string');\r\n  }\r\n  if (!key.includes('-----BEGIN') ||\r\n      !(key.includes('KEY-----') || key.includes('CERTIFICATE-----'))) {\r\n    throw new TypeError('Key must be a PEM formatted RSA public key');\r\n  }\r\n  let options = {key: key, padding: crypto.constants.RSA_PKCS1_OAEP_PADDING};\r\n  return buf2b64url(crypto.publicEncrypt(options, cek));\r\n}\r\n\r\nfunction rsaOaepDecrypt(cekEnc, key) {\r\n  if (key instanceof Buffer) {\r\n    key = key.toString();\r\n  }\r\n  if (typeof key !== 'string' ||\r\n      !key.includes('-----BEGIN') || !key.includes('KEY-----')) {\r\n    throw new TypeError('Key must be a PEM formatted RSA private key');\r\n  }\r\n  let options = {key: key, padding: crypto.constants.RSA_PKCS1_OAEP_PADDING};\r\n  return crypto.privateDecrypt(options, cekEnc);\r\n}\r\n\r\n// ===== A128KW, A192KW, A256KW ===============================================\r\n\r\nfunction aesKeyWrap(cek, key, bits) {\r\n  let bytes = bits >> 3;\r\n  if (typeof key === 'string') {\r\n    key = Buffer.from(key, 'base64');\r\n  } else if (!(key instanceof Buffer)) {\r\n    throw new TypeError('Key must be a buffer or a base64-encoded string');\r\n  }\r\n  if (key.length < bytes) {\r\n    throw new TypeError(`Key length must be at least ${bytes} bytes`);\r\n  }\r\n  key = key.slice(0, bytes);\r\n  let r = [];\r\n  for (let i = 0; i < cek.length; i += 8) {\r\n    r.push(cek.slice(i, i + 8));\r\n  }\r\n  let iv = Buffer.alloc(16);\r\n  let a = Buffer.from('A6A6A6A6A6A6A6A6', 'hex');\r\n  let count = 1;\r\n  for (let j = 0; j < 6; j++) {\r\n    for (let i = 0; i < r.length; i++) {\r\n      let cipher = crypto.createCipheriv(`AES${bits}`, key, iv);\r\n      let c = `000000000000000${count.toString(16)}`.slice(-16);\r\n      let b = cipher.update(Buffer.concat([a, r[i]]));\r\n      a = Buffer.from(c, 'hex');\r\n      for (let n = 0; n < 8; n++) {\r\n        a[n] ^= b[n];\r\n      }\r\n      r[i] = b.slice(8, 16);\r\n      count++;\r\n    }\r\n  }\r\n  return buf2b64url(Buffer.concat([a].concat(r)));\r\n}\r\n\r\nfunction aesKeyUnwrap(cekEnc, key, bits) {\r\n  let bytes = bits >> 3;\r\n  if (typeof key === 'string') {\r\n    key = Buffer.from(key, 'base64');\r\n  } else if (!(key instanceof Buffer)) {\r\n    throw new TypeError('Key must be a buffer or a base64 string');\r\n  }\r\n  if (key.length < bytes) {\r\n    throw new TypeError(`Key must be at least ${bytes} bytes`);\r\n  }\r\n  key = key.slice(0, bytes);\r\n  let a = cekEnc.slice(0, 8);\r\n  let r = [];\r\n  for (let i = 8; i < cekEnc.length; i += 8) {\r\n    r.push(cekEnc.slice(i, i + 8));\r\n  }\r\n  let z = Buffer.alloc(16);\r\n  let count = 6 * r.length;\r\n  for (let j = 5; j >= 0 ; j--) {\r\n    for (let i = r.length - 1; i >= 0; i--) {\r\n      let c = `000000000000000${count.toString(16)}`.slice(-16);\r\n      c = Buffer.from(c, 'hex');\r\n      for (let n = 0; n < 8; n++) {\r\n        a[n] ^= c[n];\r\n      }\r\n      let decipher = crypto.createDecipheriv(`AES${bits}`, key, z);\r\n      let b = decipher.update(Buffer.concat([a, r[i], z]));\r\n      a = b.slice(0, 8);\r\n      r[i] = b.slice(8, 16);\r\n      count--;\r\n    }\r\n  }\r\n  if (!a.equals(Buffer.from('A6A6A6A6A6A6A6A6', 'hex'))) {\r\n    throw new Error('Key unwrapping failed');\r\n  }\r\n  return Buffer.concat(r);\r\n}\r\n", "const jws = require('./lib/jws.js');\r\nconst jwe = require('./lib/jwe.js');\r\nconst { responder } = require('./lib/common.js');\r\n\r\n// ===== TOKEN GENERATION =====================================================\r\n\r\nexports.generate = (alg, ...rest) => {\r\n  // alg, payload, key[, cb] or alg, payload, keystore, kid[, cb]\r\n  if (rest[0].constructor === Object) return jws.generate(alg, ...rest);\r\n  // alg, enc, payload, key[, cb] or alg, enc, payload, keystore, kid[, cb]\r\n  if (rest[1].constructor === Object) return jwe.generate(alg, ...rest);\r\n  // There is no payload object where expected\r\n  let idx = rest.length - 1;\r\n  if (idx > 1 && idx < 5 && typeof rest[idx] === 'function') {\r\n    rest[idx](error);\r\n  } else {\r\n    throw error;\r\n  }\r\n}\r\n\r\n// ===== TOKEN PARSING ========================================================\r\n\r\nexports.parse = (token) => new ParsedToken(token);\r\n\r\nfunction ParsedToken(token) {\r\n  this.parts = typeof token === 'string' ? token.split('.') : [];\r\n  if (this.parts.length === 3) {\r\n    this.type = 'JWS';\r\n  } else if (this.parts.length === 5) {\r\n    this.type = 'JWE';\r\n  } else {\r\n    this.error = { message: 'Invalid token' };\r\n    return;\r\n  }\r\n  try {\r\n    this.header = JSON.parse(Buffer.from(this.parts[0], 'base64'));\r\n  } catch (error) {\r\n    this.error = { message: `Non parsable header. ${error.message}` };\r\n    return;\r\n  }\r\n  if (this.type === 'JWS') {\r\n    // Parsing exposes payload for JWS only; for JWE happens at verify\r\n    try {\r\n      this.payload = JSON.parse(Buffer.from(this.parts[1], 'base64'));\r\n    } catch (error) {\r\n      this.error = { message: `Non parsable payload. ${error.message}` };\r\n    }\r\n  }\r\n}\r\n\r\n// ===== POST-PARSING UTLITIES ================================================\r\n\r\nParsedToken.prototype.setAlgorithmList = function(algList, encList) {\r\n  // algList is ignored if not string or array of strings\r\n  if (typeof algList === 'string') {\r\n    this.algList = [algList];\r\n  } else if (Array.isArray(algList)) {\r\n    this.algList = algList;\r\n  }\r\n  // encList is ignored if not string or array of strings\r\n  if (typeof encList === 'string') {\r\n    this.encList = [encList];\r\n  } else if (Array.isArray(encList)) {\r\n    this.encList = encList;\r\n  }\r\n  return this;\r\n}\r\n\r\nParsedToken.prototype.setTokenLifetime = function(lifetime) {\r\n  // lifetime is ignored if not integer greater than 0\r\n  if (Number.isInteger(lifetime) && lifetime > 0) this.lifetime = lifetime;\r\n  return this;\r\n}\r\n\r\nParsedToken.prototype.setAudience = function(audList) {\r\n  // audList is ignored if not string or array of strings\r\n  if (typeof audList === 'string') {\r\n    this.audList = [audList];\r\n  } else if (Array.isArray(audList)) {\r\n    this.audList = audList;\r\n  }\r\n  return this;\r\n}\r\n\r\nParsedToken.prototype.setIssuer = function(issList) {\r\n  // issList is ignored if not string or array of strings\r\n  if (typeof issList === 'string') {\r\n    this.issList = [issList];\r\n  } else if (Array.isArray(issList)) {\r\n    this.issList = issList;\r\n  }\r\n  return this;\r\n}\r\n\r\n// ===== TOKEN VERIFICATION ===================================================\r\n\r\nParsedToken.prototype.verify = function(p0, cb) {\r\n  // key[, cb] or keystore[, cb]\r\n  cb = typeof cb === 'function' ? cb : undefined;\r\n  if (this.error) return responder(null, this, cb);\r\n  let key;\r\n  if (p0.constructor !== Object) {\r\n    key = p0;\r\n  } else if (this.header.kid === undefined) {\r\n    // Cannot extract key from keystore\r\n    this.error = { message: 'Missing kid claim in header' };\r\n    return responder(null, this, cb);\r\n  } else if (p0[this.header.kid] === undefined) {\r\n    // Key not found in keystore\r\n    this.error = { message: 'Key with id not found', kid: this.header.kid };\r\n    return responder(null, this, cb);\r\n  } else {\r\n    key = p0[this.header.kid];\r\n  }\r\n  let verify = this.type === 'JWS' ? jws.verify : jwe.verify;\r\n  return verify(this, key, cb);\r\n}\r\n", "let getIdx = require('./_get-idx')\nlet cookie = require('cookie')\nlet jwt = require('node-webtokens')\nlet alg = 'dir'\nlet enc = 'A128GCM'\n\n// 128bit key size\nlet fallback = Buffer.from('1234567890123456').toString('base64')\n\n// need to STRONGLY encourage setting ARC_APP_SECRET in the docs\nlet key = process.env.ARC_APP_SECRET || fallback\n\n// wrapper for jwe.create/jwe.parse\nlet jwe = {\n  create (payload) {\n    return jwt.generate(alg, enc, payload, key)\n  },\n  parse (token) {\n    const WEEK = 604800\n    return jwt.parse(token).setTokenLifetime(WEEK).verify(key)\n  }\n}\n\n/**\n * reads req cookie and returns token payload or an empty object\n */\nfunction read (req, callback) {\n  let promise\n  if (!callback) {\n    promise = new Promise(function argh (res, rej) {\n      callback = function errback (err, result) {\n        err ? rej(err) : res(result)\n      }\n    })\n  }\n  let rawCookie = req.headers && (req.headers.cookie || req.headers.Cookie)\n  // Lambda payload version 2 puts the cookies in an array on the request\n  if (!rawCookie && req.cookies) {\n    rawCookie = req.cookies.join(';')\n  }\n\n  let idx = getIdx(rawCookie)\n  let sesh = cookie.parse(idx)._idx\n  let token = jwe.parse(sesh)\n  callback(null, token.valid ? token.payload : {})\n  return promise\n}\n\n/**\n * creates a Set-Cookie header with token payload encrypted\n */\nfunction write (payload, callback) {\n  let promise\n  if (!callback) {\n    promise = new Promise(function ugh (res, rej) {\n      callback = function errback (err, result) {\n        err ? rej(err) : res(result)\n      }\n    })\n  }\n  let key = '_idx'\n  let val = jwe.create(payload)\n  let maxAge = process.env.SESSION_TTL || 7.884e+8\n  let sameSite = process.env.ARC_SESSION_SAME_SITE || 'lax'\n  let options = {\n    maxAge,\n    expires: new Date(Date.now() + maxAge * 1000),\n    secure: true,\n    httpOnly: true,\n    path: '/',\n    sameSite,\n  }\n  if (process.env.SESSION_DOMAIN) {\n    options.domain = process.env.SESSION_DOMAIN\n  }\n  if (process.env.NODE_ENV === 'testing') {\n    delete options.secure\n  }\n  callback(null, cookie.serialize(key, val, options))\n  return promise\n}\n\nmodule.exports = { read, write }\n", "/**\n * Module dependencies.\n */\n\nvar crypto = require('crypto');\n\n/**\n * Sign the given `val` with `secret`.\n *\n * @param {String} val\n * @param {String} secret\n * @return {String}\n * @api private\n */\n\nexports.sign = function(val, secret){\n  if ('string' != typeof val) throw new TypeError(\"Cookie value must be provided as a string.\");\n  if ('string' != typeof secret) throw new TypeError(\"Secret string must be provided.\");\n  return val + '.' + crypto\n    .createHmac('sha256', secret)\n    .update(val)\n    .digest('base64')\n    .replace(/\\=+$/, '');\n};\n\n/**\n * Unsign and decode the given `val` with `secret`,\n * returning `false` if the signature is invalid.\n *\n * @param {String} val\n * @param {String} secret\n * @return {String|Boolean}\n * @api private\n */\n\nexports.unsign = function(val, secret){\n  if ('string' != typeof val) throw new TypeError(\"Signed cookie string must be provided.\");\n  if ('string' != typeof secret) throw new TypeError(\"Secret string must be provided.\");\n  var str = val.slice(0, val.lastIndexOf('.'))\n    , mac = exports.sign(str, secret)\n    , macBuffer = Buffer.from(mac)\n    , valBuffer = Buffer.alloc(macBuffer.length);\n\n  valBuffer.write(val);\n  return crypto.timingSafeEqual(macBuffer, valBuffer) ? str : false;\n};\n", "let aws = require('aws-sdk')\nlet https = require('https')\n\n/**\n * Instantiates Dynamo service interfaces\n * - Internal APIs should use `db` + `doc` to instantiate DynamoDB interfaces\n * - Avoid using `direct.db` + `direct.doc`: as it's an issue vector for using Functions in certain test harnesses!\n */\nfunction getDynamo (type, callback) {\n  if (!type) throw ReferenceError('Must supply Dynamo service interface type')\n\n  let testing = process.env.NODE_ENV === 'testing'\n  let arcLocal = process.env.ARC_LOCAL\n  let port = process.env.ARC_TABLES_PORT || 5000\n  let local = {\n    endpoint: new aws.Endpoint(`http://localhost:${port}`),\n    region: process.env.AWS_REGION || 'us-west-2' // Do not assume region is set!\n  }\n  let DB = aws.DynamoDB\n  let Doc = aws.DynamoDB.DocumentClient\n  let dynamo // Assigned below\n\n  /**\n   * This module may be loaded by @arc/arc via repl\n   * - The `direct` interfaces will instantiate before NODE_ENV is set\n   * - Thus, unlike most other scenarios, don't assume the presence of NODE_ENV\n   * - Also: some test harnesses (ahem) will automatically populate NODE_ENV with their own values, unbidden\n   * - *Why this matters*: using https.Agent (and not http.Agent) will stall the Sandbox\n   */\n  if (!testing && !arcLocal) {\n    let agent = new https.Agent({\n      keepAlive: true,\n      maxSockets: 50, // Node can set to Infinity; AWS maxes at 50; check back on this every once in a while\n      rejectUnauthorized: true,\n    })\n    aws.config.update({\n      httpOptions: { agent }\n    })\n    // TODO? migrate to using `AWS_NODEJS_CONNECTION_REUSE_ENABLED`?\n  }\n\n  if (type === 'db') {\n    dynamo = testing\n      ? new DB(local)\n      : new DB\n  }\n\n  if (type === 'doc') {\n    dynamo = testing\n      ? new Doc(local)\n      : new Doc\n  }\n\n  if (type === 'session') {\n    // if SESSION_TABLE_NAME isn't defined we mock the client and just pass session thru\n    let passthru = !process.env.SESSION_TABLE_NAME\n    let mock = {\n      get (params, callback) {\n        callback()\n      },\n      put (params, callback) {\n        callback()\n      }\n    }\n    dynamo = testing\n      ? new Doc(local)\n      : (passthru ? mock : new Doc)\n  }\n\n  if (!callback) return dynamo\n  else callback(null, dynamo)\n}\n\nmodule.exports = {\n  db: getDynamo.bind({}, 'db'),\n  doc: getDynamo.bind({}, 'doc'),\n  session: getDynamo.bind({}, 'session'),\n  direct: {\n    db: getDynamo('db'),\n    doc: getDynamo('doc')\n  }\n}\n", "/*!\n * random-bytes\n * Copyright(c) 2016 Douglas Christopher Wilson\n * MIT Licensed\n */\n\n'use strict'\n\n/**\n * Module dependencies.\n * @private\n */\n\nvar crypto = require('crypto')\n\n/**\n * Module variables.\n * @private\n */\n\nvar generateAttempts = crypto.randomBytes === crypto.pseudoRandomBytes ? 1 : 3\n\n/**\n * Module exports.\n * @public\n */\n\nmodule.exports = randomBytes\nmodule.exports.sync = randomBytesSync\n\n/**\n * Generates strong pseudo-random bytes.\n *\n * @param {number} size\n * @param {function} [callback]\n * @return {Promise}\n * @public\n */\n\nfunction randomBytes(size, callback) {\n  // validate callback is a function, if provided\n  if (callback !== undefined && typeof callback !== 'function') {\n    throw new TypeError('argument callback must be a function')\n  }\n\n  // require the callback without promises\n  if (!callback && !global.Promise) {\n    throw new TypeError('argument callback is required')\n  }\n\n  if (callback) {\n    // classic callback style\n    return generateRandomBytes(size, generateAttempts, callback)\n  }\n\n  return new Promise(function executor(resolve, reject) {\n    generateRandomBytes(size, generateAttempts, function onRandomBytes(err, str) {\n      if (err) return reject(err)\n      resolve(str)\n    })\n  })\n}\n\n/**\n * Generates strong pseudo-random bytes sync.\n *\n * @param {number} size\n * @return {Buffer}\n * @public\n */\n\nfunction randomBytesSync(size) {\n  var err = null\n\n  for (var i = 0; i < generateAttempts; i++) {\n    try {\n      return crypto.randomBytes(size)\n    } catch (e) {\n      err = e\n    }\n  }\n\n  throw err\n}\n\n/**\n * Generates strong pseudo-random bytes.\n *\n * @param {number} size\n * @param {number} attempts\n * @param {function} callback\n * @private\n */\n\nfunction generateRandomBytes(size, attempts, callback) {\n  crypto.randomBytes(size, function onRandomBytes(err, buf) {\n    if (!err) return callback(null, buf)\n    if (!--attempts) return callback(err)\n    setTimeout(generateRandomBytes.bind(null, size, attempts, callback), 10)\n  })\n}\n", "/*!\n * uid-safe\n * Copyright(c) 2014 Jonathan Ong\n * Copyright(c) 2015-2017 Douglas Christopher Wilson\n * MIT Licensed\n */\n\n'use strict'\n\n/**\n * Module dependencies.\n * @private\n */\n\nvar randomBytes = require('random-bytes')\n\n/**\n * Module variables.\n * @private\n */\n\nvar EQUAL_END_REGEXP = /=+$/\nvar PLUS_GLOBAL_REGEXP = /\\+/g\nvar SLASH_GLOBAL_REGEXP = /\\//g\n\n/**\n * Module exports.\n * @public\n */\n\nmodule.exports = uid\nmodule.exports.sync = uidSync\n\n/**\n * Create a unique ID.\n *\n * @param {number} length\n * @param {function} [callback]\n * @return {Promise}\n * @public\n */\n\nfunction uid (length, callback) {\n  // validate callback is a function, if provided\n  if (callback !== undefined && typeof callback !== 'function') {\n    throw new TypeError('argument callback must be a function')\n  }\n\n  // require the callback without promises\n  if (!callback && !global.Promise) {\n    throw new TypeError('argument callback is required')\n  }\n\n  if (callback) {\n    // classic callback style\n    return generateUid(length, callback)\n  }\n\n  return new Promise(function executor (resolve, reject) {\n    generateUid(length, function onUid (err, str) {\n      if (err) return reject(err)\n      resolve(str)\n    })\n  })\n}\n\n/**\n * Create a unique ID sync.\n *\n * @param {number} length\n * @return {string}\n * @public\n */\n\nfunction uidSync (length) {\n  return toString(randomBytes.sync(length))\n}\n\n/**\n * Generate a unique ID string.\n *\n * @param {number} length\n * @param {function} callback\n * @private\n */\n\nfunction generateUid (length, callback) {\n  randomBytes(length, function (err, buf) {\n    if (err) return callback(err)\n    callback(null, toString(buf))\n  })\n}\n\n/**\n * Change a Buffer into a string.\n *\n * @param {Buffer} buf\n * @return {string}\n * @private\n */\n\nfunction toString (buf) {\n  return buf.toString('base64')\n    .replace(EQUAL_END_REGEXP, '')\n    .replace(PLUS_GLOBAL_REGEXP, '-')\n    .replace(SLASH_GLOBAL_REGEXP, '_')\n}\n", "// epoch + one week IN SECONDS\n// - Date.now() returns ms\n// - DynamoDB TTL is in seconds\nmodule.exports = function _weekFromNow () {\n  return (Date.now() / 1000) + 604800\n}\n", "\nvar assert = require('assert')\n\nvar base62 = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789'\nvar base36 = 'abcdefghijklmnopqrstuvwxyz0123456789'\nvar base10 = '0123456789'\n\nexports = module.exports = create(base62)\nexports.base62 = exports\nexports.base36 = create(base36)\nexports.base10 = create(base10)\n\nexports.create = create\n\nfunction create(chars) {\n  assert(typeof chars === 'string', 'the list of characters must be a string!')\n  var length = Buffer.byteLength(chars)\n  return function rndm(len) {\n    len = len || 10\n    assert(typeof len === 'number' && len >= 0, 'the length of the random string must be a number!')\n    var salt = ''\n    for (var i = 0; i < len; i++) salt += chars[Math.floor(length * Math.random())]\n    return salt\n  }\n}\n", "'use strict';\r\n\r\n// Implements Brad Hill's Double HMAC pattern from\r\n// https://www.nccgroup.trust/us/about-us/newsroom-and-events/blog/2011/february/double-hmac-verification/.\r\n// The approach is similar to the node's native implementation of timing safe buffer comparison that will be available on v6+.\r\n// https://github.com/nodejs/node/issues/3043\r\n// https://github.com/nodejs/node/pull/3073\r\n\r\nvar crypto = require('crypto');\r\n\r\nfunction bufferEqual(a, b) {\r\n  if (a.length !== b.length) {\r\n    return false;\r\n  }\r\n  // `crypto.timingSafeEqual` was introduced in Node v6.6.0\r\n  // <https://github.com/jshttp/basic-auth/issues/39>\r\n  if (crypto.timingSafeEqual) {\r\n    return crypto.timingSafeEqual(a, b);\r\n  }\r\n  for (var i = 0; i < a.length; i++) {\r\n    if (a[i] !== b[i]) {\r\n      return false;\r\n    }\r\n  }\r\n  return true;\r\n}\r\n\r\nfunction timeSafeCompare(a, b) {\r\n  var sa = String(a);\r\n  var sb = String(b);\r\n  var key = crypto.pseudoRandomBytes(32);\r\n  var ah = crypto.createHmac('sha256', key).update(sa).digest();\r\n  var bh = crypto.createHmac('sha256', key).update(sb).digest();\r\n\r\n  return bufferEqual(ah, bh) && a === b;\r\n}\r\n\r\nmodule.exports = timeSafeCompare;\r\n", "/*!\n * csrf\n * Copyright(c) 2014 Jonathan Ong\n * Copyright(c) 2015 Douglas Christopher Wilson\n * MIT Licensed\n */\n\n'use strict'\n\n/**\n * Module dependencies.\n * @private\n */\n\nvar rndm = require('rndm')\nvar uid = require('uid-safe')\nvar compare = require('tsscmp')\nvar crypto = require('crypto')\n\n/**\n * Module variables.\n * @private\n */\n\nvar EQUAL_GLOBAL_REGEXP = /=/g\nvar PLUS_GLOBAL_REGEXP = /\\+/g\nvar SLASH_GLOBAL_REGEXP = /\\//g\n\n/**\n * Module exports.\n * @public\n */\n\nmodule.exports = Tokens\n\n/**\n * Token generation/verification class.\n *\n * @param {object} [options]\n * @param {number} [options.saltLength=8] The string length of the salt\n * @param {number} [options.secretLength=18] The byte length of the secret key\n * @public\n */\n\nfunction Tokens (options) {\n  if (!(this instanceof Tokens)) {\n    return new Tokens(options)\n  }\n\n  var opts = options || {}\n\n  var saltLength = opts.saltLength !== undefined\n    ? opts.saltLength\n    : 8\n\n  if (typeof saltLength !== 'number' || !isFinite(saltLength) || saltLength < 1) {\n    throw new TypeError('option saltLength must be finite number > 1')\n  }\n\n  var secretLength = opts.secretLength !== undefined\n    ? opts.secretLength\n    : 18\n\n  if (typeof secretLength !== 'number' || !isFinite(secretLength) || secretLength < 1) {\n    throw new TypeError('option secretLength must be finite number > 1')\n  }\n\n  this.saltLength = saltLength\n  this.secretLength = secretLength\n}\n\n/**\n * Create a new CSRF token.\n *\n * @param {string} secret The secret for the token.\n * @public\n */\n\nTokens.prototype.create = function create (secret) {\n  if (!secret || typeof secret !== 'string') {\n    throw new TypeError('argument secret is required')\n  }\n\n  return this._tokenize(secret, rndm(this.saltLength))\n}\n\n/**\n * Create a new secret key.\n *\n * @param {function} [callback]\n * @public\n */\n\nTokens.prototype.secret = function secret (callback) {\n  return uid(this.secretLength, callback)\n}\n\n/**\n * Create a new secret key synchronously.\n * @public\n */\n\nTokens.prototype.secretSync = function secretSync () {\n  return uid.sync(this.secretLength)\n}\n\n/**\n * Tokenize a secret and salt.\n * @private\n */\n\nTokens.prototype._tokenize = function tokenize (secret, salt) {\n  return salt + '-' + hash(salt + '-' + secret)\n}\n\n/**\n * Verify if a given token is valid for a given secret.\n *\n * @param {string} secret\n * @param {string} token\n * @public\n */\n\nTokens.prototype.verify = function verify (secret, token) {\n  if (!secret || typeof secret !== 'string') {\n    return false\n  }\n\n  if (!token || typeof token !== 'string') {\n    return false\n  }\n\n  var index = token.indexOf('-')\n\n  if (index === -1) {\n    return false\n  }\n\n  var salt = token.substr(0, index)\n  var expected = this._tokenize(secret, salt)\n\n  return compare(token, expected)\n}\n\n/**\n * Hash a string with SHA1, returning url-safe base64\n * @param {string} str\n * @private\n */\n\nfunction hash (str) {\n  return crypto\n    .createHash('sha1')\n    .update(str, 'ascii')\n    .digest('base64')\n    .replace(PLUS_GLOBAL_REGEXP, '-')\n    .replace(SLASH_GLOBAL_REGEXP, '_')\n    .replace(EQUAL_GLOBAL_REGEXP, '')\n}\n", "/*! queue-microtask. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */\nlet promise\n\nmodule.exports = typeof queueMicrotask === 'function'\n  ? queueMicrotask.bind(typeof window !== 'undefined' ? window : global)\n  // reuse resolved promise, and allocate it lazily\n  : cb => (promise || (promise = Promise.resolve()))\n    .then(cb)\n    .catch(err => setTimeout(() => { throw err }, 0))\n", "/*! run-parallel. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */\nmodule.exports = runParallel\n\nconst queueMicrotask = require('queue-microtask')\n\nfunction runParallel (tasks, cb) {\n  let results, pending, keys\n  let isSync = true\n\n  if (Array.isArray(tasks)) {\n    results = []\n    pending = tasks.length\n  } else {\n    keys = Object.keys(tasks)\n    results = {}\n    pending = keys.length\n  }\n\n  function done (err) {\n    function end () {\n      if (cb) cb(err, results)\n      cb = null\n    }\n    if (isSync) queueMicrotask(end)\n    else end()\n  }\n\n  function each (i, err, result) {\n    results[i] = result\n    if (--pending === 0 || err) {\n      done(err)\n    }\n  }\n\n  if (!pending) {\n    // empty\n    done(null)\n  } else if (keys) {\n    // object\n    keys.forEach(function (key) {\n      tasks[key](function (err, result) { each(key, err, result) })\n    })\n  } else {\n    // array\n    tasks.forEach(function (task, i) {\n      task(function (err, result) { each(i, err, result) })\n    })\n  }\n\n  isSync = false\n}\n", "let uid = require('uid-safe')\nlet week = require('./_week-from-now')\nlet dynamo = require('../../../../tables/dynamo').session\nlet crsf = require('csrf')\nlet parallel = require('run-parallel')\n\nmodule.exports = function _create (name, payload, callback) {\n  parallel([\n    function _key (callback) {\n      uid(18, function _uid (err, val) {\n        if (err) callback(err)\n        else callback(null, { _idx: val })\n      })\n    },\n    function _secret (callback) {\n      (new crsf).secret(function _uid (err, val) {\n        if (err) callback(err)\n        else callback(null, { _secret: val })\n      })\n    }\n  ],\n  function _put (err, results) {\n    if (err) throw err\n    results.push({ _ttl: week() })\n    let keys = results.reduce((a, b) => Object.assign(a, b))\n    let session = Object.assign(payload, keys)\n    dynamo(function _gotDB (err, db) {\n      if (err) callback(err)\n      else {\n        db.put({\n          TableName: name,\n          Item: session\n        },\n        function _create (err) {\n          if (err) callback(err)\n          else callback(null, session)\n        })\n      }\n    })\n  })\n}\n", "let dynamo = require('../../../../tables/dynamo').session\nlet create = require('./create')\n\nmodule.exports = function _find (name, _idx, callback) {\n  dynamo(function _gotDB (err, db) {\n    if (err) callback(err)\n    else {\n      db.get({\n        TableName: name,\n        ConsistentRead: true,\n        Key: { _idx }\n      },\n      function _get (err, data) {\n        if (err) callback(err)\n        else {\n          let result = typeof data === 'undefined' ? false : data.Item\n          if (result && result._secret) {\n            callback(null, result)\n          }\n          else {\n            create(name, {}, callback)\n          }\n        }\n      })\n    }\n  })\n}\n", "let dynamo = require('../../../../tables/dynamo').session\nlet week = require('./_week-from-now')\n\nmodule.exports = function _update (name, payload, callback) {\n  let _ttl = week()\n  let session = Object.assign(payload, { _ttl })\n  dynamo(function _gotDB (err, db) {\n    if (err) callback(err)\n    else {\n      db.put({\n        TableName: name,\n        Item: session\n      },\n      function _create (err) {\n        if (err) callback(err)\n        else callback(null, session)\n      })\n    }\n  })\n}\n", "let cookie = require('cookie')\nlet getIdx = require('../_get-idx')\nlet { unsign, sign } = require('cookie-signature')\n\nlet find = require('./find')\nlet create = require('./create')\nlet update = require('./update')\n\nmodule.exports = { read, write }\n\n/**\n * reads request for session cookie and looks it up in dynamo\n */\nfunction read (request, callback) {\n\n  // be async/await friendly\n  let promise\n  if (!callback) {\n    promise = new Promise(function (res, rej) {\n      callback = function (err, result) {\n        err ? rej(err) : res(result)\n      }\n    })\n  }\n\n  // read dynamo session table\n  let name = process.env.SESSION_TABLE_NAME || tableLogicalId('arc-sessions')\n  let secret = process.env.ARC_APP_SECRET || process.env.ARC_APP_NAME || 'fallback'\n  // TODO: uppercase 'Cookie' is not the header name on AWS Lambda; it's\n  // lowercase 'cookie' on lambda...\n  let rawCookie = request.headers && (request.headers.Cookie || request.headers.cookie)\n  // Lambda payload version 2 puts the cookies in an array on the request\n  if (!rawCookie && request.cookies) {\n    rawCookie = request.cookies.join(';')\n  }\n\n  let idx = getIdx(rawCookie)\n  let sesh = cookie.parse(idx)._idx\n  let valid = unsign(sesh || '', secret)\n\n  // find or create a new session\n  let exec = sesh && valid ? find.bind({}, name) : create.bind({}, name)\n  let params = sesh && valid ? valid : {}\n\n  exec(params, callback)\n  return promise\n}\n\n/**\n * expect params to be\n * - _idx\n * - _secret\n */\nfunction write (params, callback) {\n  // be async/await friendly\n  let promise\n  if (!callback) {\n    promise = new Promise(function (res, rej) {\n      callback = function (err, result) {\n        err ? rej(err) : res(result)\n      }\n    })\n  }\n\n  // read dynamo session table\n  let name = process.env.SESSION_TABLE_NAME || tableLogicalId('arc-sessions')\n  let secret = process.env.ARC_APP_SECRET || process.env.ARC_APP_NAME || 'fallback'\n\n  update(name, params, function _update (err) {\n    if (err) {\n      callback(err)\n    }\n    else {\n      let maxAge = process.env.SESSION_TTL || 7.884e+8\n      let options = {\n        maxAge,\n        expires: new Date(Date.now() + maxAge * 1000),\n        secure: true,\n        httpOnly: true,\n        path: '/',\n        sameSite: 'lax',\n      }\n      if (process.env.SESSION_DOMAIN) {\n        options.domain = process.env.SESSION_DOMAIN\n      }\n      if (process.env.NODE_ENV === 'testing')\n        delete options.secure\n      let result = cookie.serialize('_idx', sign(params._idx, secret), options)\n      callback(null, result)\n    }\n  })\n\n  return promise\n}\n\nfunction tableLogicalId (name) {\n  let env = process.env.NODE_ENV === 'production' ? 'production' : 'staging'\n  return `${process.env.ARC_APP_NAME}-${env}-${name}`\n}\n", "let jwe = require('./providers/jwe')\nlet ddb = require('./providers/ddb')\n\nmodule.exports = function read (request, callback) {\n\n  if (process.env.SESSION_TABLE_NAME === 'jwe')\n    return jwe.read(request, callback)\n\n  return ddb.read(request, callback)\n}\n", "let jwe = require('./providers/jwe')\nlet ddb = require('./providers/ddb')\n\nmodule.exports = function write (params, callback) {\n\n  if (process.env.SESSION_TABLE_NAME === 'jwe')\n    return jwe.write(params, callback)\n\n  return ddb.write(params, callback)\n}\n", "let qs = require('querystring')\n\n/**\n * Arc 6 bodies are always base64 encoded strings with req.isBase64Encoded = true (or null, which we interpolate into `{}`)\n * <Arc 6 bodies are always objects\n */\nmodule.exports = function parseBody (req) {\n  let ctype = req.headers['Content-Type'] || req.headers['content-type']\n  let passthru = !req.body || !req.headers || !ctype || !Object.getOwnPropertyNames(req.body).length\n  if (passthru) {\n    return req.body\n  }\n  else {\n    // Paranoid deep copy\n    let request = JSON.parse(JSON.stringify(req))\n    let headers = request.headers\n    let contentType = type => headers && headers['Content-Type'] && headers['Content-Type'].includes(type) || headers && headers['content-type'] && headers['content-type'].includes(type)\n\n    let isString = typeof request.body === 'string'\n    let isBase64 = request.isBase64Encoded\n    let isParsing = isString && isBase64\n    let isJSON = (contentType('application/json') || contentType('application/vnd.api+json')) && isString\n    let isFormURLEncoded = contentType('application/x-www-form-urlencoded') && isParsing\n    let isMultiPartFormData = contentType('multipart/form-data') && isParsing\n    let isOctetStream = contentType('application/octet-stream') && isParsing\n\n    if (isJSON) {\n      try {\n        let data = isBase64\n          // Base64 + JSON-encoded payloads (>Arc 6 REST)\n          ? Buffer.from(request.body, 'base64').toString()\n          // Raw JSON (HTTP API + Lambda v2.0 payload)\n          : request.body\n        request.body = JSON.parse(data) || {}\n      }\n      catch (e) {\n        throw Error('Invalid request body encoding or invalid JSON')\n      }\n    }\n\n    if (isFormURLEncoded) {\n      let data = new Buffer.from(request.body, 'base64').toString()\n      request.body = qs.parse(data)\n    }\n\n    if (isMultiPartFormData || isOctetStream) {\n      request.body = request.body.base64\n        ? request.body\n        : { base64: request.body }\n    }\n\n    return request.body\n  }\n}\n", "module.exports = function interpolateParams (req) {\n  // Handle HTTP API v2.0 payload scenarios, which omit params instead of passing them as null\n  if (req.version && req.version === '2.0') {\n    let { requestContext: context } = req\n    if (context && context.http && context.http.method) {\n      req.httpMethod = context.http.method\n    }\n    let unUndefined = [ 'body', 'pathParameters', 'queryStringParameters' ]\n    unUndefined.forEach(i => {\n      if (req[i] === undefined) req[i] = {}\n    })\n    // Expect 'GET /foo' or '$default'\n    req.resource = req.routeKey.split(' ')[1] || req.routeKey\n    // Backfill `req.path`\n    req.path = req.rawPath\n  }\n\n  // Un-null APIG-proxy-Lambda params in 6+\n  let unNulled = [ 'body', 'pathParameters', 'queryStringParameters', 'multiValueQueryStringParameters' ]\n  unNulled.forEach(i => {\n    if (req[i] === null) req[i] = {}\n  })\n\n  // Backfill params generated by <6 VTL\n  if (!req.method) req.method = req.httpMethod\n  if (!req.params) req.params = req.pathParameters\n  if (!req.query)  req.query  = req.queryStringParameters\n\n  // Legacy path parameter interpolation; 6+ REST gets this for free in `req.path`\n  let params = /\\{\\w+\\}/g\n  if (params.test(req.path)) {\n    let matches = req.path.match(params)\n    let vars = matches.map(a => a.replace(/\\{|\\}/g, ''))\n    let idx = 0\n    matches.forEach(m => {\n      req.path = req.path.replace(m, req.params[vars[idx]])\n      idx += 1\n    })\n  }\n  return req\n}\n", "/**\n * HTTP error response generator and template\n */\nmodule.exports = {\n  httpError,\n  proxyConfig: proxyConfig()\n}\n\nfunction proxyConfig () {\n  let title = 'Index not found'\n  let message = `No static asset bucket or <code>get /</code> function found in your project. Possible solutions:<br?\n<ul>\n  <li>Add <code>@static</code> to your project manifest</li>\n  <li>Add <code>get /</code> to the <code>@http</code> pragma of your project manifest</li>\n  <li>Manually specify an S3 bucket (containing an <code>index.html</code> file) with the <code>ARC_STATIC_BUCKET</code> env var</li>\n  <li>If using <code>arc.http.proxy</code>, pass in a valid config object</li>\n</ul>\n<a href=\"https://arc.codes/primitives/static\" target=\"_blank\">Learn more</a>`\n  return httpError({ title, message })\n}\n\nfunction httpError ({ statusCode = 502, title = 'Unknown error', message = '' }) {\n  title = title === 'Error'\n    ? `${statusCode} error`\n    : `${statusCode} error: ${title}`\n  return {\n    statusCode,\n    headers: {\n      'Content-Type': 'text/html; charset=utf8;',\n      'Cache-Control': 'no-cache, no-store, must-revalidate, max-age=0, s-maxage=0'\n    },\n    body: `\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n  <title>${title}</title>\n  <style>\n    * {\n      margin: 0;\n      padding: 0;\n      box-sizing: border-box;\n    }\n    body {\n      font-family: -apple-system, BlinkMacSystemFont, sans-serif;\n    }\n    code {\n      font-size: 1.25rem;\n      color: #00c26e;\n    }\n    .max-width-320 {\n      max-width: 20rem;\n    }\n    .margin-left-8 {\n      margin-left: 0.5rem;\n    }\n    .margin-bottom-16 {\n      margin-bottom: 1rem;\n    }\n    .margin-bottom-8 {\n      margin-bottom: 0.5rem;\n    }\n    .padding-32 {\n      padding: 2rem;\n    }\n    .padding-top-16 {\n      padding-top: 1rem;\n    }\n    a, a:hover {\n      color: #333;\n    }\n    p, li {\n      padding-bottom: 0.5rem;\n    }\n  </style>\n</head>\n<body class=\"padding-32\">\n  <div>\n    <div class=\"margin-left-8\">\n      <div class=\"margin-bottom-16\">\n        <h1 class=\"margin-bottom-16\">\n          ${title}\n        </h1>\n        <p>\n          ${message}\n        </p>\n      </div>\n      <div class=\"padding-top-16\">\n        <p>\n          View Architect documentation at:\n        </p>\n        <a href=\"https://arc.codes\">https://arc.codes</a>\n      </div>\n    </div>\n  </div>\n</body>\n</html>\n`\n  }\n}\n", "/**\n * Common binary MIME types\n */\nmodule.exports = [\n  'application/octet-stream',\n  // Docs\n  'application/epub+zip',\n  'application/msword',\n  'application/pdf',\n  'application/rtf',\n  'application/vnd.amazon.ebook',\n  'application/vnd.ms-excel',\n  'application/vnd.ms-powerpoint',\n  'application/vnd.openxmlformats-officedocument.presentationml.presentation',\n  'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',\n  'application/vnd.openxmlformats-officedocument.wordprocessingml.document',\n  // Fonts\n  'font/otf',\n  'font/woff',\n  'font/woff2',\n  // Images\n  'image/bmp',\n  'image/gif',\n  'image/jpeg',\n  'image/png',\n  'image/tiff',\n  'image/vnd.microsoft.icon',\n  'image/webp',\n  // Audio\n  'audio/3gpp',\n  'audio/aac',\n  'audio/basic',\n  'audio/mpeg',\n  'audio/ogg',\n  'audio/wavaudio/webm',\n  'audio/x-aiff',\n  'audio/x-midi',\n  'audio/x-wav',\n  // Video\n  'video/3gpp',\n  'video/mp2t',\n  'video/mpeg',\n  'video/ogg',\n  'video/quicktime',\n  'video/webm',\n  'video/x-msvideo',\n  // Archives\n  'application/java-archive',\n  'application/vnd.apple.installer+xml',\n  'application/x-7z-compressed',\n  'application/x-apple-diskimage',\n  'application/x-bzip',\n  'application/x-bzip2',\n  'application/x-gzip',\n  'application/x-java-archive',\n  'application/x-rar-compressed',\n  'application/x-tar',\n  'application/x-zip',\n  'application/zip'\n]\n", "let { httpError } = require('./errors')\nlet binaryTypes = require('./helpers/binary-types')\n\nmodule.exports = function responseFormatter (req, params) {\n  // Handle HTTP API v2.0 payload scenarios, which have some very strange edges\n  if (req.version && req.version === '2.0') {\n    // New school AWS\n    let knownParams = [ 'statusCode', 'body', 'headers', 'isBase64Encoded', 'cookies' ]\n    let hasKnownParams = p => knownParams.some(k => k === p)\n    // Old school Arc\n    let tidyParams = [ 'code', 'cookie', 'cors', 'location', 'session', 'status' ]\n    let hasTidyParams = p => tidyParams.some(k => k === p)\n    // Older school Arc\n    let staticallyBound = [ 'html', 'css', 'js', 'text', 'json', 'xml' ]\n    let isStaticallyBound = p => staticallyBound.some(k => k === p)\n\n    let is = t => typeof params === t\n    // Handle scenarios where we have a known parameter returned\n    if (is('object') &&\n        (params !== null) &&\n        !Array.isArray(params) &&\n        Object.keys.length === 1 &&\n        (Object.keys(params).some(hasKnownParams) ||\n         Object.keys(params).some(hasTidyParams) ||\n         Object.keys(params).some(isStaticallyBound))) {\n      params // noop\n    }\n    // Handle scenarios where arbitrary stuff is returned to be JSONified\n    else if (is('number') ||\n             (is('object') && params !== null) ||\n             (is('string') && params) ||\n             Array.isArray(params) ||\n             params instanceof Buffer) {\n      params = { body: JSON.stringify(params) }\n    }\n    // Not returning is actually valid now lolnothingmatters\n    else if (!params) params = {}\n  }\n\n  let isError = params instanceof Error // Doesn't really pertain to async\n  let buffer\n  let bodyIsBuffer = params.body && params.body instanceof Buffer\n  if (bodyIsBuffer) buffer = params.body // Back up buffer\n  if (!isError) params = JSON.parse(JSON.stringify(params)) // Deep copy to aid testing mutation\n  if (bodyIsBuffer) params.body = buffer // Restore non-JSON-encoded buffer\n\n  /**\n   * Response defaults\n   *   where possible, normalize headers to pascal-kebab case (lolsigh)\n   */\n  // Body\n  let body = params.body || ''\n\n  // Headers: Cache-Control\n  let cacheControl = params.cacheControl ||\n                     params.headers && params.headers['Cache-Control'] ||\n                     params.headers && params.headers['cache-control'] || ''\n  if (params.headers && params.headers['cache-control']) {\n    delete params.headers['cache-control'] // Clean up improper casing\n  }\n\n  // Headers: Content-Type\n  let type = params.type ||\n             params.headers && params.headers['Content-Type'] ||\n             params.headers && params.headers['content-type'] ||\n             'application/json; charset=utf8'\n  if (params.headers && params.headers['content-type']) {\n    delete params.headers['content-type'] // Clean up improper casing\n  }\n\n  // Cross-origin ritual sacrifice\n  let cors = params.cors\n\n  if (params.html) {\n    type = 'text/html; charset=utf8'\n    body = params.html\n  }\n  else if (params.css) {\n    type = 'text/css; charset=utf8'\n    body = params.css\n  }\n  else if (params.js) {\n    type = 'text/javascript; charset=utf8'\n    body = params.js\n  }\n  else if (params.text) {\n    type = 'text/plain; charset=utf8'\n    body = params.text\n  }\n  else if (params.json) {\n    type = 'application/json; charset=utf8'\n    body = JSON.stringify(params.json)\n  }\n  else if (params.xml) {\n    type = 'application/xml; charset=utf8'\n    body = params.xml\n  }\n\n  // Status\n  let providedStatus = params.status || params.code || params.statusCode\n  let statusCode = providedStatus || 200\n\n  let res = {\n    headers: Object.assign({}, { 'Content-Type': type }, params.headers || {}),\n    statusCode,\n    body\n  }\n\n  // REST API stuff\n  if (params.multiValueHeaders) {\n    res.multiValueHeaders = params.multiValueHeaders\n  }\n  // HTTP API stuff\n  if (params.cookies) {\n    res.cookies = params.cookies\n  }\n\n  // Error override\n  if (isError) {\n    let statusCode = providedStatus || 500\n    let title = params.name\n    let message = `\n      ${params.message}<br>\n      <pre>${params.stack}<pre>\n    `\n    res = httpError({ statusCode, title, message })\n  }\n\n  /**\n   * Only send res.type for non-proxy responses in Arc 5; attributes of each env:\n   * Arc 6:\n   * - ARC_CLOUDFORMATION\n   * - ARC_HTTP === 'aws_proxy'\n   * Arc 5:\n   * - !ARC_CLOUDFORMATION\n   * - !ARC_HTTP || ARC_HTTP === 'aws'\n   */\n  let notArcSix = !process.env.ARC_CLOUDFORMATION\n  let notArcProxy = !process.env.ARC_HTTP || process.env.ARC_HTTP === 'aws'\n  let isArcFive = notArcSix && notArcProxy\n  let notProxyReq = !req.resource || req.resource && req.resource !== '/{proxy+}'\n  if (isArcFive && notProxyReq) {\n    // This is a deprecated code path that may be removed when Arc 5 exits LTS status\n    // Fixes backwards compatibility: Arc vtl needs this param\n    res.type = type\n  }\n\n  // Set and/or update headers\n  let headers = res.headers\n  if (cacheControl) headers['Cache-Control'] = cacheControl\n  let antiCache = type.includes('text/html') ||\n                  type.includes('application/json') ||\n                  type.includes('application/vnd.api+json')\n  if (headers && !headers['Cache-Control'] && antiCache) {\n    headers['Cache-Control'] = 'no-cache, no-store, must-revalidate, max-age=0, s-maxage=0'\n  }\n  else if (headers && !headers['Cache-Control']) {\n    headers['Cache-Control'] = 'max-age=86400' // Default cache to one day unless otherwise specified\n  }\n  if (cors) headers['Access-Control-Allow-Origin'] = '*'\n  if (params.isBase64Encoded) res.isBase64Encoded = true\n  if (params.location) {\n    res.statusCode = providedStatus || 302\n    res.headers.Location = params.location\n  }\n\n  // Handle body encoding (if necessary)\n  let isBinary = binaryTypes.some(t => res.headers['Content-Type'].includes(t))\n  let bodyIsString = typeof res.body === 'string'\n  let b64enc = i => new Buffer.from(i).toString('base64')\n  // Encode (and flag) outbound buffers\n  if (bodyIsBuffer) {\n    res.body = b64enc(res.body)\n    res.isBase64Encoded = true\n  }\n  // Body is likely base64 & has binary MIME type, so flag it\n  if (bodyIsString && isBinary) res.isBase64Encoded = true\n\n  return res\n}\n", "let read = require('./session/read')\nlet write = require('./session/write')\nlet bodyParser = require('./helpers/body-parser')\nlet interpolate = require('./helpers/params')\nlet responseFormatter = require('./_res-fmt')\n\n/**\n * `arc.http` accepts one or more functions with an express-style sig\n */\nmodule.exports = function http (...fns) {\n\n  // Ensure we've been passed only functions\n  fns.forEach(f => {\n    if (typeof f != 'function')\n      throw TypeError(f + ' not a function')\n  })\n\n  // Return an AWS Lambda continuation passing function signature\n  return function lambda (request, context, callback) {\n\n    // Verify the request is configured by arc\n    if (!request.headers)\n      request.headers = {}\n\n    // Cache the functions\n    let cache = fns.slice()\n\n    // read the session\n    read(request, function _read (err, session) {\n      // Fail loudly if the session isn't set up correctly\n      if (err) throw err\n\n      // construct a response function\n      let req = interpolate(Object.assign({}, request, { session }))\n      req.body = bodyParser(req)\n      let res = response.bind({}, req, callback)\n\n      // loop thru middleware\n      ;(function iterator (fun) {\n        function fail () {throw Error('next() called from last function')}\n        let next = iterator.bind({}, cache.shift() || fail)\n        fun.call({}, req, res, next)\n      })(cache.shift())\n    })\n  }\n}\n\n/**\n * req is bound so we have a ref to req.session\n * callback is raw lambda callback\n */\nfunction response (req, callback, params) {\n  // Format the response\n  let res = responseFormatter(req, params)\n\n  // Legacy 'cookie' parameter, used after direct session writes\n  if (params && params.cookie) {\n    res.headers['Set-Cookie'] = params.cookie\n  }\n\n  // Save the passed session\n  if (params && params.session) {\n    // Tag the session data with _idx, secret, ttl, from req.session\n    let { _idx, _secret, _ttl } = req.session\n    let session = { _idx, _secret, _ttl, ...params.session }\n    write(session, function _write (err, cookie) {\n      if (err) callback(err)\n      else {\n        res.headers['Set-Cookie'] = cookie\n        callback(null, res)\n      }\n    })\n  }\n  else {\n    // Just pass it through\n    callback(null, res)\n  }\n}\n", "const { readFileSync, existsSync } = require('fs')\nconst { join } = require('path')\n\n/**\n * Architect static asset helper\n * - Returns the live asset path and filename\n *\n * In order to keep this method sync, it does not use reflection to get fingerprint status\n * - Not checking @static fingerprint true (which we used to read from the .arc file) is possibly dangerous, so ensure asset path is valid\n * - ? TODO: add fingerprint state to env vars in Arc 6 to restore config safety?\n * @param {string} path - the path to the asset (eg. /index.js)\n * @returns {string} path - the resolved asset path (eg. /_static/index-xxx.js)\n */\nmodule.exports = function _static (asset, options = {}) {\n  let key = asset[0] === '/' ? asset.substring(1) : asset\n  let isIndex = asset === '/'\n  let manifest = join(process.cwd(), 'node_modules', '@architect', 'shared', 'static.json')\n  let exists = existsSync(manifest)\n  let local = process.env.NODE_ENV === 'testing' || process.env.ARC_LOCAL\n  let stagePath = options.stagePath && !local ? '/' + process.env.NODE_ENV : ''\n  let path = `${stagePath}/_static`\n  if (!local && exists && !isIndex) {\n    let read = p => readFileSync(p).toString()\n    let pkg = JSON.parse(read(manifest))\n    let asset = pkg[key]\n    if (!asset)\n      throw ReferenceError(`Could not find asset in static.json (asset fingerprint manifest): ${key}`)\n    return `${path}/${asset}`\n  }\n  return `${path}/${isIndex ? '' : key}`\n}\n", "/**\n * no magic url helper\n *\n * given a path / returns\n *\n * - / if NODE_ENV === testing\n * - /staging if NODE_ENV === staging\n * - /production if NODE_ENV === production\n */\nmodule.exports = function url (url) {\n  let staging = process.env.NODE_ENV === 'staging'\n  let production = process.env.NODE_ENV === 'production'\n  if (!process.env.ARC_LOCAL && (staging || production))\n    return `/${process.env.NODE_ENV}${url}`\n  return url // fallthru for NODE_ENV=testing\n}\n", "let read = require('../session/read')\nlet write = require('../session/write')\nlet bodyParser = require('../helpers/body-parser')\nlet interpolate = require('../helpers/params')\nlet responseFormatter = require('../_res-fmt')\n\n/**\n * `arc.http.async` accepts one or more async functions\n *\n * Each function is a regular Arc 4+ async/await route function, that may return:\n * - A falsy value .......... move onto the next function\n * - A modified `request` ... move onto the next function, passing the mutated `request` on to any subsequent functions\n * - A `response` ........... end execution and respond to the client\n */\nmodule.exports = function httpAsync (...fns) {\n\n  // Ensure we've been passed only functions\n  fns.forEach(f => {\n    if (typeof f != 'function')\n      throw TypeError(f + ' not a function')\n  })\n\n  // Return an AWS Lambda async function signature\n  async function combined (request, context) {\n    let params\n    let first = true\n    for (let fn of fns) {\n      // Only parse the request obj of the first function\n      if (first) {\n        first = false\n        let session = await read(request)\n        let req = interpolate(Object.assign({}, request, { session }))\n        req.body = bodyParser(req)\n        request = req\n      }\n      // Run the function\n      let result = await fn(request, context)\n      let isRequest = result && result.httpMethod\n      if (isRequest) {\n        // Function returned a modified request, continuing...\n        request = result\n      }\n      else {\n        if (result) {\n          params = result\n          // Got a response, finishing...\n          break\n        }\n        // Did not get a result from, continuing...\n      }\n    }\n    let isHTTPv2 = request.version && request.version === '2.0'\n    // Finished combined function!\n    if (!params && !isHTTPv2) {\n      throw new Error(`Finished all functions without returning a response.`)\n    }\n    return response(request, params)\n  }\n  return combined\n}\n\nasync function response (req, params) {\n  // Format the response\n  let res = responseFormatter(req, params)\n\n  // Legacy 'cookie' parameter, used after direct session writes\n  if (params && params.cookie) {\n    res.headers['Set-Cookie'] = params.cookie\n  }\n\n  // Save the passed session\n  if (params && params.session) {\n    // Tag the session data with _idx, secret, ttl, from req.session\n    let { _idx, _secret, _ttl } = req.session\n    let session = { _idx, _secret, _ttl, ...params.session }\n    let cookie = await write(session)\n    res.headers['Set-Cookie'] = cookie\n  }\n  return res\n}\n", "/**\n *  @license\n *    Copyright 2018 Brigham Young University\n *\n *    Licensed under the Apache License, Version 2.0 (the \"License\");\n *    you may not use this file except in compliance with the License.\n *    You may obtain a copy of the License at\n *\n *        http://www.apache.org/licenses/LICENSE-2.0\n *\n *    Unless required by applicable law or agreed to in writing, software\n *    distributed under the License is distributed on an \"AS IS\" BASIS,\n *    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *    See the License for the specific language governing permissions and\n *    limitations under the License.\n **/\n'use strict';\n\n/**\n * Toggle the case of a string based on the number value passed in.\n * @param {string} string\n * @param {number} number\n * @param {object} [options={allowOverflow: true}]\n * @returns {string|boolean}\n */\nmodule.exports = binaryCase;\n\nfunction binaryCase(string, number, options) {\n    if (!options || typeof options !== 'object') options = {};\n    if (!options.hasOwnProperty('allowOverflow')) options.allowOverflow = true;\n\n    if (number > binaryCase.maxNumber(string) && !options.allowOverflow) return false;\n\n    return getBinaryCase(string, number);\n}\n\nbinaryCase.iterator = function(string, options) {\n    const max = binaryCase.maxNumber(string);\n\n    if (!options || typeof options !== 'object') options = {};\n    if (!options.hasOwnProperty('startIndex')) options.startIndex = 0;\n    if (typeof options.startIndex !== 'number' || !Number.isInteger(options.startIndex) || options.startIndex < 0) throw Error('Option startIndex must be a non-negative integer.');\n\n    let index = options.startIndex;\n    return {\n        next: function() {\n            return index > max\n                ? { done: true }\n                : { done: false, value: getBinaryCase(string, index++) };\n        }\n    };\n};\n\n/**\n * Get the maximum number that can be used before causing overflow.\n * @param {string} string\n * @returns {number}\n */\nbinaryCase.maxNumber = function(string) {\n    const pow = string.match(/[a-z]/ig).length;\n    return Math.pow(2, pow) - 1;\n};\n\n/**\n * Get an array of all possible variations.\n * @param {string} string\n * @returns {string[]}\n */\nbinaryCase.variations = function(string) {\n    const results = [];\n    const max = binaryCase.maxNumber(string);\n    for (let i = 0; i <= max; i++) {\n        results.push(binaryCase(string, i));\n    }\n    return results;\n};\n\n/**\n * A performance improved method for acquiring the binary case, provided by Blake Embrey with very minor modification by James Speirs.\n * @author Blake Embrey | https://github.com/blakeembrey\n * @author James Speirs | https://github.com/gi60s\n * @param {string} str\n * @param {number} val\n * @returns {string}\n */\nfunction getBinaryCase (str, val) {\n    let res = '';\n\n    for (let i = 0; i < str.length; i++) {\n        const code = str.charCodeAt(i);\n\n        if (code >= 65 && code <= 90) {\n            res += val & 1 ? String.fromCharCode(code + 32) : String.fromCharCode(code);\n            val >>>= 1;\n        } else if (code >= 97 && code <= 122) {\n            res += val & 1 ? String.fromCharCode(code - 32) : String.fromCharCode(code);\n            val >>>= 1;\n        } else {\n            res += String.fromCharCode(code);\n        }\n\n        if (val === 0) {\n            return res + str.substr(i + 1);\n        }\n    }\n\n    return res;\n}", "/*!\n * media-typer\n * Copyright(c) 2014 Douglas Christopher Wilson\n * MIT Licensed\n */\n\n/**\n * RegExp to match *( \";\" parameter ) in RFC 2616 sec 3.7\n *\n * parameter     = token \"=\" ( token | quoted-string )\n * token         = 1*<any CHAR except CTLs or separators>\n * separators    = \"(\" | \")\" | \"<\" | \">\" | \"@\"\n *               | \",\" | \";\" | \":\" | \"\\\" | <\">\n *               | \"/\" | \"[\" | \"]\" | \"?\" | \"=\"\n *               | \"{\" | \"}\" | SP | HT\n * quoted-string = ( <\"> *(qdtext | quoted-pair ) <\"> )\n * qdtext        = <any TEXT except <\">>\n * quoted-pair   = \"\\\" CHAR\n * CHAR          = <any US-ASCII character (octets 0 - 127)>\n * TEXT          = <any OCTET except CTLs, but including LWS>\n * LWS           = [CRLF] 1*( SP | HT )\n * CRLF          = CR LF\n * CR            = <US-ASCII CR, carriage return (13)>\n * LF            = <US-ASCII LF, linefeed (10)>\n * SP            = <US-ASCII SP, space (32)>\n * SHT           = <US-ASCII HT, horizontal-tab (9)>\n * CTL           = <any US-ASCII control character (octets 0 - 31) and DEL (127)>\n * OCTET         = <any 8-bit sequence of data>\n */\nvar paramRegExp = /; *([!#$%&'\\*\\+\\-\\.0-9A-Z\\^_`a-z\\|~]+) *= *(\"(?:[ !\\u0023-\\u005b\\u005d-\\u007e\\u0080-\\u00ff]|\\\\[\\u0020-\\u007e])*\"|[!#$%&'\\*\\+\\-\\.0-9A-Z\\^_`a-z\\|~]+) */g;\nvar textRegExp = /^[\\u0020-\\u007e\\u0080-\\u00ff]+$/\nvar tokenRegExp = /^[!#$%&'\\*\\+\\-\\.0-9A-Z\\^_`a-z\\|~]+$/\n\n/**\n * RegExp to match quoted-pair in RFC 2616\n *\n * quoted-pair = \"\\\" CHAR\n * CHAR        = <any US-ASCII character (octets 0 - 127)>\n */\nvar qescRegExp = /\\\\([\\u0000-\\u007f])/g;\n\n/**\n * RegExp to match chars that must be quoted-pair in RFC 2616\n */\nvar quoteRegExp = /([\\\\\"])/g;\n\n/**\n * RegExp to match type in RFC 6838\n *\n * type-name = restricted-name\n * subtype-name = restricted-name\n * restricted-name = restricted-name-first *126restricted-name-chars\n * restricted-name-first  = ALPHA / DIGIT\n * restricted-name-chars  = ALPHA / DIGIT / \"!\" / \"#\" /\n *                          \"$\" / \"&\" / \"-\" / \"^\" / \"_\"\n * restricted-name-chars =/ \".\" ; Characters before first dot always\n *                              ; specify a facet name\n * restricted-name-chars =/ \"+\" ; Characters after last plus always\n *                              ; specify a structured syntax suffix\n * ALPHA =  %x41-5A / %x61-7A   ; A-Z / a-z\n * DIGIT =  %x30-39             ; 0-9\n */\nvar subtypeNameRegExp = /^[A-Za-z0-9][A-Za-z0-9!#$&^_.-]{0,126}$/\nvar typeNameRegExp = /^[A-Za-z0-9][A-Za-z0-9!#$&^_-]{0,126}$/\nvar typeRegExp = /^ *([A-Za-z0-9][A-Za-z0-9!#$&^_-]{0,126})\\/([A-Za-z0-9][A-Za-z0-9!#$&^_.+-]{0,126}) *$/;\n\n/**\n * Module exports.\n */\n\nexports.format = format\nexports.parse = parse\n\n/**\n * Format object to media type.\n *\n * @param {object} obj\n * @return {string}\n * @api public\n */\n\nfunction format(obj) {\n  if (!obj || typeof obj !== 'object') {\n    throw new TypeError('argument obj is required')\n  }\n\n  var parameters = obj.parameters\n  var subtype = obj.subtype\n  var suffix = obj.suffix\n  var type = obj.type\n\n  if (!type || !typeNameRegExp.test(type)) {\n    throw new TypeError('invalid type')\n  }\n\n  if (!subtype || !subtypeNameRegExp.test(subtype)) {\n    throw new TypeError('invalid subtype')\n  }\n\n  // format as type/subtype\n  var string = type + '/' + subtype\n\n  // append +suffix\n  if (suffix) {\n    if (!typeNameRegExp.test(suffix)) {\n      throw new TypeError('invalid suffix')\n    }\n\n    string += '+' + suffix\n  }\n\n  // append parameters\n  if (parameters && typeof parameters === 'object') {\n    var param\n    var params = Object.keys(parameters).sort()\n\n    for (var i = 0; i < params.length; i++) {\n      param = params[i]\n\n      if (!tokenRegExp.test(param)) {\n        throw new TypeError('invalid parameter name')\n      }\n\n      string += '; ' + param + '=' + qstring(parameters[param])\n    }\n  }\n\n  return string\n}\n\n/**\n * Parse media type to object.\n *\n * @param {string|object} string\n * @return {Object}\n * @api public\n */\n\nfunction parse(string) {\n  if (!string) {\n    throw new TypeError('argument string is required')\n  }\n\n  // support req/res-like objects as argument\n  if (typeof string === 'object') {\n    string = getcontenttype(string)\n  }\n\n  if (typeof string !== 'string') {\n    throw new TypeError('argument string is required to be a string')\n  }\n\n  var index = string.indexOf(';')\n  var type = index !== -1\n    ? string.substr(0, index)\n    : string\n\n  var key\n  var match\n  var obj = splitType(type)\n  var params = {}\n  var value\n\n  paramRegExp.lastIndex = index\n\n  while (match = paramRegExp.exec(string)) {\n    if (match.index !== index) {\n      throw new TypeError('invalid parameter format')\n    }\n\n    index += match[0].length\n    key = match[1].toLowerCase()\n    value = match[2]\n\n    if (value[0] === '\"') {\n      // remove quotes and escapes\n      value = value\n        .substr(1, value.length - 2)\n        .replace(qescRegExp, '$1')\n    }\n\n    params[key] = value\n  }\n\n  if (index !== -1 && index !== string.length) {\n    throw new TypeError('invalid parameter format')\n  }\n\n  obj.parameters = params\n\n  return obj\n}\n\n/**\n * Get content-type from req/res objects.\n *\n * @param {object}\n * @return {Object}\n * @api private\n */\n\nfunction getcontenttype(obj) {\n  if (typeof obj.getHeader === 'function') {\n    // res-like\n    return obj.getHeader('content-type')\n  }\n\n  if (typeof obj.headers === 'object') {\n    // req-like\n    return obj.headers && obj.headers['content-type']\n  }\n}\n\n/**\n * Quote a string if necessary.\n *\n * @param {string} val\n * @return {string}\n * @api private\n */\n\nfunction qstring(val) {\n  var str = String(val)\n\n  // no need to quote tokens\n  if (tokenRegExp.test(str)) {\n    return str\n  }\n\n  if (str.length > 0 && !textRegExp.test(str)) {\n    throw new TypeError('invalid parameter value')\n  }\n\n  return '\"' + str.replace(quoteRegExp, '\\\\$1') + '\"'\n}\n\n/**\n * Simply \"type/subtype+siffx\" into parts.\n *\n * @param {string} string\n * @return {Object}\n * @api private\n */\n\nfunction splitType(string) {\n  var match = typeRegExp.exec(string.toLowerCase())\n\n  if (!match) {\n    throw new TypeError('invalid media type')\n  }\n\n  var type = match[1]\n  var subtype = match[2]\n  var suffix\n\n  // suffix after last +\n  var index = subtype.lastIndexOf('+')\n  if (index !== -1) {\n    suffix = subtype.substr(index + 1)\n    subtype = subtype.substr(0, index)\n  }\n\n  var obj = {\n    type: type,\n    subtype: subtype,\n    suffix: suffix\n  }\n\n  return obj\n}\n", "/*!\n * mime-db\n * Copyright(c) 2014 Jonathan Ong\n * MIT Licensed\n */\n\n/**\n * Module exports.\n */\n\nmodule.exports = require('./db.json')\n", "/*!\n * mime-types\n * Copyright(c) 2014 Jonathan Ong\n * Copyright(c) 2015 Douglas Christopher Wilson\n * MIT Licensed\n */\n\n'use strict'\n\n/**\n * Module dependencies.\n * @private\n */\n\nvar db = require('mime-db')\nvar extname = require('path').extname\n\n/**\n * Module variables.\n * @private\n */\n\nvar EXTRACT_TYPE_REGEXP = /^\\s*([^;\\s]*)(?:;|\\s|$)/\nvar TEXT_TYPE_REGEXP = /^text\\//i\n\n/**\n * Module exports.\n * @public\n */\n\nexports.charset = charset\nexports.charsets = { lookup: charset }\nexports.contentType = contentType\nexports.extension = extension\nexports.extensions = Object.create(null)\nexports.lookup = lookup\nexports.types = Object.create(null)\n\n// Populate the extensions/types maps\npopulateMaps(exports.extensions, exports.types)\n\n/**\n * Get the default charset for a MIME type.\n *\n * @param {string} type\n * @return {boolean|string}\n */\n\nfunction charset (type) {\n  if (!type || typeof type !== 'string') {\n    return false\n  }\n\n  // TODO: use media-typer\n  var match = EXTRACT_TYPE_REGEXP.exec(type)\n  var mime = match && db[match[1].toLowerCase()]\n\n  if (mime && mime.charset) {\n    return mime.charset\n  }\n\n  // default text/* to utf-8\n  if (match && TEXT_TYPE_REGEXP.test(match[1])) {\n    return 'UTF-8'\n  }\n\n  return false\n}\n\n/**\n * Create a full Content-Type header given a MIME type or extension.\n *\n * @param {string} str\n * @return {boolean|string}\n */\n\nfunction contentType (str) {\n  // TODO: should this even be in this module?\n  if (!str || typeof str !== 'string') {\n    return false\n  }\n\n  var mime = str.indexOf('/') === -1\n    ? exports.lookup(str)\n    : str\n\n  if (!mime) {\n    return false\n  }\n\n  // TODO: use content-type or other module\n  if (mime.indexOf('charset') === -1) {\n    var charset = exports.charset(mime)\n    if (charset) mime += '; charset=' + charset.toLowerCase()\n  }\n\n  return mime\n}\n\n/**\n * Get the default extension for a MIME type.\n *\n * @param {string} type\n * @return {boolean|string}\n */\n\nfunction extension (type) {\n  if (!type || typeof type !== 'string') {\n    return false\n  }\n\n  // TODO: use media-typer\n  var match = EXTRACT_TYPE_REGEXP.exec(type)\n\n  // get extensions\n  var exts = match && exports.extensions[match[1].toLowerCase()]\n\n  if (!exts || !exts.length) {\n    return false\n  }\n\n  return exts[0]\n}\n\n/**\n * Lookup the MIME type for a file path/extension.\n *\n * @param {string} path\n * @return {boolean|string}\n */\n\nfunction lookup (path) {\n  if (!path || typeof path !== 'string') {\n    return false\n  }\n\n  // get the extension (\"ext\" or \".ext\" or full path)\n  var extension = extname('x.' + path)\n    .toLowerCase()\n    .substr(1)\n\n  if (!extension) {\n    return false\n  }\n\n  return exports.types[extension] || false\n}\n\n/**\n * Populate the extensions and types maps.\n * @private\n */\n\nfunction populateMaps (extensions, types) {\n  // source preference (least -> most)\n  var preference = ['nginx', 'apache', undefined, 'iana']\n\n  Object.keys(db).forEach(function forEachMimeType (type) {\n    var mime = db[type]\n    var exts = mime.extensions\n\n    if (!exts || !exts.length) {\n      return\n    }\n\n    // mime -> extensions\n    extensions[type] = exts\n\n    // extension -> mime\n    for (var i = 0; i < exts.length; i++) {\n      var extension = exts[i]\n\n      if (types[extension]) {\n        var from = preference.indexOf(db[types[extension]].source)\n        var to = preference.indexOf(mime.source)\n\n        if (types[extension] !== 'application/octet-stream' &&\n          (from > to || (from === to && types[extension].substr(0, 12) === 'application/'))) {\n          // skip the remapping\n          continue\n        }\n      }\n\n      // set the extension -> mime\n      types[extension] = type\n    }\n  })\n}\n", "/*!\n * type-is\n * Copyright(c) 2014 Jonathan Ong\n * Copyright(c) 2014-2015 Douglas Christopher Wilson\n * MIT Licensed\n */\n\n'use strict'\n\n/**\n * Module dependencies.\n * @private\n */\n\nvar typer = require('media-typer')\nvar mime = require('mime-types')\n\n/**\n * Module exports.\n * @public\n */\n\nmodule.exports = typeofrequest\nmodule.exports.is = typeis\nmodule.exports.hasBody = hasbody\nmodule.exports.normalize = normalize\nmodule.exports.match = mimeMatch\n\n/**\n * Compare a `value` content-type with `types`.\n * Each `type` can be an extension like `html`,\n * a special shortcut like `multipart` or `urlencoded`,\n * or a mime type.\n *\n * If no types match, `false` is returned.\n * Otherwise, the first `type` that matches is returned.\n *\n * @param {String} value\n * @param {Array} types\n * @public\n */\n\nfunction typeis (value, types_) {\n  var i\n  var types = types_\n\n  // remove parameters and normalize\n  var val = tryNormalizeType(value)\n\n  // no type or invalid\n  if (!val) {\n    return false\n  }\n\n  // support flattened arguments\n  if (types && !Array.isArray(types)) {\n    types = new Array(arguments.length - 1)\n    for (i = 0; i < types.length; i++) {\n      types[i] = arguments[i + 1]\n    }\n  }\n\n  // no types, return the content type\n  if (!types || !types.length) {\n    return val\n  }\n\n  var type\n  for (i = 0; i < types.length; i++) {\n    if (mimeMatch(normalize(type = types[i]), val)) {\n      return type[0] === '+' || type.indexOf('*') !== -1\n        ? val\n        : type\n    }\n  }\n\n  // no matches\n  return false\n}\n\n/**\n * Check if a request has a request body.\n * A request with a body __must__ either have `transfer-encoding`\n * or `content-length` headers set.\n * http://www.w3.org/Protocols/rfc2616/rfc2616-sec4.html#sec4.3\n *\n * @param {Object} request\n * @return {Boolean}\n * @public\n */\n\nfunction hasbody (req) {\n  return req.headers['transfer-encoding'] !== undefined ||\n    !isNaN(req.headers['content-length'])\n}\n\n/**\n * Check if the incoming request contains the \"Content-Type\"\n * header field, and it contains any of the give mime `type`s.\n * If there is no request body, `null` is returned.\n * If there is no content type, `false` is returned.\n * Otherwise, it returns the first `type` that matches.\n *\n * Examples:\n *\n *     // With Content-Type: text/html; charset=utf-8\n *     this.is('html'); // => 'html'\n *     this.is('text/html'); // => 'text/html'\n *     this.is('text/*', 'application/json'); // => 'text/html'\n *\n *     // When Content-Type is application/json\n *     this.is('json', 'urlencoded'); // => 'json'\n *     this.is('application/json'); // => 'application/json'\n *     this.is('html', 'application/*'); // => 'application/json'\n *\n *     this.is('html'); // => false\n *\n * @param {String|Array} types...\n * @return {String|false|null}\n * @public\n */\n\nfunction typeofrequest (req, types_) {\n  var types = types_\n\n  // no body\n  if (!hasbody(req)) {\n    return null\n  }\n\n  // support flattened arguments\n  if (arguments.length > 2) {\n    types = new Array(arguments.length - 1)\n    for (var i = 0; i < types.length; i++) {\n      types[i] = arguments[i + 1]\n    }\n  }\n\n  // request content type\n  var value = req.headers['content-type']\n\n  return typeis(value, types)\n}\n\n/**\n * Normalize a mime type.\n * If it's a shorthand, expand it to a valid mime type.\n *\n * In general, you probably want:\n *\n *   var type = is(req, ['urlencoded', 'json', 'multipart']);\n *\n * Then use the appropriate body parsers.\n * These three are the most common request body types\n * and are thus ensured to work.\n *\n * @param {String} type\n * @private\n */\n\nfunction normalize (type) {\n  if (typeof type !== 'string') {\n    // invalid type\n    return false\n  }\n\n  switch (type) {\n    case 'urlencoded':\n      return 'application/x-www-form-urlencoded'\n    case 'multipart':\n      return 'multipart/*'\n  }\n\n  if (type[0] === '+') {\n    // \"+json\" -> \"*/*+json\" expando\n    return '*/*' + type\n  }\n\n  return type.indexOf('/') === -1\n    ? mime.lookup(type)\n    : type\n}\n\n/**\n * Check if `expected` mime type\n * matches `actual` mime type with\n * wildcard and +suffix support.\n *\n * @param {String} expected\n * @param {String} actual\n * @return {Boolean}\n * @private\n */\n\nfunction mimeMatch (expected, actual) {\n  // invalid type\n  if (expected === false) {\n    return false\n  }\n\n  // split types\n  var actualParts = actual.split('/')\n  var expectedParts = expected.split('/')\n\n  // invalid format\n  if (actualParts.length !== 2 || expectedParts.length !== 2) {\n    return false\n  }\n\n  // validate type\n  if (expectedParts[0] !== '*' && expectedParts[0] !== actualParts[0]) {\n    return false\n  }\n\n  // validate suffix wildcard\n  if (expectedParts[1].substr(0, 2) === '*+') {\n    return expectedParts[1].length <= actualParts[1].length + 1 &&\n      expectedParts[1].substr(1) === actualParts[1].substr(1 - expectedParts[1].length)\n  }\n\n  // validate subtype\n  if (expectedParts[1] !== '*' && expectedParts[1] !== actualParts[1]) {\n    return false\n  }\n\n  return true\n}\n\n/**\n * Normalize a type and remove parameters.\n *\n * @param {string} value\n * @return {string}\n * @private\n */\n\nfunction normalizeType (value) {\n  // parse the type\n  var type = typer.parse(value)\n\n  // remove the parameters\n  type.parameters = undefined\n\n  // reformat it\n  return typer.format(type)\n}\n\n/**\n * Try to normalize a type and remove parameters.\n *\n * @param {string} value\n * @return {string}\n * @private\n */\n\nfunction tryNormalizeType (value) {\n  if (!value) {\n    return null\n  }\n\n  try {\n    return normalizeType(value)\n  } catch (err) {\n    return null\n  }\n}\n", "'use strict'\nconst http = require('http')\nconst url = require('url')\nconst binarycase = require('binary-case')\nconst isType = require('type-is')\n\nfunction getPathWithQueryStringParams (event) {\n  return url.format({ pathname: event.path, query: event.queryStringParameters })\n}\nfunction getEventBody (event) {\n  return Buffer.from(event.body, event.isBase64Encoded ? 'base64' : 'utf8')\n}\n\nfunction clone (json) {\n  return JSON.parse(JSON.stringify(json))\n}\n\nfunction getContentType (params) {\n  // only compare mime type; ignore encoding part\n  return params.contentTypeHeader ? params.contentTypeHeader.split(';')[0] : ''\n}\n\nfunction isContentTypeBinaryMimeType (params) {\n  return params.binaryMimeTypes.length > 0 && !!isType.is(params.contentType, params.binaryMimeTypes)\n}\n\nfunction mapApiGatewayEventToHttpRequest (event, context, socketPath) {\n  const headers = Object.assign({}, event.headers)\n\n  // NOTE: API Gateway is not setting Content-Length header on requests even when they have a body\n  if (event.body && !headers['Content-Length']) {\n    const body = getEventBody(event)\n    headers['Content-Length'] = Buffer.byteLength(body)\n  }\n\n  const clonedEventWithoutBody = clone(event)\n  delete clonedEventWithoutBody.body\n\n  headers['x-apigateway-event'] = encodeURIComponent(JSON.stringify(clonedEventWithoutBody))\n  headers['x-apigateway-context'] = encodeURIComponent(JSON.stringify(context))\n\n  return {\n    method: event.httpMethod,\n    path: getPathWithQueryStringParams(event),\n    headers,\n    socketPath\n    // protocol: `${headers['X-Forwarded-Proto']}:`,\n    // host: headers.Host,\n    // hostname: headers.Host, // Alias for host\n    // port: headers['X-Forwarded-Port']\n  }\n}\n\nfunction forwardResponseToApiGateway (server, response, resolver) {\n  const buf = []\n\n  response\n    .on('data', (chunk) => buf.push(chunk))\n    .on('end', () => {\n      const bodyBuffer = Buffer.concat(buf)\n      const statusCode = response.statusCode\n      const headers = response.headers\n\n      // chunked transfer not currently supported by API Gateway\n      /* istanbul ignore else */\n      if (headers['transfer-encoding'] === 'chunked') {\n        delete headers['transfer-encoding']\n      }\n\n      // HACK: modifies header casing to get around API Gateway's limitation of not allowing multiple\n      // headers with the same name, as discussed on the AWS Forum https://forums.aws.amazon.com/message.jspa?messageID=725953#725953\n      Object.keys(headers)\n        .forEach(h => {\n          if (Array.isArray(headers[h])) {\n            if (h.toLowerCase() === 'set-cookie') {\n              headers[h].forEach((value, i) => {\n                headers[binarycase(h, i + 1)] = value\n              })\n              delete headers[h]\n            } else {\n              headers[h] = headers[h].join(',')\n            }\n          }\n        })\n\n      const contentType = getContentType({ contentTypeHeader: headers['content-type'] })\n      const isBase64Encoded = isContentTypeBinaryMimeType({ contentType, binaryMimeTypes: server._binaryTypes })\n      const body = bodyBuffer.toString(isBase64Encoded ? 'base64' : 'utf8')\n      const successResponse = { statusCode, body, headers, isBase64Encoded }\n\n      resolver.succeed({ response: successResponse })\n    })\n}\n\nfunction forwardConnectionErrorResponseToApiGateway (error, resolver) {\n  console.log('ERROR: @vendia/serverless-express connection error')\n  console.error(error)\n  const errorResponse = {\n    statusCode: 502, // \"DNS resolution, TCP level errors, or actual HTTP parse errors\" - https://nodejs.org/api/http.html#http_http_request_options_callback\n    body: '',\n    headers: {}\n  }\n\n  resolver.succeed({ response: errorResponse })\n}\n\nfunction forwardLibraryErrorResponseToApiGateway (error, resolver) {\n  console.log('ERROR: @vendia/serverless-express error')\n  console.error(error)\n  const errorResponse = {\n    statusCode: 500,\n    body: '',\n    headers: {}\n  }\n\n  resolver.succeed({ response: errorResponse })\n}\n\nfunction forwardRequestToNodeServer (server, event, context, resolver) {\n  try {\n    const requestOptions = mapApiGatewayEventToHttpRequest(event, context, getSocketPath(server._socketPathSuffix))\n    const req = http.request(requestOptions, (response) => forwardResponseToApiGateway(server, response, resolver))\n    if (event.body) {\n      const body = getEventBody(event)\n\n      req.write(body)\n    }\n\n    req.on('error', (error) => forwardConnectionErrorResponseToApiGateway(error, resolver))\n      .end()\n  } catch (error) {\n    forwardLibraryErrorResponseToApiGateway(error, resolver)\n    return server\n  }\n}\n\nfunction startServer (server) {\n  return server.listen(getSocketPath(server._socketPathSuffix))\n}\n\nfunction getSocketPath (socketPathSuffix) {\n  /* istanbul ignore if */ /* only running tests on Linux; Window support is for local dev only */\n  if (/^win/.test(process.platform)) {\n    const path = require('path')\n    return path.join('\\\\\\\\?\\\\pipe', process.cwd(), `server-${socketPathSuffix}`)\n  } else {\n    return `/tmp/server-${socketPathSuffix}.sock`\n  }\n}\n\nfunction getRandomString () {\n  return Math.random().toString(36).substring(2, 15)\n}\n\nfunction createServer (requestListener, serverListenCallback, binaryTypes) {\n  const server = http.createServer(requestListener)\n\n  server._socketPathSuffix = getRandomString()\n  server._binaryTypes = binaryTypes ? binaryTypes.slice() : []\n  server.on('listening', () => {\n    server._isListening = true\n\n    if (serverListenCallback) serverListenCallback()\n  })\n  server.on('close', () => {\n    server._isListening = false\n  })\n    .on('error', (error) => {\n      /* istanbul ignore else */\n      if (error.code === 'EADDRINUSE') {\n        console.warn(`WARNING: Attempting to listen on socket ${getSocketPath(server._socketPathSuffix)}, but it is already in use. This is likely as a result of a previous invocation error or timeout. Check the logs for the invocation(s) immediately prior to this for root cause, and consider increasing the timeout and/or cpu/memory allocation if this is purely as a result of a timeout. @vendia/serverless-express will restart the Node.js server listening on a new port and continue with this request.`)\n        server._socketPathSuffix = getRandomString()\n        return server.close(() => startServer(server))\n      } else {\n        console.log('ERROR: server error')\n        console.error(error)\n      }\n    })\n\n  return server\n}\n\nfunction proxy (server, event, context, resolutionMode, callback) {\n  // DEPRECATED: Legacy support\n  if (!resolutionMode) {\n    const resolver = makeResolver({ context, resolutionMode: 'CONTEXT_SUCCEED' })\n    if (server._isListening) {\n      forwardRequestToNodeServer(server, event, context, resolver)\n      return server\n    } else {\n      return startServer(server)\n        .on('listening', () => proxy(server, event, context))\n    }\n  }\n\n  return {\n    promise: new Promise((resolve, reject) => {\n      const promise = {\n        resolve,\n        reject\n      }\n      const resolver = makeResolver({\n        context,\n        callback,\n        promise,\n        resolutionMode\n      })\n\n      if (server._isListening) {\n        forwardRequestToNodeServer(server, event, context, resolver)\n      } else {\n        startServer(server)\n          .on('listening', () => forwardRequestToNodeServer(server, event, context, resolver))\n      }\n    })\n  }\n}\n\nfunction makeResolver (params/* {\n  context,\n  callback,\n  promise,\n  resolutionMode\n} */) {\n  return {\n    succeed: (params2/* {\n      response\n    } */) => {\n      if (params.resolutionMode === 'CONTEXT_SUCCEED') return params.context.succeed(params2.response)\n      if (params.resolutionMode === 'CALLBACK') return params.callback(null, params2.response)\n      if (params.resolutionMode === 'PROMISE') return params.promise.resolve(params2.response)\n    }\n  }\n}\n\nexports.createServer = createServer\nexports.proxy = proxy\n\n/* istanbul ignore else */\nif (process.env.NODE_ENV === 'test') {\n  exports.getPathWithQueryStringParams = getPathWithQueryStringParams\n  exports.mapApiGatewayEventToHttpRequest = mapApiGatewayEventToHttpRequest\n  exports.forwardResponseToApiGateway = forwardResponseToApiGateway\n  exports.forwardConnectionErrorResponseToApiGateway = forwardConnectionErrorResponseToApiGateway\n  exports.forwardLibraryErrorResponseToApiGateway = forwardLibraryErrorResponseToApiGateway\n  exports.forwardRequestToNodeServer = forwardRequestToNodeServer\n  exports.startServer = startServer\n  exports.getSocketPath = getSocketPath\n  exports.makeResolver = makeResolver\n}\n", "'use strict'\n\nmodule.exports = require('./src/index')\n", "const serverlessExpress = require('@vendia/serverless-express')\n\nexports.createServer = serverlessExpress.createServer\nexports.proxy = serverlessExpress.proxy\n\n/* istanbul ignore else */\nif (process.env.NODE_ENV === 'test') {\n  exports.getPathWithQueryStringParams = serverlessExpress.getPathWithQueryStringParams\n  exports.mapApiGatewayEventToHttpRequest = serverlessExpress.mapApiGatewayEventToHttpRequest\n  exports.forwardResponseToApiGateway = serverlessExpress.forwardResponseToApiGateway\n  exports.forwardConnectionErrorResponseToApiGateway = serverlessExpress.forwardConnectionErrorResponseToApiGateway\n  exports.forwardLibraryErrorResponseToApiGateway = serverlessExpress.forwardLibraryErrorResponseToApiGateway\n  exports.forwardRequestToNodeServer = serverlessExpress.forwardRequestToNodeServer\n  exports.startServer = serverlessExpress.startServer\n  exports.getSocketPath = serverlessExpress.getSocketPath\n  exports.makeResolver = serverlessExpress.makeResolver\n}\n", "'use strict'\n\nmodule.exports = require('./src/index')\n", "const aws = require('aws-serverless-express')\n\nmodule.exports = function unexpress (app) {\n  let server = aws.createServer(app)\n  return function http (event, context, callback) {\n    if (process.env.NODE_ENV === 'testing' || process.env.ARC_LOCAL) {\n      return aws.proxy(server, event, context, 'CALLBACK', callback)\n    }\n    else {\n      return aws.proxy(server, event, context)\n    }\n  }\n}\n", "/**\n * transform reduces {headers, body} with given plugins\n *\n * @param args - arguments obj\n * @param args.Key - the origin S3 bucket Key requested\n * @param args.config - the entire arc.proxy.public config obj\n * @param args.defaults - the default {headers, body} in the transform pipeline\n */\nmodule.exports = function transform ({ Key, config, isBinary, defaults }) {\n  let filetype = Key.split('.').pop()\n  let plugins = config.plugins ? config.plugins[filetype] || [] : []\n  // early return if there's no processing to do\n  if (plugins.length === 0 || isBinary)\n    return defaults\n  else {\n    defaults.body = defaults.body.toString() // Convert non-binary files to strings for mutation\n    // otherwise walk the supplied plugins\n    return plugins.reduce(function run (response, plugin) {\n      /* eslint global-require: 'off' */\n      let transformer = typeof plugin === 'function' ? plugin : require(plugin)\n      return transformer(Key, response, config)\n    }, defaults)\n  }\n}\n", "module.exports = function templatizeResponse (params) {\n  let { isBinary, assets, response, isLocal = false } = params\n\n  // Bail early\n  if (isBinary) {\n    return response\n  }\n  else {\n    // Find: ${STATIC('path/filename.ext')}\n    //   or: ${arc.static('path/filename.ext')}\n    let staticRegex = /\\${(STATIC|arc\\.static)\\(.*\\)}/g\n    // Maybe stringify jic previous steps passed a buffer; perhaps we can remove this step if/when proxy plugins is retired\n    let body = response.body instanceof Buffer ? response.body.toString() : response.body\n    response.body = body.replace(staticRegex, function fingerprint (match) {\n      let start = match.startsWith(`\\${STATIC(`) ? 10 : 14\n      let Key = match.slice(start, match.length - 3)\n      // Normalize around no leading slash for static manifest lookups\n      let startsWithSlash = Key.startsWith('/')\n      let lookup = startsWithSlash ? Key.substr(1) : Key\n      if (assets && assets[lookup] && !isLocal) {\n        Key = assets[lookup]\n        Key = startsWithSlash ? `/${Key}` : Key\n      }\n      return Key\n    })\n    response.body = Buffer.from(response.body) // Re-enbufferize\n    return response\n  }\n}\n", "let {\n  gzipSync,\n  gunzipSync,\n  brotliCompressSync,\n  brotliDecompressSync,\n  deflateSync,\n  inflateSync,\n} = require('zlib')\n\nfunction compressor (direction, type, data) {\n  let compress = direction === 'compress'\n  let exec = {\n    gzip: compress ? gzipSync : gunzipSync,\n    br: compress ? brotliCompressSync : brotliDecompressSync,\n    deflate: compress ? deflateSync : inflateSync\n  }\n  if (!exec[type]) throw ReferenceError('Invalid compression type specified, must be gzip, br, or deflate')\n\n  return exec[type](data)\n}\n\nmodule.exports = {\n  compress: compressor.bind({}, 'compress'),\n  decompress: compressor.bind({}, 'decompress')\n}\n", "let mime = require('mime-types')\nlet path = require('path')\nlet { compress } = require('./compress')\n\n/**\n * Normalizes response shape\n */\nmodule.exports = function normalizeResponse (params) {\n  let { response, result, Key, isProxy, contentEncoding, config } = params\n\n  let noCache = [\n    'text/html',\n    'application/json',\n    'application/vnd.api+json'\n  ]\n  response.headers = response.headers || {}\n\n  // Establish Content-Type\n  let contentType =\n    response.headers['Content-Type'] || // Possibly get content-type passed via proxy plugins\n    response.headers['content-type'] || // ...\n    result && result.ContentType ||     // Fall back to what came down from S3's metadata\n    mime.contentType(path.extname(Key)) // Finally, fall back to the mime type database\n\n  // Set Content-Type\n  response.headers['Content-Type'] = contentType\n\n  // Set caching headers\n  let neverCache = noCache.some(n => contentType.includes(n))\n  if (config.cacheControl) {\n    response.headers['Cache-Control'] = config.cacheControl\n  }\n  else if (neverCache) {\n    response.headers['Cache-Control'] = 'no-cache, no-store, must-revalidate, max-age=0, s-maxage=0'\n  }\n  else if (result && result.CacheControl) {\n    response.headers['Cache-Control'] = result.CacheControl\n  }\n  else {\n    response.headers['Cache-Control'] = 'public, max-age=0, must-revalidate'\n  }\n\n  // Populate optional userland headers\n  if (config.headers) {\n    Object.keys(config.headers).forEach(h => response.headers[h] = config.headers[h])\n  }\n\n  // Normalize important common header casings to prevent dupes\n  if (response.headers['content-type']) {\n    response.headers['Content-Type'] = response.headers['content-type']\n    delete response.headers['content-type']\n  }\n  // Probably unable to be set via this code path, but normalize jic\n  if (response.headers['cache-control']) {\n    response.headers['Cache-Control'] = response.headers['cache-control']\n    delete response.headers['cache-control']\n  }\n\n  let notArcSix = !process.env.ARC_CLOUDFORMATION\n  let notArcProxy = !process.env.ARC_HTTP || process.env.ARC_HTTP === 'aws'\n  let isArcFive = notArcSix && notArcProxy\n  let isHTML = response.headers['Content-Type'].includes('text/html')\n  if (isArcFive && isHTML && !isProxy) {\n    // This is a deprecated code path that may be removed when Arc 5 exits LTS status\n    // Only return string bodies for certain types, and ONLY in Arc 5\n    response.body = Buffer.from(response.body).toString()\n    response.type = response.headers['Content-Type'] // Re-set type or it will fall back to JSON\n  }\n  else {\n    if (contentEncoding) {\n      response.body = compress(contentEncoding, response.body)\n      response.headers['Content-Encoding'] = contentEncoding\n    }\n    // Base64 everything else on the way out to enable text + binary support\n    response.body = Buffer.from(response.body).toString('base64')\n    response.isBase64Encoded = true\n  }\n\n  // Add ETag\n  response.headers.ETag = result.ETag\n\n  return response\n}\n", "let aws = require('aws-sdk')\nlet { existsSync, readFileSync } = require('fs')\nlet { join } = require('path')\nlet { httpError } = require('../../errors')\n\n/**\n * Peek into a dir without a trailing slash to see if it's got an index.html file\n *   If not, look for a custom 404.html\n *   Finally, return the default 404\n */\nmodule.exports = async function pretty (params) {\n  let { Bucket, Key, assets, headers, isFolder, prefix } = params\n  let { ARC_LOCAL, ARC_SANDBOX_PATH_TO_STATIC, NODE_ENV } = process.env\n  let local = NODE_ENV === 'testing' || ARC_LOCAL\n  let s3 = new aws.S3\n\n  function getKey (Key) {\n    let lookup = Key.replace(prefix + '/', '')\n    if (assets && assets[lookup]) {\n      Key = assets[lookup]\n      Key = prefix ? `${prefix}/${Key}` : Key\n    }\n    return Key\n  }\n\n  // eslint-disable-next-line\n  async function getLocal (file) {\n    let basepath = ARC_SANDBOX_PATH_TO_STATIC\n    if (!file.startsWith(basepath)) {\n      file = join(basepath, file)\n    }\n    if (!existsSync(file)) {\n      let err = ReferenceError(`NoSuchKey: ${Key} not found`)\n      err.name = 'NoSuchKey'\n      throw err\n    }\n    else return {\n      Body: readFileSync(file)\n    }\n  }\n\n  async function getS3 (Key) {\n    return await s3.getObject({ Bucket, Key }).promise()\n  }\n\n  async function get (file) {\n    let getter = local ? getLocal : getS3\n    try {\n      return await getter(file)\n    }\n    catch (err) {\n      if (err.name === 'NoSuchKey') {\n        err.statusCode = 404\n        return err\n      }\n      else {\n        err.statusCode = 500\n        return err\n      }\n    }\n  }\n\n  /**\n   * Enable pretty urls\n   *   Peek into a dir without trailing slash to see if it contains index.html\n   */\n  if (isFolder && !Key.endsWith('/')) {\n    let peek = getKey(`${Key}/index.html`)\n    let result = await get(peek)\n    if (result.Body) {\n      let body = result.Body.toString()\n      return { headers, statusCode: 200, body }\n    }\n  }\n\n  /**\n   * Enable custom 404s\n   *   Check to see if user defined a custom 404 page\n   */\n  let notFound = getKey(`404.html`)\n  let result = await get(notFound)\n  if (result.Body) {\n    let body = result.Body.toString()\n    return {\n      headers: {\n        'Content-Type': 'text/html; charset=utf8;',\n        'Cache-Control': 'no-cache, no-store, must-revalidate, max-age=0, s-maxage=0'\n      },\n      statusCode: 404,\n      body\n    }\n  }\n  else {\n    let err = result\n    let { statusCode } = err\n    let title = err.name\n    let message = `\n      ${err.message} <pre><b>${Key}</b></pre><br>\n      <pre>${err.stack}</pre>\n    `\n    return httpError({ statusCode, title, message })\n  }\n}\n", "let { existsSync, readFileSync } = require('fs')\nlet { extname, join, sep } = require('path')\nlet mime = require('mime-types')\nlet crypto = require('crypto')\n\nlet binaryTypes = require('../../helpers/binary-types')\nlet { httpError } = require('../../errors')\nlet transform = require('../format/transform') // Soon to be deprecated\nlet templatizeResponse = require('../format/templatize')\nlet normalizeResponse = require('../format/response')\nlet pretty = require('./_pretty')\n\n/**\n * arc.http.proxy.read\n *\n * Reads a file from the local filesystem, resolving an HTTP Lambda friendly payload\n *\n * @param {Object} params\n * @param {String} params.Key\n * @param {String} params.IfNoneMatch\n * @param {String} params.isFolder\n * @param {String} params.isProxy\n * @param {Object} params.config\n * @returns {Object} {statusCode, headers, body}\n */\nmodule.exports = async function readLocal (params) {\n\n  let { ARC_SANDBOX_PATH_TO_STATIC, ARC_STATIC_PREFIX, ARC_STATIC_FOLDER } = process.env\n  let { Key, IfNoneMatch, isFolder, isProxy, config } = params\n  let headers = {}\n  let response = {}\n\n  // Unlike S3, handle basePath and assets inside the function as Sandbox is long-lived\n  let staticAssets\n  // After 6.x we can rely on this env var in sandbox\n  let basePath = ARC_SANDBOX_PATH_TO_STATIC || join(process.cwd(), '..', '..', '..', 'public')\n  let staticManifest = join(basePath, 'static.json')\n  if (existsSync(staticManifest)) {\n    staticAssets = JSON.parse(readFileSync(staticManifest))\n  }\n  let assets = config.assets || staticAssets\n\n  // Look up the blob\n  // Assume we're running from a lambda in src/**/* OR from vendored node_modules/@architect/sandbox\n  let filePath = join(basePath, Key)\n  // Denormalize static folder for local paths (not something we'd do in S3)\n  let staticPrefix = ARC_STATIC_PREFIX || ARC_STATIC_FOLDER\n  if (filePath.includes(staticPrefix)) {\n    filePath = filePath.replace(`${staticPrefix}${sep}`, '')\n  }\n\n  try {\n    // If client sends If-None-Match, use it in S3 getObject params\n    let matchedETag = false\n\n    // If the static asset manifest has the key, use that, otherwise fall back to the original Key\n    let contentType = mime.contentType(extname(Key))\n\n    if (!existsSync(filePath)) {\n      return await pretty({ Key: filePath, config, isFolder })\n    }\n\n    let body = readFileSync(filePath)\n    let ETag = crypto.createHash('sha256').update(body).digest('hex')\n    let result = {\n      ContentType: contentType,\n      ETag\n    }\n    if (IfNoneMatch === ETag) {\n      matchedETag = true\n      headers.ETag = IfNoneMatch\n      response = {\n        statusCode: 304,\n        headers\n      }\n    }\n\n    // No ETag found, return the blob\n    if (!matchedETag) {\n      let isBinary = binaryTypes.some(type => result.ContentType.includes(type) || contentType.includes(type))\n\n      // Transform first to allow for any proxy plugin mutations\n      response = transform({\n        Key,\n        config,\n        isBinary,\n        defaults: {\n          headers,\n          body\n        }\n      })\n\n      // Handle templating\n      response = templatizeResponse({\n        isBinary,\n        assets,\n        response,\n        isLocal: true\n      })\n\n      // Normalize response\n      response = normalizeResponse({\n        response,\n        result,\n        Key,\n        isProxy,\n        config\n      })\n\n      // Add ETag\n      response.headers.ETag = result.ETag\n    }\n\n    if (!response.statusCode) {\n      response.statusCode = 200\n    }\n\n    return response\n  }\n  catch (err) {\n    let notFound = err.name === 'NoSuchKey'\n    if (notFound) {\n      return await pretty({ Key: filePath, config, isFolder })\n    }\n    else {\n      let title = err.name\n      let message = `\n        ${err.message}<br>\n        <pre>${err.stack}</pre>\n      `\n      return httpError({ statusCode: 500, title, message })\n    }\n  }\n}\n", "let { existsSync, readFileSync } = require('fs')\nlet { extname, join } = require('path')\nlet mime = require('mime-types')\nlet aws = require('aws-sdk')\n\nlet binaryTypes = require('../../helpers/binary-types')\nlet { httpError } = require('../../errors')\nlet transform = require('../format/transform') // Soon to be deprecated\nlet templatizeResponse = require('../format/templatize')\nlet normalizeResponse = require('../format/response')\nlet pretty = require('./_pretty')\nlet { decompress } = require('../format/compress')\n\n/**\n * arc.http.proxy.read\n *\n * Reads a file from S3, resolving an HTTP Lambda friendly payload\n *\n * @param {Object} params\n * @param {String} params.Key\n * @param {String} params.Bucket\n * @param {String} params.IfNoneMatch\n * @param {String} params.isFolder\n * @param {String} params.isProxy\n * @param {Object} params.config\n * @returns {Object} {statusCode, headers, body}\n */\nmodule.exports = async function readS3 (params) {\n\n  let { Bucket, Key, IfNoneMatch, isFolder, isProxy, config, rootPath } = params\n  let { ARC_STATIC_PREFIX, ARC_STATIC_FOLDER } = process.env\n  let prefix = ARC_STATIC_PREFIX || ARC_STATIC_FOLDER || config.bucket && config.bucket.folder\n  let assets = config.assets || staticAssets\n  let headers = {}\n  let response = {}\n\n  try {\n    // If client sends If-None-Match, use it in S3 getObject params\n    let matchedETag = false\n    let s3 = new aws.S3\n\n    // Try to interpolate HTML/JSON requests to fingerprinted filenames\n    let contentType = mime.contentType(extname(Key))\n    let capture = [ 'text/html', 'application/json' ]\n    let isCaptured = capture.some(type => contentType.includes(type))\n    if (assets && assets[Key] && isCaptured) {\n      // Not necessary to flag response formatter for anti-caching\n      // Those headers are already set in S3 file metadata\n      Key = assets[Key]\n    }\n\n    /**\n     * Check for possible fingerprint upgrades and forward valid requests\n     */\n    if (assets && assets[Key] && !isCaptured) {\n      let location = rootPath\n        ? `/${rootPath}/_static/${assets[Key]}`\n        : `/_static/${assets[Key]}`\n      return {\n        statusCode: 302,\n        headers: {\n          location,\n          'Cache-Control': 'no-cache, no-store, must-revalidate, max-age=0, s-maxage=0'\n        }\n      }\n    }\n\n    /**\n     * Folder prefix\n     *   Enables a bucket folder at root to be specified\n     */\n    if (prefix) {\n      Key = `${prefix}/${Key}`\n    }\n\n    let options = { Bucket, Key }\n    if (IfNoneMatch) {\n      options.IfNoneMatch = IfNoneMatch\n    }\n\n    let result = await s3.getObject(options).promise().catch(err => {\n      // ETag matches (getObject error code of NotModified), so don't transit the whole file\n      if (err.code === 'NotModified') {\n        matchedETag = true\n        headers.ETag = IfNoneMatch\n        response = {\n          statusCode: 304,\n          headers\n        }\n      }\n      else {\n        // Important: do not swallow this error otherwise!\n        throw err\n      }\n    })\n\n    // No ETag found, return the blob\n    if (!matchedETag) {\n      let contentEncoding = result.ContentEncoding\n      if (contentEncoding) {\n        result.Body = decompress(contentEncoding, result.Body)\n      }\n\n      let isBinary = binaryTypes.some(type => result.ContentType.includes(type) || contentType.includes(type))\n\n      // Transform first to allow for any proxy plugin mutations\n      response = transform({\n        Key,\n        config,\n        isBinary,\n        defaults: {\n          headers,\n          body: result.Body\n        }\n      })\n\n      // Handle templating\n      response = templatizeResponse({\n        isBinary,\n        assets,\n        response\n      })\n\n      // Normalize response\n      response = normalizeResponse({\n        response,\n        result,\n        Key,\n        isProxy,\n        contentEncoding,\n        config\n      })\n    }\n\n    if (!response.statusCode) {\n      response.statusCode = 200\n    }\n\n    return response\n  }\n  catch (err) {\n    let notFound = err.name === 'NoSuchKey'\n    if (notFound) {\n      return await pretty({ Bucket, Key, assets, headers, isFolder, prefix })\n    }\n    else {\n      let title = err.name\n      let message = `\n        ${err.message}<br>\n        <pre>${err.stack}</pre>\n      `\n      return httpError({ statusCode: 500, title, message })\n    }\n  }\n}\n\n/**\n * Fingerprinting manifest\n *   Load the manifest, try to hit the disk as infrequently as possible across invocations\n */\nlet staticAssets\nlet staticManifest = join(process.cwd(), 'node_modules', '@architect', 'shared', 'static.json')\nif (staticAssets === false) {\n  null /* noop*/\n}\nelse if (existsSync(staticManifest) && !staticAssets) {\n  staticAssets = JSON.parse(readFileSync(staticManifest))\n}\nelse {\n  staticAssets = false\n}\n", "let readLocal = require('./_local')\nlet readS3 = require('./_s3')\n\nfunction read () {\n  let { ARC_LOCAL, NODE_ENV } = process.env\n  let local = NODE_ENV === 'testing' || ARC_LOCAL\n  return local ? readLocal : readS3\n}\n\nmodule.exports = read()\n", "let read = require('./read')\nlet errors = require('../errors')\n\n/**\n * arc.http.proxy\n *\n * Primary interface for reading static assets out of S3\n *\n * @param config - object, for configuration\n * @param config.alias - object, map of root rel URLs to map to fully qualified root rel URLs\n * @param config.assets - object, map of local, unfingerprinted filenames to fingerprinted filenames\n * @param config.bucket - object, {staging, production} override the s3 bucket names\n * @param config.bucket.staging - object, {staging, production} override the s3 bucket names\n * @param config.bucket.production - object, {staging, production} override the s3 bucket names\n * @param config.bucket.folder - string, bucket folder\n * @param config.cacheControl - string, set a custom Cache-Control max-age header value\n * @param config.plugins - object, configure proxy-plugin-* transforms per file extension\n * @param config.spa - boolean, forces index.html no matter the folder depth\n *\n * @returns HTTPLambda - an HTTP Lambda function that proxies calls to S3\n */\nfunction proxy (config = {}) {\n  return async function httpProxy (req) {\n    let { ARC_STATIC_BUCKET, ARC_STATIC_SPA, NODE_ENV } = process.env\n    let deprecated = req.version === undefined || req.version === '1.0'\n\n    let isProduction = NODE_ENV === 'production'\n    let path = deprecated ? req.path : req.rawPath\n    let isFolder = path.split('/').pop().indexOf('.') === -1\n    let Key // Assigned below\n\n    /**\n     * Bucket config\n     */\n    let configBucket = config.bucket\n    let bucketSetting = isProduction\n      ? configBucket && configBucket['production']\n      : configBucket && configBucket['staging']\n    // Ok, all that out of the way, let's set the actual bucket, eh?\n    let Bucket = ARC_STATIC_BUCKET || bucketSetting\n    if (!Bucket) {\n      return errors.proxyConfig\n    }\n\n    /**\n     * Configure SPA + set up the file to be requested\n     */\n    let spa = ARC_STATIC_SPA === 'false'\n      ? false\n      : config && config.spa\n    if (!spa) config.spa = false\n    if (spa) {\n      // If SPA: force index.html\n      Key = isFolder ? 'index.html' : path.substring(1)\n    }\n    else {\n      // Return index.html for root, otherwise pass the path\n      let last = path.split('/').filter(Boolean).pop()\n      let isFile = last ? last.includes('.') : false\n      let isRoot = path === '/'\n\n      Key = isRoot ? 'index.html' : path.substring(1) // Always remove leading slash\n\n      // Append default index.html to requests to folder paths\n      if (isRoot === false && isFile === false) {\n        Key = `${Key.replace(/\\/$/, '')}/index.html`\n      }\n    }\n\n    /**\n     * Alias\n     *   Allows a Key to be manually overridden\n     */\n    let aliasing = config && config.alias && config.alias[path]\n    if (aliasing) {\n      Key = config.alias[path].substring(1) // Always remove leading slash\n    }\n\n    /**\n     * REST API [very deprecated]: strip `staging/`, `production/` path parts\n     * - Post Architect 5.5 (2019-02-03) which added /{proxy+} this would be an edge case\n     * - e.g. you'd see this if someone put up a proxy in not-`get /`\n     */\n    if (Key.startsWith('staging/'))     Key = Key.replace('staging/', '')\n    if (Key.startsWith('production/'))  Key = Key.replace('production/', '')\n\n    /**\n     * REST API [deprecated]: flag `staging/`, `production/` requests\n     */\n    let rootPath\n    let reqPath = req.requestContext && req.requestContext.path\n    if (deprecated && reqPath) {\n      if (reqPath && reqPath.startsWith('/staging/')) rootPath = 'staging'\n      if (reqPath && reqPath.startsWith('/production/')) rootPath = 'production'\n    }\n\n    // Normalize if-none-match header to lower case; it differs between environments\n    let find = k => k.toLowerCase() === 'if-none-match'\n    let IfNoneMatch = req.headers && req.headers[Object.keys(req.headers).find(find)]\n\n    // Ensure response shape is correct for proxy SPA responses\n    let isProxy = req.resource === '/{proxy+}' || !!req.rawPath\n\n    return await read({ Key, Bucket, IfNoneMatch, isFolder, isProxy, config, rootPath })\n  }\n}\n\nmodule.exports = {\n  proxy,  // Default\n  read    // Read a specific file\n}\n", "// HTTP\nlet http = require('./http')\n\n// HTTP helpers\nlet bodyParser = require('./helpers/body-parser')\nlet interpolate = require('./helpers/params')\nlet _static = require('../static')\nlet url = require('./helpers/url')\n\n// Session\nlet read = require('./session/read')\nlet write = require('./session/write')\n\n// Middleware\nlet _async = require('./async')\nlet express = require('./express')\n\n// Proxy\nlet proxy = require('./proxy')\n\nhttp.helpers = {\n  bodyParser,\n  interpolate,\n  static: _static,\n  url\n}\nhttp.session = { read, write }\nhttp.async = _async\nhttp.express = express\nhttp.proxy = proxy.proxy\n\n// Legacy methods\nhttp.proxy.public = proxy.proxy\nhttp.proxy.read = proxy.read\nhttp.middleware = _async\n\nmodule.exports = http\n", "let aws = require('aws-sdk')\nlet http = require('http')\n/**\n * @param {string} type - events, queues, or tables\n * @returns {object} {name: value}\n */\nmodule.exports = function lookup (callback) {\n  let Path = `/${process.env.ARC_CLOUDFORMATION}`\n  let Recursive = true\n  let values = []\n  let isLocal = process.env.NODE_ENV === 'testing'\n  let config\n  if (isLocal) {\n    // if running in sandbox, sandbox has an SSM mock, use that\n    let port = process.env.ARC_INTERNAL || 3332\n    let region = process.env.AWS_REGION || 'us-west-2'\n    config = {\n      endpoint: new aws.Endpoint(`http://localhost:${port}/_arc/ssm`),\n      region,\n      httpOptions: { agent: new http.Agent() }\n    }\n  }\n  let ssm = new aws.SSM(config)\n\n  function getParams (params) {\n    ssm.getParametersByPath(params, function done (err, result) {\n      if (err) {\n        callback(err)\n      }\n      else if (result.NextToken) {\n        values = values.concat(result.Parameters)\n        getParams({ Path, Recursive, NextToken: result.NextToken })\n      }\n      else {\n        values = values.concat(result.Parameters)\n        callback(null, values.reduce((a, b) => {\n          let hierarchy = b.Name.split('/')\n          hierarchy.shift() // leading slash\n          hierarchy.shift() // stack name\n          let type = hierarchy.shift() // i.e. tables, events, queues, plugins\n          if (!a[type]) a[type] = {}\n          let parent = a[type]\n          let child, lastChild, lastParent\n          /* eslint-disable-next-line */\n          while (child = hierarchy.shift()) {\n            if (!parent[child]) parent[child] = {}\n            lastParent = parent\n            parent = parent[child]\n            lastChild = child\n          }\n          lastParent[lastChild] = b.Value\n          return a\n        }, {}))\n      }\n    })\n  }\n\n  getParams({ Path, Recursive })\n}\n", "let http = require('http')\n\nmodule.exports = function send ({ id, payload }, callback) {\n  let port = process.env.PORT || 3333\n  let body = JSON.stringify({ id, payload })\n  let req = http.request({\n    method: 'POST',\n    port,\n    path: '/__arc',\n    headers: {\n      'Content-Type': 'application/json',\n      'Content-Length': Buffer.byteLength(body)\n    }\n  })\n  req.on('error', callback)\n  req.on('close', () => callback())\n  req.write(body)\n  req.end()\n}\n", "let aws = require('aws-sdk')\n\nmodule.exports = function send ({ id, payload }, callback) {\n  let endpoint\n  let ARC_WSS_URL = process.env.ARC_WSS_URL\n  if (!ARC_WSS_URL.startsWith('wss://')) {\n    // This format of env was only alive for a few weeks, can prob safely retire by mid 2020\n    endpoint = `https://${ARC_WSS_URL}/${process.env.NODE_ENV}`\n  }\n  else {\n    endpoint = `https://${ARC_WSS_URL.replace('wss://', '')}`\n  }\n  let api = new aws.ApiGatewayManagementApi({\n    apiVersion: '2018-11-29',\n    endpoint\n  })\n  api.postToConnection({\n    ConnectionId: id,\n    Data: JSON.stringify(payload)\n  },\n  function postToConnection (err) {\n    if (err) callback(err)\n    else callback()\n  })\n}\n", "let sandbox = require('./send-sandbox')\nlet run = require('./send')\n\n/**\n * arc.ws.send\n *\n * publish web socket events\n *\n * @param {Object} params\n * @param {String} params.id - the ws connecton id (required)\n * @param {Object} params.payload - an event payload (required)\n * @param {Function} callback - a node style errback (optional)\n * @returns {Promise} - returned if no callback is supplied\n */\nmodule.exports = function send ({ id, payload }, callback) {\n\n  // create a promise if no callback is defined\n  let promise\n  if (!callback) {\n    promise = new Promise(function (res, rej) {\n      callback = function (err, result) {\n        err ? rej(err) : res(result)\n      }\n    })\n  }\n\n  let local = process.env.NODE_ENV === 'testing' || process.env.ARC_LOCAL\n  let exec = local ? sandbox : run\n\n  exec({\n    id,\n    payload\n  }, callback)\n\n  return promise\n}\n", "/*! run-waterfall. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */\nmodule.exports = runWaterfall\n\nfunction runWaterfall (tasks, cb) {\n  var current = 0\n  var isSync = true\n\n  function done (err, args) {\n    function end () {\n      args = args ? [].concat(err, args) : [err]\n      if (cb) cb.apply(undefined, args)\n    }\n    if (isSync) process.nextTick(end)\n    else end()\n  }\n\n  function each (err) {\n    var args = Array.prototype.slice.call(arguments, 1)\n    if (++current >= tasks.length || err) {\n      done(err, args)\n    } else {\n      tasks[current].apply(undefined, [].concat(args, each))\n    }\n  }\n\n  if (tasks.length) {\n    tasks[0](each)\n  } else {\n    done(null)\n  }\n\n  isSync = false\n}\n", "var parallel = require('run-parallel')\n/**\n * var trigger = require('aws-dynamodb-lambda-trigger/lambda')\n *\n * function onInsert(record, callback) {\n *   console.log(record)\n *   callback(null, record) // errback style; results passed to context.succeed\n * }\n *\n * module.exports = trigger.insert(onInsert)\n */\n\nfunction __trigger (types, handler) {\n  return function __lambdaSignature (evt, ctx) {\n    // dynamo triggers send batches of records so we're going to create a handler for each one\n    var handlers = evt.Records.map(function (record) {\n      // for each record we construct a handler function\n      return function __actualHandler (callback) {\n        // if isInvoking we invoke the handler with the record\n        var isInvoking = types.indexOf(record.eventName) > -1\n        if (isInvoking) {\n          handler(record, callback)\n        }\n        else {\n          callback() // if not we just call the continuation (callback)\n        }\n      }\n    })\n    // executes the handlers in parallel\n    parallel(handlers, function __processedRecords (err, results) {\n      if (err) {\n        ctx.fail(err)\n      }\n      else {\n        ctx.succeed(results)\n      }\n    })\n  }\n}\n\n/* eslint indent: 0 */\nmodule.exports = {\n  insert: __trigger.bind({}, [ 'INSERT' ]),\n  modify: __trigger.bind({}, [ 'MODIFY' ]),\n  update: __trigger.bind({}, [ 'MODIFY' ]),\n  remove: __trigger.bind({}, [ 'REMOVE' ]),\n destroy: __trigger.bind({}, [ 'REMOVE' ]),\n     all: __trigger.bind({}, [ 'INSERT', 'MODIFY', 'REMOVE' ]),\n    save: __trigger.bind({}, [ 'INSERT', 'MODIFY' ]),\n  change: __trigger.bind({}, [ 'INSERT', 'REMOVE' ])\n}\n", "// accepts an object and promisifies all keys\nmodule.exports = function pfy (obj) {\n  var copy = {}\n  Object.keys(obj).forEach(k => {\n    copy[k] = promised(obj[k])\n  })\n  return copy\n}\n\n// accepts an errback style fn and returns a promisified fn\nfunction promised (fn) {\n  return function _promisified (params, callback) {\n    if (!callback) {\n      return new Promise(function (res, rej) {\n        fn(params, function (err, result) {\n          err ? rej(err) : res(result)\n        })\n      })\n    }\n    else {\n      fn(params, callback)\n    }\n  }\n}\n", "let dynamo = require('./dynamo')\nlet promisify = require('./promisify-object')\nlet parallel = require('run-parallel')\n\n/**\n * returns a data client\n */\nmodule.exports = function reflectFactory (tables, callback) {\n  let { db, doc } = dynamo\n  parallel({ db, doc }, function done (err, { db, doc }) {\n    if (err) throw err\n    else {\n\n      let data = Object.keys(tables).reduce((client, tablename) => {\n        client[tablename] = factory(tables[tablename])\n        return client\n      }, {})\n\n      Object.defineProperty(data, '_db', {\n        enumerable: false,\n        value: db\n      })\n\n      Object.defineProperty(data, '_doc', {\n        enumerable: false,\n        value: doc\n      })\n\n      // async jic for later\n      // eslint-disable-next-line\n      data.reflect = async function reflect () {\n        return tables\n      }\n\n      let _name = name => tables[name]\n      data.name = _name\n      data._name = _name\n\n      function factory (TableName) {\n        return promisify({\n          delete (key, callback) {\n            let params = {}\n            params.TableName = TableName\n            params.Key = key\n            doc.delete(params, callback)\n          },\n          get (key, callback) {\n            let params = {}\n            params.TableName = TableName\n            params.Key = key\n            doc.get(params, function _get (err, result) {\n              if (err) callback(err)\n              else callback(null, result.Item)\n            })\n          },\n          put (item, callback) {\n            let params = {}\n            params.TableName = TableName\n            params.Item = item\n            doc.put(params, function _put (err) {\n              if (err) callback(err)\n              else callback(null, item)\n            })\n          },\n          query (params, callback) {\n            params.TableName = TableName\n            doc.query(params, callback)\n          },\n          scan (params, callback) {\n            params.TableName = TableName\n            doc.scan(params, callback)\n          },\n          update (params, callback) {\n            params.TableName = TableName\n            doc.update(params, callback)\n          }\n        })\n      }\n\n      callback(null, data)\n    }\n  })\n}\n", "const promisifyObject = require('./promisify-object')\nconst parallel = require('run-parallel')\n\nconst stagingTables = tbl => !tbl.includes('-production-')\n\nfunction client (doc, TableName) {\n  let client = {\n    delete (key, callback) {\n      let params = {}\n      params.TableName = TableName\n      params.Key = key\n      doc.delete(params, callback)\n    },\n    get (key, callback) {\n      let params = {}\n      params.TableName = TableName\n      params.Key = key\n      doc.get(params, function _get (err, result) {\n        if (err) {\n          callback(err)\n        }\n        else {\n          callback(null, result.Item)\n        }\n      })\n    },\n    put (item, callback) {\n      let params = {}\n      params.TableName = TableName\n      params.Item = item\n      doc.put(params, function _put (err) {\n        if (err) {\n          callback(err)\n        }\n        else {\n          callback(null, item)\n        }\n      })\n    },\n    query (params, callback) {\n      params.TableName = TableName\n      doc.query(params, callback)\n    },\n    scan (params, callback) {\n      params.TableName = TableName\n      doc.scan(params, callback)\n    },\n    update (params, callback) {\n      params.TableName = TableName\n      doc.update(params, callback)\n    }\n  }\n  return promisifyObject(client)\n}\n\n/**\n * returns a data client\n */\nmodule.exports = function sandbox (dynamo, callback) {\n  function done (err, results) {\n    if (err) {\n      return callback(err)\n    }\n\n    const db = results[0]\n    const doc = results[1]\n\n    db.listTables({}, function listed (err, result) {\n      if (err) {\n        return callback(err)\n      }\n      const tables = result.TableNames.filter(stagingTables)\n      const data = {}\n      const tableMap = {}\n      tables.forEach(fullTableName => {\n        const tableName = fullTableName.replace(/.+-staging-/, '')\n        tableMap[tableName] = fullTableName\n        data[tableName] = client(doc, fullTableName)\n      })\n\n      Object.defineProperty(data, '_db', {\n        enumerable: false,\n        value: db\n      })\n\n      Object.defineProperty(data, '_doc', {\n        enumerable: false,\n        value: doc\n      })\n\n      // async jic for later\n      // eslint-disable-next-line\n      data.reflect = async () => tableMap\n\n      let _name = tableName => tableMap[tableName]\n      data.name = _name\n      data._name = _name\n\n      callback(null, data)\n    })\n  }\n\n  parallel([ dynamo.db, dynamo.doc ], done)\n}\n", "let waterfall = require('run-waterfall')\nlet old = require('./old')\nlet factory = require('./factory')\nlet sandbox = require('./sandbox')\nlet dynamo = require('./dynamo')\n\n// cheap client cache\nlet client = false\n\n/**\n * // example usage:\n * let arc = require('architect/functions')\n *\n * exports.handler = async function http(req) {\n *  let data = await arc.tables()\n *  await data.tacos.put({taco: 'pollo'})\n *  return {statusCode: 200}\n * }\n */\nfunction tables (arc) {\n  function api (callback) {\n    let promise\n    if (!callback) {\n      promise = new Promise(function ugh (res, rej) {\n        callback = function errback (err, result) {\n          if (err) rej(err)\n          else res(result)\n        }\n      })\n    }\n    /**\n     * Read Architect manifest if local / sandbox, otherwise use service reflection\n     */\n    let runningLocally = process.env.NODE_ENV === 'testing'\n    if (runningLocally) {\n      sandbox(dynamo, callback)\n    }\n    else if (client) {\n      callback(null, client)\n    }\n    else {\n      waterfall([\n        function (callback) {\n          arc.services().then(function (serviceMap) {\n            callback(null, serviceMap.tables)\n          }).catch(callback)\n        },\n        factory,\n        function (created, callback) {\n          client = created\n          callback(null, client)\n        }\n      ], callback)\n    }\n    return promise\n  }\n  // Export directly for fast use\n  api.doc = dynamo.direct.doc\n  api.db = dynamo.direct.db\n\n  // Legacy compat methods\n  api.insert = old.insert\n  api.modify = old.modify\n  api.update = old.update\n  api.remove = old.remove\n  api.destroy = old.destroy\n  api.all = old.all\n  api.save = old.save\n  api.change = old.change\n  return api\n}\n\nmodule.exports = tables\n", "let http = require('http')\nlet waterfall = require('run-waterfall')\nlet aws = require('aws-sdk')\n\n/**\n * invoke an sqs lambda by name\n *\n * usage\n *\n *   let arc = require('@architect/functions')\n *\n *   arc.queues.publish({\n *     name: 'queue-name-here',\n *     payload: {hello: 'world'},\n *   }, console.log)\n *\n */\nmodule.exports = function _publish (params, callback) {\n\n  // ensure required input\n  if (!params.name)\n    throw ReferenceError('missing params.name')\n  if (!params.payload)\n    throw ReferenceError('missing params.payload')\n\n  // queue name normalized with appname and env\n  let name = `${process.env.ARC_APP_NAME}-${process.env.NODE_ENV}-${params.name}`\n  let payload = params.payload\n\n  let promise\n  if (!callback) {\n    promise = new Promise((resolve, reject) => {\n      callback = function errback (err, result) {\n        err ? reject(err) : resolve(result)\n      }\n    })\n  }\n\n  // check if we're running locally\n  let local = process.env.NODE_ENV === 'testing' || process.env.ARC_LOCAL\n  if (local) {\n    let port = process.env.ARC_EVENTS_PORT || 3334\n\n    // if so send the mock request\n    let req = http.request({\n      method: 'POST',\n      port,\n      path: '/queues',\n    },\n    function done (res) {\n      let data = []\n      res.resume()\n      res.on('data', chunk => data.push(chunk))\n      res.on('end', () => {\n        let body = Buffer.concat(data).toString()\n        let code = `${res.statusCode}`\n        if (!code.startsWith(2)) callback(Error(`${body} (${code})`))\n        else callback(null, body)\n      })\n    })\n    req.write(JSON.stringify(params))\n    req.end('\\n')\n  }\n  else {\n    // otherwise attempt to sqs.sendMessage\n    let sqs = new aws.SQS\n    waterfall([\n      function reads (callback) {\n        sqs.getQueueUrl({\n          QueueName: name,\n        }, callback)\n      },\n      function publishes (result, callback) {\n        let QueueUrl = result.QueueUrl\n        let DelaySeconds = params.delaySeconds || 0\n        sqs.sendMessage({\n          QueueUrl,\n          DelaySeconds,\n          MessageBody: JSON.stringify(payload)\n        }, callback)\n      }\n    ],\n    function _published (err, result) {\n      if (err) throw err\n      callback(null, result)\n    })\n  }\n  return promise\n}\n", "let parallel = require('run-parallel')\n/**\n * // Exmaple usage:\n *\n * var arc = require('@architect/functions')\n *\n * function signup(record, callback) {\n *   console.log(record)\n *   callback()\n * }\n *\n * // or\n * async function signup(event) {\n *   console.log(event)\n *   return true\n * }\n *\n * exports.handler = arc.queues.subscribe(signup)\n *\n */\nmodule.exports = function _subscribe (fn) {\n  if (fn.constructor.name === 'AsyncFunction') {\n    return async function lambda (event) {\n      return await Promise.all(event.Records.map(async record => {\n        try {\n          let result = JSON.parse(record.body)\n          return await fn(result)\n        }\n        catch (e) {\n          console.log('Queue subscribe error:', e)\n          throw e\n        }\n      }))\n    }\n  }\n  else {\n    return function _lambdaSignature (evt, ctx, callback) {\n      // sqs triggers send batches of records\n      // so we're going to create a handler for each one\n      // and execute them in parallel\n      parallel(evt.Records.map(function _iterator (record) {\n        // for each record we construct a handler function that assumes body is JSON\n        return function _actualHandler (callback) {\n          try {\n            fn(JSON.parse(record.body), callback)\n          }\n          catch (e) {\n            callback(e)\n          }\n        }\n      }), callback)\n    }\n  }\n}\n", "let http = require('http')\n\nmodule.exports = function sandbox (params, callback) {\n  let port = process.env.ARC_EVENTS_PORT || 3334\n  let req = http.request({\n    method: 'POST',\n    port,\n    path: '/queues',\n  },\n  function done (res) {\n    let data = []\n    res.resume()\n    res.on('data', chunk => data.push(chunk))\n    res.on('end', () => {\n      let body = Buffer.concat(data).toString()\n      let code = `${res.statusCode}`\n      if (!code.startsWith(2)) callback(Error(`${body} (${code})`))\n      else callback(null, body)\n    })\n  })\n  req.write(JSON.stringify(params))\n  req.end('\\n')\n}\n", "let aws = require('aws-sdk')\nlet ledger = {}\n\nmodule.exports = function liveFactory (arc) {\n  return function live ({ name, payload, delaySeconds, groupID }, callback) {\n\n    function publish (QueueUrl, payload, callback) {\n      let sqs = new aws.SQS\n      let params = {\n        QueueUrl,\n        DelaySeconds: delaySeconds || 0,\n        MessageBody: JSON.stringify(payload)\n      }\n      if (QueueUrl.endsWith('.fifo')) {\n        params.MessageGroupId = groupID || name\n      }\n      sqs.sendMessage(params, callback)\n    }\n\n    function cacheLedgerAndPublish (serviceMap) {\n      ledger = serviceMap.queues\n      if (!ledger[name]) callback(ReferenceError(`${name} queue not found`))\n      else publish(ledger[name], payload, callback)\n    }\n\n    let arn = ledger[name]\n    if (arn) {\n      publish(ledger[name], payload, callback)\n    }\n    else {\n      arc.services().then(cacheLedgerAndPublish).catch(callback)\n    }\n  }\n}\n", "let sandbox = require('./publish-sandbox')\nlet queueFactory = require('./publish-queue')\n\n/**\n * invoke a queue lambda by sqs queue name\n */\nmodule.exports = function publishFactory (arc) {\n  let queue = queueFactory(arc)\n  return function publish (params, callback) {\n\n    if (!params.name)\n      throw ReferenceError('missing params.name')\n\n    if (!params.payload)\n      throw ReferenceError('missing params.payload')\n\n    let promise\n    if (!callback) {\n      promise = new Promise((resolve, reject) => {\n        callback = function errback (err, result) {\n          err ? reject(err) : resolve(result)\n        }\n      })\n    }\n\n    let isLocal = process.env.NODE_ENV === 'testing' || process.env.ARC_LOCAL\n    let exec = isLocal ? sandbox : queue\n    exec(params, callback)\n    return promise\n  }\n}\n", "let oldPublish = require('./publish-old')\nlet subscribe = require('./subscribe')\nlet publishFactory = require('./publish')\n\nmodule.exports = function queueFactory (arc) {\n  let publish = publishFactory(arc)\n  return {\n    /**\n     * arc.queues.publish\n     *\n     * publish to an sqs queue\n     *\n     * @param {Object} params\n     * @param {String} params.name - the queue name (required)\n     * @param {String} params.payload - a json event payload (required)\n     * @param {Function} callback - a node style errback (optional)\n     * @returns {Promise} - returned if no callback is supplied\n     */\n    publish (params, callback) {\n      if (process.env.ARC_CLOUDFORMATION) {\n        return publish(params, callback)\n      }\n      else {\n        return oldPublish(params, callback)\n      }\n    },\n\n    /**\n     * arc.queues.subscribe\n     *\n     * handle payloads published to the queue\n     *\n     * @param {Function} handler - a single queue handler function\n     * @returns {Lambda} - a Lambda function sig: (event, context, callback)=>\n     */\n    subscribe,\n  }\n}\n", "/* eslint global-require: \"off\" */\nlet http = require('http')\nlet aws = require('aws-sdk')\nlet sns = new aws.SNS\nlet ledger = {}\n\n// priv publish\n// blindly publishes to sns topic json stringified record\n// throws if fails so lambda errors are noticible\nfunction __publish (arn, payload, callback) {\n  sns.publish({\n    TopicArn: arn,\n    Message: JSON.stringify(payload)\n  },\n  function _published (err, result) {\n    if (err) throw err\n    callback(null, result)\n  })\n}\n\n/**\n * invoke an event lambda by name\n *\n * usage\n *\n *   let arc = require('@smallwins/arc-prototype')\n *\n *   arc.events.publish({\n *     name: 'eventname',\n *     payload: {hello: 'world'},\n *   }, console.log)\n *\n * this will invoke appname-staging-eventname (or appname-production-eventname)\n *\n * you can invoke events for other arc apps in the same region by overriding appname with app param like so:\n *\n *   arc.events.publish({\n *     app: 'otherappname',\n *     name: 'eventname',\n *     payload: {hello: 'world2'},\n *   }, console.log)\n */\nmodule.exports = function _publish (params, callback) {\n  if (!params.name)\n    throw ReferenceError('missing params.name')\n\n  if (!params.payload)\n    throw ReferenceError('missing params.payload')\n\n  let promise\n  if (!callback) {\n    promise = new Promise((resolve, reject) => {\n      callback = function errback (err, result) {\n        err ? reject(err) : resolve(result)\n      }\n    })\n  }\n\n  let isLocal = process.env.NODE_ENV === 'testing' || process.env.ARC_LOCAL\n  let exec = isLocal ? _local : _live\n  exec(params, callback)\n  return promise\n}\n\nfunction _live (params, callback) {\n  let { name, payload } = params\n  let arn = ledger[name]\n\n  if (arn) {\n    __publish(ledger[name], payload, callback)\n  }\n  else {\n    let override = params.app\n    let eventName = `${override ? params.app : process.env.ARC_APP_NAME}-${process.env.NODE_ENV}-${name}`\n    _scan({ eventName }, function _scan (err, found) {\n      if (err) throw err\n      // cache the arn here\n      ledger[name] = found\n      // and continue\n      __publish(ledger[name], payload, callback)\n    })\n  }\n}\n\nfunction _local (params, callback) {\n  let port = process.env.ARC_EVENTS_PORT || 3334\n  let req = http.request({\n    method: 'POST',\n    port,\n    path: '/events',\n  },\n  function done (res) {\n    let data = []\n    res.resume()\n    res.on('data', chunk => data.push(chunk))\n    res.on('end', () => {\n      let body = Buffer.concat(data).toString()\n      let code = `${res.statusCode}`\n      if (!code.startsWith(2)) callback(Error(`${body} (${code})`))\n      else callback(null, body)\n    })\n  })\n  req.write(JSON.stringify(params))\n  req.end('\\n')\n}\n\nfunction _scan ({ eventName }, callback) {\n  let sns = new aws.SNS()\n  ;(function __scanner (params = {}, callback) {\n    sns.listTopics(params, function _listTopics (err, results) {\n      if (err) throw err\n      let found = results.Topics.find(t => {\n        let bits = t.TopicArn.split(':')\n        let it = bits[bits.length - 1]\n        return it === eventName\n      })\n      if (found) {\n        callback(null, found.TopicArn)\n      }\n      else if (results.NextToken) {\n        setTimeout(() => {\n          // 30tps on sns.listTopics, so let's give just a bit of buffer\n          __scanner({ NextToken: results.NextToken }, callback)\n        }, 50)\n      }\n      else {\n        callback(Error(`topic ${eventName} not found`))\n      }\n    })\n  })({}, callback)\n}\n", "let parallel = require('run-parallel')\n\nlet fallback = {\n  Records: [\n    { Sns: { Message: JSON.stringify({}) } }\n  ]\n}\n\n/**\n * // Example usage:\n *\n * var arc = require('@architect/functions')\n *\n * function signup(record, callback) {\n *   console.log(record)\n *   callback()\n * }\n *\n * exports.handler = arc.events.subscribe(signup)\n */\nmodule.exports = function _subscribe (fn) {\n  if (fn.constructor.name === 'AsyncFunction') {\n    return async function lambda (event) {\n      event = event && Object.keys(event).length ? event : fallback\n      return await Promise.all(event.Records.map(async record => {\n        try {\n          let result = JSON.parse(record.Sns.Message)\n          return await fn(result)\n        }\n        catch (e) {\n          console.log('Event subscribe error:', e)\n          throw e\n        }\n      }))\n    }\n  }\n  else {\n    // callback interface\n    return function _lambdaSignature (event, context, callback) {\n      event = event && Object.keys(event).length ? event : fallback\n      // sns triggers send batches of records\n      // so we're going to create a handler for each one\n      // and execute them in parallel\n      parallel(event.Records.map(function _iterator (record) {\n        // for each record we construct a handler function\n        return function _actualHandler (callback) {\n          try {\n            fn(JSON.parse(record.Sns.Message), callback)\n          }\n          catch (e) {\n            callback(e)\n          }\n        }\n      }), callback)\n    }\n  }\n}\n", "let http = require('http')\n\nmodule.exports = function publishLocal (params, callback) {\n  let port = process.env.ARC_EVENTS_PORT || 3334\n  let req = http.request({\n    method: 'POST',\n    port,\n    path: '/events',\n  },\n  function done (res) {\n    let data = []\n    res.resume()\n    res.on('data', chunk => data.push(chunk))\n    res.on('end', () => {\n      let body = Buffer.concat(data).toString()\n      let code = `${res.statusCode}`\n      if (!code.startsWith(2)) callback(Error(`${body} (${code})`))\n      else callback(null, body)\n    })\n  })\n  req.write(JSON.stringify(params))\n  req.end('\\n')\n}\n", "let aws = require('aws-sdk')\nlet ledger = {}\n\nmodule.exports = function liveFactory (arc) {\n  return function live ({ name, payload }, callback) {\n\n    function publish (arn, payload, callback) {\n      let sns = new aws.SNS\n      sns.publish({\n        TopicArn: arn,\n        Message: JSON.stringify(payload)\n      }, callback)\n    }\n\n    function cacheLedgerAndPublish (serviceMap) {\n      ledger = serviceMap.events\n      if (!ledger[name]) callback(ReferenceError(`${name} event not found`))\n      else publish(ledger[name], payload, callback)\n    }\n\n    let arn = ledger[name]\n    if (arn) {\n      publish(ledger[name], payload, callback)\n    }\n    else {\n      arc.services().then(cacheLedgerAndPublish).catch(callback)\n    }\n  }\n}\n", "let sandbox = require('./publish-sandbox')\nlet topicFactory = require('./publish-topic')\n\n/**\n * invoke an event lambda by sns topic name\n */\nmodule.exports = function publishFactory (arc) {\n  let topic = topicFactory(arc)\n  return function publish (params, callback) {\n    if (!params.name)\n      throw ReferenceError('missing params.name')\n\n    if (!params.payload)\n      throw ReferenceError('missing params.payload')\n\n    let promise\n    if (!callback) {\n      promise = new Promise((resolve, reject) => {\n        callback = function errback (err, result) {\n          err ? reject(err) : resolve(result)\n        }\n      })\n    }\n\n    let isLocal = process.env.NODE_ENV === 'testing' || process.env.ARC_LOCAL\n    let exec = isLocal ? sandbox : topic\n    exec(params, callback)\n    return promise\n  }\n}\n", "let oldPublish = require('./publish-old')\nlet subscribe = require('./subscribe')\nlet publishFactory = require('./publish')\n\nmodule.exports = function eventFactory (arc) {\n  let publish = publishFactory(arc)\n  return {\n    /**\n     * arc.events.publish\n     *\n     * publish events (sns topics)\n     *\n     * @param {Object} params\n     * @param {String} params.name - the event name (required)\n     * @param {String} params.payload - a json event payload (required)\n     * @param {Function} callback - a node style errback (optional)\n     * @returns {Promise} - returned if no callback is supplied\n     */\n    publish (params, callback) {\n      if (process.env.ARC_CLOUDFORMATION) {\n        return publish(params, callback)\n      }\n      else {\n        return oldPublish(params, callback)\n      }\n    },\n\n    /**\n     * arc.events.subscribe\n     *\n     * listen for events (sns topics)\n     *\n     * @param {Function} handler - a single event handler function\n     * @returns {Lambda} - a Lambda function sig: (event, context, callback)=>\n     */\n    subscribe\n  }\n}\n", "/**\n * Ensure env is one of: 'testing', 'staging', or 'production'\n * - Some test harnesses (ahem) will automatically populate NODE_ENV with their own values, unbidden\n * - Due to tables.direct auto initializing, always set (or override) default NODE_ENV to 'testing'\n */\nlet env = process.env.NODE_ENV\nlet isNotStagingOrProd = env !== 'staging' && env !== 'production'\nif (!env || isNotStagingOrProd) {\n  process.env.NODE_ENV = 'testing'\n}\n\n\nlet http = require('./http')\nlet _static = require('./static')\nlet serviceDiscovery = require('./discovery')\nlet services\n\nlet send = require('./ws')\nlet arc = {\n  http,\n  static: _static,\n  ws: { send },\n  services: function () {\n    return new Promise(function (resolve, reject) {\n      if (services) resolve(services)\n      else serviceDiscovery(function (err, serviceMap) {\n        if (err) reject(err)\n        else {\n          services = serviceMap\n          resolve(services)\n        }\n      })\n    })\n  }\n}\narc.tables = require('./tables')(arc)\narc.queues = require('./queues')(arc)\narc.events = require('./events')(arc)\n\n// backwards compat\narc.proxy = {}\narc.proxy.public = http.proxy.public\narc.middleware = http.middleware\n// backwards compat\n\nmodule.exports = arc\n", "function printExpires(expires){\n    if(!expires) return false;\n    if(typeof expires == 'string') expires = new Date(expires);\n    if(typeof expires == 'number') expires = new Date(expires);\n    var n = ( expires.valueOf() - (new Date()).valueOf() ) / 1000;\n    return 'Expires='+expires.toGMTString()+';Max-Age='+Math.round( n );\n}\n\nvar cookie = {\n    stringify: function( obj ){\n        var value;\n        try{\n            value = encodeURIComponent(obj.value);\n        }catch(e){\n            value = obj.value;\n        }\n        return [\n\n            obj.name+'='+value,\n            ( typeof obj.expires != 'undefined' && obj.expires ? printExpires(obj.expires) : '' ),\n            ( typeof obj.path != 'undefined' ? (obj.path ? 'Path='+obj.path : '') : 'Path=/' ),\n            ( typeof obj.domain != 'undefined' && obj.domain ? 'Domain='+obj.domain : '' ),\n            ( typeof obj.secure != 'undefined' && obj.secure ? 'secure' : '' ),\n            ( typeof obj.httponly != 'undefined' && obj.httponly ? 'HttpOnly' : '' ),\n            ( typeof obj.samesite != 'undefined' && obj.samesite ? 'SameSite=' + obj.samesite : '')\n\n        ].join(';').replace(/;+/g,';').replace(/;$/,'').replace(/;/g,'; ');\n    },\n    parse: function( string, path, domain ){\n        var s = string.replace(/;\\s+/g,';').split(';')\n            .map(function(s){return s.replace(/\\s+\\s+/g,'=').split('=');});\n\n        var n = s.shift();\n\n        var obj = {};\n        obj.expires = false;\n        obj.httponly = false;\n        obj.secure = false;\n        obj.path = path || '/';\n        obj.domain = domain || '';\n        obj.samesite = '';\n\n        var I, f = {\n            httponly: function(){ obj.httponly = true; },\n            secure: function(){ obj.secure = true; },\n            expires: function(v){ obj.expires = new Date(v); },\n            'max-age': function(v){ if(obj.expires) return; obj.expires = new Date((new Date()).valueOf()+(v*1000)); },\n            path: function(v){ obj.path = v; },\n            domain: function(v){ obj.domain = v; },\n            samesite: function(v) { obj.samesite = v; }\n        };\n\n        for(var i in s) {\n            I = s[i][0].toLowerCase();\n            if( typeof f[I] != 'undefined' ) f[I]( s[i].length==2 ? s[i][1] : '' );\n        }\n\n        if( !obj.expires ) obj.expires = 0;\n        obj.name = n.shift();\n        n = n.map((s) => {\n            var f;\n            try{\n                f = decodeURIComponent(s)\n            }catch(e){ f = s }\n            return s\n        })\n        \n        obj.value = n.join('=');\n        return obj;\n    },\n    tokenize: function( array ){\n        return array.map(function(s){ return s.name+'='+s.value; }).join('; ');\n    }\n};\n\nmodule.exports = exports = cookie;\n", "function _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nmodule.exports = _interopRequireDefault;\nmodule.exports[\"default\"] = module.exports, module.exports.__esModule = true;", "module.exports.KEYOBJECT = Symbol('KEYOBJECT')\nmodule.exports.PRIVATE_MEMBERS = Symbol('PRIVATE_MEMBERS')\nmodule.exports.PUBLIC_MEMBERS = Symbol('PUBLIC_MEMBERS')\nmodule.exports.THUMBPRINT_MATERIAL = Symbol('THUMBPRINT_MATERIAL')\nmodule.exports.JWK_MEMBERS = Symbol('JWK_MEMBERS')\nmodule.exports.KEY_MANAGEMENT_ENCRYPT = Symbol('KEY_MANAGEMENT_ENCRYPT')\nmodule.exports.KEY_MANAGEMENT_DECRYPT = Symbol('KEY_MANAGEMENT_DECRYPT')\n\nconst USES_MAPPING = {\n  sig: new Set(['sign', 'verify']),\n  enc: new Set(['encrypt', 'decrypt', 'wrapKey', 'unwrapKey', 'deriveKey'])\n}\nconst OPS = new Set([...USES_MAPPING.sig, ...USES_MAPPING.enc])\nconst USES = new Set(Object.keys(USES_MAPPING))\n\nmodule.exports.USES_MAPPING = USES_MAPPING\nmodule.exports.OPS = OPS\nmodule.exports.USES = USES\n", "const { deprecate } = require('util')\n\nconst deprecation = deprecate(() => {}, '\"P-256K\" EC curve name is deprecated')\n\nmodule.exports = {\n  name: 'secp256k1',\n  rename (value) {\n    if (value !== 'secp256k1') {\n      deprecation()\n    }\n    module.exports.name = value\n  }\n}\n", "const { getCurves } = require('crypto')\n\nconst { name: secp256k1 } = require('../jwk/key/secp256k1_crv')\n\nconst curves = new Set()\n\nif (getCurves().includes('prime256v1')) {\n  curves.add('P-256')\n}\n\nif (getCurves().includes('secp256k1')) {\n  curves.add(secp256k1)\n}\n\nif (getCurves().includes('secp384r1')) {\n  curves.add('P-384')\n}\n\nif (getCurves().includes('secp521r1')) {\n  curves.add('P-521')\n}\n\nmodule.exports = curves\n", "module.exports = new Map([\n  ['A128CBC-HS256', 128],\n  ['A128GCM', 96],\n  ['A128GCMKW', 96],\n  ['A192CBC-HS384', 128],\n  ['A192GCM', 96],\n  ['A192GCMKW', 96],\n  ['A256CBC-HS512', 128],\n  ['A256GCM', 96],\n  ['A256GCMKW', 96]\n])\n", "module.exports = {\n  sign: new Map(),\n  verify: new Map(),\n  keyManagementEncrypt: new Map(),\n  keyManagementDecrypt: new Map(),\n  encrypt: new Map(),\n  decrypt: new Map()\n}\n", "module.exports = {\n  oct: {\n    decrypt: {},\n    deriveKey: {},\n    encrypt: {},\n    sign: {},\n    unwrapKey: {},\n    verify: {},\n    wrapKey: {}\n  },\n  EC: {\n    decrypt: {},\n    deriveKey: {},\n    encrypt: {},\n    sign: {},\n    unwrapKey: {},\n    verify: {},\n    wrapKey: {}\n  },\n  RSA: {\n    decrypt: {},\n    deriveKey: {},\n    encrypt: {},\n    sign: {},\n    unwrapKey: {},\n    verify: {},\n    wrapKey: {}\n  },\n  OKP: {\n    decrypt: {},\n    deriveKey: {},\n    encrypt: {},\n    sign: {},\n    unwrapKey: {},\n    verify: {},\n    wrapKey: {}\n  }\n}\n", "module.exports = new Map([\n  ['A128CBC-HS256', 256],\n  ['A128GCM', 128],\n  ['A192CBC-HS384', 384],\n  ['A192GCM', 192],\n  ['A256CBC-HS512', 512],\n  ['A256GCM', 256]\n])\n", "const curves = new Set(['Ed25519'])\n\nif (!('electron' in process.versions)) {\n  curves.add('Ed448')\n  curves.add('X25519')\n  curves.add('X448')\n}\n\nmodule.exports = curves\n", "module.exports = new Map()\n", "const EC_CURVES = require('./ec_curves')\nconst IVLENGTHS = require('./iv_lengths')\nconst JWA = require('./jwa')\nconst JWK = require('./jwk')\nconst KEYLENGTHS = require('./key_lengths')\nconst OKP_CURVES = require('./okp_curves')\nconst ECDH_DERIVE_LENGTHS = require('./ecdh_derive_lengths')\n\nmodule.exports = {\n  EC_CURVES,\n  ECDH_DERIVE_LENGTHS,\n  IVLENGTHS,\n  JWA,\n  JWK,\n  KEYLENGTHS,\n  OKP_CURVES\n}\n", "const { randomBytes } = require('crypto')\n\nconst { IVLENGTHS } = require('../registry')\n\nmodule.exports = alg => randomBytes(IVLENGTHS.get(alg) / 8)\n", "/* global BigInt */\n\nconst fromBase64 = (base64) => {\n  return base64.replace(/=/g, '').replace(/\\+/g, '-').replace(/\\//g, '_')\n}\n\nconst encode = (input, encoding = 'utf8') => {\n  return fromBase64(Buffer.from(input, encoding).toString('base64'))\n}\n\nconst encodeBuffer = (buf) => {\n  return fromBase64(buf.toString('base64'))\n}\n\nconst decodeToBuffer = (input) => {\n  return Buffer.from(input, 'base64')\n}\n\nconst decode = (input, encoding = 'utf8') => {\n  return decodeToBuffer(input).toString(encoding)\n}\n\nconst b64uJSON = {\n  encode: (input) => {\n    return encode(JSON.stringify(input))\n  },\n  decode: (input, encoding = 'utf8') => {\n    return JSON.parse(decode(input, encoding))\n  }\n}\n\nb64uJSON.decode.try = (input, encoding = 'utf8') => {\n  try {\n    return b64uJSON.decode(input, encoding)\n  } catch (err) {\n    return decode(input, encoding)\n  }\n}\n\nconst bnToBuf = (bn) => {\n  let hex = BigInt(bn).toString(16)\n  if (hex.length % 2) {\n    hex = `0${hex}`\n  }\n\n  const len = hex.length / 2\n  const u8 = new Uint8Array(len)\n\n  let i = 0\n  let j = 0\n  while (i < len) {\n    u8[i] = parseInt(hex.slice(j, j + 2), 16)\n    i += 1\n    j += 2\n  }\n\n  return u8\n}\n\nconst encodeBigInt = (bn) => encodeBuffer(Buffer.from(bnToBuf(bn)))\n\nmodule.exports.decode = decode\nmodule.exports.decodeToBuffer = decodeToBuffer\nmodule.exports.encode = encode\nmodule.exports.encodeBuffer = encodeBuffer\nmodule.exports.JSON = b64uJSON\nmodule.exports.encodeBigInt = encodeBigInt\n", "const CODES = {\n  JOSEAlgNotWhitelisted: 'ERR_JOSE_ALG_NOT_WHITELISTED',\n  JOSECritNotUnderstood: 'ERR_JOSE_CRIT_NOT_UNDERSTOOD',\n  JOSEInvalidEncoding: 'ERR_JOSE_INVALID_ENCODING',\n  JOSEMultiError: 'ERR_JOSE_MULTIPLE_ERRORS',\n  JOSENotSupported: 'ERR_JOSE_NOT_SUPPORTED',\n  JWEDecryptionFailed: 'ERR_JWE_DECRYPTION_FAILED',\n  JWEInvalid: 'ERR_JWE_INVALID',\n  JWKImportFailed: 'ERR_JWK_IMPORT_FAILED',\n  JWKInvalid: 'ERR_JWK_INVALID',\n  JWKKeySupport: 'ERR_JWK_KEY_SUPPORT',\n  JWKSNoMatchingKey: 'ERR_JWKS_NO_MATCHING_KEY',\n  JWSInvalid: 'ERR_JWS_INVALID',\n  JWSVerificationFailed: 'ERR_JWS_VERIFICATION_FAILED',\n  JWTClaimInvalid: 'ERR_JWT_CLAIM_INVALID',\n  JWTExpired: 'ERR_JWT_EXPIRED',\n  JWTMalformed: 'ERR_JWT_MALFORMED'\n}\n\nconst DEFAULT_MESSAGES = {\n  JWEDecryptionFailed: 'decryption operation failed',\n  JWEInvalid: 'JWE invalid',\n  JWKSNoMatchingKey: 'no matching key found in the KeyStore',\n  JWSInvalid: 'JWS invalid',\n  JWSVerificationFailed: 'signature verification failed'\n}\n\nclass JOSEError extends Error {\n  constructor (message) {\n    super(message)\n    if (message === undefined) {\n      this.message = DEFAULT_MESSAGES[this.constructor.name]\n    }\n    this.name = this.constructor.name\n    this.code = CODES[this.constructor.name]\n    Error.captureStackTrace(this, this.constructor)\n  }\n}\n\nconst isMulti = e => e instanceof JOSEMultiError\nclass JOSEMultiError extends JOSEError {\n  constructor (errors) {\n    super()\n    let i\n    while ((i = errors.findIndex(isMulti)) && i !== -1) {\n      errors.splice(i, 1, ...errors[i])\n    }\n    Object.defineProperty(this, 'errors', { value: errors })\n  }\n\n  * [Symbol.iterator] () {\n    for (const error of this.errors) {\n      yield error\n    }\n  }\n}\nmodule.exports.JOSEError = JOSEError\n\nmodule.exports.JOSEAlgNotWhitelisted = class JOSEAlgNotWhitelisted extends JOSEError {}\nmodule.exports.JOSECritNotUnderstood = class JOSECritNotUnderstood extends JOSEError {}\nmodule.exports.JOSEInvalidEncoding = class JOSEInvalidEncoding extends JOSEError {}\nmodule.exports.JOSEMultiError = JOSEMultiError\nmodule.exports.JOSENotSupported = class JOSENotSupported extends JOSEError {}\n\nmodule.exports.JWEDecryptionFailed = class JWEDecryptionFailed extends JOSEError {}\nmodule.exports.JWEInvalid = class JWEInvalid extends JOSEError {}\n\nmodule.exports.JWKImportFailed = class JWKImportFailed extends JOSEError {}\nmodule.exports.JWKInvalid = class JWKInvalid extends JOSEError {}\nmodule.exports.JWKKeySupport = class JWKKeySupport extends JOSEError {}\n\nmodule.exports.JWKSNoMatchingKey = class JWKSNoMatchingKey extends JOSEError {}\n\nmodule.exports.JWSInvalid = class JWSInvalid extends JOSEError {}\nmodule.exports.JWSVerificationFailed = class JWSVerificationFailed extends JOSEError {}\n\nclass JWTClaimInvalid extends JOSEError {\n  constructor (message, claim = 'unspecified', reason = 'unspecified') {\n    super(message)\n    this.claim = claim\n    this.reason = reason\n  }\n}\nmodule.exports.JWTClaimInvalid = JWTClaimInvalid\nmodule.exports.JWTExpired = class JWTExpired extends JWTClaimInvalid {}\nmodule.exports.JWTMalformed = class JWTMalformed extends JOSEError {}\n", "const { diffieHellman, KeyObject, sign, verify } = require('crypto')\n\nconst [major, minor] = process.version.substr(1).split('.').map(x => parseInt(x, 10))\n\nmodule.exports = {\n  oaepHashSupported: major > 12 || (major === 12 && minor >= 9),\n  keyObjectSupported: !!KeyObject && major >= 12,\n  edDSASupported: !!sign && !!verify,\n  dsaEncodingSupported: major > 13 || (major === 13 && minor >= 2) || (major === 12 && minor >= 16),\n  improvedDH: !!diffieHellman\n}\n", "module.exports = a => !!a && a.constructor === Object\n", "const { inherits } = require('util')\n\nfunction Reporter (options) {\n  this._reporterState = {\n    obj: null,\n    path: [],\n    options: options || {},\n    errors: []\n  }\n}\n\nReporter.prototype.isError = function isError (obj) {\n  return obj instanceof ReporterError\n}\n\nReporter.prototype.save = function save () {\n  const state = this._reporterState\n\n  return { obj: state.obj, pathLen: state.path.length }\n}\n\nReporter.prototype.restore = function restore (data) {\n  const state = this._reporterState\n\n  state.obj = data.obj\n  state.path = state.path.slice(0, data.pathLen)\n}\n\nReporter.prototype.enterKey = function enterKey (key) {\n  return this._reporterState.path.push(key)\n}\n\nReporter.prototype.exitKey = function exitKey (index) {\n  const state = this._reporterState\n\n  state.path = state.path.slice(0, index - 1)\n}\n\nReporter.prototype.leaveKey = function leaveKey (index, key, value) {\n  const state = this._reporterState\n\n  this.exitKey(index)\n  if (state.obj !== null) { state.obj[key] = value }\n}\n\nReporter.prototype.path = function path () {\n  return this._reporterState.path.join('/')\n}\n\nReporter.prototype.enterObject = function enterObject () {\n  const state = this._reporterState\n\n  const prev = state.obj\n  state.obj = {}\n  return prev\n}\n\nReporter.prototype.leaveObject = function leaveObject (prev) {\n  const state = this._reporterState\n\n  const now = state.obj\n  state.obj = prev\n  return now\n}\n\nReporter.prototype.error = function error (msg) {\n  let err\n  const state = this._reporterState\n\n  const inherited = msg instanceof ReporterError\n  if (inherited) {\n    err = msg\n  } else {\n    err = new ReporterError(state.path.map(function (elem) {\n      return `[${JSON.stringify(elem)}]`\n    }).join(''), msg.message || msg, msg.stack)\n  }\n\n  if (!state.options.partial) { throw err }\n\n  if (!inherited) { state.errors.push(err) }\n\n  return err\n}\n\nReporter.prototype.wrapResult = function wrapResult (result) {\n  const state = this._reporterState\n  if (!state.options.partial) { return result }\n\n  return {\n    result: this.isError(result) ? null : result,\n    errors: state.errors\n  }\n}\n\nfunction ReporterError (path, msg) {\n  this.path = path\n  this.rethrow(msg)\n}\ninherits(ReporterError, Error)\n\nReporterError.prototype.rethrow = function rethrow (msg) {\n  this.message = `${msg} at: ${this.path || '(shallow)'}`\n  if (Error.captureStackTrace) { Error.captureStackTrace(this, ReporterError) }\n\n  if (!this.stack) {\n    try {\n      // IE only adds stack when thrown\n      throw new Error(this.message)\n    } catch (e) {\n      this.stack = e.stack\n    }\n  }\n  return this\n}\n\nexports.Reporter = Reporter\n", "const { inherits } = require('util')\n\nconst { Reporter } = require('../base/reporter')\n\nfunction DecoderBuffer (base, options) {\n  Reporter.call(this, options)\n  if (!Buffer.isBuffer(base)) {\n    this.error('Input not Buffer')\n    return\n  }\n\n  this.base = base\n  this.offset = 0\n  this.length = base.length\n}\ninherits(DecoderBuffer, Reporter)\n\nDecoderBuffer.isDecoderBuffer = function isDecoderBuffer (data) {\n  if (data instanceof DecoderBuffer) {\n    return true\n  }\n\n  // Or accept compatible API\n  const isCompatible = typeof data === 'object' &&\n    Buffer.isBuffer(data.base) &&\n    data.constructor.name === 'DecoderBuffer' &&\n    typeof data.offset === 'number' &&\n    typeof data.length === 'number' &&\n    typeof data.save === 'function' &&\n    typeof data.restore === 'function' &&\n    typeof data.isEmpty === 'function' &&\n    typeof data.readUInt8 === 'function' &&\n    typeof data.skip === 'function' &&\n    typeof data.raw === 'function'\n\n  return isCompatible\n}\n\nDecoderBuffer.prototype.save = function save () {\n  return { offset: this.offset, reporter: Reporter.prototype.save.call(this) }\n}\n\nDecoderBuffer.prototype.restore = function restore (save) {\n  // Return skipped data\n  const res = new DecoderBuffer(this.base)\n  res.offset = save.offset\n  res.length = this.offset\n\n  this.offset = save.offset\n  Reporter.prototype.restore.call(this, save.reporter)\n\n  return res\n}\n\nDecoderBuffer.prototype.isEmpty = function isEmpty () {\n  return this.offset === this.length\n}\n\nDecoderBuffer.prototype.readUInt8 = function readUInt8 (fail) {\n  if (this.offset + 1 <= this.length) { return this.base.readUInt8(this.offset++, true) } else { return this.error(fail || 'DecoderBuffer overrun') }\n}\n\nDecoderBuffer.prototype.skip = function skip (bytes, fail) {\n  if (!(this.offset + bytes <= this.length)) { return this.error(fail || 'DecoderBuffer overrun') }\n\n  const res = new DecoderBuffer(this.base)\n\n  // Share reporter state\n  res._reporterState = this._reporterState\n\n  res.offset = this.offset\n  res.length = this.offset + bytes\n  this.offset += bytes\n  return res\n}\n\nDecoderBuffer.prototype.raw = function raw (save) {\n  return this.base.slice(save ? save.offset : this.offset, this.length)\n}\n\nfunction EncoderBuffer (value, reporter) {\n  if (Array.isArray(value)) {\n    this.length = 0\n    this.value = value.map(function (item) {\n      if (!EncoderBuffer.isEncoderBuffer(item)) { item = new EncoderBuffer(item, reporter) }\n      this.length += item.length\n      return item\n    }, this)\n  } else if (typeof value === 'number') {\n    if (!(value >= 0 && value <= 0xff)) { return reporter.error('non-byte EncoderBuffer value') }\n    this.value = value\n    this.length = 1\n  } else if (typeof value === 'string') {\n    this.value = value\n    this.length = Buffer.byteLength(value)\n  } else if (Buffer.isBuffer(value)) {\n    this.value = value\n    this.length = value.length\n  } else {\n    return reporter.error(`Unsupported type: ${typeof value}`)\n  }\n}\n\nEncoderBuffer.isEncoderBuffer = function isEncoderBuffer (data) {\n  if (data instanceof EncoderBuffer) {\n    return true\n  }\n\n  // Or accept compatible API\n  const isCompatible = typeof data === 'object' &&\n    data.constructor.name === 'EncoderBuffer' &&\n    typeof data.length === 'number' &&\n    typeof data.join === 'function'\n\n  return isCompatible\n}\n\nEncoderBuffer.prototype.join = function join (out, offset) {\n  if (!out) { out = Buffer.alloc(this.length) }\n  if (!offset) { offset = 0 }\n\n  if (this.length === 0) { return out }\n\n  if (Array.isArray(this.value)) {\n    this.value.forEach(function (item) {\n      item.join(out, offset)\n      offset += item.length\n    })\n  } else {\n    if (typeof this.value === 'number') { out[offset] = this.value } else if (typeof this.value === 'string') { out.write(this.value, offset) } else if (Buffer.isBuffer(this.value)) { this.value.copy(out, offset) }\n    offset += this.length\n  }\n\n  return out\n}\n\nmodule.exports = {\n  DecoderBuffer,\n  EncoderBuffer\n}\n", "const { strict: assert } = require('assert')\n\nconst { Reporter } = require('../base/reporter')\nconst { DecoderBuffer, EncoderBuffer } = require('../base/buffer')\n\n// Supported tags\nconst tags = [\n  'seq', 'seqof', 'set', 'setof', 'objid', 'bool',\n  'gentime', 'utctime', 'null_', 'enum', 'int', 'objDesc',\n  'bitstr', 'bmpstr', 'charstr', 'genstr', 'graphstr', 'ia5str', 'iso646str',\n  'numstr', 'octstr', 'printstr', 't61str', 'unistr', 'utf8str', 'videostr'\n]\n\n// Public methods list\nconst methods = [\n  'key', 'obj', 'use', 'optional', 'explicit', 'implicit', 'def', 'choice',\n  'any', 'contains'\n].concat(tags)\n\n// Overrided methods list\nconst overrided = [\n  '_peekTag', '_decodeTag', '_use',\n  '_decodeStr', '_decodeObjid', '_decodeTime',\n  '_decodeNull', '_decodeInt', '_decodeBool', '_decodeList',\n\n  '_encodeComposite', '_encodeStr', '_encodeObjid', '_encodeTime',\n  '_encodeNull', '_encodeInt', '_encodeBool'\n]\n\nfunction Node (enc, parent, name) {\n  const state = {}\n  this._baseState = state\n\n  state.name = name\n  state.enc = enc\n\n  state.parent = parent || null\n  state.children = null\n\n  // State\n  state.tag = null\n  state.args = null\n  state.reverseArgs = null\n  state.choice = null\n  state.optional = false\n  state.any = false\n  state.obj = false\n  state.use = null\n  state.useDecoder = null\n  state.key = null\n  state.default = null\n  state.explicit = null\n  state.implicit = null\n  state.contains = null\n\n  // Should create new instance on each method\n  if (!state.parent) {\n    state.children = []\n    this._wrap()\n  }\n}\n\nconst stateProps = [\n  'enc', 'parent', 'children', 'tag', 'args', 'reverseArgs', 'choice',\n  'optional', 'any', 'obj', 'use', 'alteredUse', 'key', 'default', 'explicit',\n  'implicit', 'contains'\n]\n\nNode.prototype.clone = function clone () {\n  const state = this._baseState\n  const cstate = {}\n  stateProps.forEach(function (prop) {\n    cstate[prop] = state[prop]\n  })\n  const res = new this.constructor(cstate.parent)\n  res._baseState = cstate\n  return res\n}\n\nNode.prototype._wrap = function wrap () {\n  const state = this._baseState\n  methods.forEach(function (method) {\n    this[method] = function _wrappedMethod () {\n      const clone = new this.constructor(this)\n      state.children.push(clone)\n      return clone[method].apply(clone, arguments)\n    }\n  }, this)\n}\n\nNode.prototype._init = function init (body) {\n  const state = this._baseState\n\n  assert(state.parent === null)\n  body.call(this)\n\n  // Filter children\n  state.children = state.children.filter(function (child) {\n    return child._baseState.parent === this\n  }, this)\n  assert.equal(state.children.length, 1, 'Root node can have only one child')\n}\n\nNode.prototype._useArgs = function useArgs (args) {\n  const state = this._baseState\n\n  // Filter children and args\n  const children = args.filter(function (arg) {\n    return arg instanceof this.constructor\n  }, this)\n  args = args.filter(function (arg) {\n    return !(arg instanceof this.constructor)\n  }, this)\n\n  if (children.length !== 0) {\n    assert(state.children === null)\n    state.children = children\n\n    // Replace parent to maintain backward link\n    children.forEach(function (child) {\n      child._baseState.parent = this\n    }, this)\n  }\n  if (args.length !== 0) {\n    assert(state.args === null)\n    state.args = args\n    state.reverseArgs = args.map(function (arg) {\n      if (typeof arg !== 'object' || arg.constructor !== Object) { return arg }\n\n      const res = {}\n      Object.keys(arg).forEach(function (key) {\n        if (key == (key | 0)) { key |= 0 } // eslint-disable-line eqeqeq\n        const value = arg[key]\n        res[value] = key\n      })\n      return res\n    })\n  }\n}\n\n//\n// Overrided methods\n//\n\noverrided.forEach(function (method) {\n  Node.prototype[method] = function _overrided () {\n    const state = this._baseState\n    throw new Error(`${method} not implemented for encoding: ${state.enc}`)\n  }\n})\n\n//\n// Public methods\n//\n\ntags.forEach(function (tag) {\n  Node.prototype[tag] = function _tagMethod () {\n    const state = this._baseState\n    const args = Array.prototype.slice.call(arguments)\n\n    assert(state.tag === null)\n    state.tag = tag\n\n    this._useArgs(args)\n\n    return this\n  }\n})\n\nNode.prototype.use = function use (item) {\n  assert(item)\n  const state = this._baseState\n\n  assert(state.use === null)\n  state.use = item\n\n  return this\n}\n\nNode.prototype.optional = function optional () {\n  const state = this._baseState\n\n  state.optional = true\n\n  return this\n}\n\nNode.prototype.def = function def (val) {\n  const state = this._baseState\n\n  assert(state.default === null)\n  state.default = val\n  state.optional = true\n\n  return this\n}\n\nNode.prototype.explicit = function explicit (num) {\n  const state = this._baseState\n\n  assert(state.explicit === null && state.implicit === null)\n  state.explicit = num\n\n  return this\n}\n\nNode.prototype.implicit = function implicit (num) {\n  const state = this._baseState\n\n  assert(state.explicit === null && state.implicit === null)\n  state.implicit = num\n\n  return this\n}\n\nNode.prototype.obj = function obj () {\n  const state = this._baseState\n  const args = Array.prototype.slice.call(arguments)\n\n  state.obj = true\n\n  if (args.length !== 0) { this._useArgs(args) }\n\n  return this\n}\n\nNode.prototype.key = function key (newKey) {\n  const state = this._baseState\n\n  assert(state.key === null)\n  state.key = newKey\n\n  return this\n}\n\nNode.prototype.any = function any () {\n  const state = this._baseState\n\n  state.any = true\n\n  return this\n}\n\nNode.prototype.choice = function choice (obj) {\n  const state = this._baseState\n\n  assert(state.choice === null)\n  state.choice = obj\n  this._useArgs(Object.keys(obj).map(function (key) {\n    return obj[key]\n  }))\n\n  return this\n}\n\nNode.prototype.contains = function contains (item) {\n  const state = this._baseState\n\n  assert(state.use === null)\n  state.contains = item\n\n  return this\n}\n\n//\n// Decoding\n//\n\nNode.prototype._decode = function decode (input, options) {\n  const state = this._baseState\n\n  // Decode root node\n  if (state.parent === null) { return input.wrapResult(state.children[0]._decode(input, options)) }\n\n  let result = state.default\n  let present = true\n\n  let prevKey = null\n  if (state.key !== null) { prevKey = input.enterKey(state.key) }\n\n  // Check if tag is there\n  if (state.optional) {\n    let tag = null\n    if (state.explicit !== null) { tag = state.explicit } else if (state.implicit !== null) { tag = state.implicit } else if (state.tag !== null) { tag = state.tag }\n\n    if (tag === null && !state.any) {\n      // Trial and Error\n      const save = input.save()\n      try {\n        if (state.choice === null) { this._decodeGeneric(state.tag, input, options) } else { this._decodeChoice(input, options) }\n        present = true\n      } catch (e) {\n        present = false\n      }\n      input.restore(save)\n    } else {\n      present = this._peekTag(input, tag, state.any)\n\n      if (input.isError(present)) { return present }\n    }\n  }\n\n  // Push object on stack\n  let prevObj\n  if (state.obj && present) { prevObj = input.enterObject() }\n\n  if (present) {\n    // Unwrap explicit values\n    if (state.explicit !== null) {\n      const explicit = this._decodeTag(input, state.explicit)\n      if (input.isError(explicit)) { return explicit }\n      input = explicit\n    }\n\n    const start = input.offset\n\n    // Unwrap implicit and normal values\n    if (state.use === null && state.choice === null) {\n      let save\n      if (state.any) { save = input.save() }\n      const body = this._decodeTag(\n        input,\n        state.implicit !== null ? state.implicit : state.tag,\n        state.any\n      )\n      if (input.isError(body)) { return body }\n\n      if (state.any) { result = input.raw(save) } else { input = body }\n    }\n\n    if (options && options.track && state.tag !== null) { options.track(input.path(), start, input.length, 'tagged') }\n\n    if (options && options.track && state.tag !== null) { options.track(input.path(), input.offset, input.length, 'content') }\n\n    // Select proper method for tag\n    if (state.any) {\n      // no-op\n    } else if (state.choice === null) {\n      result = this._decodeGeneric(state.tag, input, options)\n    } else {\n      result = this._decodeChoice(input, options)\n    }\n\n    if (input.isError(result)) { return result }\n\n    // Decode children\n    if (!state.any && state.choice === null && state.children !== null) {\n      state.children.forEach(function decodeChildren (child) {\n        // NOTE: We are ignoring errors here, to let parser continue with other\n        // parts of encoded data\n        child._decode(input, options)\n      })\n    }\n\n    // Decode contained/encoded by schema, only in bit or octet strings\n    if (state.contains && (state.tag === 'octstr' || state.tag === 'bitstr')) {\n      const data = new DecoderBuffer(result)\n      result = this._getUse(state.contains, input._reporterState.obj)\n        ._decode(data, options)\n    }\n  }\n\n  // Pop object\n  if (state.obj && present) { result = input.leaveObject(prevObj) }\n\n  // Set key\n  if (state.key !== null && (result !== null || present === true)) { input.leaveKey(prevKey, state.key, result) } else if (prevKey !== null) { input.exitKey(prevKey) }\n\n  return result\n}\n\nNode.prototype._decodeGeneric = function decodeGeneric (tag, input, options) {\n  const state = this._baseState\n\n  if (tag === 'seq' || tag === 'set') { return null }\n  if (tag === 'seqof' || tag === 'setof') { return this._decodeList(input, tag, state.args[0], options) } else if (/str$/.test(tag)) { return this._decodeStr(input, tag, options) } else if (tag === 'objid' && state.args) { return this._decodeObjid(input, state.args[0], state.args[1], options) } else if (tag === 'objid') { return this._decodeObjid(input, null, null, options) } else if (tag === 'gentime' || tag === 'utctime') { return this._decodeTime(input, tag, options) } else if (tag === 'null_') { return this._decodeNull(input, options) } else if (tag === 'bool') { return this._decodeBool(input, options) } else if (tag === 'objDesc') { return this._decodeStr(input, tag, options) } else if (tag === 'int' || tag === 'enum') { return this._decodeInt(input, state.args && state.args[0], options) }\n\n  if (state.use !== null) {\n    return this._getUse(state.use, input._reporterState.obj)\n      ._decode(input, options)\n  } else {\n    return input.error(`unknown tag: ${tag}`)\n  }\n}\n\nNode.prototype._getUse = function _getUse (entity, obj) {\n  const state = this._baseState\n  // Create altered use decoder if implicit is set\n  state.useDecoder = this._use(entity, obj)\n  assert(state.useDecoder._baseState.parent === null)\n  state.useDecoder = state.useDecoder._baseState.children[0]\n  if (state.implicit !== state.useDecoder._baseState.implicit) {\n    state.useDecoder = state.useDecoder.clone()\n    state.useDecoder._baseState.implicit = state.implicit\n  }\n  return state.useDecoder\n}\n\nNode.prototype._decodeChoice = function decodeChoice (input, options) {\n  const state = this._baseState\n  let result = null\n  let match = false\n\n  Object.keys(state.choice).some(function (key) {\n    const save = input.save()\n    const node = state.choice[key]\n    try {\n      const value = node._decode(input, options)\n      if (input.isError(value)) { return false }\n\n      result = { type: key, value: value }\n      match = true\n    } catch (e) {\n      input.restore(save)\n      return false\n    }\n    return true\n  }, this)\n\n  if (!match) { return input.error('Choice not matched') }\n\n  return result\n}\n\n//\n// Encoding\n//\n\nNode.prototype._createEncoderBuffer = function createEncoderBuffer (data) {\n  return new EncoderBuffer(data, this.reporter)\n}\n\nNode.prototype._encode = function encode (data, reporter, parent) {\n  const state = this._baseState\n  if (state.default !== null && state.default === data) { return }\n\n  const result = this._encodeValue(data, reporter, parent)\n  if (result === undefined) { return }\n\n  if (this._skipDefault(result, reporter, parent)) { return }\n\n  return result\n}\n\nNode.prototype._encodeValue = function encode (data, reporter, parent) {\n  const state = this._baseState\n\n  // Decode root node\n  if (state.parent === null) { return state.children[0]._encode(data, reporter || new Reporter()) }\n\n  let result = null\n\n  // Set reporter to share it with a child class\n  this.reporter = reporter\n\n  // Check if data is there\n  if (state.optional && data === undefined) {\n    if (state.default !== null) { data = state.default } else { return }\n  }\n\n  // Encode children first\n  let content = null\n  let primitive = false\n  if (state.any) {\n    // Anything that was given is translated to buffer\n    result = this._createEncoderBuffer(data)\n  } else if (state.choice) {\n    result = this._encodeChoice(data, reporter)\n  } else if (state.contains) {\n    content = this._getUse(state.contains, parent)._encode(data, reporter)\n    primitive = true\n  } else if (state.children) {\n    content = state.children.map(function (child) {\n      if (child._baseState.tag === 'null_') { return child._encode(null, reporter, data) }\n\n      if (child._baseState.key === null) { return reporter.error('Child should have a key') }\n      const prevKey = reporter.enterKey(child._baseState.key)\n\n      if (typeof data !== 'object') { return reporter.error('Child expected, but input is not object') }\n\n      const res = child._encode(data[child._baseState.key], reporter, data)\n      reporter.leaveKey(prevKey)\n\n      return res\n    }, this).filter(function (child) {\n      return child\n    })\n    content = this._createEncoderBuffer(content)\n  } else {\n    if (state.tag === 'seqof' || state.tag === 'setof') {\n      if (!(state.args && state.args.length === 1)) { return reporter.error(`Too many args for: ${state.tag}`) }\n\n      if (!Array.isArray(data)) { return reporter.error('seqof/setof, but data is not Array') }\n\n      const child = this.clone()\n      child._baseState.implicit = null\n      content = this._createEncoderBuffer(data.map(function (item) {\n        const state = this._baseState\n\n        return this._getUse(state.args[0], data)._encode(item, reporter)\n      }, child))\n    } else if (state.use !== null) {\n      result = this._getUse(state.use, parent)._encode(data, reporter)\n    } else {\n      content = this._encodePrimitive(state.tag, data)\n      primitive = true\n    }\n  }\n\n  // Encode data itself\n  if (!state.any && state.choice === null) {\n    const tag = state.implicit !== null ? state.implicit : state.tag\n    const cls = state.implicit === null ? 'universal' : 'context'\n\n    if (tag === null) {\n      if (state.use === null) { reporter.error('Tag could be omitted only for .use()') }\n    } else {\n      if (state.use === null) { result = this._encodeComposite(tag, primitive, cls, content) }\n    }\n  }\n\n  // Wrap in explicit\n  if (state.explicit !== null) { result = this._encodeComposite(state.explicit, false, 'context', result) }\n\n  return result\n}\n\nNode.prototype._encodeChoice = function encodeChoice (data, reporter) {\n  const state = this._baseState\n\n  const node = state.choice[data.type]\n  if (!node) {\n    assert(\n      false,\n      `${data.type} not found in ${JSON.stringify(Object.keys(state.choice))}`\n    )\n  }\n  return node._encode(data.value, reporter)\n}\n\nNode.prototype._encodePrimitive = function encodePrimitive (tag, data) {\n  const state = this._baseState\n\n  if (/str$/.test(tag)) { return this._encodeStr(data, tag) } else if (tag === 'objid' && state.args) { return this._encodeObjid(data, state.reverseArgs[0], state.args[1]) } else if (tag === 'objid') { return this._encodeObjid(data, null, null) } else if (tag === 'gentime' || tag === 'utctime') { return this._encodeTime(data, tag) } else if (tag === 'null_') { return this._encodeNull() } else if (tag === 'int' || tag === 'enum') { return this._encodeInt(data, state.args && state.reverseArgs[0]) } else if (tag === 'bool') { return this._encodeBool(data) } else if (tag === 'objDesc') { return this._encodeStr(data, tag) } else { throw new Error(`Unsupported tag: ${tag}`) }\n}\n\nNode.prototype._isNumstr = function isNumstr (str) {\n  return /^[0-9 ]*$/.test(str)\n}\n\nNode.prototype._isPrintstr = function isPrintstr (str) {\n  return /^[A-Za-z0-9 '()+,-./:=?]*$/.test(str)\n}\n\nmodule.exports = Node\n", "// Helper\nfunction reverse (map) {\n  const res = {}\n\n  Object.keys(map).forEach(function (key) {\n    // Convert key to integer if it is stringified\n    if ((key | 0) == key) { key = key | 0 } // eslint-disable-line eqeqeq\n\n    const value = map[key]\n    res[value] = key\n  })\n\n  return res\n}\n\nexports.tagClass = {\n  0: 'universal',\n  1: 'application',\n  2: 'context',\n  3: 'private'\n}\nexports.tagClassByName = reverse(exports.tagClass)\n\nexports.tag = {\n  0x00: 'end',\n  0x01: 'bool',\n  0x02: 'int',\n  0x03: 'bitstr',\n  0x04: 'octstr',\n  0x05: 'null_',\n  0x06: 'objid',\n  0x07: 'objDesc',\n  0x08: 'external',\n  0x09: 'real',\n  0x0a: 'enum',\n  0x0b: 'embed',\n  0x0c: 'utf8str',\n  0x0d: 'relativeOid',\n  0x10: 'seq',\n  0x11: 'set',\n  0x12: 'numstr',\n  0x13: 'printstr',\n  0x14: 't61str',\n  0x15: 'videostr',\n  0x16: 'ia5str',\n  0x17: 'utctime',\n  0x18: 'gentime',\n  0x19: 'graphstr',\n  0x1a: 'iso646str',\n  0x1b: 'genstr',\n  0x1c: 'unistr',\n  0x1d: 'charstr',\n  0x1e: 'bmpstr'\n}\nexports.tagByName = reverse(exports.tag)\n", "/* global BigInt */\nconst { inherits } = require('util')\n\nconst Node = require('../base/node')\nconst der = require('../constants/der')\n\nfunction DEREncoder (entity) {\n  this.enc = 'der'\n  this.name = entity.name\n  this.entity = entity\n\n  // Construct base tree\n  this.tree = new DERNode()\n  this.tree._init(entity.body)\n}\n\nDEREncoder.prototype.encode = function encode (data, reporter) {\n  return this.tree._encode(data, reporter).join()\n}\n\n// Tree methods\n\nfunction DERNode (parent) {\n  Node.call(this, 'der', parent)\n}\ninherits(DERNode, Node)\n\nDERNode.prototype._encodeComposite = function encodeComposite (tag,\n  primitive,\n  cls,\n  content) {\n  const encodedTag = encodeTag(tag, primitive, cls, this.reporter)\n\n  // Short form\n  if (content.length < 0x80) {\n    const header = Buffer.alloc(2)\n    header[0] = encodedTag\n    header[1] = content.length\n    return this._createEncoderBuffer([header, content])\n  }\n\n  // Long form\n  // Count octets required to store length\n  let lenOctets = 1\n  for (let i = content.length; i >= 0x100; i >>= 8) { lenOctets++ }\n\n  const header = Buffer.alloc(1 + 1 + lenOctets)\n  header[0] = encodedTag\n  header[1] = 0x80 | lenOctets\n\n  for (let i = 1 + lenOctets, j = content.length; j > 0; i--, j >>= 8) { header[i] = j & 0xff }\n\n  return this._createEncoderBuffer([header, content])\n}\n\nDERNode.prototype._encodeStr = function encodeStr (str, tag) {\n  if (tag === 'bitstr') {\n    return this._createEncoderBuffer([str.unused | 0, str.data])\n  } else if (tag === 'bmpstr') {\n    const buf = Buffer.alloc(str.length * 2)\n    for (let i = 0; i < str.length; i++) {\n      buf.writeUInt16BE(str.charCodeAt(i), i * 2)\n    }\n    return this._createEncoderBuffer(buf)\n  } else if (tag === 'numstr') {\n    if (!this._isNumstr(str)) {\n      return this.reporter.error('Encoding of string type: numstr supports only digits and space')\n    }\n    return this._createEncoderBuffer(str)\n  } else if (tag === 'printstr') {\n    if (!this._isPrintstr(str)) {\n      return this.reporter.error('Encoding of string type: printstr supports only latin upper and lower case letters, digits, space, apostrophe, left and rigth parenthesis, plus sign, comma, hyphen, dot, slash, colon, equal sign, question mark')\n    }\n    return this._createEncoderBuffer(str)\n  } else if (/str$/.test(tag)) {\n    return this._createEncoderBuffer(str)\n  } else if (tag === 'objDesc') {\n    return this._createEncoderBuffer(str)\n  } else {\n    return this.reporter.error(`Encoding of string type: ${tag} unsupported`)\n  }\n}\n\nDERNode.prototype._encodeObjid = function encodeObjid (id, values, relative) {\n  if (typeof id === 'string') {\n    if (!values) { return this.reporter.error('string objid given, but no values map found') }\n    if (!Object.prototype.hasOwnProperty.call(values, id)) { return this.reporter.error('objid not found in values map') }\n    id = values[id].split(/[\\s.]+/g)\n    for (let i = 0; i < id.length; i++) { id[i] |= 0 }\n  } else if (Array.isArray(id)) {\n    id = id.slice()\n    for (let i = 0; i < id.length; i++) { id[i] |= 0 }\n  }\n\n  if (!Array.isArray(id)) {\n    return this.reporter.error(`objid() should be either array or string, got: ${JSON.stringify(id)}`)\n  }\n\n  if (!relative) {\n    if (id[1] >= 40) { return this.reporter.error('Second objid identifier OOB') }\n    id.splice(0, 2, id[0] * 40 + id[1])\n  }\n\n  // Count number of octets\n  let size = 0\n  for (let i = 0; i < id.length; i++) {\n    let ident = id[i]\n    for (size++; ident >= 0x80; ident >>= 7) { size++ }\n  }\n\n  const objid = Buffer.alloc(size)\n  let offset = objid.length - 1\n  for (let i = id.length - 1; i >= 0; i--) {\n    let ident = id[i]\n    objid[offset--] = ident & 0x7f\n    while ((ident >>= 7) > 0) { objid[offset--] = 0x80 | (ident & 0x7f) }\n  }\n\n  return this._createEncoderBuffer(objid)\n}\n\nfunction two (num) {\n  if (num < 10) { return `0${num}` } else { return num }\n}\n\nDERNode.prototype._encodeTime = function encodeTime (time, tag) {\n  let str\n  const date = new Date(time)\n\n  if (tag === 'gentime') {\n    str = [\n      two(date.getUTCFullYear()),\n      two(date.getUTCMonth() + 1),\n      two(date.getUTCDate()),\n      two(date.getUTCHours()),\n      two(date.getUTCMinutes()),\n      two(date.getUTCSeconds()),\n      'Z'\n    ].join('')\n  } else if (tag === 'utctime') {\n    str = [\n      two(date.getUTCFullYear() % 100),\n      two(date.getUTCMonth() + 1),\n      two(date.getUTCDate()),\n      two(date.getUTCHours()),\n      two(date.getUTCMinutes()),\n      two(date.getUTCSeconds()),\n      'Z'\n    ].join('')\n  } else {\n    this.reporter.error(`Encoding ${tag} time is not supported yet`)\n  }\n\n  return this._encodeStr(str, 'octstr')\n}\n\nDERNode.prototype._encodeNull = function encodeNull () {\n  return this._createEncoderBuffer('')\n}\n\nfunction bnToBuf (bn) {\n  var hex = BigInt(bn).toString(16)\n  if (hex.length % 2) { hex = '0' + hex }\n\n  var len = hex.length / 2\n  var u8 = new Uint8Array(len)\n\n  var i = 0\n  var j = 0\n  while (i < len) {\n    u8[i] = parseInt(hex.slice(j, j + 2), 16)\n    i += 1\n    j += 2\n  }\n\n  return u8\n}\n\nDERNode.prototype._encodeInt = function encodeInt (num, values) {\n  if (typeof num === 'string') {\n    if (!values) { return this.reporter.error('String int or enum given, but no values map') }\n    if (!Object.prototype.hasOwnProperty.call(values, num)) {\n      return this.reporter.error(`Values map doesn't contain: ${JSON.stringify(num)}`)\n    }\n    num = values[num]\n  }\n\n  if (typeof num === 'bigint') {\n    const numArray = [...bnToBuf(num)]\n    if (numArray[0] & 0x80) {\n      numArray.unshift(0)\n    }\n    num = Buffer.from(numArray)\n  }\n\n  if (Buffer.isBuffer(num)) {\n    let size = num.length\n    if (num.length === 0) { size++ }\n\n    const out = Buffer.alloc(size)\n    num.copy(out)\n    if (num.length === 0) { out[0] = 0 }\n    return this._createEncoderBuffer(out)\n  }\n\n  if (num < 0x80) { return this._createEncoderBuffer(num) }\n\n  if (num < 0x100) { return this._createEncoderBuffer([0, num]) }\n\n  let size = 1\n  for (let i = num; i >= 0x100; i >>= 8) { size++ }\n\n  const out = new Array(size)\n  for (let i = out.length - 1; i >= 0; i--) {\n    out[i] = num & 0xff\n    num >>= 8\n  }\n  if (out[0] & 0x80) {\n    out.unshift(0)\n  }\n\n  return this._createEncoderBuffer(Buffer.from(out))\n}\n\nDERNode.prototype._encodeBool = function encodeBool (value) {\n  return this._createEncoderBuffer(value ? 0xff : 0)\n}\n\nDERNode.prototype._use = function use (entity, obj) {\n  if (typeof entity === 'function') { entity = entity(obj) }\n  return entity._getEncoder('der').tree\n}\n\nDERNode.prototype._skipDefault = function skipDefault (dataBuffer, reporter, parent) {\n  const state = this._baseState\n  let i\n  if (state.default === null) { return false }\n\n  const data = dataBuffer.join()\n  if (state.defaultBuffer === undefined) { state.defaultBuffer = this._encodeValue(state.default, reporter, parent).join() }\n\n  if (data.length !== state.defaultBuffer.length) { return false }\n\n  for (i = 0; i < data.length; i++) {\n    if (data[i] !== state.defaultBuffer[i]) { return false }\n  }\n\n  return true\n}\n\n// Utility methods\n\nfunction encodeTag (tag, primitive, cls, reporter) {\n  let res\n\n  if (tag === 'seqof') { tag = 'seq' } else if (tag === 'setof') { tag = 'set' }\n\n  if (Object.prototype.hasOwnProperty.call(der.tagByName, tag)) { res = der.tagByName[tag] } else if (typeof tag === 'number' && (tag | 0) === tag) { res = tag } else { return reporter.error(`Unknown tag: ${tag}`) }\n\n  if (res >= 0x1f) { return reporter.error('Multi-octet tag encoding unsupported') }\n\n  if (!primitive) { res |= 0x20 }\n\n  res |= (der.tagClassByName[cls || 'universal'] << 6)\n\n  return res\n}\n\nmodule.exports = DEREncoder\n", "const { inherits } = require('util')\n\nconst DEREncoder = require('./der')\n\nfunction PEMEncoder (entity) {\n  DEREncoder.call(this, entity)\n  this.enc = 'pem'\n}\ninherits(PEMEncoder, DEREncoder)\n\nPEMEncoder.prototype.encode = function encode (data, options) {\n  const buf = DEREncoder.prototype.encode.call(this, data)\n\n  const p = buf.toString('base64')\n  const out = [`-----BEGIN ${options.label}-----`]\n  for (let i = 0; i < p.length; i += 64) { out.push(p.slice(i, i + 64)) }\n  out.push(`-----END ${options.label}-----`)\n  return out.join('\\n')\n}\n\nmodule.exports = PEMEncoder\n", "module.exports = {\n  der: require('./der'),\n  pem: require('./pem')\n}\n", "/* global BigInt */\nconst { inherits } = require('util')\n\nconst { DecoderBuffer } = require('../base/buffer')\nconst Node = require('../base/node')\n\n// Import DER constants\nconst der = require('../constants/der')\n\nfunction DERDecoder (entity) {\n  this.enc = 'der'\n  this.name = entity.name\n  this.entity = entity\n\n  // Construct base tree\n  this.tree = new DERNode()\n  this.tree._init(entity.body)\n}\n\nDERDecoder.prototype.decode = function decode (data, options) {\n  if (!DecoderBuffer.isDecoderBuffer(data)) {\n    data = new DecoderBuffer(data, options)\n  }\n\n  return this.tree._decode(data, options)\n}\n\n// Tree methods\n\nfunction DERNode (parent) {\n  Node.call(this, 'der', parent)\n}\ninherits(DERNode, Node)\n\nDERNode.prototype._peekTag = function peekTag (buffer, tag, any) {\n  if (buffer.isEmpty()) { return false }\n\n  const state = buffer.save()\n  const decodedTag = derDecodeTag(buffer, `Failed to peek tag: \"${tag}\"`)\n  if (buffer.isError(decodedTag)) { return decodedTag }\n\n  buffer.restore(state)\n\n  return decodedTag.tag === tag || decodedTag.tagStr === tag || (decodedTag.tagStr + 'of') === tag || any\n}\n\nDERNode.prototype._decodeTag = function decodeTag (buffer, tag, any) {\n  const decodedTag = derDecodeTag(buffer,\n    `Failed to decode tag of \"${tag}\"`)\n  if (buffer.isError(decodedTag)) { return decodedTag }\n\n  let len = derDecodeLen(buffer,\n    decodedTag.primitive,\n    `Failed to get length of \"${tag}\"`)\n\n  // Failure\n  if (buffer.isError(len)) { return len }\n\n  if (!any &&\n      decodedTag.tag !== tag &&\n      decodedTag.tagStr !== tag &&\n      decodedTag.tagStr + 'of' !== tag) {\n    return buffer.error(`Failed to match tag: \"${tag}\"`)\n  }\n\n  if (decodedTag.primitive || len !== null) { return buffer.skip(len, `Failed to match body of: \"${tag}\"`) }\n\n  // Indefinite length... find END tag\n  const state = buffer.save()\n  const res = this._skipUntilEnd(\n    buffer,\n    `Failed to skip indefinite length body: \"${this.tag}\"`)\n  if (buffer.isError(res)) { return res }\n\n  len = buffer.offset - state.offset\n  buffer.restore(state)\n  return buffer.skip(len, `Failed to match body of: \"${tag}\"`)\n}\n\nDERNode.prototype._skipUntilEnd = function skipUntilEnd (buffer, fail) {\n  for (;;) {\n    const tag = derDecodeTag(buffer, fail)\n    if (buffer.isError(tag)) { return tag }\n    const len = derDecodeLen(buffer, tag.primitive, fail)\n    if (buffer.isError(len)) { return len }\n\n    let res\n    if (tag.primitive || len !== null) { res = buffer.skip(len) } else { res = this._skipUntilEnd(buffer, fail) }\n\n    // Failure\n    if (buffer.isError(res)) { return res }\n\n    if (tag.tagStr === 'end') { break }\n  }\n}\n\nDERNode.prototype._decodeList = function decodeList (buffer, tag, decoder,\n  options) {\n  const result = []\n  while (!buffer.isEmpty()) {\n    const possibleEnd = this._peekTag(buffer, 'end')\n    if (buffer.isError(possibleEnd)) { return possibleEnd }\n\n    const res = decoder.decode(buffer, 'der', options)\n    if (buffer.isError(res) && possibleEnd) { break }\n    result.push(res)\n  }\n  return result\n}\n\nDERNode.prototype._decodeStr = function decodeStr (buffer, tag) {\n  if (tag === 'bitstr') {\n    const unused = buffer.readUInt8()\n    if (buffer.isError(unused)) { return unused }\n    return { unused: unused, data: buffer.raw() }\n  } else if (tag === 'bmpstr') {\n    const raw = buffer.raw()\n    if (raw.length % 2 === 1) { return buffer.error('Decoding of string type: bmpstr length mismatch') }\n\n    let str = ''\n    for (let i = 0; i < raw.length / 2; i++) {\n      str += String.fromCharCode(raw.readUInt16BE(i * 2))\n    }\n    return str\n  } else if (tag === 'numstr') {\n    const numstr = buffer.raw().toString('ascii')\n    if (!this._isNumstr(numstr)) {\n      return buffer.error('Decoding of string type: numstr unsupported characters')\n    }\n    return numstr\n  } else if (tag === 'octstr') {\n    return buffer.raw()\n  } else if (tag === 'objDesc') {\n    return buffer.raw()\n  } else if (tag === 'printstr') {\n    const printstr = buffer.raw().toString('ascii')\n    if (!this._isPrintstr(printstr)) {\n      return buffer.error('Decoding of string type: printstr unsupported characters')\n    }\n    return printstr\n  } else if (/str$/.test(tag)) {\n    return buffer.raw().toString()\n  } else {\n    return buffer.error(`Decoding of string type: ${tag} unsupported`)\n  }\n}\n\nDERNode.prototype._decodeObjid = function decodeObjid (buffer, values, relative) {\n  let result\n  const identifiers = []\n  let ident = 0\n  let subident = 0\n  while (!buffer.isEmpty()) {\n    subident = buffer.readUInt8()\n    ident <<= 7\n    ident |= subident & 0x7f\n    if ((subident & 0x80) === 0) {\n      identifiers.push(ident)\n      ident = 0\n    }\n  }\n  if (subident & 0x80) { identifiers.push(ident) }\n\n  const first = (identifiers[0] / 40) | 0\n  const second = identifiers[0] % 40\n\n  if (relative) { result = identifiers } else { result = [first, second].concat(identifiers.slice(1)) }\n\n  if (values) {\n    let tmp = values[result.join(' ')]\n    if (tmp === undefined) { tmp = values[result.join('.')] }\n    if (tmp !== undefined) { result = tmp }\n  }\n\n  return result\n}\n\nDERNode.prototype._decodeTime = function decodeTime (buffer, tag) {\n  const str = buffer.raw().toString()\n\n  let year\n  let mon\n  let day\n  let hour\n  let min\n  let sec\n  if (tag === 'gentime') {\n    year = str.slice(0, 4) | 0\n    mon = str.slice(4, 6) | 0\n    day = str.slice(6, 8) | 0\n    hour = str.slice(8, 10) | 0\n    min = str.slice(10, 12) | 0\n    sec = str.slice(12, 14) | 0\n  } else if (tag === 'utctime') {\n    year = str.slice(0, 2) | 0\n    mon = str.slice(2, 4) | 0\n    day = str.slice(4, 6) | 0\n    hour = str.slice(6, 8) | 0\n    min = str.slice(8, 10) | 0\n    sec = str.slice(10, 12) | 0\n    if (year < 70) { year = 2000 + year } else { year = 1900 + year }\n  } else {\n    return buffer.error(`Decoding ${tag} time is not supported yet`)\n  }\n\n  return Date.UTC(year, mon - 1, day, hour, min, sec, 0)\n}\n\nDERNode.prototype._decodeNull = function decodeNull () {\n  return null\n}\n\nDERNode.prototype._decodeBool = function decodeBool (buffer) {\n  const res = buffer.readUInt8()\n  if (buffer.isError(res)) { return res } else { return res !== 0 }\n}\n\nDERNode.prototype._decodeInt = function decodeInt (buffer, values) {\n  // Bigint, return as it is (assume big endian)\n  const raw = buffer.raw()\n  let res = BigInt(`0x${raw.toString('hex')}`)\n\n  if (values) {\n    res = values[res.toString(10)] || res\n  }\n\n  return res\n}\n\nDERNode.prototype._use = function use (entity, obj) {\n  if (typeof entity === 'function') { entity = entity(obj) }\n  return entity._getDecoder('der').tree\n}\n\n// Utility methods\n\nfunction derDecodeTag (buf, fail) {\n  let tag = buf.readUInt8(fail)\n  if (buf.isError(tag)) { return tag }\n\n  const cls = der.tagClass[tag >> 6]\n  const primitive = (tag & 0x20) === 0\n\n  // Multi-octet tag - load\n  if ((tag & 0x1f) === 0x1f) {\n    let oct = tag\n    tag = 0\n    while ((oct & 0x80) === 0x80) {\n      oct = buf.readUInt8(fail)\n      if (buf.isError(oct)) { return oct }\n\n      tag <<= 7\n      tag |= oct & 0x7f\n    }\n  } else {\n    tag &= 0x1f\n  }\n  const tagStr = der.tag[tag]\n\n  return {\n    cls: cls,\n    primitive: primitive,\n    tag: tag,\n    tagStr: tagStr\n  }\n}\n\nfunction derDecodeLen (buf, primitive, fail) {\n  let len = buf.readUInt8(fail)\n  if (buf.isError(len)) { return len }\n\n  // Indefinite form\n  if (!primitive && len === 0x80) { return null }\n\n  // Definite form\n  if ((len & 0x80) === 0) {\n    // Short form\n    return len\n  }\n\n  // Long form\n  const num = len & 0x7f\n  if (num > 4) { return buf.error('length octect is too long') }\n\n  len = 0\n  for (let i = 0; i < num; i++) {\n    len <<= 8\n    const j = buf.readUInt8(fail)\n    if (buf.isError(j)) { return j }\n    len |= j\n  }\n\n  return len\n}\n\nmodule.exports = DERDecoder\n", "const { inherits } = require('util')\n\nconst DERDecoder = require('./der')\n\nfunction PEMDecoder (entity) {\n  DERDecoder.call(this, entity)\n  this.enc = 'pem'\n}\ninherits(PEMDecoder, DERDecoder)\n\nPEMDecoder.prototype.decode = function decode (data, options) {\n  const lines = data.toString().split(/[\\r\\n]+/g)\n\n  const label = options.label.toUpperCase()\n\n  const re = /^-----(BEGIN|END) ([^-]+)-----$/\n  let start = -1\n  let end = -1\n  for (let i = 0; i < lines.length; i++) {\n    const match = lines[i].match(re)\n    if (match === null) { continue }\n\n    if (match[2] !== label) { continue }\n\n    if (start === -1) {\n      if (match[1] !== 'BEGIN') { break }\n      start = i\n    } else {\n      if (match[1] !== 'END') { break }\n      end = i\n      break\n    }\n  }\n  if (start === -1 || end === -1) { throw new Error(`PEM section not found for: ${label}`) }\n\n  const base64 = lines.slice(start + 1, end).join('')\n  // Remove excessive symbols\n  base64.replace(/[^a-z0-9+/=]+/gi, '')\n\n  const input = Buffer.from(base64, 'base64')\n  return DERDecoder.prototype.decode.call(this, input, options)\n}\n\nmodule.exports = PEMDecoder\n", "module.exports = {\n  der: require('./der'),\n  pem: require('./pem')\n}\n", "const { inherits } = require('util')\nconst encoders = require('./encoders')\nconst decoders = require('./decoders')\n\nmodule.exports.define = function define (name, body) {\n  return new Entity(name, body)\n}\n\nfunction Entity (name, body) {\n  this.name = name\n  this.body = body\n\n  this.decoders = {}\n  this.encoders = {}\n}\n\nEntity.prototype._createNamed = function createNamed (Base) {\n  const name = this.name\n\n  function Generated (entity) {\n    this._initNamed(entity, name)\n  }\n  inherits(Generated, Base)\n  Generated.prototype._initNamed = function _initNamed (entity, name) {\n    Base.call(this, entity, name)\n  }\n\n  return new Generated(this)\n}\n\nEntity.prototype._getDecoder = function _getDecoder (enc) {\n  enc = enc || 'der'\n  // Lazily create decoder\n  if (!Object.prototype.hasOwnProperty.call(this.decoders, enc)) { this.decoders[enc] = this._createNamed(decoders[enc]) }\n  return this.decoders[enc]\n}\n\nEntity.prototype.decode = function decode (data, enc, options) {\n  return this._getDecoder(enc).decode(data, options)\n}\n\nEntity.prototype._getEncoder = function _getEncoder (enc) {\n  enc = enc || 'der'\n  // Lazily create encoder\n  if (!Object.prototype.hasOwnProperty.call(this.encoders, enc)) { this.encoders[enc] = this._createNamed(encoders[enc]) }\n  return this.encoders[enc]\n}\n\nEntity.prototype.encode = function encode (data, enc, /* internal */ reporter) {\n  return this._getEncoder(enc).encode(data, reporter)\n}\n", "const { Reporter } = require('./reporter')\nconst { DecoderBuffer, EncoderBuffer } = require('./buffer')\nconst Node = require('./node')\n\nmodule.exports = {\n  DecoderBuffer,\n  EncoderBuffer,\n  Node,\n  Reporter\n}\n", "module.exports = {\n  der: require('./der')\n}\n", "const { define } = require('./asn1/api')\nconst base = require('./asn1/base')\nconst constants = require('./asn1/constants')\nconst decoders = require('./asn1/decoders')\nconst encoders = require('./asn1/encoders')\n\nmodule.exports = {\n  base,\n  constants,\n  decoders,\n  define,\n  encoders\n}\n", "const { name: secp256k1 } = require('../../jwk/key/secp256k1_crv')\n\nconst oids = {\n  '1 2 840 10045 3 1 7': 'P-256',\n  '1 3 132 0 10': secp256k1,\n  '1 3 132 0 34': 'P-384',\n  '1 3 132 0 35': 'P-521',\n  '1 2 840 10045 2 1': 'ecPublicKey',\n  '1 2 840 113549 1 1 1': 'rsaEncryption',\n  '1 3 101 110': 'X25519',\n  '1 3 101 111': 'X448',\n  '1 3 101 112': 'Ed25519',\n  '1 3 101 113': 'Ed448'\n}\n\nmodule.exports = oids\n", "const oids = require('./oids')\n\nmodule.exports = function () {\n  this.seq().obj(\n    this.key('algorithm').objid(oids),\n    this.key('parameters').optional().choice({ namedCurve: this.objid(oids), null: this.null_() })\n  )\n}\n", "const oids = require('./oids')\n\nmodule.exports = function () {\n  this.seq().obj(\n    this.key('version').int(),\n    this.key('privateKey').octstr(),\n    this.key('parameters').explicit(0).optional().choice({ namedCurve: this.objid(oids) }),\n    this.key('publicKey').explicit(1).optional().bitstr()\n  )\n}\n", "module.exports = (AlgorithmIdentifier) => function () {\n  this.seq().obj(\n    this.key('version').int(),\n    this.key('algorithm').use(AlgorithmIdentifier),\n    this.key('privateKey').octstr()\n  )\n}\n", "module.exports = AlgorithmIdentifier => function () {\n  this.seq().obj(\n    this.key('algorithm').use(AlgorithmIdentifier),\n    this.key('publicKey').bitstr()\n  )\n}\n", "module.exports = function () {\n  this.octstr().contains().obj(\n    this.key('privateKey').octstr()\n  )\n}\n", "module.exports = (AlgorithmIdentifier, PrivateKey) => function () {\n  this.seq().obj(\n    this.key('version').int(),\n    this.key('algorithm').use(AlgorithmIdentifier),\n    this.key('privateKey').use(PrivateKey)\n  )\n}\n", "module.exports = function () {\n  this.seq().obj(\n    this.key('version').int({ 0: 'two-prime', 1: 'multi' }),\n    this.key('n').int(),\n    this.key('e').int(),\n    this.key('d').int(),\n    this.key('p').int(),\n    this.key('q').int(),\n    this.key('dp').int(),\n    this.key('dq').int(),\n    this.key('qi').int()\n  )\n}\n", "module.exports = function () {\n  this.seq().obj(\n    this.key('n').int(),\n    this.key('e').int()\n  )\n}\n", "const asn1 = require('@panva/asn1.js')\n\nconst types = new Map()\n\nconst AlgorithmIdentifier = asn1.define('AlgorithmIdentifier', require('./algorithm_identifier'))\ntypes.set('AlgorithmIdentifier', AlgorithmIdentifier)\n\nconst ECPrivateKey = asn1.define('ECPrivateKey', require('./ec_private_key'))\ntypes.set('ECPrivateKey', ECPrivateKey)\n\nconst PrivateKeyInfo = asn1.define('PrivateKeyInfo', require('./private_key_info')(AlgorithmIdentifier))\ntypes.set('PrivateKeyInfo', PrivateKeyInfo)\n\nconst PublicKeyInfo = asn1.define('PublicKeyInfo', require('./public_key_info')(AlgorithmIdentifier))\ntypes.set('PublicKeyInfo', PublicKeyInfo)\n\nconst PrivateKey = asn1.define('PrivateKey', require('./private_key'))\ntypes.set('PrivateKey', PrivateKey)\n\nconst OneAsymmetricKey = asn1.define('OneAsymmetricKey', require('./one_asymmetric_key')(AlgorithmIdentifier, PrivateKey))\ntypes.set('OneAsymmetricKey', OneAsymmetricKey)\n\nconst RSAPrivateKey = asn1.define('RSAPrivateKey', require('./rsa_private_key'))\ntypes.set('RSAPrivateKey', RSAPrivateKey)\n\nconst RSAPublicKey = asn1.define('RSAPublicKey', require('./rsa_public_key'))\ntypes.set('RSAPublicKey', RSAPublicKey)\n\nmodule.exports = types\n", "/* global BigInt */\n\nconst { keyObjectSupported } = require('./runtime_support')\n\nlet createPublicKey\nlet createPrivateKey\nlet createSecretKey\nlet KeyObject\nlet asInput\n\nif (keyObjectSupported) {\n  ({ createPublicKey, createPrivateKey, createSecretKey, KeyObject } = require('crypto'))\n  asInput = (input) => input\n} else {\n  const { EOL } = require('os')\n\n  const errors = require('../errors')\n  const isObject = require('./is_object')\n  const asn1 = require('./asn1')\n  const toInput = Symbol('toInput')\n\n  const namedCurve = Symbol('namedCurve')\n\n  asInput = (keyObject, needsPublic) => {\n    if (keyObject instanceof KeyObject) {\n      return keyObject[toInput](needsPublic)\n    }\n\n    return createSecretKey(keyObject)[toInput](needsPublic)\n  }\n\n  const pemToDer = pem => Buffer.from(pem.replace(/(?:-----(?:BEGIN|END)(?: (?:RSA|EC))? (?:PRIVATE|PUBLIC) KEY-----|\\s)/g, ''), 'base64')\n  const derToPem = (der, label) => `-----BEGIN ${label}-----${EOL}${(der.toString('base64').match(/.{1,64}/g) || []).join(EOL)}${EOL}-----END ${label}-----`\n  const unsupported = (input) => {\n    const label = typeof input === 'string' ? input : `OID ${input.join('.')}`\n    throw new errors.JOSENotSupported(`${label} is not supported in your Node.js runtime version`)\n  }\n\n  KeyObject = class KeyObject {\n    export ({ cipher, passphrase, type, format } = {}) {\n      if (this._type === 'secret') {\n        return this._buffer\n      }\n\n      if (this._type === 'public') {\n        if (this.asymmetricKeyType === 'rsa') {\n          switch (type) {\n            case 'pkcs1':\n              if (format === 'pem') {\n                return this._pem\n              }\n\n              return pemToDer(this._pem)\n            case 'spki': {\n              const PublicKeyInfo = asn1.get('PublicKeyInfo')\n              const pem = PublicKeyInfo.encode({\n                algorithm: {\n                  algorithm: 'rsaEncryption',\n                  parameters: { type: 'null' }\n                },\n                publicKey: {\n                  unused: 0,\n                  data: pemToDer(this._pem)\n                }\n              }, 'pem', { label: 'PUBLIC KEY' })\n\n              return format === 'pem' ? pem : pemToDer(pem)\n            }\n            default:\n              throw new TypeError(`The value ${type} is invalid for option \"type\"`)\n          }\n        }\n\n        if (this.asymmetricKeyType === 'ec') {\n          if (type !== 'spki') {\n            throw new TypeError(`The value ${type} is invalid for option \"type\"`)\n          }\n\n          if (format === 'pem') {\n            return this._pem\n          }\n\n          return pemToDer(this._pem)\n        }\n      }\n\n      if (this._type === 'private') {\n        if (passphrase !== undefined || cipher !== undefined) {\n          throw new errors.JOSENotSupported('encrypted private keys are not supported in your Node.js runtime version')\n        }\n\n        if (type === 'pkcs8') {\n          if (this._pkcs8) {\n            if (format === 'der' && typeof this._pkcs8 === 'string') {\n              return pemToDer(this._pkcs8)\n            }\n\n            if (format === 'pem' && Buffer.isBuffer(this._pkcs8)) {\n              return derToPem(this._pkcs8, 'PRIVATE KEY')\n            }\n\n            return this._pkcs8\n          }\n\n          if (this.asymmetricKeyType === 'rsa') {\n            const parsed = this._asn1\n            const RSAPrivateKey = asn1.get('RSAPrivateKey')\n            const privateKey = RSAPrivateKey.encode(parsed)\n            const PrivateKeyInfo = asn1.get('PrivateKeyInfo')\n            const pkcs8 = PrivateKeyInfo.encode({\n              version: 0,\n              privateKey,\n              algorithm: {\n                algorithm: 'rsaEncryption',\n                parameters: { type: 'null' }\n              }\n            })\n\n            this._pkcs8 = pkcs8\n\n            return this.export({ type, format })\n          }\n\n          if (this.asymmetricKeyType === 'ec') {\n            const parsed = this._asn1\n            const ECPrivateKey = asn1.get('ECPrivateKey')\n            const privateKey = ECPrivateKey.encode({\n              version: parsed.version,\n              privateKey: parsed.privateKey,\n              publicKey: parsed.publicKey\n            })\n            const PrivateKeyInfo = asn1.get('PrivateKeyInfo')\n            const pkcs8 = PrivateKeyInfo.encode({\n              version: 0,\n              privateKey,\n              algorithm: {\n                algorithm: 'ecPublicKey',\n                parameters: this._asn1.parameters\n              }\n            })\n\n            this._pkcs8 = pkcs8\n\n            return this.export({ type, format })\n          }\n        }\n\n        if (this.asymmetricKeyType === 'rsa' && type === 'pkcs1') {\n          if (format === 'pem') {\n            return this._pem\n          }\n\n          return pemToDer(this._pem)\n        } else if (this.asymmetricKeyType === 'ec' && type === 'sec1') {\n          if (format === 'pem') {\n            return this._pem\n          }\n\n          return pemToDer(this._pem)\n        } else {\n          throw new TypeError(`The value ${type} is invalid for option \"type\"`)\n        }\n      }\n    }\n\n    get type () {\n      return this._type\n    }\n\n    get asymmetricKeyType () {\n      return this._asymmetricKeyType\n    }\n\n    get symmetricKeySize () {\n      return this._symmetricKeySize\n    }\n\n    [toInput] (needsPublic) {\n      switch (this._type) {\n        case 'secret':\n          return this._buffer\n        case 'public':\n          return this._pem\n        default:\n          if (needsPublic) {\n            if (!('_pub' in this)) {\n              this._pub = createPublicKey(this)\n            }\n\n            return this._pub[toInput](false)\n          }\n\n          return this._pem\n      }\n    }\n  }\n\n  createSecretKey = (buffer) => {\n    if (!Buffer.isBuffer(buffer) || !buffer.length) {\n      throw new TypeError('input must be a non-empty Buffer instance')\n    }\n\n    const keyObject = new KeyObject()\n    keyObject._buffer = Buffer.from(buffer)\n    keyObject._symmetricKeySize = buffer.length\n    keyObject._type = 'secret'\n\n    return keyObject\n  }\n\n  createPublicKey = (input) => {\n    if (input instanceof KeyObject) {\n      if (input.type !== 'private') {\n        throw new TypeError(`Invalid key object type ${input.type}, expected private.`)\n      }\n\n      switch (input.asymmetricKeyType) {\n        case 'ec': {\n          const PublicKeyInfo = asn1.get('PublicKeyInfo')\n          const key = PublicKeyInfo.encode({\n            algorithm: {\n              algorithm: 'ecPublicKey',\n              parameters: input._asn1.parameters\n            },\n            publicKey: input._asn1.publicKey\n          })\n\n          return createPublicKey({ key, format: 'der', type: 'spki' })\n        }\n        case 'rsa': {\n          const RSAPublicKey = asn1.get('RSAPublicKey')\n          const key = RSAPublicKey.encode(input._asn1)\n          return createPublicKey({ key, format: 'der', type: 'pkcs1' })\n        }\n      }\n    }\n\n    if (typeof input === 'string' || Buffer.isBuffer(input)) {\n      input = { key: input, format: 'pem' }\n    }\n\n    if (!isObject(input)) {\n      throw new TypeError('input must be a string, Buffer or an object')\n    }\n\n    const { format, passphrase } = input\n    let { key, type } = input\n\n    if (typeof key !== 'string' && !Buffer.isBuffer(key)) {\n      throw new TypeError('key must be a string or Buffer')\n    }\n\n    if (format !== 'pem' && format !== 'der') {\n      throw new TypeError('format must be one of \"pem\" or \"der\"')\n    }\n\n    let label\n    if (format === 'pem') {\n      key = key.toString()\n      switch (key.split(/\\r?\\n/g)[0].toString()) {\n        case '-----BEGIN PUBLIC KEY-----':\n          type = 'spki'\n          label = 'PUBLIC KEY'\n          break\n        case '-----BEGIN RSA PUBLIC KEY-----':\n          type = 'pkcs1'\n          label = 'RSA PUBLIC KEY'\n          break\n        case '-----BEGIN CERTIFICATE-----':\n          throw new errors.JOSENotSupported('X.509 certificates are not supported in your Node.js runtime version')\n        case '-----BEGIN PRIVATE KEY-----':\n        case '-----BEGIN EC PRIVATE KEY-----':\n        case '-----BEGIN RSA PRIVATE KEY-----':\n          return createPublicKey(createPrivateKey(key))\n        default:\n          throw new TypeError('unknown/unsupported PEM type')\n      }\n    }\n\n    switch (type) {\n      case 'spki': {\n        const PublicKeyInfo = asn1.get('PublicKeyInfo')\n        const parsed = PublicKeyInfo.decode(key, format, { label })\n\n        let type, keyObject\n        switch (parsed.algorithm.algorithm) {\n          case 'ecPublicKey': {\n            keyObject = new KeyObject()\n            keyObject._asn1 = parsed\n            keyObject._asymmetricKeyType = 'ec'\n            keyObject._type = 'public'\n            keyObject._pem = PublicKeyInfo.encode(parsed, 'pem', { label: 'PUBLIC KEY' })\n\n            break\n          }\n          case 'rsaEncryption': {\n            type = 'pkcs1'\n            keyObject = createPublicKey({ type, key: parsed.publicKey.data, format: 'der' })\n            break\n          }\n          default:\n            unsupported(parsed.algorithm.algorithm)\n        }\n\n        return keyObject\n      }\n      case 'pkcs1': {\n        const RSAPublicKey = asn1.get('RSAPublicKey')\n        const parsed = RSAPublicKey.decode(key, format, { label })\n\n        // special case when private pkcs1 PEM / DER is used with createPublicKey\n        if (parsed.n === BigInt(0)) {\n          return createPublicKey(createPrivateKey({ key, format, type, passphrase }))\n        }\n\n        const keyObject = new KeyObject()\n        keyObject._asn1 = parsed\n        keyObject._asymmetricKeyType = 'rsa'\n        keyObject._type = 'public'\n        keyObject._pem = RSAPublicKey.encode(parsed, 'pem', { label: 'RSA PUBLIC KEY' })\n\n        return keyObject\n      }\n      case 'pkcs8':\n      case 'sec1':\n        return createPublicKey(createPrivateKey({ format, key, type, passphrase }))\n      default:\n        throw new TypeError(`The value ${type} is invalid for option \"type\"`)\n    }\n  }\n\n  createPrivateKey = (input, hints) => {\n    if (typeof input === 'string' || Buffer.isBuffer(input)) {\n      input = { key: input, format: 'pem' }\n    }\n\n    if (!isObject(input)) {\n      throw new TypeError('input must be a string, Buffer or an object')\n    }\n\n    const { format, passphrase } = input\n    let { key, type } = input\n\n    if (typeof key !== 'string' && !Buffer.isBuffer(key)) {\n      throw new TypeError('key must be a string or Buffer')\n    }\n\n    if (passphrase !== undefined) {\n      throw new errors.JOSENotSupported('encrypted private keys are not supported in your Node.js runtime version')\n    }\n\n    if (format !== 'pem' && format !== 'der') {\n      throw new TypeError('format must be one of \"pem\" or \"der\"')\n    }\n\n    let label\n    if (format === 'pem') {\n      key = key.toString()\n      switch (key.split(/\\r?\\n/g)[0].toString()) {\n        case '-----BEGIN PRIVATE KEY-----':\n          type = 'pkcs8'\n          label = 'PRIVATE KEY'\n          break\n        case '-----BEGIN EC PRIVATE KEY-----':\n          type = 'sec1'\n          label = 'EC PRIVATE KEY'\n          break\n        case '-----BEGIN RSA PRIVATE KEY-----':\n          type = 'pkcs1'\n          label = 'RSA PRIVATE KEY'\n          break\n        default:\n          throw new TypeError('unknown/unsupported PEM type')\n      }\n    }\n\n    switch (type) {\n      case 'pkcs8': {\n        const PrivateKeyInfo = asn1.get('PrivateKeyInfo')\n        const parsed = PrivateKeyInfo.decode(key, format, { label })\n\n        let type, keyObject\n        switch (parsed.algorithm.algorithm) {\n          case 'ecPublicKey': {\n            type = 'sec1'\n            keyObject = createPrivateKey({ type, key: parsed.privateKey, format: 'der' }, { [namedCurve]: parsed.algorithm.parameters.value })\n            break\n          }\n          case 'rsaEncryption': {\n            type = 'pkcs1'\n            keyObject = createPrivateKey({ type, key: parsed.privateKey, format: 'der' })\n            break\n          }\n          default:\n            unsupported(parsed.algorithm.algorithm)\n        }\n\n        keyObject._pkcs8 = key\n        return keyObject\n      }\n      case 'pkcs1': {\n        const RSAPrivateKey = asn1.get('RSAPrivateKey')\n        const parsed = RSAPrivateKey.decode(key, format, { label })\n\n        const keyObject = new KeyObject()\n        keyObject._asn1 = parsed\n        keyObject._asymmetricKeyType = 'rsa'\n        keyObject._type = 'private'\n        keyObject._pem = RSAPrivateKey.encode(parsed, 'pem', { label: 'RSA PRIVATE KEY' })\n\n        return keyObject\n      }\n      case 'sec1': {\n        const ECPrivateKey = asn1.get('ECPrivateKey')\n        let parsed = ECPrivateKey.decode(key, format, { label })\n\n        if (!('parameters' in parsed) && !hints[namedCurve]) {\n          throw new Error('invalid sec1')\n        } else if (!('parameters' in parsed)) {\n          parsed = { ...parsed, parameters: { type: 'namedCurve', value: hints[namedCurve] } }\n        }\n\n        const keyObject = new KeyObject()\n        keyObject._asn1 = parsed\n        keyObject._asymmetricKeyType = 'ec'\n        keyObject._type = 'private'\n        keyObject._pem = ECPrivateKey.encode(parsed, 'pem', { label: 'EC PRIVATE KEY' })\n\n        return keyObject\n      }\n      default:\n        throw new TypeError(`The value ${type} is invalid for option \"type\"`)\n    }\n  }\n}\n\nmodule.exports = { createPublicKey, createPrivateKey, createSecretKey, KeyObject, asInput }\n", "/* global BigInt */\n\nconst { randomBytes } = require('crypto')\n\nconst base64url = require('./base64url')\nconst errors = require('../errors')\n\nconst ZERO = BigInt(0)\nconst ONE = BigInt(1)\nconst TWO = BigInt(2)\n\nconst toJWKParameter = (n) => {\n  const hex = n.toString(16)\n  return base64url.encodeBuffer(Buffer.from(hex.length % 2 ? `0${hex}` : hex, 'hex'))\n}\nconst fromBuffer = buf => BigInt(`0x${buf.toString('hex')}`)\nconst bitLength = n => n.toString(2).length\n\nconst eGcdX = (a, b) => {\n  let x = ZERO\n  let y = ONE\n  let u = ONE\n  let v = ZERO\n\n  while (a !== ZERO) {\n    const q = b / a\n    const r = b % a\n    const m = x - (u * q)\n    const n = y - (v * q)\n    b = a\n    a = r\n    x = u\n    y = v\n    u = m\n    v = n\n  }\n  return x\n}\n\nconst gcd = (a, b) => {\n  let shift = ZERO\n  while (!((a | b) & ONE)) {\n    a >>= ONE\n    b >>= ONE\n    shift++\n  }\n  while (!(a & ONE)) {\n    a >>= ONE\n  }\n  do {\n    while (!(b & ONE)) {\n      b >>= ONE\n    }\n    if (a > b) {\n      const x = a\n      a = b\n      b = x\n    }\n    b -= a\n  } while (b)\n\n  return a << shift\n}\n\nconst modPow = (a, b, n) => {\n  a = toZn(a, n)\n  let result = ONE\n  let x = a\n  while (b > 0) {\n    var leastSignificantBit = b % TWO\n    b = b / TWO\n    if (leastSignificantBit === ONE) {\n      result = result * x\n      result = result % n\n    }\n    x = x * x\n    x = x % n\n  }\n  return result\n}\n\nconst randBetween = (min, max) => {\n  const interval = max - min\n  const bitLen = bitLength(interval)\n  let rnd\n  do {\n    rnd = fromBuffer(randBits(bitLen))\n  } while (rnd > interval)\n  return rnd + min\n}\n\nconst randBits = (bitLength) => {\n  const byteLength = Math.ceil(bitLength / 8)\n  const rndBytes = randomBytes(byteLength)\n  // Fill with 0's the extra bits\n  rndBytes[0] = rndBytes[0] & (2 ** (bitLength % 8) - 1)\n  return rndBytes\n}\n\nconst toZn = (a, n) => {\n  a = a % n\n  return (a < 0) ? a + n : a\n}\n\nconst odd = (n) => {\n  let r = n\n  while (r % TWO === ZERO) {\n    r = r / TWO\n  }\n  return r\n}\n\n// not sold on these values\nconst maxCountWhileNoY = 30\nconst maxCountWhileInot0 = 22\n\nconst getPrimeFactors = (e, d, n) => {\n  const r = odd(e * d - ONE)\n\n  let countWhileNoY = 0\n  let y\n  do {\n    countWhileNoY++\n    if (countWhileNoY === maxCountWhileNoY) {\n      throw new errors.JWKImportFailed('failed to calculate missing primes')\n    }\n\n    let countWhileInot0 = 0\n    let i = modPow(randBetween(TWO, n), r, n)\n    let o = ZERO\n    while (i !== ONE) {\n      countWhileInot0++\n      if (countWhileInot0 === maxCountWhileInot0) {\n        throw new errors.JWKImportFailed('failed to calculate missing primes')\n      }\n      o = i\n      i = (i * i) % n\n    }\n    if (o !== (n - ONE)) {\n      y = o\n    }\n  } while (!y)\n\n  const p = gcd(y - ONE, n)\n  const q = n / p\n\n  return p > q ? { p, q } : { p: q, q: p }\n}\n\nmodule.exports = (jwk) => {\n  const e = fromBuffer(base64url.decodeToBuffer(jwk.e))\n  const d = fromBuffer(base64url.decodeToBuffer(jwk.d))\n  const n = fromBuffer(base64url.decodeToBuffer(jwk.n))\n\n  if (d >= n) {\n    throw new errors.JWKInvalid('invalid RSA private exponent')\n  }\n\n  const { p, q } = getPrimeFactors(e, d, n)\n  const dp = d % (p - ONE)\n  const dq = d % (q - ONE)\n  const qi = toZn(eGcdX(toZn(q, p), p), p)\n\n  return {\n    ...jwk,\n    p: toJWKParameter(p),\n    q: toJWKParameter(q),\n    dp: toJWKParameter(dp),\n    dq: toJWKParameter(dq),\n    qi: toJWKParameter(qi)\n  }\n}\n", "/* global BigInt */\n\nconst { EOL } = require('os')\n\nconst errors = require('../errors')\n\nconst { keyObjectSupported } = require('./runtime_support')\nconst { createPublicKey } = require('./key_object')\nconst base64url = require('./base64url')\nconst asn1 = require('./asn1')\nconst computePrimes = require('./rsa_primes')\nconst { OKP_CURVES, EC_CURVES } = require('../registry')\n\nconst formatPem = (base64pem, descriptor) => `-----BEGIN ${descriptor} KEY-----${EOL}${(base64pem.match(/.{1,64}/g) || []).join(EOL)}${EOL}-----END ${descriptor} KEY-----`\n\nconst okpToJWK = {\n  private (crv, keyObject) {\n    const der = keyObject.export({ type: 'pkcs8', format: 'der' })\n    const OneAsymmetricKey = asn1.get('OneAsymmetricKey')\n    const { privateKey: { privateKey: d } } = OneAsymmetricKey.decode(der)\n\n    return {\n      ...okpToJWK.public(crv, createPublicKey(keyObject)),\n      d: base64url.encodeBuffer(d)\n    }\n  },\n  public (crv, keyObject) {\n    const der = keyObject.export({ type: 'spki', format: 'der' })\n\n    const PublicKeyInfo = asn1.get('PublicKeyInfo')\n\n    const { publicKey: { data: x } } = PublicKeyInfo.decode(der)\n\n    return {\n      kty: 'OKP',\n      crv,\n      x: base64url.encodeBuffer(x)\n    }\n  }\n}\n\nconst keyObjectToJWK = {\n  rsa: {\n    private (keyObject) {\n      const der = keyObject.export({ type: 'pkcs8', format: 'der' })\n\n      const PrivateKeyInfo = asn1.get('PrivateKeyInfo')\n      const RSAPrivateKey = asn1.get('RSAPrivateKey')\n\n      const { privateKey } = PrivateKeyInfo.decode(der)\n      const { version, n, e, d, p, q, dp, dq, qi } = RSAPrivateKey.decode(privateKey)\n\n      if (version !== 'two-prime') {\n        throw new errors.JOSENotSupported('Private RSA keys with more than two primes are not supported')\n      }\n\n      return {\n        kty: 'RSA',\n        n: base64url.encodeBigInt(n),\n        e: base64url.encodeBigInt(e),\n        d: base64url.encodeBigInt(d),\n        p: base64url.encodeBigInt(p),\n        q: base64url.encodeBigInt(q),\n        dp: base64url.encodeBigInt(dp),\n        dq: base64url.encodeBigInt(dq),\n        qi: base64url.encodeBigInt(qi)\n      }\n    },\n    public (keyObject) {\n      const der = keyObject.export({ type: 'spki', format: 'der' })\n\n      const PublicKeyInfo = asn1.get('PublicKeyInfo')\n      const RSAPublicKey = asn1.get('RSAPublicKey')\n\n      const { publicKey: { data: publicKey } } = PublicKeyInfo.decode(der)\n      const { n, e } = RSAPublicKey.decode(publicKey)\n\n      return {\n        kty: 'RSA',\n        n: base64url.encodeBigInt(n),\n        e: base64url.encodeBigInt(e)\n      }\n    }\n  },\n  ec: {\n    private (keyObject) {\n      const der = keyObject.export({ type: 'pkcs8', format: 'der' })\n\n      const PrivateKeyInfo = asn1.get('PrivateKeyInfo')\n      const ECPrivateKey = asn1.get('ECPrivateKey')\n\n      const { privateKey, algorithm: { parameters: { value: crv } } } = PrivateKeyInfo.decode(der)\n      const { privateKey: d, publicKey } = ECPrivateKey.decode(privateKey)\n\n      if (typeof publicKey === 'undefined') {\n        if (keyObjectSupported) {\n          return {\n            ...keyObjectToJWK.ec.public(createPublicKey(keyObject)),\n            d: base64url.encodeBuffer(d)\n          }\n        }\n\n        throw new errors.JOSENotSupported('Private EC keys without the public key embedded are not supported in your Node.js runtime version')\n      }\n\n      const x = publicKey.data.slice(1, ((publicKey.data.length - 1) / 2) + 1)\n      const y = publicKey.data.slice(((publicKey.data.length - 1) / 2) + 1)\n\n      return {\n        kty: 'EC',\n        crv,\n        d: base64url.encodeBuffer(d),\n        x: base64url.encodeBuffer(x),\n        y: base64url.encodeBuffer(y)\n      }\n    },\n    public (keyObject) {\n      const der = keyObject.export({ type: 'spki', format: 'der' })\n\n      const PublicKeyInfo = asn1.get('PublicKeyInfo')\n\n      const { publicKey: { data: publicKey }, algorithm: { parameters: { value: crv } } } = PublicKeyInfo.decode(der)\n\n      const x = publicKey.slice(1, ((publicKey.length - 1) / 2) + 1)\n      const y = publicKey.slice(((publicKey.length - 1) / 2) + 1)\n\n      return {\n        kty: 'EC',\n        crv,\n        x: base64url.encodeBuffer(x),\n        y: base64url.encodeBuffer(y)\n      }\n    }\n  },\n  ed25519: {\n    private (keyObject) {\n      return okpToJWK.private('Ed25519', keyObject)\n    },\n    public (keyObject) {\n      return okpToJWK.public('Ed25519', keyObject)\n    }\n  },\n  ed448: {\n    private (keyObject) {\n      return okpToJWK.private('Ed448', keyObject)\n    },\n    public (keyObject) {\n      return okpToJWK.public('Ed448', keyObject)\n    }\n  },\n  x25519: {\n    private (keyObject) {\n      return okpToJWK.private('X25519', keyObject)\n    },\n    public (keyObject) {\n      return okpToJWK.public('X25519', keyObject)\n    }\n  },\n  x448: {\n    private (keyObject) {\n      return okpToJWK.private('X448', keyObject)\n    },\n    public (keyObject) {\n      return okpToJWK.public('X448', keyObject)\n    }\n  }\n}\n\nmodule.exports.keyObjectToJWK = (keyObject) => {\n  if (keyObject.type === 'private') {\n    return keyObjectToJWK[keyObject.asymmetricKeyType].private(keyObject)\n  }\n\n  return keyObjectToJWK[keyObject.asymmetricKeyType].public(keyObject)\n}\n\nconst concatEcPublicKey = (x, y) => ({\n  unused: 0,\n  data: Buffer.concat([\n    Buffer.alloc(1, 4),\n    base64url.decodeToBuffer(x),\n    base64url.decodeToBuffer(y)\n  ])\n})\n\nconst jwkToPem = {\n  RSA: {\n    private (jwk, { calculateMissingRSAPrimes }) {\n      const RSAPrivateKey = asn1.get('RSAPrivateKey')\n\n      if ('oth' in jwk) {\n        throw new errors.JOSENotSupported('Private RSA keys with more than two primes are not supported')\n      }\n\n      if (jwk.p || jwk.q || jwk.dp || jwk.dq || jwk.qi) {\n        if (!(jwk.p && jwk.q && jwk.dp && jwk.dq && jwk.qi)) {\n          throw new errors.JWKInvalid('all other private key parameters must be present when any one of them is present')\n        }\n      } else if (calculateMissingRSAPrimes) {\n        jwk = computePrimes(jwk)\n      } else if (!calculateMissingRSAPrimes) {\n        throw new errors.JOSENotSupported('importing private RSA keys without all other private key parameters is not enabled, see documentation and its advisory on how and when its ok to enable it')\n      }\n\n      return RSAPrivateKey.encode({\n        version: 0,\n        n: BigInt(`0x${base64url.decodeToBuffer(jwk.n).toString('hex')}`),\n        e: BigInt(`0x${base64url.decodeToBuffer(jwk.e).toString('hex')}`),\n        d: BigInt(`0x${base64url.decodeToBuffer(jwk.d).toString('hex')}`),\n        p: BigInt(`0x${base64url.decodeToBuffer(jwk.p).toString('hex')}`),\n        q: BigInt(`0x${base64url.decodeToBuffer(jwk.q).toString('hex')}`),\n        dp: BigInt(`0x${base64url.decodeToBuffer(jwk.dp).toString('hex')}`),\n        dq: BigInt(`0x${base64url.decodeToBuffer(jwk.dq).toString('hex')}`),\n        qi: BigInt(`0x${base64url.decodeToBuffer(jwk.qi).toString('hex')}`)\n      }, 'pem', { label: 'RSA PRIVATE KEY' })\n    },\n    public (jwk) {\n      const RSAPublicKey = asn1.get('RSAPublicKey')\n\n      return RSAPublicKey.encode({\n        version: 0,\n        n: BigInt(`0x${base64url.decodeToBuffer(jwk.n).toString('hex')}`),\n        e: BigInt(`0x${base64url.decodeToBuffer(jwk.e).toString('hex')}`)\n      }, 'pem', { label: 'RSA PUBLIC KEY' })\n    }\n  },\n  EC: {\n    private (jwk) {\n      const ECPrivateKey = asn1.get('ECPrivateKey')\n\n      return ECPrivateKey.encode({\n        version: 1,\n        privateKey: base64url.decodeToBuffer(jwk.d),\n        parameters: { type: 'namedCurve', value: jwk.crv },\n        publicKey: concatEcPublicKey(jwk.x, jwk.y)\n      }, 'pem', { label: 'EC PRIVATE KEY' })\n    },\n    public (jwk) {\n      const PublicKeyInfo = asn1.get('PublicKeyInfo')\n\n      return PublicKeyInfo.encode({\n        algorithm: {\n          algorithm: 'ecPublicKey',\n          parameters: { type: 'namedCurve', value: jwk.crv }\n        },\n        publicKey: concatEcPublicKey(jwk.x, jwk.y)\n      }, 'pem', { label: 'PUBLIC KEY' })\n    }\n  },\n  OKP: {\n    private (jwk) {\n      const OneAsymmetricKey = asn1.get('OneAsymmetricKey')\n\n      const b64 = OneAsymmetricKey.encode({\n        version: 0,\n        privateKey: { privateKey: base64url.decodeToBuffer(jwk.d) },\n        algorithm: { algorithm: jwk.crv }\n      }, 'der')\n\n      // TODO: WHYYY? https://github.com/indutny/asn1.js/issues/110\n      b64.write('04', 12, 1, 'hex')\n\n      return formatPem(b64.toString('base64'), 'PRIVATE')\n    },\n    public (jwk) {\n      const PublicKeyInfo = asn1.get('PublicKeyInfo')\n\n      return PublicKeyInfo.encode({\n        algorithm: { algorithm: jwk.crv },\n        publicKey: {\n          unused: 0,\n          data: base64url.decodeToBuffer(jwk.x)\n        }\n      }, 'pem', { label: 'PUBLIC KEY' })\n    }\n  }\n}\n\nmodule.exports.jwkToPem = (jwk, { calculateMissingRSAPrimes = false } = {}) => {\n  switch (jwk.kty) {\n    case 'EC':\n      if (!EC_CURVES.has(jwk.crv)) {\n        throw new errors.JOSENotSupported(`unsupported EC key curve: ${jwk.crv}`)\n      }\n      break\n    case 'OKP':\n      if (!OKP_CURVES.has(jwk.crv)) {\n        throw new errors.JOSENotSupported(`unsupported OKP key curve: ${jwk.crv}`)\n      }\n      break\n    case 'RSA':\n      break\n    default:\n      throw new errors.JOSENotSupported(`unsupported key type: ${jwk.kty}`)\n  }\n\n  if (jwk.d) {\n    return jwkToPem[jwk.kty].private(jwk, { calculateMissingRSAPrimes })\n  }\n\n  return jwkToPem[jwk.kty].public(jwk)\n}\n", "const { createHash } = require('crypto')\n\nconst base64url = require('../help/base64url')\n\nconst x5t = (hash, cert) => base64url.encodeBuffer(createHash(hash).update(Buffer.from(cert, 'base64')).digest())\n\nmodule.exports.kid = components => base64url.encodeBuffer(createHash('sha256').update(JSON.stringify(components)).digest())\nmodule.exports.x5t = x5t.bind(undefined, 'sha1')\nmodule.exports['x5t#S256'] = x5t.bind(undefined, 'sha256')\n", "const { strict: assert } = require('assert')\nconst { inspect } = require('util')\nconst { EOL } = require('os')\n\nconst { keyObjectSupported } = require('../../help/runtime_support')\nconst { createPublicKey } = require('../../help/key_object')\nconst { keyObjectToJWK } = require('../../help/key_utils')\nconst {\n  THUMBPRINT_MATERIAL, PUBLIC_MEMBERS, PRIVATE_MEMBERS, JWK_MEMBERS, KEYOBJECT,\n  USES_MAPPING, OPS, USES\n} = require('../../help/consts')\nconst isObject = require('../../help/is_object')\nconst thumbprint = require('../thumbprint')\nconst errors = require('../../errors')\n\nconst privateApi = Symbol('privateApi')\nconst { JWK } = require('../../registry')\n\nclass Key {\n  constructor (keyObject, { alg, use, kid, key_ops: ops, x5c, x5t, 'x5t#S256': x5t256 } = {}) {\n    if (use !== undefined) {\n      if (typeof use !== 'string' || !USES.has(use)) {\n        throw new TypeError('`use` must be either \"sig\" or \"enc\" string when provided')\n      }\n    }\n\n    if (alg !== undefined) {\n      if (typeof alg !== 'string' || !alg) {\n        throw new TypeError('`alg` must be a non-empty string when provided')\n      }\n    }\n\n    if (kid !== undefined) {\n      if (typeof kid !== 'string' || !kid) {\n        throw new TypeError('`kid` must be a non-empty string when provided')\n      }\n    }\n\n    if (ops !== undefined) {\n      if (!Array.isArray(ops) || !ops.length || ops.some(o => typeof o !== 'string')) {\n        throw new TypeError('`key_ops` must be a non-empty array of strings when provided')\n      }\n      ops = Array.from(new Set(ops)).filter(x => OPS.has(x))\n    }\n\n    if (ops && use) {\n      if (\n        (use === 'enc' && ops.some(x => USES_MAPPING.sig.has(x))) ||\n        (use === 'sig' && ops.some(x => USES_MAPPING.enc.has(x)))\n      ) {\n        throw new errors.JWKInvalid('inconsistent JWK \"use\" and \"key_ops\"')\n      }\n    }\n\n    if (keyObjectSupported && x5c !== undefined) {\n      if (!Array.isArray(x5c) || !x5c.length || x5c.some(c => typeof c !== 'string')) {\n        throw new TypeError('`x5c` must be an array of one or more PKIX certificates when provided')\n      }\n\n      x5c.forEach((cert, i) => {\n        let publicKey\n        try {\n          publicKey = createPublicKey({\n            key: `-----BEGIN CERTIFICATE-----${EOL}${(cert.match(/.{1,64}/g) || []).join(EOL)}${EOL}-----END CERTIFICATE-----`, format: 'pem'\n          })\n        } catch (err) {\n          throw new errors.JWKInvalid(`\\`x5c\\` member at index ${i} is not a valid base64-encoded DER PKIX certificate`)\n        }\n        if (i === 0) {\n          try {\n            assert.deepEqual(\n              publicKey.export({ type: 'spki', format: 'der' }),\n              (keyObject.type === 'public' ? keyObject : createPublicKey(keyObject)).export({ type: 'spki', format: 'der' })\n            )\n          } catch (err) {\n            throw new errors.JWKInvalid('The key in the first `x5c` certificate MUST match the public key represented by the JWK')\n          }\n        }\n      })\n    }\n\n    Object.defineProperties(this, {\n      [KEYOBJECT]: { value: isObject(keyObject) ? undefined : keyObject },\n      keyObject: {\n        get () {\n          if (!keyObjectSupported) {\n            throw new errors.JOSENotSupported('KeyObject class is not supported in your Node.js runtime version')\n          }\n\n          return this[KEYOBJECT]\n        }\n      },\n      type: { value: keyObject.type },\n      private: { value: keyObject.type === 'private' },\n      public: { value: keyObject.type === 'public' },\n      secret: { value: keyObject.type === 'secret' },\n      alg: { value: alg, enumerable: alg !== undefined },\n      use: { value: use, enumerable: use !== undefined },\n      x5c: {\n        enumerable: x5c !== undefined,\n        ...(x5c ? { get () { return [...x5c] } } : { value: undefined })\n      },\n      key_ops: {\n        enumerable: ops !== undefined,\n        ...(ops ? { get () { return [...ops] } } : { value: undefined })\n      },\n      kid: {\n        enumerable: true,\n        ...(kid ? { value: kid } : {\n          get () {\n            Object.defineProperty(this, 'kid', { value: this.thumbprint, configurable: false })\n            return this.kid\n          },\n          configurable: true\n        })\n      },\n      ...(x5c ? {\n        x5t: {\n          enumerable: true,\n          ...(x5t ? { value: x5t } : {\n            get () {\n              Object.defineProperty(this, 'x5t', { value: thumbprint.x5t(this.x5c[0]), configurable: false })\n              return this.x5t\n            },\n            configurable: true\n          })\n        }\n      } : undefined),\n      ...(x5c ? {\n        'x5t#S256': {\n          enumerable: true,\n          ...(x5t256 ? { value: x5t256 } : {\n            get () {\n              Object.defineProperty(this, 'x5t#S256', { value: thumbprint['x5t#S256'](this.x5c[0]), configurable: false })\n              return this['x5t#S256']\n            },\n            configurable: true\n          })\n        }\n      } : undefined),\n      thumbprint: {\n        get () {\n          Object.defineProperty(this, 'thumbprint', { value: thumbprint.kid(this[THUMBPRINT_MATERIAL]()), configurable: false })\n          return this.thumbprint\n        },\n        configurable: true\n      }\n    })\n  }\n\n  toPEM (priv = false, encoding = {}) {\n    if (this.secret) {\n      throw new TypeError('symmetric keys cannot be exported as PEM')\n    }\n\n    if (priv && this.public === true) {\n      throw new TypeError('public key cannot be exported as private')\n    }\n\n    const { type = priv ? 'pkcs8' : 'spki', cipher, passphrase } = encoding\n\n    let keyObject = this[KEYOBJECT]\n\n    if (!priv) {\n      if (this.private) {\n        keyObject = createPublicKey(keyObject)\n      }\n      if (cipher || passphrase) {\n        throw new TypeError('cipher and passphrase can only be applied when exporting private keys')\n      }\n    }\n\n    if (priv) {\n      return keyObject.export({ format: 'pem', type, cipher, passphrase })\n    }\n\n    return keyObject.export({ format: 'pem', type })\n  }\n\n  toJWK (priv = false) {\n    if (priv && this.public === true) {\n      throw new TypeError('public key cannot be exported as private')\n    }\n\n    const components = [...this.constructor[priv ? PRIVATE_MEMBERS : PUBLIC_MEMBERS]]\n      .map(k => [k, this[k]])\n\n    const result = {}\n\n    Object.keys(components).forEach((key) => {\n      const [k, v] = components[key]\n\n      result[k] = v\n    })\n\n    result.kty = this.kty\n    result.kid = this.kid\n\n    if (this.alg) {\n      result.alg = this.alg\n    }\n\n    if (this.key_ops && this.key_ops.length) {\n      result.key_ops = this.key_ops\n    }\n\n    if (this.use) {\n      result.use = this.use\n    }\n\n    if (this.x5c) {\n      result.x5c = this.x5c\n    }\n\n    if (this.x5t) {\n      result.x5t = this.x5t\n    }\n\n    if (this['x5t#S256']) {\n      result['x5t#S256'] = this['x5t#S256']\n    }\n\n    return result\n  }\n\n  [JWK_MEMBERS] () {\n    const props = this[KEYOBJECT].type === 'private' ? this.constructor[PRIVATE_MEMBERS] : this.constructor[PUBLIC_MEMBERS]\n    Object.defineProperties(this, [...props].reduce((acc, component) => {\n      acc[component] = {\n        get () {\n          const jwk = keyObjectToJWK(this[KEYOBJECT])\n          Object.defineProperties(\n            this,\n            Object.entries(jwk)\n              .filter(([key]) => props.has(key))\n              .reduce((acc, [key, value]) => {\n                acc[key] = { value, enumerable: this.constructor[PUBLIC_MEMBERS].has(key), configurable: false }\n                return acc\n              }, {})\n          )\n\n          return this[component]\n        },\n        enumerable: this.constructor[PUBLIC_MEMBERS].has(component),\n        configurable: true\n      }\n      return acc\n    }, {}))\n  }\n\n  /* c8 ignore next 8 */\n  [inspect.custom] () {\n    return `${this.constructor.name} ${inspect(this.toJWK(false), {\n      depth: Infinity,\n      colors: process.stdout.isTTY,\n      compact: false,\n      sorted: true\n    })}`\n  }\n\n  /* c8 ignore next 3 */\n  [THUMBPRINT_MATERIAL] () {\n    throw new Error(`\"[THUMBPRINT_MATERIAL]()\" is not implemented on ${this.constructor.name}`)\n  }\n\n  algorithms (operation, /* the rest is private API */ int, opts) {\n    const { use = this.use, alg = this.alg, key_ops: ops = this.key_ops } = int === privateApi ? opts : {}\n    if (alg) {\n      return new Set(this.algorithms(operation, privateApi, { alg: null, use, key_ops: ops }).has(alg) ? [alg] : undefined)\n    }\n\n    if (typeof operation === 'symbol') {\n      try {\n        return this[operation]()\n      } catch (err) {\n        return new Set()\n      }\n    }\n\n    if (operation && ops && !ops.includes(operation)) {\n      return new Set()\n    }\n\n    switch (operation) {\n      case 'decrypt':\n      case 'deriveKey':\n      case 'encrypt':\n      case 'sign':\n      case 'unwrapKey':\n      case 'verify':\n      case 'wrapKey':\n        return new Set(Object.entries(JWK[this.kty][operation]).map(([alg, fn]) => fn(this) ? alg : undefined).filter(Boolean))\n      case undefined:\n        return new Set([\n          ...this.algorithms('sign'),\n          ...this.algorithms('verify'),\n          ...this.algorithms('decrypt'),\n          ...this.algorithms('encrypt'),\n          ...this.algorithms('unwrapKey'),\n          ...this.algorithms('wrapKey'),\n          ...this.algorithms('deriveKey')\n        ])\n      default:\n        throw new TypeError('invalid key operation')\n    }\n  }\n\n  /* c8 ignore next 3 */\n  static async generate () {\n    throw new Error(`\"static async generate()\" is not implemented on ${this.name}`)\n  }\n\n  /* c8 ignore next 3 */\n  static generateSync () {\n    throw new Error(`\"static generateSync()\" is not implemented on ${this.name}`)\n  }\n\n  /* c8 ignore next 3 */\n  static get [PUBLIC_MEMBERS] () {\n    throw new Error(`\"static get [PUBLIC_MEMBERS]()\" is not implemented on ${this.name}`)\n  }\n\n  /* c8 ignore next 3 */\n  static get [PRIVATE_MEMBERS] () {\n    throw new Error(`\"static get [PRIVATE_MEMBERS]()\" is not implemented on ${this.name}`)\n  }\n}\n\nmodule.exports = Key\n", "const { generateKeyPairSync, generateKeyPair: async } = require('crypto')\nconst { promisify } = require('util')\n\nconst {\n  THUMBPRINT_MATERIAL, JWK_MEMBERS, PUBLIC_MEMBERS,\n  PRIVATE_MEMBERS, KEY_MANAGEMENT_DECRYPT, KEY_MANAGEMENT_ENCRYPT\n} = require('../../help/consts')\nconst { keyObjectSupported } = require('../../help/runtime_support')\nconst { createPublicKey, createPrivateKey } = require('../../help/key_object')\n\nconst Key = require('./base')\n\nconst generateKeyPair = promisify(async)\n\nconst RSA_PUBLIC = new Set(['e', 'n'])\nObject.freeze(RSA_PUBLIC)\nconst RSA_PRIVATE = new Set([...RSA_PUBLIC, 'd', 'p', 'q', 'dp', 'dq', 'qi'])\nObject.freeze(RSA_PRIVATE)\n\n// RSA Key Type\nclass RSAKey extends Key {\n  constructor (...args) {\n    super(...args)\n    this[JWK_MEMBERS]()\n    Object.defineProperties(this, {\n      kty: {\n        value: 'RSA',\n        enumerable: true\n      },\n      length: {\n        get () {\n          Object.defineProperty(this, 'length', {\n            value: Buffer.byteLength(this.n, 'base64') * 8,\n            configurable: false\n          })\n\n          return this.length\n        },\n        configurable: true\n      }\n    })\n  }\n\n  static get [PUBLIC_MEMBERS] () {\n    return RSA_PUBLIC\n  }\n\n  static get [PRIVATE_MEMBERS] () {\n    return RSA_PRIVATE\n  }\n\n  // https://tc39.github.io/ecma262/#sec-ordinaryownpropertykeys no need for any special\n  // JSON.stringify handling in V8\n  [THUMBPRINT_MATERIAL] () {\n    return { e: this.e, kty: 'RSA', n: this.n }\n  }\n\n  [KEY_MANAGEMENT_ENCRYPT] () {\n    return this.algorithms('wrapKey')\n  }\n\n  [KEY_MANAGEMENT_DECRYPT] () {\n    return this.algorithms('unwrapKey')\n  }\n\n  static async generate (len = 2048, privat = true) {\n    if (!Number.isSafeInteger(len) || len < 512 || len % 8 !== 0 || (('electron' in process.versions) && len % 128 !== 0)) {\n      throw new TypeError('invalid bit length')\n    }\n\n    let privateKey, publicKey\n\n    if (keyObjectSupported) {\n      ({ privateKey, publicKey } = await generateKeyPair('rsa', { modulusLength: len }))\n      return privat ? privateKey : publicKey\n    }\n\n    ({ privateKey, publicKey } = await generateKeyPair('rsa', {\n      modulusLength: len,\n      publicKeyEncoding: { type: 'spki', format: 'pem' },\n      privateKeyEncoding: { type: 'pkcs8', format: 'pem' }\n    }))\n\n    if (privat) {\n      return createPrivateKey(privateKey)\n    } else {\n      return createPublicKey(publicKey)\n    }\n  }\n\n  static generateSync (len = 2048, privat = true) {\n    if (!Number.isSafeInteger(len) || len < 512 || len % 8 !== 0 || (('electron' in process.versions) && len % 128 !== 0)) {\n      throw new TypeError('invalid bit length')\n    }\n\n    let privateKey, publicKey\n\n    if (keyObjectSupported) {\n      ({ privateKey, publicKey } = generateKeyPairSync('rsa', { modulusLength: len }))\n      return privat ? privateKey : publicKey\n    }\n\n    ({ privateKey, publicKey } = generateKeyPairSync('rsa', {\n      modulusLength: len,\n      publicKeyEncoding: { type: 'spki', format: 'pem' },\n      privateKeyEncoding: { type: 'pkcs8', format: 'pem' }\n    }))\n\n    if (privat) {\n      return createPrivateKey(privateKey)\n    } else {\n      return createPublicKey(publicKey)\n    }\n  }\n}\n\nmodule.exports = RSAKey\n", "const { generateKeyPairSync, generateKeyPair: async } = require('crypto')\nconst { promisify } = require('util')\n\nconst {\n  THUMBPRINT_MATERIAL, JWK_MEMBERS, PUBLIC_MEMBERS,\n  PRIVATE_MEMBERS, KEY_MANAGEMENT_DECRYPT, KEY_MANAGEMENT_ENCRYPT\n} = require('../../help/consts')\nconst { EC_CURVES } = require('../../registry')\nconst { keyObjectSupported } = require('../../help/runtime_support')\nconst { createPublicKey, createPrivateKey } = require('../../help/key_object')\n\nconst errors = require('../../errors')\nconst { name: secp256k1 } = require('./secp256k1_crv')\n\nconst Key = require('./base')\n\nconst generateKeyPair = promisify(async)\n\nconst EC_PUBLIC = new Set(['crv', 'x', 'y'])\nObject.freeze(EC_PUBLIC)\nconst EC_PRIVATE = new Set([...EC_PUBLIC, 'd'])\nObject.freeze(EC_PRIVATE)\n\n// Elliptic Curve Key Type\nclass ECKey extends Key {\n  constructor (...args) {\n    super(...args)\n    this[JWK_MEMBERS]()\n    Object.defineProperty(this, 'kty', { value: 'EC', enumerable: true })\n    if (!EC_CURVES.has(this.crv)) {\n      throw new errors.JOSENotSupported('unsupported EC key curve')\n    }\n  }\n\n  static get [PUBLIC_MEMBERS] () {\n    return EC_PUBLIC\n  }\n\n  static get [PRIVATE_MEMBERS] () {\n    return EC_PRIVATE\n  }\n\n  // https://tc39.github.io/ecma262/#sec-ordinaryownpropertykeys no need for any special\n  // JSON.stringify handling in V8\n  [THUMBPRINT_MATERIAL] () {\n    return { crv: this.crv, kty: 'EC', x: this.x, y: this.y }\n  }\n\n  [KEY_MANAGEMENT_ENCRYPT] () {\n    return this.algorithms('deriveKey')\n  }\n\n  [KEY_MANAGEMENT_DECRYPT] () {\n    if (this.public) {\n      return new Set()\n    }\n    return this.algorithms('deriveKey')\n  }\n\n  static async generate (crv = 'P-256', privat = true) {\n    if (!EC_CURVES.has(crv)) {\n      throw new errors.JOSENotSupported(`unsupported EC key curve: ${crv}`)\n    }\n\n    if (crv === secp256k1 && crv !== 'secp256k1') {\n      crv = 'secp256k1'\n    }\n\n    let privateKey, publicKey\n\n    if (keyObjectSupported) {\n      ({ privateKey, publicKey } = await generateKeyPair('ec', { namedCurve: crv }))\n      return privat ? privateKey : publicKey\n    }\n\n    ({ privateKey, publicKey } = await generateKeyPair('ec', {\n      namedCurve: crv,\n      publicKeyEncoding: { type: 'spki', format: 'pem' },\n      privateKeyEncoding: { type: 'pkcs8', format: 'pem' }\n    }))\n\n    if (privat) {\n      return createPrivateKey(privateKey)\n    } else {\n      return createPublicKey(publicKey)\n    }\n  }\n\n  static generateSync (crv = 'P-256', privat = true) {\n    if (!EC_CURVES.has(crv)) {\n      throw new errors.JOSENotSupported(`unsupported EC key curve: ${crv}`)\n    }\n\n    if (crv === secp256k1 && crv !== 'secp256k1') {\n      crv = 'secp256k1'\n    }\n\n    let privateKey, publicKey\n\n    if (keyObjectSupported) {\n      ({ privateKey, publicKey } = generateKeyPairSync('ec', { namedCurve: crv }))\n      return privat ? privateKey : publicKey\n    }\n\n    ({ privateKey, publicKey } = generateKeyPairSync('ec', {\n      namedCurve: crv,\n      publicKeyEncoding: { type: 'spki', format: 'pem' },\n      privateKeyEncoding: { type: 'pkcs8', format: 'pem' }\n    }))\n\n    if (privat) {\n      return createPrivateKey(privateKey)\n    } else {\n      return createPublicKey(publicKey)\n    }\n  }\n}\n\nmodule.exports = ECKey\n", "const { generateKeyPairSync, generateKeyPair: async } = require('crypto')\nconst { promisify } = require('util')\n\nconst {\n  THUMBPRINT_MATERIAL, JWK_MEMBERS, PUBLIC_MEMBERS,\n  PRIVATE_MEMBERS, KEY_MANAGEMENT_DECRYPT, KEY_MANAGEMENT_ENCRYPT\n} = require('../../help/consts')\nconst { OKP_CURVES } = require('../../registry')\nconst { edDSASupported } = require('../../help/runtime_support')\nconst errors = require('../../errors')\n\nconst Key = require('./base')\n\nconst generateKeyPair = promisify(async)\n\nconst OKP_PUBLIC = new Set(['crv', 'x'])\nObject.freeze(OKP_PUBLIC)\nconst OKP_PRIVATE = new Set([...OKP_PUBLIC, 'd'])\nObject.freeze(OKP_PRIVATE)\n\n// Octet string key pairs Key Type\nclass OKPKey extends Key {\n  constructor (...args) {\n    super(...args)\n    this[JWK_MEMBERS]()\n    Object.defineProperty(this, 'kty', { value: 'OKP', enumerable: true })\n    if (!OKP_CURVES.has(this.crv)) {\n      throw new errors.JOSENotSupported('unsupported OKP key curve')\n    }\n  }\n\n  static get [PUBLIC_MEMBERS] () {\n    return OKP_PUBLIC\n  }\n\n  static get [PRIVATE_MEMBERS] () {\n    return OKP_PRIVATE\n  }\n\n  // https://tc39.github.io/ecma262/#sec-ordinaryownpropertykeys no need for any special\n  // JSON.stringify handling in V8\n  [THUMBPRINT_MATERIAL] () {\n    return { crv: this.crv, kty: 'OKP', x: this.x }\n  }\n\n  [KEY_MANAGEMENT_ENCRYPT] () {\n    return this.algorithms('deriveKey')\n  }\n\n  [KEY_MANAGEMENT_DECRYPT] () {\n    if (this.public) {\n      return new Set()\n    }\n    return this.algorithms('deriveKey')\n  }\n\n  static async generate (crv = 'Ed25519', privat = true) {\n    if (!edDSASupported) {\n      throw new errors.JOSENotSupported('OKP keys are not supported in your Node.js runtime version')\n    }\n\n    if (!OKP_CURVES.has(crv)) {\n      throw new errors.JOSENotSupported(`unsupported OKP key curve: ${crv}`)\n    }\n\n    const { privateKey, publicKey } = await generateKeyPair(crv.toLowerCase())\n\n    return privat ? privateKey : publicKey\n  }\n\n  static generateSync (crv = 'Ed25519', privat = true) {\n    if (!edDSASupported) {\n      throw new errors.JOSENotSupported('OKP keys are not supported in your Node.js runtime version')\n    }\n\n    if (!OKP_CURVES.has(crv)) {\n      throw new errors.JOSENotSupported(`unsupported OKP key curve: ${crv}`)\n    }\n\n    const { privateKey, publicKey } = generateKeyPairSync(crv.toLowerCase())\n\n    return privat ? privateKey : publicKey\n  }\n}\n\nmodule.exports = OKPKey\n", "const { randomBytes } = require('crypto')\n\nconst { createSecretKey } = require('../../help/key_object')\nconst base64url = require('../../help/base64url')\nconst {\n  THUMBPRINT_MATERIAL, PUBLIC_MEMBERS, PRIVATE_MEMBERS,\n  KEY_MANAGEMENT_DECRYPT, KEY_MANAGEMENT_ENCRYPT, KEYOBJECT\n} = require('../../help/consts')\n\nconst Key = require('./base')\n\nconst OCT_PUBLIC = new Set()\nObject.freeze(OCT_PUBLIC)\nconst OCT_PRIVATE = new Set(['k'])\nObject.freeze(OCT_PRIVATE)\n\n// Octet sequence Key Type\nclass OctKey extends Key {\n  constructor (...args) {\n    super(...args)\n    Object.defineProperties(this, {\n      kty: {\n        value: 'oct',\n        enumerable: true\n      },\n      length: {\n        value: this[KEYOBJECT] ? this[KEYOBJECT].symmetricKeySize * 8 : undefined\n      },\n      k: {\n        enumerable: false,\n        get () {\n          if (this[KEYOBJECT]) {\n            Object.defineProperty(this, 'k', {\n              value: base64url.encodeBuffer(this[KEYOBJECT].export()),\n              configurable: false\n            })\n          } else {\n            Object.defineProperty(this, 'k', {\n              value: undefined,\n              configurable: false\n            })\n          }\n\n          return this.k\n        },\n        configurable: true\n      }\n    })\n  }\n\n  static get [PUBLIC_MEMBERS] () {\n    return OCT_PUBLIC\n  }\n\n  static get [PRIVATE_MEMBERS] () {\n    return OCT_PRIVATE\n  }\n\n  // https://tc39.github.io/ecma262/#sec-ordinaryownpropertykeys no need for any special\n  // JSON.stringify handling in V8\n  [THUMBPRINT_MATERIAL] () {\n    if (!this[KEYOBJECT]) {\n      throw new TypeError('reference \"oct\" keys without \"k\" cannot have their thumbprint calculated')\n    }\n    return { k: this.k, kty: 'oct' }\n  }\n\n  [KEY_MANAGEMENT_ENCRYPT] () {\n    return new Set([\n      ...this.algorithms('wrapKey'),\n      ...this.algorithms('deriveKey')\n    ])\n  }\n\n  [KEY_MANAGEMENT_DECRYPT] () {\n    return this[KEY_MANAGEMENT_ENCRYPT]()\n  }\n\n  algorithms (...args) {\n    if (!this[KEYOBJECT]) {\n      return new Set()\n    }\n\n    return Key.prototype.algorithms.call(this, ...args)\n  }\n\n  static async generate (...args) {\n    return this.generateSync(...args)\n  }\n\n  static generateSync (len = 256, privat = true) {\n    if (!privat) {\n      throw new TypeError('\"oct\" keys cannot be generated as public')\n    }\n    if (!Number.isSafeInteger(len) || !len || len % 8 !== 0) {\n      throw new TypeError('invalid bit length')\n    }\n\n    return createSecretKey(randomBytes(len / 8))\n  }\n}\n\nmodule.exports = OctKey\n", "const { deprecate } = require('util')\n\nconst { createPublicKey, createPrivateKey, createSecretKey, KeyObject } = require('../help/key_object')\nconst base64url = require('../help/base64url')\nconst isObject = require('../help/is_object')\nconst { jwkToPem } = require('../help/key_utils')\nconst errors = require('../errors')\n\nconst RSAKey = require('./key/rsa')\nconst ECKey = require('./key/ec')\nconst OKPKey = require('./key/okp')\nconst OctKey = require('./key/oct')\n\nconst importable = new Set(['string', 'buffer', 'object'])\n\nconst mergedParameters = (target = {}, source = {}) => {\n  return {\n    alg: source.alg,\n    key_ops: source.key_ops,\n    kid: source.kid,\n    use: source.use,\n    x5c: source.x5c,\n    x5t: source.x5t,\n    'x5t#S256': source['x5t#S256'],\n    ...target\n  }\n}\n\nconst openSSHpublicKey = /^[a-zA-Z0-9-]+ AAAA(?:[0-9A-Za-z+/])+(?:==|=)?(?: .*)?$/\n\nconst asKey = (key, parameters, { calculateMissingRSAPrimes = false } = {}) => {\n  let privateKey, publicKey, secret\n\n  if (!importable.has(typeof key)) {\n    throw new TypeError('key argument must be a string, buffer or an object')\n  }\n\n  if (parameters !== undefined && !isObject(parameters)) {\n    throw new TypeError('parameters argument must be a plain object when provided')\n  }\n\n  if (key instanceof KeyObject) {\n    switch (key.type) {\n      case 'private':\n        privateKey = key\n        break\n      case 'public':\n        publicKey = key\n        break\n      case 'secret':\n        secret = key\n        break\n    }\n  } else if (typeof key === 'object' && key && 'kty' in key && key.kty === 'oct') { // symmetric key <Object>\n    try {\n      secret = createSecretKey(base64url.decodeToBuffer(key.k))\n    } catch (err) {\n      if (!('k' in key)) {\n        secret = { type: 'secret' }\n      }\n    }\n    parameters = mergedParameters(parameters, key)\n  } else if (typeof key === 'object' && key && 'kty' in key) { // assume JWK formatted asymmetric key <Object>\n    ({ calculateMissingRSAPrimes = false } = parameters || { calculateMissingRSAPrimes })\n    let pem\n\n    try {\n      pem = jwkToPem(key, { calculateMissingRSAPrimes })\n    } catch (err) {\n      if (err instanceof errors.JOSEError) {\n        throw err\n      }\n    }\n\n    if (pem && key.d) {\n      privateKey = createPrivateKey(pem)\n    } else if (pem) {\n      publicKey = createPublicKey(pem)\n    }\n\n    parameters = mergedParameters({}, key)\n  } else if (key && (typeof key === 'object' || typeof key === 'string')) { // <Object> | <string> | <Buffer> passed to crypto.createPrivateKey or crypto.createPublicKey or <Buffer> passed to crypto.createSecretKey\n    try {\n      privateKey = createPrivateKey(key)\n    } catch (err) {\n      if (err instanceof errors.JOSEError) {\n        throw err\n      }\n    }\n\n    try {\n      publicKey = createPublicKey(key)\n      if (key.startsWith('-----BEGIN CERTIFICATE-----') && (!parameters || !('x5c' in parameters))) {\n        parameters = mergedParameters(parameters, {\n          x5c: [key.replace(/(?:-----(?:BEGIN|END) CERTIFICATE-----|\\s)/g, '')]\n        })\n      }\n    } catch (err) {\n      if (err instanceof errors.JOSEError) {\n        throw err\n      }\n    }\n\n    try {\n      // this is to filter out invalid PEM keys and certs, i'll rather have them fail import then\n      // have them imported as symmetric \"oct\" keys\n      if (!key.includes('-----BEGIN') && !openSSHpublicKey.test(key.toString('ascii').replace(/[\\r\\n]/g, ''))) {\n        secret = createSecretKey(Buffer.isBuffer(key) ? key : Buffer.from(key))\n      }\n    } catch (err) {}\n  }\n\n  const keyObject = privateKey || publicKey || secret\n\n  if (privateKey || publicKey) {\n    switch (keyObject.asymmetricKeyType) {\n      case 'rsa':\n        return new RSAKey(keyObject, parameters)\n      case 'ec':\n        return new ECKey(keyObject, parameters)\n      case 'ed25519':\n      case 'ed448':\n      case 'x25519':\n      case 'x448':\n        return new OKPKey(keyObject, parameters)\n      default:\n        throw new errors.JOSENotSupported('only RSA, EC and OKP asymmetric keys are supported')\n    }\n  } else if (secret) {\n    return new OctKey(keyObject, parameters)\n  }\n\n  throw new errors.JWKImportFailed('key import failed')\n}\n\nmodule.exports = asKey\nObject.defineProperty(asKey, 'deprecated', {\n  value: deprecate((key, parameters) => { return asKey(key, parameters, { calculateMissingRSAPrimes: true }) }, 'JWK.importKey() is deprecated, use JWK.asKey() instead'),\n  enumerable: false\n})\n", "const errors = require('../errors')\n\nconst importKey = require('./import')\n\nconst RSAKey = require('./key/rsa')\nconst ECKey = require('./key/ec')\nconst OKPKey = require('./key/okp')\nconst OctKey = require('./key/oct')\n\nconst generate = async (kty, crvOrSize, params, generatePrivate = true) => {\n  switch (kty) {\n    case 'RSA':\n      return importKey(\n        await RSAKey.generate(crvOrSize, generatePrivate),\n        params\n      )\n    case 'EC':\n      return importKey(\n        await ECKey.generate(crvOrSize, generatePrivate),\n        params\n      )\n    case 'OKP':\n      return importKey(\n        await OKPKey.generate(crvOrSize, generatePrivate),\n        params\n      )\n    case 'oct':\n      return importKey(\n        await OctKey.generate(crvOrSize, generatePrivate),\n        params\n      )\n    default:\n      throw new errors.JOSENotSupported(`unsupported key type: ${kty}`)\n  }\n}\n\nconst generateSync = (kty, crvOrSize, params, generatePrivate = true) => {\n  switch (kty) {\n    case 'RSA':\n      return importKey(RSAKey.generateSync(crvOrSize, generatePrivate), params)\n    case 'EC':\n      return importKey(ECKey.generateSync(crvOrSize, generatePrivate), params)\n    case 'OKP':\n      return importKey(OKPKey.generateSync(crvOrSize, generatePrivate), params)\n    case 'oct':\n      return importKey(OctKey.generateSync(crvOrSize, generatePrivate), params)\n    default:\n      throw new errors.JOSENotSupported(`unsupported key type: ${kty}`)\n  }\n}\n\nmodule.exports.generate = generate\nmodule.exports.generateSync = generateSync\n", "const { inspect } = require('util')\n\nconst Key = require('./base')\n\nclass NoneKey extends Key {\n  constructor () {\n    super({ type: 'unsecured' }, { alg: 'none' })\n    Object.defineProperties(this, {\n      kid: { value: undefined },\n      kty: { value: undefined },\n      thumbprint: { value: undefined },\n      toJWK: { value: undefined },\n      toPEM: { value: undefined }\n    })\n  }\n\n  /* c8 ignore next 3 */\n  [inspect.custom] () {\n    return 'None {}'\n  }\n\n  algorithms (operation) {\n    switch (operation) {\n      case 'sign':\n      case 'verify':\n      case undefined:\n        return new Set(['none'])\n      default:\n        return new Set()\n    }\n  }\n}\n\nmodule.exports = new NoneKey()\n", "const { inspect } = require('util')\n\nconst Key = require('./base')\n\nclass EmbeddedJWK extends Key {\n  constructor () {\n    super({ type: 'embedded' })\n    Object.defineProperties(this, {\n      kid: { value: undefined },\n      kty: { value: undefined },\n      thumbprint: { value: undefined },\n      toJWK: { value: undefined },\n      toPEM: { value: undefined }\n    })\n  }\n\n  /* c8 ignore next 3 */\n  [inspect.custom] () {\n    return 'Embedded.JWK {}'\n  }\n\n  algorithms () {\n    return new Set()\n  }\n}\n\nmodule.exports = new EmbeddedJWK()\n", "const { inspect } = require('util')\n\nconst Key = require('./base')\n\nclass EmbeddedX5C extends Key {\n  constructor () {\n    super({ type: 'embedded' })\n    Object.defineProperties(this, {\n      kid: { value: undefined },\n      kty: { value: undefined },\n      thumbprint: { value: undefined },\n      toJWK: { value: undefined },\n      toPEM: { value: undefined }\n    })\n  }\n\n  /* c8 ignore next 3 */\n  [inspect.custom] () {\n    return 'Embedded.X5C {}'\n  }\n\n  algorithms () {\n    return new Set()\n  }\n}\n\nmodule.exports = new EmbeddedX5C()\n", "const Key = require('./key/base')\nconst None = require('./key/none')\nconst EmbeddedJWK = require('./key/embedded.jwk')\nconst EmbeddedX5C = require('./key/embedded.x5c')\nconst importKey = require('./import')\nconst generate = require('./generate')\n\nmodule.exports = {\n  ...generate,\n  asKey: importKey,\n  isKey: input => input instanceof Key,\n  None,\n  EmbeddedJWK,\n  EmbeddedX5C\n}\n\n/* deprecated */\nObject.defineProperty(module.exports, 'importKey', {\n  value: importKey.deprecated,\n  enumerable: false\n})\n", "const { deprecate, inspect } = require('util')\n\nconst isObject = require('../help/is_object')\nconst { generate, generateSync } = require('../jwk/generate')\nconst { USES_MAPPING } = require('../help/consts')\nconst { isKey, asKey: importKey } = require('../jwk')\n\nconst keyscore = (key, { alg, use, ops }) => {\n  let score = 0\n\n  if (alg && key.alg) {\n    score++\n  }\n\n  if (use && key.use) {\n    score++\n  }\n\n  if (ops && key.key_ops) {\n    score++\n  }\n\n  return score\n}\n\nclass KeyStore {\n  constructor (...keys) {\n    while (keys.some(Array.isArray)) {\n      keys = keys.flat ? keys.flat() : keys.reduce((acc, val) => {\n        if (Array.isArray(val)) {\n          return [...acc, ...val]\n        }\n\n        acc.push(val)\n        return acc\n      }, [])\n    }\n    if (keys.some(k => !isKey(k) || !k.kty)) {\n      throw new TypeError('all keys must be instances of a key instantiated by JWK.asKey')\n    }\n\n    this._keys = new Set(keys)\n  }\n\n  all ({ alg, kid, thumbprint, use, kty, key_ops: ops, x5t, 'x5t#S256': x5t256, crv } = {}) {\n    if (ops !== undefined && (!Array.isArray(ops) || !ops.length || ops.some(x => typeof x !== 'string'))) {\n      throw new TypeError('`key_ops` must be a non-empty array of strings')\n    }\n\n    const search = { alg, use, ops }\n    return [...this._keys]\n      .filter((key) => {\n        let candidate = true\n\n        if (candidate && kid !== undefined && key.kid !== kid) {\n          candidate = false\n        }\n\n        if (candidate && thumbprint !== undefined && key.thumbprint !== thumbprint) {\n          candidate = false\n        }\n\n        if (candidate && x5t !== undefined && key.x5t !== x5t) {\n          candidate = false\n        }\n\n        if (candidate && x5t256 !== undefined && key['x5t#S256'] !== x5t256) {\n          candidate = false\n        }\n\n        if (candidate && kty !== undefined && key.kty !== kty) {\n          candidate = false\n        }\n\n        if (candidate && crv !== undefined && (key.crv !== crv)) {\n          candidate = false\n        }\n\n        if (alg !== undefined && !key.algorithms().has(alg)) {\n          candidate = false\n        }\n\n        if (candidate && use !== undefined && (key.use !== undefined && key.use !== use)) {\n          candidate = false\n        }\n\n        // TODO:\n        if (candidate && ops !== undefined && (key.key_ops !== undefined || key.use !== undefined)) {\n          let keyOps\n          if (key.key_ops) {\n            keyOps = new Set(key.key_ops)\n          } else {\n            keyOps = USES_MAPPING[key.use]\n          }\n          if (ops.some(x => !keyOps.has(x))) {\n            candidate = false\n          }\n        }\n\n        return candidate\n      })\n      .sort((first, second) => keyscore(second, search) - keyscore(first, search))\n  }\n\n  get (...args) {\n    return this.all(...args)[0]\n  }\n\n  add (key) {\n    if (!isKey(key) || !key.kty) {\n      throw new TypeError('key must be an instance of a key instantiated by JWK.asKey')\n    }\n\n    this._keys.add(key)\n  }\n\n  remove (key) {\n    if (!isKey(key)) {\n      throw new TypeError('key must be an instance of a key instantiated by JWK.asKey')\n    }\n\n    this._keys.delete(key)\n  }\n\n  toJWKS (priv = false) {\n    return {\n      keys: [...this._keys.values()].map(\n        key => key.toJWK(priv && (key.private || (key.secret && key.k)))\n      )\n    }\n  }\n\n  async generate (...args) {\n    this._keys.add(await generate(...args))\n  }\n\n  generateSync (...args) {\n    this._keys.add(generateSync(...args))\n  }\n\n  get size () {\n    return this._keys.size\n  }\n\n  /* c8 ignore next 8 */\n  [inspect.custom] () {\n    return `${this.constructor.name} ${inspect(this.toJWKS(false), {\n      depth: Infinity,\n      colors: process.stdout.isTTY,\n      compact: false,\n      sorted: true\n    })}`\n  }\n\n  * [Symbol.iterator] () {\n    for (const key of this._keys) {\n      yield key\n    }\n  }\n}\n\nfunction asKeyStore (jwks, { ignoreErrors = false, calculateMissingRSAPrimes = false } = {}) {\n  if (!isObject(jwks) || !Array.isArray(jwks.keys) || jwks.keys.some(k => !isObject(k) || !('kty' in k))) {\n    throw new TypeError('jwks must be a JSON Web Key Set formatted object')\n  }\n\n  const keys = jwks.keys.map((jwk) => {\n    try {\n      return importKey(jwk, { calculateMissingRSAPrimes })\n    } catch (err) {\n      if (!ignoreErrors) {\n        throw err\n      }\n    }\n  }).filter(Boolean)\n\n  return new KeyStore(...keys)\n}\n\nObject.defineProperty(KeyStore, 'fromJWKS', {\n  value: deprecate(jwks => asKeyStore(jwks, { calculateMissingRSAPrimes: true }), 'JWKS.KeyStore.fromJWKS() is deprecated, use JWKS.asKeyStore() instead'),\n  enumerable: false\n})\n\nmodule.exports = { KeyStore, asKeyStore }\n", "const errors = require('../errors')\nconst Key = require('../jwk/key/base')\nconst importKey = require('../jwk/import')\nconst { KeyStore } = require('../jwks/keystore')\n\nmodule.exports = (input, keyStoreAllowed = false) => {\n  if (input instanceof Key) {\n    return input\n  }\n\n  if (input instanceof KeyStore) {\n    if (!keyStoreAllowed) {\n      throw new TypeError('key argument for this operation must not be a JWKS.KeyStore instance')\n    }\n\n    return input\n  }\n\n  try {\n    return importKey(input)\n  } catch (err) {\n    if (err instanceof errors.JOSEError && !(err instanceof errors.JWKImportFailed)) {\n      throw err\n    }\n\n    let msg\n    if (keyStoreAllowed) {\n      msg = 'key must be an instance of a key instantiated by JWK.asKey, a valid JWK.asKey input, or a JWKS.KeyStore instance'\n    } else {\n      msg = 'key must be an instance of a key instantiated by JWK.asKey, or a valid JWK.asKey input'\n    }\n\n    throw new TypeError(msg)\n  }\n}\n", "module.exports = obj => JSON.parse(JSON.stringify(obj))\n", "const { timingSafeEqual: TSE } = require('crypto')\n\nconst paddedBuffer = (input, length) => {\n  if (input.length === length) {\n    return input\n  }\n\n  const buffer = Buffer.alloc(length)\n  input.copy(buffer)\n  return buffer\n}\n\nconst timingSafeEqual = (a, b) => {\n  const length = Math.max(a.length, b.length)\n  return TSE(paddedBuffer(a, length), paddedBuffer(b, length))\n}\n\nmodule.exports = timingSafeEqual\n", "module.exports = alg => `sha${alg.substr(2, 3)}`\n", "const { createHmac } = require('crypto')\n\nconst { KEYOBJECT } = require('../help/consts')\nconst timingSafeEqual = require('../help/timing_safe_equal')\nconst resolveNodeAlg = require('../help/node_alg')\nconst { asInput } = require('../help/key_object')\n\nconst sign = (jwaAlg, hmacAlg, { [KEYOBJECT]: keyObject }, payload) => {\n  const hmac = createHmac(hmacAlg, asInput(keyObject, false))\n  hmac.update(payload)\n  return hmac.digest()\n}\n\nconst verify = (jwaAlg, hmacAlg, key, payload, signature) => {\n  const expected = sign(jwaAlg, hmacAlg, key, payload)\n  const actual = signature\n\n  return timingSafeEqual(actual, expected)\n}\n\nmodule.exports = (JWA, JWK) => {\n  ['HS256', 'HS384', 'HS512'].forEach((jwaAlg) => {\n    const hmacAlg = resolveNodeAlg(jwaAlg)\n    JWA.sign.set(jwaAlg, sign.bind(undefined, jwaAlg, hmacAlg))\n    JWA.verify.set(jwaAlg, verify.bind(undefined, jwaAlg, hmacAlg))\n    JWK.oct.sign[jwaAlg] = JWK.oct.verify[jwaAlg] = key => key.use === 'sig' || key.use === undefined\n  })\n}\n", "const MAX_OCTET = 0x80\nconst CLASS_UNIVERSAL = 0\nconst PRIMITIVE_BIT = 0x20\nconst TAG_SEQ = 0x10\nconst TAG_INT = 0x02\nconst ENCODED_TAG_SEQ = (TAG_SEQ | PRIMITIVE_BIT) | (CLASS_UNIVERSAL << 6)\nconst ENCODED_TAG_INT = TAG_INT | (CLASS_UNIVERSAL << 6)\n\nconst getParamSize = keySize => ((keySize / 8) | 0) + (keySize % 8 === 0 ? 0 : 1)\n\nconst paramBytesForAlg = {\n  ES256: getParamSize(256),\n  ES256K: getParamSize(256),\n  ES384: getParamSize(384),\n  ES512: getParamSize(521)\n}\n\nconst countPadding = (buf, start, stop) => {\n  let padding = 0\n  while (start + padding < stop && buf[start + padding] === 0) {\n    ++padding\n  }\n\n  const needsSign = buf[start + padding] >= MAX_OCTET\n  if (needsSign) {\n    --padding\n  }\n\n  return padding\n}\n\nmodule.exports.derToJose = (signature, alg) => {\n  if (!Buffer.isBuffer(signature)) {\n    throw new TypeError('ECDSA signature must be a Buffer')\n  }\n\n  if (!paramBytesForAlg[alg]) {\n    throw new Error(`Unknown algorithm \"${alg}\"`)\n  }\n\n  const paramBytes = paramBytesForAlg[alg]\n\n  // the DER encoded param should at most be the param size, plus a padding\n  // zero, since due to being a signed integer\n  const maxEncodedParamLength = paramBytes + 1\n\n  const inputLength = signature.length\n\n  let offset = 0\n  if (signature[offset++] !== ENCODED_TAG_SEQ) {\n    throw new Error('Could not find expected \"seq\"')\n  }\n\n  let seqLength = signature[offset++]\n  if (seqLength === (MAX_OCTET | 1)) {\n    seqLength = signature[offset++]\n  }\n\n  if (inputLength - offset < seqLength) {\n    throw new Error(`\"seq\" specified length of ${seqLength}\", only ${inputLength - offset}\" remaining`)\n  }\n\n  if (signature[offset++] !== ENCODED_TAG_INT) {\n    throw new Error('Could not find expected \"int\" for \"r\"')\n  }\n\n  const rLength = signature[offset++]\n\n  if (inputLength - offset - 2 < rLength) {\n    throw new Error(`\"r\" specified length of \"${rLength}\", only \"${inputLength - offset - 2}\" available`)\n  }\n\n  if (maxEncodedParamLength < rLength) {\n    throw new Error(`\"r\" specified length of \"${rLength}\", max of \"${maxEncodedParamLength}\" is acceptable`)\n  }\n\n  const rOffset = offset\n  offset += rLength\n\n  if (signature[offset++] !== ENCODED_TAG_INT) {\n    throw new Error('Could not find expected \"int\" for \"s\"')\n  }\n\n  const sLength = signature[offset++]\n\n  if (inputLength - offset !== sLength) {\n    throw new Error(`\"s\" specified length of \"${sLength}\", expected \"${inputLength - offset}\"`)\n  }\n\n  if (maxEncodedParamLength < sLength) {\n    throw new Error(`\"s\" specified length of \"${sLength}\", max of \"${maxEncodedParamLength}\" is acceptable`)\n  }\n\n  const sOffset = offset\n  offset += sLength\n\n  if (offset !== inputLength) {\n    throw new Error(`Expected to consume entire buffer, but \"${inputLength - offset}\" bytes remain`)\n  }\n\n  const rPadding = paramBytes - rLength\n\n  const sPadding = paramBytes - sLength\n\n  const dst = Buffer.allocUnsafe(rPadding + rLength + sPadding + sLength)\n\n  for (offset = 0; offset < rPadding; ++offset) {\n    dst[offset] = 0\n  }\n  signature.copy(dst, offset, rOffset + Math.max(-rPadding, 0), rOffset + rLength)\n\n  offset = paramBytes\n\n  for (const o = offset; offset < o + sPadding; ++offset) {\n    dst[offset] = 0\n  }\n  signature.copy(dst, offset, sOffset + Math.max(-sPadding, 0), sOffset + sLength)\n\n  return dst\n}\n\nmodule.exports.joseToDer = (signature, alg) => {\n  if (!Buffer.isBuffer(signature)) {\n    throw new TypeError('ECDSA signature must be a Buffer')\n  }\n\n  if (!paramBytesForAlg[alg]) {\n    throw new TypeError(`Unknown algorithm \"${alg}\"`)\n  }\n\n  const paramBytes = paramBytesForAlg[alg]\n\n  const signatureBytes = signature.length\n  if (signatureBytes !== paramBytes * 2) {\n    throw new Error(`\"${alg}\" signatures must be \"${paramBytes * 2}\" bytes, saw \"${signatureBytes}\"`)\n  }\n\n  const rPadding = countPadding(signature, 0, paramBytes)\n  const sPadding = countPadding(signature, paramBytes, signature.length)\n  const rLength = paramBytes - rPadding\n  const sLength = paramBytes - sPadding\n\n  const rsBytes = 1 + 1 + rLength + 1 + 1 + sLength\n\n  const shortLength = rsBytes < MAX_OCTET\n\n  const dst = Buffer.allocUnsafe((shortLength ? 2 : 3) + rsBytes)\n\n  let offset = 0\n  dst[offset++] = ENCODED_TAG_SEQ\n  if (shortLength) {\n    // Bit 8 has value \"0\"\n    // bits 7-1 give the length.\n    dst[offset++] = rsBytes\n  } else {\n    // Bit 8 of first octet has value \"1\"\n    // bits 7-1 give the number of additional length octets.\n    dst[offset++] = MAX_OCTET\t| 1 // eslint-disable-line no-tabs\n    // length, base 256\n    dst[offset++] = rsBytes & 0xff\n  }\n  dst[offset++] = ENCODED_TAG_INT\n  dst[offset++] = rLength\n  if (rPadding < 0) {\n    dst[offset++] = 0\n    offset += signature.copy(dst, offset, 0, paramBytes)\n  } else {\n    offset += signature.copy(dst, offset, rPadding, paramBytes)\n  }\n  dst[offset++] = ENCODED_TAG_INT\n  dst[offset++] = sLength\n  if (sPadding < 0) {\n    dst[offset++] = 0\n    signature.copy(dst, offset, paramBytes)\n  } else {\n    signature.copy(dst, offset, paramBytes + sPadding)\n  }\n\n  return dst\n}\n", "const { sign: signOneShot, verify: verifyOneShot, createSign, createVerify, getCurves } = require('crypto')\n\nconst { derToJose, joseToDer } = require('../help/ecdsa_signatures')\nconst { KEYOBJECT } = require('../help/consts')\nconst resolveNodeAlg = require('../help/node_alg')\nconst { asInput } = require('../help/key_object')\nconst { dsaEncodingSupported } = require('../help/runtime_support')\nconst { name: secp256k1 } = require('../jwk/key/secp256k1_crv')\n\nlet sign, verify\n\nif (dsaEncodingSupported) {\n  sign = (jwaAlg, nodeAlg, { [KEYOBJECT]: keyObject }, payload) => {\n    if (typeof payload === 'string') {\n      payload = Buffer.from(payload)\n    }\n    return signOneShot(nodeAlg, payload, { key: asInput(keyObject, false), dsaEncoding: 'ieee-p1363' })\n  }\n  verify = (jwaAlg, nodeAlg, { [KEYOBJECT]: keyObject }, payload, signature) => {\n    try {\n      return verifyOneShot(nodeAlg, payload, { key: asInput(keyObject, true), dsaEncoding: 'ieee-p1363' }, signature)\n    } catch (err) {\n      return false\n    }\n  }\n} else {\n  sign = (jwaAlg, nodeAlg, { [KEYOBJECT]: keyObject }, payload) => {\n    return derToJose(createSign(nodeAlg).update(payload).sign(asInput(keyObject, false)), jwaAlg)\n  }\n  verify = (jwaAlg, nodeAlg, { [KEYOBJECT]: keyObject }, payload, signature) => {\n    try {\n      return createVerify(nodeAlg).update(payload).verify(asInput(keyObject, true), joseToDer(signature, jwaAlg))\n    } catch (err) {\n      return false\n    }\n  }\n}\n\nconst crvToAlg = (crv) => {\n  switch (crv) {\n    case 'P-256':\n      return 'ES256'\n    case secp256k1:\n      return 'ES256K'\n    case 'P-384':\n      return 'ES384'\n    case 'P-521':\n      return 'ES512'\n  }\n}\n\nmodule.exports = (JWA, JWK) => {\n  const algs = []\n\n  if (getCurves().includes('prime256v1')) {\n    algs.push('ES256')\n  }\n\n  if (getCurves().includes('secp256k1')) {\n    algs.push('ES256K')\n  }\n\n  if (getCurves().includes('secp384r1')) {\n    algs.push('ES384')\n  }\n\n  if (getCurves().includes('secp521r1')) {\n    algs.push('ES512')\n  }\n\n  algs.forEach((jwaAlg) => {\n    const nodeAlg = resolveNodeAlg(jwaAlg)\n    JWA.sign.set(jwaAlg, sign.bind(undefined, jwaAlg, nodeAlg))\n    JWA.verify.set(jwaAlg, verify.bind(undefined, jwaAlg, nodeAlg))\n    JWK.EC.sign[jwaAlg] = key => key.private && JWK.EC.verify[jwaAlg](key)\n    JWK.EC.verify[jwaAlg] = key => (key.use === 'sig' || key.use === undefined) && crvToAlg(key.crv) === jwaAlg\n  })\n}\n", "const { sign: signOneShot, verify: verifyOneShot } = require('crypto')\n\nconst { KEYOBJECT } = require('../help/consts')\nconst { edDSASupported } = require('../help/runtime_support')\n\nconst sign = ({ [KEYOBJECT]: keyObject }, payload) => {\n  if (typeof payload === 'string') {\n    payload = Buffer.from(payload)\n  }\n  return signOneShot(undefined, payload, keyObject)\n}\n\nconst verify = ({ [KEYOBJECT]: keyObject }, payload, signature) => {\n  return verifyOneShot(undefined, payload, keyObject, signature)\n}\n\nmodule.exports = (JWA, JWK) => {\n  if (edDSASupported) {\n    JWA.sign.set('EdDSA', sign)\n    JWA.verify.set('EdDSA', verify)\n    JWK.OKP.sign.EdDSA = key => key.private && JWK.OKP.verify.EdDSA(key)\n    JWK.OKP.verify.EdDSA = key => (key.use === 'sig' || key.use === undefined) && key.keyObject.asymmetricKeyType.startsWith('ed')\n  }\n}\n", "const {\n  createSign,\n  createVerify,\n  constants\n} = require('crypto')\n\nconst { KEYOBJECT } = require('../help/consts')\nconst resolveNodeAlg = require('../help/node_alg')\nconst { asInput } = require('../help/key_object')\n\nconst sign = (nodeAlg, { [KEYOBJECT]: keyObject }, payload) => {\n  const key = asInput(keyObject, false)\n  return createSign(nodeAlg).update(payload).sign({\n    key,\n    padding: constants.RSA_PKCS1_PSS_PADDING,\n    saltLength: constants.RSA_PSS_SALTLEN_DIGEST\n  })\n}\n\nconst verify = (nodeAlg, { [KEYOBJECT]: keyObject }, payload, signature) => {\n  const key = asInput(keyObject, true)\n  return createVerify(nodeAlg).update(payload).verify({\n    key,\n    padding: constants.RSA_PKCS1_PSS_PADDING,\n    saltLength: constants.RSA_PSS_SALTLEN_DIGEST\n  }, signature)\n}\n\nconst LENGTHS = {\n  PS256: 528,\n  PS384: 784,\n  PS512: 1040\n}\n\nmodule.exports = (JWA, JWK) => {\n  ['PS256', 'PS384', 'PS512'].forEach((jwaAlg) => {\n    const nodeAlg = resolveNodeAlg(jwaAlg)\n    JWA.sign.set(jwaAlg, sign.bind(undefined, nodeAlg))\n    JWA.verify.set(jwaAlg, verify.bind(undefined, nodeAlg))\n    JWK.RSA.sign[jwaAlg] = key => key.private && JWK.RSA.verify[jwaAlg](key)\n    JWK.RSA.verify[jwaAlg] = key => (key.use === 'sig' || key.use === undefined) && key.length >= LENGTHS[jwaAlg]\n  })\n}\n", "const { createSign, createVerify } = require('crypto')\n\nconst { KEYOBJECT } = require('../help/consts')\nconst resolveNodeAlg = require('../help/node_alg')\nconst { asInput } = require('../help/key_object')\n\nconst sign = (nodeAlg, { [KEYOBJECT]: keyObject }, payload) => {\n  return createSign(nodeAlg).update(payload).sign(asInput(keyObject, false))\n}\n\nconst verify = (nodeAlg, { [KEYOBJECT]: keyObject }, payload, signature) => {\n  return createVerify(nodeAlg).update(payload).verify(asInput(keyObject, true), signature)\n}\n\nconst LENGTHS = {\n  RS256: 0,\n  RS384: 624,\n  RS512: 752\n}\n\nmodule.exports = (JWA, JWK) => {\n  ['RS256', 'RS384', 'RS512'].forEach((jwaAlg) => {\n    const nodeAlg = resolveNodeAlg(jwaAlg)\n    JWA.sign.set(jwaAlg, sign.bind(undefined, nodeAlg))\n    JWA.verify.set(jwaAlg, verify.bind(undefined, nodeAlg))\n    JWK.RSA.sign[jwaAlg] = key => key.private && JWK.RSA.verify[jwaAlg](key)\n    JWK.RSA.verify[jwaAlg] = key => (key.use === 'sig' || key.use === undefined) && key.length >= LENGTHS[jwaAlg]\n  })\n}\n", "const sign = () => Buffer.from('')\nconst verify = (key, payload, signature) => !signature.length\n\nmodule.exports = (JWA, JWK) => {\n  JWA.sign.set('none', sign)\n  JWA.verify.set('none', verify)\n}\n", "const MAX_INT32 = Math.pow(2, 32)\n\nmodule.exports = (value, buf = Buffer.allocUnsafe(8)) => {\n  const high = Math.floor(value / MAX_INT32)\n  const low = value % MAX_INT32\n\n  buf.writeUInt32BE(high, 0)\n  buf.writeUInt32BE(low, 4)\n  return buf\n}\n", "const { createCipheriv, createDecipheriv, getCiphers } = require('crypto')\n\nconst uint64be = require('../help/uint64be')\nconst timingSafeEqual = require('../help/timing_safe_equal')\nconst { KEYOBJECT } = require('../help/consts')\nconst { JWEInvalid, JWEDecryptionFailed } = require('../errors')\n\nconst checkInput = function (size, iv, tag) {\n  if (iv.length !== 16) {\n    throw new JWEInvalid('invalid iv')\n  }\n  if (arguments.length === 3) {\n    if (tag.length !== size / 8) {\n      throw new JWEInvalid('invalid tag')\n    }\n  }\n}\n\nconst encrypt = (size, sign, { [KEYOBJECT]: keyObject }, cleartext, { iv, aad = Buffer.alloc(0) }) => {\n  const key = keyObject.export()\n  checkInput(size, iv)\n\n  const keySize = size / 8\n  const encKey = key.slice(keySize)\n  const cipher = createCipheriv(`aes-${size}-cbc`, encKey, iv)\n  const ciphertext = Buffer.concat([cipher.update(cleartext), cipher.final()])\n  const macData = Buffer.concat([aad, iv, ciphertext, uint64be(aad.length * 8)])\n\n  const macKey = key.slice(0, keySize)\n  const tag = sign({ [KEYOBJECT]: macKey }, macData).slice(0, keySize)\n\n  return { ciphertext, tag }\n}\n\nconst decrypt = (size, sign, { [KEYOBJECT]: keyObject }, ciphertext, { iv, tag = Buffer.alloc(0), aad = Buffer.alloc(0) }) => {\n  checkInput(size, iv, tag)\n\n  const keySize = size / 8\n  const key = keyObject.export()\n  const encKey = key.slice(keySize)\n  const macKey = key.slice(0, keySize)\n\n  const macData = Buffer.concat([aad, iv, ciphertext, uint64be(aad.length * 8)])\n  const expectedTag = sign({ [KEYOBJECT]: macKey }, macData, tag).slice(0, keySize)\n  const macCheckPassed = timingSafeEqual(tag, expectedTag)\n\n  if (!macCheckPassed) {\n    throw new JWEDecryptionFailed()\n  }\n\n  let cleartext\n  try {\n    const cipher = createDecipheriv(`aes-${size}-cbc`, encKey, iv)\n    cleartext = Buffer.concat([cipher.update(ciphertext), cipher.final()])\n  } catch (err) {}\n\n  if (!cleartext) {\n    throw new JWEDecryptionFailed()\n  }\n\n  return cleartext\n}\n\nmodule.exports = (JWA, JWK) => {\n  ['A128CBC-HS256', 'A192CBC-HS384', 'A256CBC-HS512'].forEach((jwaAlg) => {\n    const size = parseInt(jwaAlg.substr(1, 3), 10)\n    const sign = JWA.sign.get(`HS${size * 2}`)\n    if (getCiphers().includes(`aes-${size}-cbc`)) {\n      JWA.encrypt.set(jwaAlg, encrypt.bind(undefined, size, sign))\n      JWA.decrypt.set(jwaAlg, decrypt.bind(undefined, size, sign))\n      JWK.oct.encrypt[jwaAlg] = JWK.oct.decrypt[jwaAlg] = key => (key.use === 'enc' || key.use === undefined) && key.length / 2 === size\n    }\n  })\n}\n", "const { createCipheriv, createDecipheriv, getCiphers } = require('crypto')\n\nconst { KEYOBJECT } = require('../help/consts')\nconst { JWEInvalid, JWEDecryptionFailed } = require('../errors')\nconst { asInput } = require('../help/key_object')\n\nconst checkInput = function (size, iv, tag) {\n  if (iv.length !== 12) {\n    throw new JWEInvalid('invalid iv')\n  }\n  if (arguments.length === 3) {\n    if (tag.length !== 16) {\n      throw new JWEInvalid('invalid tag')\n    }\n  }\n}\n\nconst encrypt = (size, { [KEYOBJECT]: keyObject }, cleartext, { iv, aad = Buffer.alloc(0) }) => {\n  const key = asInput(keyObject, false)\n  checkInput(size, iv)\n\n  const cipher = createCipheriv(`aes-${size}-gcm`, key, iv, { authTagLength: 16 })\n  cipher.setAAD(aad)\n\n  const ciphertext = Buffer.concat([cipher.update(cleartext), cipher.final()])\n  const tag = cipher.getAuthTag()\n\n  return { ciphertext, tag }\n}\n\nconst decrypt = (size, { [KEYOBJECT]: keyObject }, ciphertext, { iv, tag = Buffer.alloc(0), aad = Buffer.alloc(0) }) => {\n  const key = asInput(keyObject, false)\n  checkInput(size, iv, tag)\n\n  try {\n    const cipher = createDecipheriv(`aes-${size}-gcm`, key, iv, { authTagLength: 16 })\n    cipher.setAuthTag(tag)\n    cipher.setAAD(aad)\n\n    return Buffer.concat([cipher.update(ciphertext), cipher.final()])\n  } catch (err) {\n    throw new JWEDecryptionFailed()\n  }\n}\n\nmodule.exports = (JWA, JWK) => {\n  ['A128GCM', 'A192GCM', 'A256GCM'].forEach((jwaAlg) => {\n    const size = parseInt(jwaAlg.substr(1, 3), 10)\n    if (getCiphers().includes(`aes-${size}-gcm`)) {\n      JWA.encrypt.set(jwaAlg, encrypt.bind(undefined, size))\n      JWA.decrypt.set(jwaAlg, decrypt.bind(undefined, size))\n      JWK.oct.encrypt[jwaAlg] = JWK.oct.decrypt[jwaAlg] = key => (key.use === 'enc' || key.use === undefined) && key.length === size\n    }\n  })\n}\n", "const { publicEncrypt, privateDecrypt, constants } = require('crypto')\n\nconst { oaepHashSupported } = require('../help/runtime_support')\nconst { KEYOBJECT } = require('../help/consts')\nconst { asInput } = require('../help/key_object')\n\nconst resolvePadding = (alg) => {\n  switch (alg) {\n    case 'RSA-OAEP':\n    case 'RSA-OAEP-256':\n    case 'RSA-OAEP-384':\n    case 'RSA-OAEP-512':\n      return constants.RSA_PKCS1_OAEP_PADDING\n    case 'RSA1_5':\n      return constants.RSA_PKCS1_PADDING\n  }\n}\n\nconst resolveOaepHash = (alg) => {\n  switch (alg) {\n    case 'RSA-OAEP':\n      return 'sha1'\n    case 'RSA-OAEP-256':\n      return 'sha256'\n    case 'RSA-OAEP-384':\n      return 'sha384'\n    case 'RSA-OAEP-512':\n      return 'sha512'\n    default:\n      return undefined\n  }\n}\n\nconst wrapKey = (padding, oaepHash, { [KEYOBJECT]: keyObject }, payload) => {\n  const key = asInput(keyObject, true)\n  return { wrapped: publicEncrypt({ key, oaepHash, padding }, payload) }\n}\n\nconst unwrapKey = (padding, oaepHash, { [KEYOBJECT]: keyObject }, payload) => {\n  const key = asInput(keyObject, false)\n  return privateDecrypt({ key, oaepHash, padding }, payload)\n}\n\nconst LENGTHS = {\n  RSA1_5: 0,\n  'RSA-OAEP': 592,\n  'RSA-OAEP-256': 784,\n  'RSA-OAEP-384': 1040,\n  'RSA-OAEP-512': 1296\n}\n\nmodule.exports = (JWA, JWK) => {\n  const algs = ['RSA-OAEP', 'RSA1_5']\n\n  if (oaepHashSupported) {\n    algs.splice(1, 0, 'RSA-OAEP-256', 'RSA-OAEP-384', 'RSA-OAEP-512')\n  }\n\n  algs.forEach((jwaAlg) => {\n    const padding = resolvePadding(jwaAlg)\n    const oaepHash = resolveOaepHash(jwaAlg)\n    JWA.keyManagementEncrypt.set(jwaAlg, wrapKey.bind(undefined, padding, oaepHash))\n    JWA.keyManagementDecrypt.set(jwaAlg, unwrapKey.bind(undefined, padding, oaepHash))\n    JWK.RSA.wrapKey[jwaAlg] = key => (key.use === 'enc' || key.use === undefined) && key.length >= LENGTHS[jwaAlg]\n    JWK.RSA.unwrapKey[jwaAlg] = key => key.private && (key.use === 'enc' || key.use === undefined) && key.length >= LENGTHS[jwaAlg]\n  })\n}\n", "const { createCipheriv, createDecipheriv, getCiphers } = require('crypto')\n\nconst { KEYOBJECT } = require('../help/consts')\nconst { asInput } = require('../help/key_object')\n\nconst checkInput = (data) => {\n  if (data !== undefined && data.length % 8 !== 0) {\n    throw new Error('invalid data length')\n  }\n}\n\nconst wrapKey = (alg, { [KEYOBJECT]: keyObject }, payload) => {\n  const key = asInput(keyObject, false)\n  const cipher = createCipheriv(alg, key, Buffer.alloc(8, 'a6', 'hex'))\n\n  return { wrapped: Buffer.concat([cipher.update(payload), cipher.final()]) }\n}\n\nconst unwrapKey = (alg, { [KEYOBJECT]: keyObject }, payload) => {\n  const key = asInput(keyObject, false)\n  checkInput(payload)\n  const cipher = createDecipheriv(alg, key, Buffer.alloc(8, 'a6', 'hex'))\n\n  return Buffer.concat([cipher.update(payload), cipher.final()])\n}\n\nmodule.exports = (JWA, JWK) => {\n  ['A128KW', 'A192KW', 'A256KW'].forEach((jwaAlg) => {\n    const size = parseInt(jwaAlg.substr(1, 3), 10)\n    const alg = `aes${size}-wrap`\n    if (getCiphers().includes(alg)) {\n      JWA.keyManagementEncrypt.set(jwaAlg, wrapKey.bind(undefined, alg))\n      JWA.keyManagementDecrypt.set(jwaAlg, unwrapKey.bind(undefined, alg))\n      JWK.oct.wrapKey[jwaAlg] = JWK.oct.unwrapKey[jwaAlg] = key => (key.use === 'enc' || key.use === undefined) && key.length === size\n    }\n  })\n}\n", "const generateIV = require('../help/generate_iv')\nconst base64url = require('../help/base64url')\n\nmodule.exports = (JWA, JWK) => {\n  ['A128GCMKW', 'A192GCMKW', 'A256GCMKW'].forEach((jwaAlg) => {\n    const encAlg = jwaAlg.substr(0, 7)\n    const size = parseInt(jwaAlg.substr(1, 3), 10)\n    const encrypt = JWA.encrypt.get(encAlg)\n    const decrypt = JWA.decrypt.get(encAlg)\n\n    if (encrypt && decrypt) {\n      JWA.keyManagementEncrypt.set(jwaAlg, (key, payload) => {\n        const iv = generateIV(jwaAlg)\n        const { ciphertext, tag } = encrypt(key, payload, { iv })\n        return {\n          wrapped: ciphertext,\n          header: { tag: base64url.encodeBuffer(tag), iv: base64url.encodeBuffer(iv) }\n        }\n      })\n      JWA.keyManagementDecrypt.set(jwaAlg, decrypt)\n      JWK.oct.wrapKey[jwaAlg] = JWK.oct.unwrapKey[jwaAlg] = key => (key.use === 'enc' || key.use === undefined) && key.length === size\n    }\n  })\n}\n", "const { pbkdf2Sync: pbkdf2, randomBytes } = require('crypto')\n\nconst { KEYOBJECT } = require('../help/consts')\nconst base64url = require('../help/base64url')\n\nconst SALT_LENGTH = 16\nconst NULL_BUFFER = Buffer.alloc(1, 0)\n\nconst concatSalt = (alg, p2s) => {\n  return Buffer.concat([\n    Buffer.from(alg, 'utf8'),\n    NULL_BUFFER,\n    p2s\n  ])\n}\n\nconst wrapKey = (keylen, sha, concat, wrap, { [KEYOBJECT]: keyObject }, payload) => {\n  // Note that if password-based encryption is used for multiple\n  // recipients, it is expected that each recipient use different values\n  // for the PBES2 parameters \"p2s\" and \"p2c\".\n  // here we generate p2c between 2048 and 4096 and random p2s\n  const p2c = Math.floor((Math.random() * 2049) + 2048)\n  const p2s = randomBytes(SALT_LENGTH)\n  const salt = concat(p2s)\n\n  const derivedKey = pbkdf2(keyObject.export(), salt, p2c, keylen, sha)\n\n  const result = wrap({ [KEYOBJECT]: derivedKey }, payload)\n  result.header = result.header || {}\n  Object.assign(result.header, { p2c, p2s: base64url.encodeBuffer(p2s) })\n\n  return result\n}\n\nconst unwrapKey = (keylen, sha, concat, unwrap, { [KEYOBJECT]: keyObject }, payload, header) => {\n  const { p2s, p2c } = header\n  const salt = concat(p2s)\n  const derivedKey = pbkdf2(keyObject.export(), salt, p2c, keylen, sha)\n  return unwrap({ [KEYOBJECT]: derivedKey }, payload, header)\n}\n\nmodule.exports = (JWA, JWK) => {\n  ['PBES2-HS256+A128KW', 'PBES2-HS384+A192KW', 'PBES2-HS512+A256KW'].forEach((jwaAlg) => {\n    const kw = jwaAlg.substr(-6)\n    const kwWrap = JWA.keyManagementEncrypt.get(kw)\n    const kwUnwrap = JWA.keyManagementDecrypt.get(kw)\n    const keylen = parseInt(jwaAlg.substr(13, 3), 10) / 8\n    const sha = `sha${jwaAlg.substr(8, 3)}`\n\n    if (kwWrap && kwUnwrap) {\n      JWA.keyManagementEncrypt.set(jwaAlg, wrapKey.bind(undefined, keylen, sha, concatSalt.bind(undefined, jwaAlg), kwWrap))\n      JWA.keyManagementDecrypt.set(jwaAlg, unwrapKey.bind(undefined, keylen, sha, concatSalt.bind(undefined, jwaAlg), kwUnwrap))\n      JWK.oct.deriveKey[jwaAlg] = key => key.use === 'enc' || key.use === undefined\n    }\n  })\n}\n", "const { improvedDH } = require('../../help/runtime_support')\n\nif (improvedDH) {\n  const { diffieHellman } = require('crypto')\n\n  const { KeyObject } = require('../../help/key_object')\n  const importKey = require('../../jwk/import')\n\n  module.exports = ({ keyObject: privateKey }, publicKey) => {\n    if (!(publicKey instanceof KeyObject)) {\n      ({ keyObject: publicKey } = importKey(publicKey))\n    }\n\n    return diffieHellman({ privateKey, publicKey })\n  }\n} else {\n  const { createECDH, constants: { POINT_CONVERSION_UNCOMPRESSED } } = require('crypto')\n\n  const base64url = require('../../help/base64url')\n\n  const crvToCurve = (crv) => {\n    switch (crv) {\n      case 'P-256':\n        return 'prime256v1'\n      case 'P-384':\n        return 'secp384r1'\n      case 'P-521':\n        return 'secp521r1'\n    }\n  }\n\n  const UNCOMPRESSED = Buffer.alloc(1, POINT_CONVERSION_UNCOMPRESSED)\n  const pubToBuffer = (x, y) => Buffer.concat([UNCOMPRESSED, base64url.decodeToBuffer(x), base64url.decodeToBuffer(y)])\n\n  module.exports = ({ crv, d }, { x, y }) => {\n    const curve = crvToCurve(crv)\n    const exchange = createECDH(curve)\n\n    exchange.setPrivateKey(base64url.decodeToBuffer(d))\n\n    return exchange.computeSecret(pubToBuffer(x, y))\n  }\n}\n", "const { createHash } = require('crypto')\nconst ecdhComputeSecret = require('./compute_secret')\n\nconst concat = (key, length, value) => {\n  const iterations = Math.ceil(length / 32)\n  let res\n\n  for (let iter = 1; iter <= iterations; iter++) {\n    const buf = Buffer.allocUnsafe(4 + key.length + value.length)\n    buf.writeUInt32BE(iter, 0)\n    key.copy(buf, 4)\n    value.copy(buf, 4 + key.length)\n    if (!res) {\n      res = createHash('sha256').update(buf).digest()\n    } else {\n      res = Buffer.concat([res, createHash('sha256').update(buf).digest()])\n    }\n  }\n\n  return res.slice(0, length)\n}\n\nconst uint32be = (value, buf = Buffer.allocUnsafe(4)) => {\n  buf.writeUInt32BE(value)\n  return buf\n}\n\nconst lengthAndInput = input => Buffer.concat([uint32be(input.length), input])\n\nmodule.exports = (alg, keyLen, privKey, pubKey, { apu = Buffer.alloc(0), apv = Buffer.alloc(0) } = {}, computeSecret = ecdhComputeSecret) => {\n  const value = Buffer.concat([\n    lengthAndInput(Buffer.from(alg)),\n    lengthAndInput(apu),\n    lengthAndInput(apv),\n    uint32be(keyLen)\n  ])\n\n  const sharedSecret = computeSecret(privKey, pubKey)\n  return concat(sharedSecret, keyLen / 8, value)\n}\n", "const { improvedDH } = require('../../help/runtime_support')\nconst { KEYLENGTHS } = require('../../registry')\nconst { generateSync } = require('../../jwk/generate')\nconst { name: secp256k1 } = require('../../jwk/key/secp256k1_crv')\n\nconst derive = require('./derive')\n\nconst wrapKey = (key, payload, { enc }) => {\n  const epk = generateSync(key.kty, key.crv)\n\n  const derivedKey = derive(enc, KEYLENGTHS.get(enc), epk, key)\n\n  return {\n    wrapped: derivedKey,\n    header: { epk: { kty: key.kty, crv: key.crv, x: epk.x, y: epk.y } }\n  }\n}\n\nconst unwrapKey = (key, payload, header) => {\n  const { enc, epk } = header\n  return derive(enc, KEYLENGTHS.get(enc), key, epk, header)\n}\n\nmodule.exports = (JWA, JWK) => {\n  JWA.keyManagementEncrypt.set('ECDH-ES', wrapKey)\n  JWA.keyManagementDecrypt.set('ECDH-ES', unwrapKey)\n  JWK.EC.deriveKey['ECDH-ES'] = key => (key.use === 'enc' || key.use === undefined) && key.crv !== secp256k1\n\n  if (improvedDH) {\n    JWK.OKP.deriveKey['ECDH-ES'] = key => (key.use === 'enc' || key.use === undefined) && key.keyObject.asymmetricKeyType.startsWith('x')\n  }\n}\n", "const { improvedDH } = require('../../help/runtime_support')\nconst { KEYOBJECT } = require('../../help/consts')\nconst { generateSync } = require('../../jwk/generate')\nconst { name: secp256k1 } = require('../../jwk/key/secp256k1_crv')\nconst { ECDH_DERIVE_LENGTHS } = require('../../registry')\n\nconst derive = require('./derive')\n\nconst wrapKey = (wrap, derive, key, payload) => {\n  const epk = generateSync(key.kty, key.crv)\n\n  const derivedKey = derive(epk, key, payload)\n\n  const result = wrap({ [KEYOBJECT]: derivedKey }, payload)\n  result.header = result.header || {}\n  Object.assign(result.header, { epk: { kty: key.kty, crv: key.crv, x: epk.x, y: epk.y } })\n\n  return result\n}\n\nconst unwrapKey = (unwrap, derive, key, payload, header) => {\n  const { epk } = header\n  const derivedKey = derive(key, epk, header)\n\n  return unwrap({ [KEYOBJECT]: derivedKey }, payload, header)\n}\n\nmodule.exports = (JWA, JWK) => {\n  ['ECDH-ES+A128KW', 'ECDH-ES+A192KW', 'ECDH-ES+A256KW'].forEach((jwaAlg) => {\n    const kw = jwaAlg.substr(-6)\n    const kwWrap = JWA.keyManagementEncrypt.get(kw)\n    const kwUnwrap = JWA.keyManagementDecrypt.get(kw)\n    const keylen = parseInt(jwaAlg.substr(9, 3), 10)\n    ECDH_DERIVE_LENGTHS.set(jwaAlg, keylen)\n\n    if (kwWrap && kwUnwrap) {\n      JWA.keyManagementEncrypt.set(jwaAlg, wrapKey.bind(undefined, kwWrap, derive.bind(undefined, jwaAlg, keylen)))\n      JWA.keyManagementDecrypt.set(jwaAlg, unwrapKey.bind(undefined, kwUnwrap, derive.bind(undefined, jwaAlg, keylen)))\n      JWK.EC.deriveKey[jwaAlg] = key => (key.use === 'enc' || key.use === undefined) && key.crv !== secp256k1\n\n      if (improvedDH) {\n        JWK.OKP.deriveKey[jwaAlg] = key => (key.use === 'enc' || key.use === undefined) && key.keyObject.asymmetricKeyType.startsWith('x')\n      }\n    }\n  })\n}\nmodule.exports.wrapKey = wrapKey\nmodule.exports.unwrapKey = unwrapKey\n", "const { JWKKeySupport, JOSENotSupported } = require('../errors')\nconst { KEY_MANAGEMENT_ENCRYPT, KEY_MANAGEMENT_DECRYPT } = require('../help/consts')\n\nconst { JWA, JWK } = require('../registry')\n\n// sign, verify\nrequire('./hmac')(JWA, JWK)\nrequire('./ecdsa')(JWA, JWK)\nrequire('./eddsa')(JWA, JWK)\nrequire('./rsassa_pss')(JWA, JWK)\nrequire('./rsassa')(JWA, JWK)\nrequire('./none')(JWA)\n\n// encrypt, decrypt\nrequire('./aes_cbc_hmac_sha2')(JWA, JWK)\nrequire('./aes_gcm')(JWA, JWK)\n\n// wrapKey, unwrapKey\nrequire('./rsaes')(JWA, JWK)\nrequire('./aes_kw')(JWA, JWK)\nrequire('./aes_gcm_kw')(JWA, JWK)\n\n// deriveKey\nrequire('./pbes2')(JWA, JWK)\nrequire('./ecdh/dir')(JWA, JWK)\nrequire('./ecdh/kw')(JWA, JWK)\n\nconst check = (key, op, alg) => {\n  const cache = `_${op}_${alg}`\n\n  let label\n  let keyOp\n  if (op === 'keyManagementEncrypt') {\n    label = 'key management (encryption)'\n    keyOp = KEY_MANAGEMENT_ENCRYPT\n  } else if (op === 'keyManagementDecrypt') {\n    label = 'key management (decryption)'\n    keyOp = KEY_MANAGEMENT_DECRYPT\n  }\n\n  if (cache in key) {\n    if (key[cache]) {\n      return\n    }\n    throw new JWKKeySupport(`the key does not support ${alg} ${label || op} algorithm`)\n  }\n\n  let value = true\n  if (!JWA[op].has(alg)) {\n    throw new JOSENotSupported(`unsupported ${label || op} alg: ${alg}`)\n  } else if (!key.algorithms(keyOp).has(alg)) {\n    value = false\n  }\n\n  Object.defineProperty(key, cache, { value, enumerable: false })\n\n  if (!value) {\n    return check(key, op, alg)\n  }\n}\n\nmodule.exports = {\n  check,\n  sign: (alg, key, payload) => {\n    check(key, 'sign', alg)\n    return JWA.sign.get(alg)(key, payload)\n  },\n  verify: (alg, key, payload, signature) => {\n    check(key, 'verify', alg)\n    return JWA.verify.get(alg)(key, payload, signature)\n  },\n  keyManagementEncrypt: (alg, key, payload, opts) => {\n    check(key, 'keyManagementEncrypt', alg)\n    return JWA.keyManagementEncrypt.get(alg)(key, payload, opts)\n  },\n  keyManagementDecrypt: (alg, key, payload, opts) => {\n    check(key, 'keyManagementDecrypt', alg)\n    return JWA.keyManagementDecrypt.get(alg)(key, payload, opts)\n  },\n  encrypt: (alg, key, cleartext, opts) => {\n    check(key, 'encrypt', alg)\n    return JWA.encrypt.get(alg)(key, cleartext, opts)\n  },\n  decrypt: (alg, key, ciphertext, opts) => {\n    check(key, 'decrypt', alg)\n    return JWA.decrypt.get(alg)(key, ciphertext, opts)\n  }\n}\n", "const { JOSECritNotUnderstood, JWSInvalid } = require('../errors')\n\nconst DEFINED = new Set([\n  'alg', 'jku', 'jwk', 'kid', 'x5u', 'x5c', 'x5t', 'x5t#S256', 'typ', 'cty',\n  'crit', 'enc', 'zip', 'epk', 'apu', 'apv', 'iv', 'tag', 'p2s', 'p2c'\n])\n\nmodule.exports = function validateCrit (Err, protectedHeader, unprotectedHeader, understood) {\n  if (protectedHeader && 'crit' in protectedHeader) {\n    if (\n      !Array.isArray(protectedHeader.crit) ||\n      protectedHeader.crit.length === 0 ||\n      protectedHeader.crit.some(s => typeof s !== 'string' || !s)\n    ) {\n      throw new Err('\"crit\" Header Parameter MUST be an array of non-empty strings when present')\n    }\n    const whitelisted = new Set(understood)\n    const combined = { ...protectedHeader, ...unprotectedHeader }\n    protectedHeader.crit.forEach((parameter) => {\n      if (DEFINED.has(parameter)) {\n        throw new Err(`The critical list contains a non-extension Header Parameter ${parameter}`)\n      }\n      if (!whitelisted.has(parameter)) {\n        throw new JOSECritNotUnderstood(`critical \"${parameter}\" is not understood`)\n      }\n      if (parameter === 'b64') {\n        if (!('b64' in protectedHeader)) {\n          throw new JWSInvalid('\"b64\" critical parameter must be integrity protected')\n        }\n        if (typeof protectedHeader.b64 !== 'boolean') {\n          throw new JWSInvalid('\"b64\" critical parameter must be a boolean')\n        }\n      } else if (!(parameter in combined)) {\n        throw new Err(`critical parameter \"${parameter}\" is missing`)\n      }\n    })\n  }\n  if (unprotectedHeader && 'crit' in unprotectedHeader) {\n    throw new Err('\"crit\" Header Parameter MUST be integrity protected when present')\n  }\n}\n", "const isObject = require('../help/is_object')\nlet validateCrit = require('../help/validate_crit')\n\nconst { JWEInvalid } = require('../errors')\n\nvalidateCrit = validateCrit.bind(undefined, JWEInvalid)\n\nconst compactSerializer = (final, [recipient]) => {\n  return `${final.protected}.${recipient.encrypted_key}.${final.iv}.${final.ciphertext}.${final.tag}`\n}\ncompactSerializer.validate = (protectedHeader, unprotectedHeader, aad, { 0: { header }, length }) => {\n  if (length !== 1 || aad || unprotectedHeader || header) {\n    throw new JWEInvalid('JWE Compact Serialization doesn\\'t support multiple recipients, JWE unprotected headers or AAD')\n  }\n  validateCrit(protectedHeader, unprotectedHeader, protectedHeader ? protectedHeader.crit : undefined)\n}\n\nconst flattenedSerializer = (final, [recipient]) => {\n  const { header, encrypted_key: encryptedKey } = recipient\n\n  return {\n    ...(final.protected ? { protected: final.protected } : undefined),\n    ...(final.unprotected ? { unprotected: final.unprotected } : undefined),\n    ...(header ? { header } : undefined),\n    ...(encryptedKey ? { encrypted_key: encryptedKey } : undefined),\n    ...(final.aad ? { aad: final.aad } : undefined),\n    iv: final.iv,\n    ciphertext: final.ciphertext,\n    tag: final.tag\n  }\n}\nflattenedSerializer.validate = (protectedHeader, unprotectedHeader, aad, { 0: { header }, length }) => {\n  if (length !== 1) {\n    throw new JWEInvalid('Flattened JWE JSON Serialization doesn\\'t support multiple recipients')\n  }\n  validateCrit(protectedHeader, { ...unprotectedHeader, ...header }, protectedHeader ? protectedHeader.crit : undefined)\n}\n\nconst generalSerializer = (final, recipients) => {\n  const result = {\n    ...(final.protected ? { protected: final.protected } : undefined),\n    ...(final.unprotected ? { unprotected: final.unprotected } : undefined),\n    recipients: recipients.map(({ header, encrypted_key: encryptedKey, generatedHeader }) => {\n      if (!header && !encryptedKey && !generatedHeader) {\n        return false\n      }\n\n      return {\n        ...(header || generatedHeader ? { header: { ...header, ...generatedHeader } } : undefined),\n        ...(encryptedKey ? { encrypted_key: encryptedKey } : undefined)\n      }\n    }).filter(Boolean),\n    ...(final.aad ? { aad: final.aad } : undefined),\n    iv: final.iv,\n    ciphertext: final.ciphertext,\n    tag: final.tag\n  }\n\n  if (!result.recipients.length) {\n    delete result.recipients\n  }\n\n  return result\n}\ngeneralSerializer.validate = (protectedHeader, unprotectedHeader, aad, recipients) => {\n  recipients.forEach(({ header }) => {\n    validateCrit(protectedHeader, { ...header, ...unprotectedHeader }, protectedHeader ? protectedHeader.crit : undefined)\n  })\n}\n\nconst isJSON = (input) => {\n  return isObject(input) &&\n    typeof input.ciphertext === 'string' &&\n    typeof input.iv === 'string' &&\n    typeof input.tag === 'string' &&\n    (input.unprotected === undefined || isObject(input.unprotected)) &&\n    (input.protected === undefined || typeof input.protected === 'string') &&\n    (input.aad === undefined || typeof input.aad === 'string')\n}\n\nconst isSingleRecipient = (input) => {\n  return (input.encrypted_key === undefined || typeof input.encrypted_key === 'string') &&\n    (input.header === undefined || isObject(input.header))\n}\n\nconst isValidRecipient = (recipient) => {\n  return isObject(recipient) && typeof recipient.encrypted_key === 'string' && (recipient.header === undefined || isObject(recipient.header))\n}\n\nconst isMultiRecipient = (input) => {\n  if (Array.isArray(input.recipients) && input.recipients.every(isValidRecipient)) {\n    return true\n  }\n\n  return false\n}\n\nconst detect = (input) => {\n  if (typeof input === 'string' && input.split('.').length === 5) {\n    return 'compact'\n  }\n\n  if (isJSON(input)) {\n    if (isMultiRecipient(input)) {\n      return 'general'\n    }\n\n    if (isSingleRecipient(input)) {\n      return 'flattened'\n    }\n  }\n\n  throw new JWEInvalid('JWE malformed or invalid serialization')\n}\n\nmodule.exports = {\n  compact: compactSerializer,\n  flattened: flattenedSerializer,\n  general: generalSerializer,\n  detect\n}\n", "const { randomBytes } = require('crypto')\n\nconst { createSecretKey } = require('../help/key_object')\nconst { KEYLENGTHS } = require('../registry')\nconst Key = require('../jwk/key/oct')\n\nmodule.exports = (alg) => {\n  const keyLength = KEYLENGTHS.get(alg)\n\n  if (!keyLength) {\n    return new Key({ type: 'secret' })\n  }\n\n  return new Key(createSecretKey(randomBytes(keyLength / 8)), { use: 'enc', alg })\n}\n", "module.exports = (a = {}, b = {}) => {\n  const keysA = Object.keys(a)\n  const keysB = new Set(Object.keys(b))\n  return !keysA.some((ka) => keysB.has(ka))\n}\n", "const isDisjoint = require('../help/is_disjoint')\nconst base64url = require('../help/base64url')\nlet validateCrit = require('../help/validate_crit')\nconst { JWEInvalid, JOSENotSupported } = require('../errors')\n\nvalidateCrit = validateCrit.bind(undefined, JWEInvalid)\n\nmodule.exports = (prot, unprotected, recipients, checkAlgorithms, crit) => {\n  if (typeof prot === 'string') {\n    try {\n      prot = base64url.JSON.decode(prot)\n    } catch (err) {\n      throw new JWEInvalid('could not parse JWE protected header')\n    }\n  }\n\n  let alg = []\n  const enc = new Set()\n  if (!isDisjoint(prot, unprotected) || !recipients.every(({ header }) => {\n    if (typeof header === 'object') {\n      alg.push(header.alg)\n      enc.add(header.enc)\n    }\n    const combined = { ...unprotected, ...header }\n    validateCrit(prot, combined, crit)\n    if ('zip' in combined) {\n      throw new JWEInvalid('\"zip\" Header Parameter MUST be integrity protected')\n    } else if (prot && 'zip' in prot && prot.zip !== 'DEF') {\n      throw new JOSENotSupported('only \"DEF\" compression algorithm is supported')\n    }\n    return isDisjoint(header, prot) && isDisjoint(header, unprotected)\n  })) {\n    throw new JWEInvalid('JWE Shared Protected, JWE Shared Unprotected and JWE Per-Recipient Header Parameter names must be disjoint')\n  }\n\n  if (typeof prot === 'object') {\n    alg.push(prot.alg)\n    enc.add(prot.enc)\n  }\n  if (typeof unprotected === 'object') {\n    alg.push(unprotected.alg)\n    enc.add(unprotected.enc)\n  }\n\n  alg = alg.filter(Boolean)\n  enc.delete(undefined)\n\n  if (recipients.length !== 1) {\n    if (alg.includes('dir') || alg.includes('ECDH-ES')) {\n      throw new JWEInvalid('dir and ECDH-ES alg may only be used with a single recipient')\n    }\n  }\n\n  if (checkAlgorithms) {\n    if (alg.length !== recipients.length) {\n      throw new JWEInvalid('missing Key Management algorithm')\n    }\n    if (enc.size === 0) {\n      throw new JWEInvalid('missing Content Encryption algorithm')\n    } else if (enc.size !== 1) {\n      throw new JWEInvalid('there must only be one Content Encryption algorithm')\n    }\n  } else {\n    if (enc.size > 1) {\n      throw new JWEInvalid('there must only be one Content Encryption algorithm')\n    }\n  }\n\n  return [...enc][0]\n}\n", "const { deflateRawSync } = require('zlib')\n\nconst { KEYOBJECT } = require('../help/consts')\nconst generateIV = require('../help/generate_iv')\nconst base64url = require('../help/base64url')\nconst getKey = require('../help/get_key')\nconst isObject = require('../help/is_object')\nconst { createSecretKey } = require('../help/key_object')\nconst deepClone = require('../help/deep_clone')\nconst importKey = require('../jwk/import')\nconst { JWEInvalid } = require('../errors')\nconst { check, keyManagementEncrypt, encrypt } = require('../jwa')\n\nconst serializers = require('./serializers')\nconst generateCEK = require('./generate_cek')\nconst validateHeaders = require('./validate_headers')\n\nconst PROCESS_RECIPIENT = Symbol('PROCESS_RECIPIENT')\n\nclass Encrypt {\n  // TODO: in v2.x swap unprotectedHeader and aad\n  constructor (cleartext, protectedHeader, unprotectedHeader, aad) {\n    if (!Buffer.isBuffer(cleartext) && typeof cleartext !== 'string') {\n      throw new TypeError('cleartext argument must be a Buffer or a string')\n    }\n    cleartext = Buffer.from(cleartext)\n\n    if (aad !== undefined && !Buffer.isBuffer(aad) && typeof aad !== 'string') {\n      throw new TypeError('aad argument must be a Buffer or a string when provided')\n    }\n    aad = aad ? Buffer.from(aad) : undefined\n\n    if (protectedHeader !== undefined && !isObject(protectedHeader)) {\n      throw new TypeError('protectedHeader argument must be a plain object when provided')\n    }\n\n    if (unprotectedHeader !== undefined && !isObject(unprotectedHeader)) {\n      throw new TypeError('unprotectedHeader argument must be a plain object when provided')\n    }\n\n    this._recipients = []\n    this._cleartext = cleartext\n    this._aad = aad\n    this._unprotected = unprotectedHeader ? deepClone(unprotectedHeader) : undefined\n    this._protected = protectedHeader ? deepClone(protectedHeader) : undefined\n  }\n\n  /*\n   * @public\n   */\n  recipient (key, header) {\n    key = getKey(key)\n\n    if (header !== undefined && !isObject(header)) {\n      throw new TypeError('header argument must be a plain object when provided')\n    }\n\n    this._recipients.push({\n      key,\n      header: header ? deepClone(header) : undefined\n    })\n\n    return this\n  }\n\n  /*\n   * @private\n   */\n  [PROCESS_RECIPIENT] (recipient) {\n    const unprotectedHeader = this._unprotected\n    const protectedHeader = this._protected\n    const { length: recipientCount } = this._recipients\n\n    const jweHeader = {\n      ...protectedHeader,\n      ...unprotectedHeader,\n      ...recipient.header\n    }\n    const { key } = recipient\n\n    const enc = jweHeader.enc\n    let alg = jweHeader.alg\n\n    if (key.use === 'sig') {\n      throw new TypeError('a key with \"use\":\"sig\" is not usable for encryption')\n    }\n\n    if (alg === 'dir') {\n      check(key, 'encrypt', enc)\n    } else if (alg) {\n      check(key, 'keyManagementEncrypt', alg)\n    } else {\n      alg = key.alg || [...key.algorithms('wrapKey')][0] || [...key.algorithms('deriveKey')][0]\n\n      if (alg === 'ECDH-ES' && recipientCount !== 1) {\n        alg = [...key.algorithms('deriveKey')][1]\n      }\n\n      if (!alg) {\n        throw new JWEInvalid('could not resolve a usable \"alg\" for a recipient')\n      }\n\n      if (recipientCount === 1) {\n        if (protectedHeader) {\n          protectedHeader.alg = alg\n        } else {\n          this._protected = { alg }\n        }\n      } else {\n        if (recipient.header) {\n          recipient.header.alg = alg\n        } else {\n          recipient.header = { alg }\n        }\n      }\n    }\n\n    let wrapped\n    let generatedHeader\n\n    if (key.kty === 'oct' && alg === 'dir') {\n      this._cek = importKey(key[KEYOBJECT], { use: 'enc', alg: enc })\n    } else {\n      check(this._cek, 'encrypt', enc)\n      ;({ wrapped, header: generatedHeader } = keyManagementEncrypt(alg, key, this._cek[KEYOBJECT].export(), { enc, alg }))\n      if (alg === 'ECDH-ES') {\n        this._cek = importKey(createSecretKey(wrapped), { use: 'enc', alg: enc })\n      }\n    }\n\n    if (alg === 'dir' || alg === 'ECDH-ES') {\n      recipient.encrypted_key = ''\n    } else {\n      recipient.encrypted_key = base64url.encodeBuffer(wrapped)\n    }\n\n    if (generatedHeader) {\n      recipient.generatedHeader = generatedHeader\n    }\n  }\n\n  /*\n   * @public\n   */\n  encrypt (serialization) {\n    const serializer = serializers[serialization]\n    if (!serializer) {\n      throw new TypeError('serialization must be one of \"compact\", \"flattened\", \"general\"')\n    }\n\n    if (!this._recipients.length) {\n      throw new JWEInvalid('missing recipients')\n    }\n\n    serializer.validate(this._protected, this._unprotected, this._aad, this._recipients)\n\n    let enc = validateHeaders(this._protected, this._unprotected, this._recipients, false, this._protected ? this._protected.crit : undefined)\n    if (!enc) {\n      enc = 'A128CBC-HS256'\n      if (this._protected) {\n        this._protected.enc = enc\n      } else {\n        this._protected = { enc }\n      }\n    }\n    const final = {}\n    this._cek = generateCEK(enc)\n\n    for (const recipient of this._recipients) {\n      this[PROCESS_RECIPIENT](recipient)\n    }\n\n    const iv = generateIV(enc)\n    final.iv = base64url.encodeBuffer(iv)\n\n    if (this._recipients.length === 1 && this._recipients[0].generatedHeader) {\n      const [{ generatedHeader }] = this._recipients\n      delete this._recipients[0].generatedHeader\n      this._protected = {\n        ...this._protected,\n        ...generatedHeader\n      }\n    }\n\n    if (this._protected) {\n      final.protected = base64url.JSON.encode(this._protected)\n    }\n    final.unprotected = this._unprotected\n\n    let aad\n    if (this._aad) {\n      final.aad = base64url.encode(this._aad)\n      aad = Buffer.concat([\n        Buffer.from(final.protected || ''),\n        Buffer.from('.'),\n        Buffer.from(final.aad)\n      ])\n    } else {\n      aad = Buffer.from(final.protected || '')\n    }\n\n    let cleartext = this._cleartext\n    if (this._protected && 'zip' in this._protected) {\n      cleartext = deflateRawSync(cleartext)\n    }\n\n    const { ciphertext, tag } = encrypt(enc, this._cek, cleartext, { iv, aad })\n    final.tag = base64url.encodeBuffer(tag)\n    final.ciphertext = base64url.encodeBuffer(ciphertext)\n\n    return serializer(final, this._recipients)\n  }\n}\n\nmodule.exports = Encrypt\n", "const KeyStore = require('./keystore')\n\nmodule.exports = KeyStore\n", "const { inflateRawSync } = require('zlib')\n\nconst base64url = require('../help/base64url')\nconst getKey = require('../help/get_key')\nconst { KeyStore } = require('../jwks')\nconst errors = require('../errors')\nconst { check, decrypt, keyManagementDecrypt } = require('../jwa')\nconst JWK = require('../jwk')\n\nconst { createSecretKey } = require('../help/key_object')\nconst generateCEK = require('./generate_cek')\nconst validateHeaders = require('./validate_headers')\nconst { detect: resolveSerialization } = require('./serializers')\n\nconst SINGLE_RECIPIENT = new Set(['compact', 'flattened'])\n\nconst combineHeader = (prot = {}, unprotected = {}, header = {}) => {\n  if (typeof prot === 'string') {\n    prot = base64url.JSON.decode(prot)\n  }\n\n  const p2s = prot.p2s || unprotected.p2s || header.p2s\n  const apu = prot.apu || unprotected.apu || header.apu\n  const apv = prot.apv || unprotected.apv || header.apv\n  const iv = prot.iv || unprotected.iv || header.iv\n  const tag = prot.tag || unprotected.tag || header.tag\n\n  return {\n    ...prot,\n    ...unprotected,\n    ...header,\n    ...(typeof p2s === 'string' ? { p2s: base64url.decodeToBuffer(p2s) } : undefined),\n    ...(typeof apu === 'string' ? { apu: base64url.decodeToBuffer(apu) } : undefined),\n    ...(typeof apv === 'string' ? { apv: base64url.decodeToBuffer(apv) } : undefined),\n    ...(typeof iv === 'string' ? { iv: base64url.decodeToBuffer(iv) } : undefined),\n    ...(typeof tag === 'string' ? { tag: base64url.decodeToBuffer(tag) } : undefined)\n  }\n}\n\n/*\n * @public\n */\nconst jweDecrypt = (skipValidateHeaders, serialization, jwe, key, { crit = [], complete = false, algorithms } = {}) => {\n  key = getKey(key, true)\n\n  if (algorithms !== undefined && (!Array.isArray(algorithms) || algorithms.some(s => typeof s !== 'string' || !s))) {\n    throw new TypeError('\"algorithms\" option must be an array of non-empty strings')\n  } else if (algorithms) {\n    algorithms = new Set(algorithms)\n  }\n\n  if (!Array.isArray(crit) || crit.some(s => typeof s !== 'string' || !s)) {\n    throw new TypeError('\"crit\" option must be an array of non-empty strings')\n  }\n\n  if (!serialization) {\n    serialization = resolveSerialization(jwe)\n  }\n\n  let alg, ciphertext, enc, encryptedKey, iv, opts, prot, tag, unprotected, cek, aad, header\n\n  // treat general format with one recipient as flattened\n  // skips iteration and avoids multi errors in this case\n  if (serialization === 'general' && jwe.recipients.length === 1) {\n    serialization = 'flattened'\n    const { recipients, ...root } = jwe\n    jwe = { ...root, ...recipients[0] }\n  }\n\n  if (SINGLE_RECIPIENT.has(serialization)) {\n    if (serialization === 'compact') { // compact serialization format\n      ([prot, encryptedKey, iv, ciphertext, tag] = jwe.split('.'))\n    } else { // flattened serialization format\n      ({ protected: prot, encrypted_key: encryptedKey, iv, ciphertext, tag, unprotected, aad, header } = jwe)\n    }\n\n    if (!skipValidateHeaders) {\n      validateHeaders(prot, unprotected, [{ header }], true, crit)\n    }\n\n    opts = combineHeader(prot, unprotected, header)\n\n    ;({ alg, enc } = opts)\n\n    if (algorithms && !algorithms.has(alg === 'dir' ? enc : alg)) {\n      throw new errors.JOSEAlgNotWhitelisted('alg not whitelisted')\n    }\n\n    if (key instanceof KeyStore) {\n      const keystore = key\n      let keys\n      if (opts.alg === 'dir') {\n        keys = keystore.all({ kid: opts.kid, alg: opts.enc, key_ops: ['decrypt'] })\n      } else {\n        keys = keystore.all({ kid: opts.kid, alg: opts.alg, key_ops: ['unwrapKey'] })\n      }\n      switch (keys.length) {\n        case 0:\n          throw new errors.JWKSNoMatchingKey()\n        case 1:\n          // treat the call as if a Key instance was passed in\n          // skips iteration and avoids multi errors in this case\n          key = keys[0]\n          break\n        default: {\n          const errs = []\n          for (const key of keys) {\n            try {\n              return jweDecrypt(true, serialization, jwe, key, { crit, complete, algorithms: algorithms ? [...algorithms] : undefined })\n            } catch (err) {\n              errs.push(err)\n              continue\n            }\n          }\n\n          const multi = new errors.JOSEMultiError(errs)\n          if ([...multi].some(e => e instanceof errors.JWEDecryptionFailed)) {\n            throw new errors.JWEDecryptionFailed()\n          }\n          throw multi\n        }\n      }\n    }\n\n    check(key, ...(alg === 'dir' ? ['decrypt', enc] : ['keyManagementDecrypt', alg]))\n\n    try {\n      if (alg === 'dir') {\n        cek = JWK.asKey(key, { alg: enc, use: 'enc' })\n      } else if (alg === 'ECDH-ES') {\n        const unwrapped = keyManagementDecrypt(alg, key, undefined, opts)\n        cek = JWK.asKey(createSecretKey(unwrapped), { alg: enc, use: 'enc' })\n      } else {\n        const unwrapped = keyManagementDecrypt(alg, key, base64url.decodeToBuffer(encryptedKey), opts)\n        cek = JWK.asKey(createSecretKey(unwrapped), { alg: enc, use: 'enc' })\n      }\n    } catch (err) {\n      // To mitigate the attacks described in RFC 3218, the\n      // recipient MUST NOT distinguish between format, padding, and length\n      // errors of encrypted keys.  It is strongly recommended, in the event\n      // of receiving an improperly formatted key, that the recipient\n      // substitute a randomly generated CEK and proceed to the next step, to\n      // mitigate timing attacks.\n      cek = generateCEK(enc)\n    }\n\n    let adata\n    if (aad) {\n      adata = Buffer.concat([\n        Buffer.from(prot || ''),\n        Buffer.from('.'),\n        Buffer.from(aad)\n      ])\n    } else {\n      adata = Buffer.from(prot || '')\n    }\n\n    try {\n      iv = base64url.decodeToBuffer(iv)\n    } catch (err) {}\n    try {\n      tag = base64url.decodeToBuffer(tag)\n    } catch (err) {}\n\n    let cleartext = decrypt(enc, cek, base64url.decodeToBuffer(ciphertext), { iv, tag, aad: adata })\n\n    if (opts.zip) {\n      cleartext = inflateRawSync(cleartext)\n    }\n\n    if (complete) {\n      const result = { cleartext, key, cek }\n      if (aad) result.aad = aad\n      if (header) result.header = header\n      if (unprotected) result.unprotected = unprotected\n      if (prot) result.protected = base64url.JSON.decode(prot)\n      return result\n    }\n\n    return cleartext\n  }\n\n  validateHeaders(jwe.protected, jwe.unprotected, jwe.recipients.map(({ header }) => ({ header })), true, crit)\n\n  // general serialization format\n  const { recipients, ...root } = jwe\n  const errs = []\n  for (const recipient of recipients) {\n    try {\n      return jweDecrypt(true, 'flattened', { ...root, ...recipient }, key, { crit, complete, algorithms: algorithms ? [...algorithms] : undefined })\n    } catch (err) {\n      errs.push(err)\n      continue\n    }\n  }\n\n  const multi = new errors.JOSEMultiError(errs)\n  if ([...multi].some(e => e instanceof errors.JWEDecryptionFailed)) {\n    throw new errors.JWEDecryptionFailed()\n  } else if ([...multi].every(e => e instanceof errors.JWKSNoMatchingKey)) {\n    throw new errors.JWKSNoMatchingKey()\n  }\n  throw multi\n}\n\nmodule.exports = jweDecrypt.bind(undefined, false, undefined)\n", "const Encrypt = require('./encrypt')\nconst decrypt = require('./decrypt')\n\n// TODO: in v2.x swap unprotectedHeader and aad\nconst single = (serialization, cleartext, key, protectedHeader, unprotectedHeader, aad) => {\n  return new Encrypt(cleartext, protectedHeader, unprotectedHeader, aad)\n    .recipient(key)\n    .encrypt(serialization)\n}\n\nmodule.exports.Encrypt = Encrypt\nmodule.exports.encrypt = single.bind(undefined, 'compact')\nmodule.exports.encrypt.flattened = single.bind(undefined, 'flattened')\nmodule.exports.encrypt.general = single.bind(undefined, 'general')\n\nmodule.exports.decrypt = decrypt\n", "const isObject = require('../help/is_object')\nlet validateCrit = require('../help/validate_crit')\nconst { JWSInvalid } = require('../errors')\n\nvalidateCrit = validateCrit.bind(undefined, JWSInvalid)\n\nconst compactSerializer = (payload, [recipient]) => {\n  return `${recipient.protected}.${payload}.${recipient.signature}`\n}\ncompactSerializer.validate = (jws, { 0: { unprotectedHeader, protectedHeader }, length }) => {\n  if (length !== 1 || unprotectedHeader) {\n    throw new JWSInvalid('JWS Compact Serialization doesn\\'t support multiple recipients or JWS unprotected headers')\n  }\n  validateCrit(protectedHeader, unprotectedHeader, protectedHeader ? protectedHeader.crit : undefined)\n}\n\nconst flattenedSerializer = (payload, [recipient]) => {\n  const { header, signature, protected: prot } = recipient\n\n  return {\n    payload,\n    ...prot ? { protected: prot } : undefined,\n    ...header ? { header } : undefined,\n    signature\n  }\n}\nflattenedSerializer.validate = (jws, { 0: { unprotectedHeader, protectedHeader }, length }) => {\n  if (length !== 1) {\n    throw new JWSInvalid('Flattened JWS JSON Serialization doesn\\'t support multiple recipients')\n  }\n  validateCrit(protectedHeader, unprotectedHeader, protectedHeader ? protectedHeader.crit : undefined)\n}\n\nconst generalSerializer = (payload, recipients) => {\n  return {\n    payload,\n    signatures: recipients.map(({ header, signature, protected: prot }) => {\n      return {\n        ...prot ? { protected: prot } : undefined,\n        ...header ? { header } : undefined,\n        signature\n      }\n    })\n  }\n}\ngeneralSerializer.validate = (jws, recipients) => {\n  let validateB64 = false\n  recipients.forEach(({ protectedHeader, unprotectedHeader }) => {\n    if (protectedHeader && !validateB64 && 'b64' in protectedHeader) {\n      validateB64 = true\n    }\n    validateCrit(protectedHeader, unprotectedHeader, protectedHeader ? protectedHeader.crit : undefined)\n  })\n\n  if (validateB64) {\n    const values = recipients.map(({ protectedHeader }) => protectedHeader && protectedHeader.b64)\n    if (!values.every((actual, i, [expected]) => actual === expected)) {\n      throw new JWSInvalid('the \"b64\" Header Parameter value MUST be the same for all recipients')\n    }\n  }\n}\n\nconst isJSON = (input) => {\n  return isObject(input) && (typeof input.payload === 'string' || Buffer.isBuffer(input.payload))\n}\n\nconst isValidRecipient = (recipient) => {\n  return isObject(recipient) && typeof recipient.signature === 'string' &&\n    (recipient.header === undefined || isObject(recipient.header)) &&\n    (recipient.protected === undefined || typeof recipient.protected === 'string')\n}\n\nconst isMultiRecipient = (input) => {\n  if (Array.isArray(input.signatures) && input.signatures.every(isValidRecipient)) {\n    return true\n  }\n\n  return false\n}\n\nconst detect = (input) => {\n  if (typeof input === 'string' && input.split('.').length === 3) {\n    return 'compact'\n  }\n\n  if (isJSON(input)) {\n    if (isMultiRecipient(input)) {\n      return 'general'\n    }\n\n    if (isValidRecipient(input)) {\n      return 'flattened'\n    }\n  }\n\n  throw new JWSInvalid('JWS malformed or invalid serialization')\n}\n\nmodule.exports = {\n  compact: compactSerializer,\n  flattened: flattenedSerializer,\n  general: generalSerializer,\n  detect\n}\n", "const base64url = require('../help/base64url')\nconst isDisjoint = require('../help/is_disjoint')\nconst isObject = require('../help/is_object')\nconst deepClone = require('../help/deep_clone')\nconst { JWSInvalid } = require('../errors')\nconst { sign } = require('../jwa')\nconst getKey = require('../help/get_key')\n\nconst serializers = require('./serializers')\n\nconst PROCESS_RECIPIENT = Symbol('PROCESS_RECIPIENT')\n\nclass Sign {\n  constructor (payload) {\n    if (typeof payload === 'string') {\n      payload = base64url.encode(payload)\n    } else if (Buffer.isBuffer(payload)) {\n      payload = base64url.encodeBuffer(payload)\n      this._binary = true\n    } else if (isObject(payload)) {\n      payload = base64url.JSON.encode(payload)\n    } else {\n      throw new TypeError('payload argument must be a Buffer, string or an object')\n    }\n\n    this._payload = payload\n    this._recipients = []\n  }\n\n  /*\n   * @public\n   */\n  recipient (key, protectedHeader, unprotectedHeader) {\n    key = getKey(key)\n\n    if (protectedHeader !== undefined && !isObject(protectedHeader)) {\n      throw new TypeError('protectedHeader argument must be a plain object when provided')\n    }\n\n    if (unprotectedHeader !== undefined && !isObject(unprotectedHeader)) {\n      throw new TypeError('unprotectedHeader argument must be a plain object when provided')\n    }\n\n    if (!isDisjoint(protectedHeader, unprotectedHeader)) {\n      throw new JWSInvalid('JWS Protected and JWS Unprotected Header Parameter names must be disjoint')\n    }\n\n    this._recipients.push({\n      key,\n      protectedHeader: protectedHeader ? deepClone(protectedHeader) : undefined,\n      unprotectedHeader: unprotectedHeader ? deepClone(unprotectedHeader) : undefined\n    })\n\n    return this\n  }\n\n  /*\n   * @private\n   */\n  [PROCESS_RECIPIENT] (recipient, first) {\n    const { key, protectedHeader, unprotectedHeader } = recipient\n\n    if (key.use === 'enc') {\n      throw new TypeError('a key with \"use\":\"enc\" is not usable for signing')\n    }\n\n    const joseHeader = {\n      protected: protectedHeader || {},\n      unprotected: unprotectedHeader || {}\n    }\n\n    let alg = joseHeader.protected.alg || joseHeader.unprotected.alg\n\n    if (!alg) {\n      alg = key.alg || [...key.algorithms('sign')][0]\n      if (recipient.protectedHeader) {\n        joseHeader.protected.alg = recipient.protectedHeader.alg = alg\n      } else {\n        joseHeader.protected = recipient.protectedHeader = { alg }\n      }\n    }\n\n    if (!alg) {\n      throw new JWSInvalid('could not resolve a usable \"alg\" for a recipient')\n    }\n\n    recipient.header = unprotectedHeader\n    recipient.protected = Object.keys(joseHeader.protected).length ? base64url.JSON.encode(joseHeader.protected) : ''\n\n    if (first && joseHeader.protected.crit && joseHeader.protected.crit.includes('b64') && joseHeader.protected.b64 === false) {\n      if (this._binary) {\n        this._payload = base64url.decodeToBuffer(this._payload)\n      } else {\n        this._payload = base64url.decode(this._payload)\n      }\n    }\n\n    const data = Buffer.concat([\n      Buffer.from(recipient.protected || ''),\n      Buffer.from('.'),\n      Buffer.from(this._payload)\n    ])\n\n    recipient.signature = base64url.encodeBuffer(sign(alg, key, data))\n  }\n\n  /*\n   * @public\n   */\n  sign (serialization) {\n    const serializer = serializers[serialization]\n    if (!serializer) {\n      throw new TypeError('serialization must be one of \"compact\", \"flattened\", \"general\"')\n    }\n\n    if (!this._recipients.length) {\n      throw new JWSInvalid('missing recipients')\n    }\n\n    serializer.validate(this, this._recipients)\n\n    this._recipients.forEach((recipient, i) => {\n      this[PROCESS_RECIPIENT](recipient, i === 0)\n    })\n\n    return serializer(this._payload, this._recipients)\n  }\n}\n\nmodule.exports = Sign\n", "const { EOL } = require('os')\n\nconst base64url = require('../help/base64url')\nconst isDisjoint = require('../help/is_disjoint')\nconst isObject = require('../help/is_object')\nlet validateCrit = require('../help/validate_crit')\nconst getKey = require('../help/get_key')\nconst { KeyStore } = require('../jwks')\nconst errors = require('../errors')\nconst { check, verify } = require('../jwa')\nconst JWK = require('../jwk')\n\nconst { detect: resolveSerialization } = require('./serializers')\n\nvalidateCrit = validateCrit.bind(undefined, errors.JWSInvalid)\nconst SINGLE_RECIPIENT = new Set(['compact', 'flattened', 'preparsed'])\n\n/*\n * @public\n */\nconst jwsVerify = (skipDisjointCheck, serialization, jws, key, { crit = [], complete = false, algorithms, parse = true, encoding = 'utf8' } = {}) => {\n  key = getKey(key, true)\n\n  if (algorithms !== undefined && (!Array.isArray(algorithms) || algorithms.some(s => typeof s !== 'string' || !s))) {\n    throw new TypeError('\"algorithms\" option must be an array of non-empty strings')\n  } else if (algorithms) {\n    algorithms = new Set(algorithms)\n  }\n\n  if (!Array.isArray(crit) || crit.some(s => typeof s !== 'string' || !s)) {\n    throw new TypeError('\"crit\" option must be an array of non-empty strings')\n  }\n\n  if (!serialization) {\n    serialization = resolveSerialization(jws)\n  }\n\n  let prot // protected header\n  let header // unprotected header\n  let payload\n  let signature\n  let alg\n\n  // treat general format with one recipient as flattened\n  // skips iteration and avoids multi errors in this case\n  if (serialization === 'general' && jws.signatures.length === 1) {\n    serialization = 'flattened'\n    const { signatures, ...root } = jws\n    jws = { ...root, ...signatures[0] }\n  }\n\n  let decoded\n\n  if (SINGLE_RECIPIENT.has(serialization)) {\n    let parsedProt = {}\n\n    switch (serialization) {\n      case 'compact': // compact serialization format\n        ([prot, payload, signature] = jws.split('.'))\n        break\n      case 'flattened': // flattened serialization format\n        ({ protected: prot, payload, signature, header } = jws)\n        break\n      case 'preparsed': { // from the JWT module\n        ({ decoded } = jws);\n        ([prot, payload, signature] = jws.token.split('.'))\n        break\n      }\n    }\n\n    if (!header) {\n      skipDisjointCheck = true\n    }\n\n    if (decoded) {\n      parsedProt = decoded.header\n    } else if (prot) {\n      try {\n        parsedProt = base64url.JSON.decode(prot)\n      } catch (err) {\n        throw new errors.JWSInvalid('could not parse JWS protected header')\n      }\n    } else {\n      skipDisjointCheck = skipDisjointCheck || true\n    }\n\n    if (!skipDisjointCheck && !isDisjoint(parsedProt, header)) {\n      throw new errors.JWSInvalid('JWS Protected and JWS Unprotected Header Parameter names must be disjoint')\n    }\n\n    const combinedHeader = { ...parsedProt, ...header }\n    validateCrit(parsedProt, header, crit)\n\n    alg = parsedProt.alg || (header && header.alg)\n    if (!alg) {\n      throw new errors.JWSInvalid('missing JWS signature algorithm')\n    } else if (algorithms && !algorithms.has(alg)) {\n      throw new errors.JOSEAlgNotWhitelisted('alg not whitelisted')\n    }\n\n    if (key instanceof KeyStore) {\n      const keystore = key\n      const keys = keystore.all({ kid: combinedHeader.kid, alg: combinedHeader.alg, key_ops: ['verify'] })\n      switch (keys.length) {\n        case 0:\n          throw new errors.JWKSNoMatchingKey()\n        case 1:\n          // treat the call as if a Key instance was passed in\n          // skips iteration and avoids multi errors in this case\n          key = keys[0]\n          break\n        default: {\n          const errs = []\n          for (const key of keys) {\n            try {\n              return jwsVerify(true, serialization, jws, key, { crit, complete, encoding, parse, algorithms: algorithms ? [...algorithms] : undefined })\n            } catch (err) {\n              errs.push(err)\n              continue\n            }\n          }\n\n          const multi = new errors.JOSEMultiError(errs)\n          if ([...multi].some(e => e instanceof errors.JWSVerificationFailed)) {\n            throw new errors.JWSVerificationFailed()\n          }\n          throw multi\n        }\n      }\n    }\n\n    if (key === JWK.EmbeddedJWK) {\n      if (!isObject(combinedHeader.jwk)) {\n        throw new errors.JWSInvalid('JWS Header Parameter \"jwk\" must be a JSON object')\n      }\n      key = JWK.asKey(combinedHeader.jwk)\n      if (key.type !== 'public') {\n        throw new errors.JWSInvalid('JWS Header Parameter \"jwk\" must be a public key')\n      }\n    } else if (key === JWK.EmbeddedX5C) {\n      if (!Array.isArray(combinedHeader.x5c) || !combinedHeader.x5c.length || combinedHeader.x5c.some(c => typeof c !== 'string' || !c)) {\n        throw new errors.JWSInvalid('JWS Header Parameter \"x5c\" must be a JSON array of certificate value strings')\n      }\n      key = JWK.asKey(\n        `-----BEGIN CERTIFICATE-----${EOL}${(combinedHeader.x5c[0].match(/.{1,64}/g) || []).join(EOL)}${EOL}-----END CERTIFICATE-----`,\n        { x5c: combinedHeader.x5c }\n      )\n    }\n\n    check(key, 'verify', alg)\n\n    const toBeVerified = Buffer.concat([\n      Buffer.from(prot || ''),\n      Buffer.from('.'),\n      Buffer.isBuffer(payload) ? payload : Buffer.from(payload)\n    ])\n\n    if (!verify(alg, key, toBeVerified, base64url.decodeToBuffer(signature))) {\n      throw new errors.JWSVerificationFailed()\n    }\n\n    if (!combinedHeader.crit || !combinedHeader.crit.includes('b64') || combinedHeader.b64) {\n      if (parse) {\n        payload = decoded ? decoded.payload : base64url.JSON.decode.try(payload, encoding)\n      } else {\n        payload = base64url.decodeToBuffer(payload)\n      }\n    }\n\n    if (complete) {\n      const result = { payload, key }\n      if (prot) result.protected = parsedProt\n      if (header) result.header = header\n      return result\n    }\n\n    return payload\n  }\n\n  // general serialization format\n  const { signatures, ...root } = jws\n  const errs = []\n  for (const recipient of signatures) {\n    try {\n      return jwsVerify(false, 'flattened', { ...root, ...recipient }, key, { crit, complete, encoding, parse, algorithms: algorithms ? [...algorithms] : undefined })\n    } catch (err) {\n      errs.push(err)\n      continue\n    }\n  }\n\n  const multi = new errors.JOSEMultiError(errs)\n  if ([...multi].some(e => e instanceof errors.JWSVerificationFailed)) {\n    throw new errors.JWSVerificationFailed()\n  } else if ([...multi].every(e => e instanceof errors.JWKSNoMatchingKey)) {\n    throw new errors.JWKSNoMatchingKey()\n  }\n  throw multi\n}\n\nmodule.exports = {\n  bare: jwsVerify,\n  verify: jwsVerify.bind(undefined, false, undefined)\n}\n", "const Sign = require('./sign')\nconst { verify } = require('./verify')\n\nconst single = (serialization, payload, key, protectedHeader, unprotectedHeader) => {\n  return new Sign(payload)\n    .recipient(key, protectedHeader, unprotectedHeader)\n    .sign(serialization)\n}\n\nmodule.exports.Sign = Sign\nmodule.exports.sign = single.bind(undefined, 'compact')\nmodule.exports.sign.flattened = single.bind(undefined, 'flattened')\nmodule.exports.sign.general = single.bind(undefined, 'general')\n\nmodule.exports.verify = verify\n", "const base64url = require('../help/base64url')\nconst errors = require('../errors')\n\nmodule.exports = (token, { complete = false } = {}) => {\n  if (typeof token !== 'string' || !token) {\n    throw new TypeError('JWT must be a string')\n  }\n\n  const { 0: header, 1: payload, 2: signature, length } = token.split('.')\n\n  if (length === 5) {\n    throw new TypeError('JWTs must be decrypted first')\n  }\n\n  if (length !== 3) {\n    throw new errors.JWTMalformed('JWTs must have three components')\n  }\n\n  try {\n    const result = {\n      header: base64url.JSON.decode(header),\n      payload: base64url.JSON.decode(payload),\n      signature\n    }\n\n    return complete ? result : result.payload\n  } catch (err) {\n    throw new errors.JWTMalformed('JWT is malformed')\n  }\n}\n", "const minute = 60\nconst hour = minute * 60\nconst day = hour * 24\nconst week = day * 7\nconst year = day * 365.25\n\nconst REGEX = /^(\\d+|\\d+\\.\\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)$/i\n\nmodule.exports = (str) => {\n  const matched = REGEX.exec(str)\n\n  if (!matched) {\n    throw new TypeError(`invalid time period format (\"${str}\")`)\n  }\n\n  const value = parseFloat(matched[1])\n  const unit = matched[2].toLowerCase()\n\n  switch (unit) {\n    case 'sec':\n    case 'secs':\n    case 'second':\n    case 'seconds':\n    case 's':\n      return Math.round(value)\n    case 'minute':\n    case 'minutes':\n    case 'min':\n    case 'mins':\n    case 'm':\n      return Math.round(value * minute)\n    case 'hour':\n    case 'hours':\n    case 'hr':\n    case 'hrs':\n    case 'h':\n      return Math.round(value * hour)\n    case 'day':\n    case 'days':\n    case 'd':\n      return Math.round(value * day)\n    case 'week':\n    case 'weeks':\n    case 'w':\n      return Math.round(value * week)\n    case 'year':\n    case 'years':\n    case 'yr':\n    case 'yrs':\n    case 'y':\n      return Math.round(value * year)\n  }\n}\n", "module.exports = (date) => Math.floor(date.getTime() / 1000)\n", "const isNotString = val => typeof val !== 'string' || val.length === 0\n\nmodule.exports.isNotString = isNotString\nmodule.exports.isString = function isString (Err, value, label, claim, required = false) {\n  if (required && value === undefined) {\n    throw new Err(`${label} is missing`, claim, 'missing')\n  }\n\n  if (value !== undefined && isNotString(value)) {\n    throw new Err(`${label} must be a string`, claim, 'invalid')\n  }\n}\n", "const isObject = require('../help/is_object')\nconst secs = require('../help/secs')\nconst epoch = require('../help/epoch')\nconst getKey = require('../help/get_key')\nconst JWS = require('../jws')\n\nconst isString = require('./shared_validations').isString.bind(undefined, TypeError)\n\nconst validateOptions = (options) => {\n  if (typeof options.iat !== 'boolean') {\n    throw new TypeError('options.iat must be a boolean')\n  }\n\n  if (typeof options.kid !== 'boolean') {\n    throw new TypeError('options.kid must be a boolean')\n  }\n\n  isString(options.subject, 'options.subject')\n  isString(options.issuer, 'options.issuer')\n\n  if (\n    options.audience !== undefined &&\n    (\n      (typeof options.audience !== 'string' || !options.audience) &&\n      (!Array.isArray(options.audience) || options.audience.length === 0 || options.audience.some(a => !a || typeof a !== 'string'))\n    )\n  ) {\n    throw new TypeError('options.audience must be a string or an array of strings')\n  }\n\n  if (!isObject(options.header)) {\n    throw new TypeError('options.header must be an object')\n  }\n\n  isString(options.algorithm, 'options.algorithm')\n  isString(options.expiresIn, 'options.expiresIn')\n  isString(options.notBefore, 'options.notBefore')\n  isString(options.jti, 'options.jti')\n  isString(options.nonce, 'options.nonce')\n\n  if (options.now !== undefined && (!(options.now instanceof Date) || !options.now.getTime())) {\n    throw new TypeError('options.now must be a valid Date object')\n  }\n}\n\nmodule.exports = (payload, key, options = {}) => {\n  if (!isObject(options)) {\n    throw new TypeError('options must be an object')\n  }\n\n  const {\n    algorithm, audience, expiresIn, header = {}, iat = true,\n    issuer, jti, kid = true, nonce, notBefore, subject, now\n  } = options\n\n  validateOptions({\n    algorithm, audience, expiresIn, header, iat, issuer, jti, kid, nonce, notBefore, now, subject\n  })\n\n  if (!isObject(payload)) {\n    throw new TypeError('payload must be an object')\n  }\n\n  let unix\n  if (expiresIn || notBefore || iat) {\n    unix = epoch(now || new Date())\n  }\n\n  payload = {\n    ...payload,\n    sub: subject || payload.sub,\n    aud: audience || payload.aud,\n    iss: issuer || payload.iss,\n    jti: jti || payload.jti,\n    iat: iat ? unix : payload.iat,\n    nonce: nonce || payload.nonce,\n    exp: expiresIn ? unix + secs(expiresIn) : payload.exp,\n    nbf: notBefore ? unix + secs(notBefore) : payload.nbf\n  }\n\n  key = getKey(key)\n\n  let includeKid\n\n  if (typeof options.kid === 'boolean') {\n    includeKid = kid\n  } else {\n    includeKid = !key.secret\n  }\n\n  return JWS.sign(JSON.stringify(payload), key, {\n    ...header,\n    alg: algorithm || header.alg,\n    kid: includeKid ? key.kid : header.kid\n  })\n}\n", "const isObject = require('../help/is_object')\nconst epoch = require('../help/epoch')\nconst secs = require('../help/secs')\nconst getKey = require('../help/get_key')\nconst { bare: verify } = require('../jws/verify')\nconst { JWTClaimInvalid, JWTExpired } = require('../errors')\n\nconst { isString, isNotString } = require('./shared_validations')\nconst decode = require('./decode')\n\nconst isPayloadString = isString.bind(undefined, JWTClaimInvalid)\nconst isOptionString = isString.bind(undefined, TypeError)\n\nconst IDTOKEN = 'id_token'\nconst LOGOUTTOKEN = 'logout_token'\nconst ATJWT = 'at+JWT'\n\nconst isTimestamp = (value, label, required = false) => {\n  if (required && value === undefined) {\n    throw new JWTClaimInvalid(`\"${label}\" claim is missing`, label, 'missing')\n  }\n\n  if (value !== undefined && (typeof value !== 'number')) {\n    throw new JWTClaimInvalid(`\"${label}\" claim must be a JSON numeric value`, label, 'invalid')\n  }\n}\n\nconst isStringOrArrayOfStrings = (value, label, required = false) => {\n  if (required && value === undefined) {\n    throw new JWTClaimInvalid(`\"${label}\" claim is missing`, label, 'missing')\n  }\n\n  if (value !== undefined && (isNotString(value) && isNotArrayOfStrings(value))) {\n    throw new JWTClaimInvalid(`\"${label}\" claim must be a string or array of strings`, label, 'invalid')\n  }\n}\n\nconst isNotArrayOfStrings = val => !Array.isArray(val) || val.length === 0 || val.some(isNotString)\nconst normalizeTyp = (value) => value.toLowerCase().replace(/^application\\//, '')\n\nconst validateOptions = ({\n  algorithms, audience, clockTolerance, complete = false, crit, ignoreExp = false,\n  ignoreIat = false, ignoreNbf = false, issuer, jti, maxAuthAge, maxTokenAge, nonce, now = new Date(),\n  profile, subject, typ\n}) => {\n  isOptionString(profile, 'options.profile')\n\n  if (typeof complete !== 'boolean') {\n    throw new TypeError('options.complete must be a boolean')\n  }\n\n  if (typeof ignoreExp !== 'boolean') {\n    throw new TypeError('options.ignoreExp must be a boolean')\n  }\n\n  if (typeof ignoreNbf !== 'boolean') {\n    throw new TypeError('options.ignoreNbf must be a boolean')\n  }\n\n  if (typeof ignoreIat !== 'boolean') {\n    throw new TypeError('options.ignoreIat must be a boolean')\n  }\n\n  isOptionString(maxTokenAge, 'options.maxTokenAge')\n  isOptionString(subject, 'options.subject')\n  isOptionString(maxAuthAge, 'options.maxAuthAge')\n  isOptionString(jti, 'options.jti')\n  isOptionString(clockTolerance, 'options.clockTolerance')\n  isOptionString(typ, 'options.typ')\n\n  if (issuer !== undefined && (isNotString(issuer) && isNotArrayOfStrings(issuer))) {\n    throw new TypeError('options.issuer must be a string or an array of strings')\n  }\n\n  if (audience !== undefined && (isNotString(audience) && isNotArrayOfStrings(audience))) {\n    throw new TypeError('options.audience must be a string or an array of strings')\n  }\n\n  if (algorithms !== undefined && isNotArrayOfStrings(algorithms)) {\n    throw new TypeError('options.algorithms must be an array of strings')\n  }\n\n  isOptionString(nonce, 'options.nonce')\n\n  if (!(now instanceof Date) || !now.getTime()) {\n    throw new TypeError('options.now must be a valid Date object')\n  }\n\n  if (ignoreIat && maxTokenAge !== undefined) {\n    throw new TypeError('options.ignoreIat and options.maxTokenAge cannot used together')\n  }\n\n  if (crit !== undefined && isNotArrayOfStrings(crit)) {\n    throw new TypeError('options.crit must be an array of strings')\n  }\n\n  switch (profile) {\n    case IDTOKEN:\n      if (!issuer) {\n        throw new TypeError('\"issuer\" option is required to validate an ID Token')\n      }\n\n      if (!audience) {\n        throw new TypeError('\"audience\" option is required to validate an ID Token')\n      }\n\n      break\n    case ATJWT:\n      if (!issuer) {\n        throw new TypeError('\"issuer\" option is required to validate a JWT Access Token')\n      }\n\n      if (!audience) {\n        throw new TypeError('\"audience\" option is required to validate a JWT Access Token')\n      }\n\n      typ = ATJWT\n\n      break\n    case LOGOUTTOKEN:\n      if (!issuer) {\n        throw new TypeError('\"issuer\" option is required to validate a Logout Token')\n      }\n\n      if (!audience) {\n        throw new TypeError('\"audience\" option is required to validate a Logout Token')\n      }\n\n      break\n    case undefined:\n      break\n    default:\n      throw new TypeError(`unsupported options.profile value \"${profile}\"`)\n  }\n\n  return {\n    algorithms,\n    audience,\n    clockTolerance,\n    complete,\n    crit,\n    ignoreExp,\n    ignoreIat,\n    ignoreNbf,\n    issuer,\n    jti,\n    maxAuthAge,\n    maxTokenAge,\n    nonce,\n    now,\n    profile,\n    subject,\n    typ\n  }\n}\n\nconst validateTypes = ({ header, payload }, profile, options) => {\n  isPayloadString(header.alg, '\"alg\" header parameter', 'alg', true)\n\n  isTimestamp(payload.iat, 'iat', profile === IDTOKEN || profile === LOGOUTTOKEN || profile === ATJWT || !!options.maxTokenAge)\n  isTimestamp(payload.exp, 'exp', profile === IDTOKEN || profile === ATJWT)\n  isTimestamp(payload.auth_time, 'auth_time', !!options.maxAuthAge)\n  isTimestamp(payload.nbf, 'nbf')\n  isPayloadString(payload.jti, '\"jti\" claim', 'jti', profile === LOGOUTTOKEN || profile === ATJWT || !!options.jti)\n  isPayloadString(payload.acr, '\"acr\" claim', 'acr')\n  isPayloadString(payload.nonce, '\"nonce\" claim', 'nonce', !!options.nonce)\n  isStringOrArrayOfStrings(payload.iss, 'iss', !!options.issuer)\n  isPayloadString(payload.sub, '\"sub\" claim', 'sub', profile === IDTOKEN || profile === ATJWT || !!options.subject)\n  isStringOrArrayOfStrings(payload.aud, 'aud', !!options.audience)\n  isPayloadString(payload.azp, '\"azp\" claim', 'azp', profile === IDTOKEN && Array.isArray(payload.aud) && payload.aud.length > 1)\n  isStringOrArrayOfStrings(payload.amr, 'amr')\n  isPayloadString(header.typ, '\"typ\" header parameter', 'typ', !!options.typ)\n\n  if (profile === ATJWT) {\n    isPayloadString(payload.client_id, '\"client_id\" claim', 'client_id', true)\n  }\n\n  if (profile === LOGOUTTOKEN) {\n    isPayloadString(payload.sid, '\"sid\" claim', 'sid')\n\n    if (!('sid' in payload) && !('sub' in payload)) {\n      throw new JWTClaimInvalid('either \"sid\" or \"sub\" (or both) claims must be present')\n    }\n\n    if ('nonce' in payload) {\n      throw new JWTClaimInvalid('\"nonce\" claim is prohibited', 'nonce', 'prohibited')\n    }\n\n    if (!('events' in payload)) {\n      throw new JWTClaimInvalid('\"events\" claim is missing', 'events', 'missing')\n    }\n\n    if (!isObject(payload.events)) {\n      throw new JWTClaimInvalid('\"events\" claim must be an object', 'events', 'invalid')\n    }\n\n    if (!('http://schemas.openid.net/event/backchannel-logout' in payload.events)) {\n      throw new JWTClaimInvalid('\"http://schemas.openid.net/event/backchannel-logout\" member is missing in the \"events\" claim', 'events', 'invalid')\n    }\n\n    if (!isObject(payload.events['http://schemas.openid.net/event/backchannel-logout'])) {\n      throw new JWTClaimInvalid('\"http://schemas.openid.net/event/backchannel-logout\" member in the \"events\" claim must be an object', 'events', 'invalid')\n    }\n  }\n}\n\nconst checkAudiencePresence = (audPayload, audOption, profile) => {\n  if (typeof audPayload === 'string') {\n    return audOption.includes(audPayload)\n  }\n\n  // Each principal intended to process the JWT MUST\n  // identify itself with a value in the audience claim\n  audPayload = new Set(audPayload)\n  return audOption.some(Set.prototype.has.bind(audPayload))\n}\n\nmodule.exports = (token, key, options = {}) => {\n  if (!isObject(options)) {\n    throw new TypeError('options must be an object')\n  }\n\n  const {\n    algorithms, audience, clockTolerance, complete, crit, ignoreExp, ignoreIat, ignoreNbf, issuer,\n    jti, maxAuthAge, maxTokenAge, nonce, now, profile, subject, typ\n  } = options = validateOptions(options)\n\n  const decoded = decode(token, { complete: true })\n  key = getKey(key, true)\n\n  if (complete) {\n    ({ key } = verify(true, 'preparsed', { decoded, token }, key, { crit, algorithms, complete: true }))\n    decoded.key = key\n  } else {\n    verify(true, 'preparsed', { decoded, token }, key, { crit, algorithms })\n  }\n\n  const unix = epoch(now)\n  validateTypes(decoded, profile, options)\n\n  if (issuer && (typeof decoded.payload.iss !== 'string' || !(typeof issuer === 'string' ? [issuer] : issuer).includes(decoded.payload.iss))) {\n    throw new JWTClaimInvalid('unexpected \"iss\" claim value', 'iss', 'check_failed')\n  }\n\n  if (nonce && decoded.payload.nonce !== nonce) {\n    throw new JWTClaimInvalid('unexpected \"nonce\" claim value', 'nonce', 'check_failed')\n  }\n\n  if (subject && decoded.payload.sub !== subject) {\n    throw new JWTClaimInvalid('unexpected \"sub\" claim value', 'sub', 'check_failed')\n  }\n\n  if (jti && decoded.payload.jti !== jti) {\n    throw new JWTClaimInvalid('unexpected \"jti\" claim value', 'jti', 'check_failed')\n  }\n\n  if (audience && !checkAudiencePresence(decoded.payload.aud, typeof audience === 'string' ? [audience] : audience, profile)) {\n    throw new JWTClaimInvalid('unexpected \"aud\" claim value', 'aud', 'check_failed')\n  }\n\n  if (typ && normalizeTyp(decoded.header.typ) !== normalizeTyp(typ)) {\n    throw new JWTClaimInvalid('unexpected \"typ\" JWT header value', 'typ', 'check_failed')\n  }\n\n  const tolerance = clockTolerance ? secs(clockTolerance) : 0\n\n  if (maxAuthAge) {\n    const maxAuthAgeSeconds = secs(maxAuthAge)\n    if (decoded.payload.auth_time + maxAuthAgeSeconds < unix - tolerance) {\n      throw new JWTClaimInvalid('\"auth_time\" claim timestamp check failed (too much time has elapsed since the last End-User authentication)', 'auth_time', 'check_failed')\n    }\n  }\n\n  if (!ignoreIat && !('exp' in decoded.payload) && 'iat' in decoded.payload && decoded.payload.iat > unix + tolerance) {\n    throw new JWTClaimInvalid('\"iat\" claim timestamp check failed (it should be in the past)', 'iat', 'check_failed')\n  }\n\n  if (!ignoreNbf && 'nbf' in decoded.payload && decoded.payload.nbf > unix + tolerance) {\n    throw new JWTClaimInvalid('\"nbf\" claim timestamp check failed', 'nbf', 'check_failed')\n  }\n\n  if (!ignoreExp && 'exp' in decoded.payload && decoded.payload.exp <= unix - tolerance) {\n    throw new JWTExpired('\"exp\" claim timestamp check failed', 'exp', 'check_failed')\n  }\n\n  if (maxTokenAge) {\n    const age = unix - decoded.payload.iat\n    const max = secs(maxTokenAge)\n\n    if (age - tolerance > max) {\n      throw new JWTExpired('\"iat\" claim timestamp check failed (too far in the past)', 'iat', 'check_failed')\n    }\n\n    if (age < 0 - tolerance) {\n      throw new JWTClaimInvalid('\"iat\" claim timestamp check failed (it should be in the past)', 'iat', 'check_failed')\n    }\n  }\n\n  if (profile === IDTOKEN && Array.isArray(decoded.payload.aud) && decoded.payload.aud.length > 1 && decoded.payload.azp !== audience) {\n    throw new JWTClaimInvalid('unexpected \"azp\" claim value', 'azp', 'check_failed')\n  }\n\n  return complete ? decoded : decoded.payload\n}\n", "const verify = require('./verify')\n\nmodule.exports = {\n  IdToken: { verify: (token, key, options) => verify(token, key, { ...options, profile: 'id_token' }) },\n  LogoutToken: { verify: (token, key, options) => verify(token, key, { ...options, profile: 'logout_token' }) },\n  AccessToken: { verify: (token, key, options) => verify(token, key, { ...options, profile: 'at+JWT' }) }\n}\n", "const decode = require('./decode')\nconst sign = require('./sign')\nconst verify = require('./verify')\nconst profiles = require('./profiles')\n\nmodule.exports = {\n  decode,\n  sign,\n  verify,\n  ...profiles\n}\n", "module.exports = {\n  JWE: require('./jwe'),\n  JWK: require('./jwk'),\n  JWKS: require('./jwks'),\n  JWS: require('./jws'),\n  JWT: require('./jwt'),\n  errors: require('./errors')\n}\n", "\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.setLogger = setLogger;\nexports.proxyLogger = proxyLogger;\nexports.default = void 0;\nconst _logger = {\n  error(code, ...message) {\n    console.error(`[next-auth][error][${code.toLowerCase()}]`, `\\nhttps://next-auth.js.org/errors#${code.toLowerCase()}`, ...message);\n  },\n\n  warn(code, ...message) {\n    console.warn(`[next-auth][warn][${code.toLowerCase()}]`, `\\nhttps://next-auth.js.org/warnings#${code.toLowerCase()}`, ...message);\n  },\n\n  debug(code, ...message) {\n    var _process, _process$env;\n\n    if (!((_process = process) !== null && _process !== void 0 && (_process$env = _process.env) !== null && _process$env !== void 0 && _process$env._NEXTAUTH_DEBUG)) return;\n    console.log(`[next-auth][debug][${code.toLowerCase()}]`, ...message);\n  }\n\n};\n\nfunction setLogger(newLogger = {}) {\n  if (newLogger.error) _logger.error = newLogger.error;\n  if (newLogger.warn) _logger.warn = newLogger.warn;\n  if (newLogger.debug) _logger.debug = newLogger.debug;\n}\n\nvar _default = _logger;\nexports.default = _default;\n\nfunction proxyLogger(logger = _logger, basePath) {\n  try {\n    if (typeof window === \"undefined\") {\n      return logger;\n    }\n\n    const clientLogger = {};\n\n    for (const level in logger) {\n      clientLogger[level] = (code, ...message) => {\n        _logger[level](code, ...message);\n\n        const url = `${basePath}/_log`;\n        const body = new URLSearchParams({\n          level,\n          code,\n          message: JSON.stringify(message.map(m => {\n            if (m instanceof Error) {\n              return {\n                name: m.name,\n                message: m.message,\n                stack: m.stack\n              };\n            }\n\n            return m;\n          }))\n        });\n\n        if (navigator.sendBeacon) {\n          return navigator.sendBeacon(url, body);\n        }\n\n        return fetch(url, {\n          method: \"POST\",\n          headers: {\n            \"Content-Type\": \"application/json\"\n          },\n          body\n        });\n      };\n    }\n\n    return clientLogger;\n  } catch (_unused) {\n    return _logger;\n  }\n}", "'use strict';\n\n/**\n * @file\n *\n * Copyright 2018 FutoIn Project (https://futoin.org)\n * Copyright 2018 Andrey Galkin <andrey@futoin.org>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nconst { createHash, createHmac } = require( 'crypto' );\n\nconst g_digestLenCache = {};\n\n/**\n * Get expected hash length.\n *\n * @func\n * @alias hkdf.hash_length\n * @param {string} hash - Hash algorithm (as in underlying Node.js crypto library)\n * @returns {integer} hash digest byte length\n *\n * @note Values are hardcoded with fallback for unknown algorithms.\n */\nconst hash_length = ( hash ) => {\n    switch ( hash ) {\n    case 'sha256': return 32;\n    case 'sha512': return 64;\n    case 'sha224': return 28;\n    case 'sha384': return 48;\n    case 'sha3-256': return 32;\n    case 'sha3-512': return 64;\n    case 'sha3-224': return 28;\n    case 'sha3-384': return 48;\n    case 'blake2s256': return 32;\n    case 'blake2b512': return 64;\n    case 'sha1': return 20;\n    case 'md5': return 16;\n    default: {\n        let len = g_digestLenCache[hash];\n\n        if ( len === undefined ) {\n            len = createHash( hash ).digest().length;\n            g_digestLenCache[hash] = len;\n        }\n\n        return len;\n    }\n    }\n};\n\n/**\n * HKDF extract action.\n *\n * @func\n * @alias hkdf.extract\n * @param {string} hash - Hash algorithm (as in underlying Node.js crypto library)\n * @param {integer} hash_len - Hash digest length\n * @param {Buffer|string} ikm - Initial Keying Material\n * @param {Buffer|string} salt - Optional salt (recommended)\n * @returns {Buffer} A buffer with pseudorandom key\n *\n * @note Values are hardcoded with fallback for unknown algorithms.\n */\nconst hkdf_extract = ( hash, hash_len, ikm, salt ) => {\n    const b_ikm = Buffer.isBuffer( ikm ) ? ikm : Buffer.from( ikm );\n    const b_salt = ( salt && salt.length ) ? Buffer.from( salt ) : Buffer.alloc( hash_len, 0 );\n\n    return createHmac( hash, b_salt ).update( b_ikm ).digest();\n};\n\n/**\n * HKDF expand action.\n *\n * @func\n * @alias hkdf.expand\n * @param {string} hash - Hash algorithm (as in underlying Node.js crypto library)\n * @param {integer} hash_len - Hash digest length\n * @param {Buffer|string} prk - A buffer with pseudorandom key\n * @param {integer} length - length of output keying material in octets\n * @param {Buffer|string} info - Optional context (safe to skip)\n * @returns {Buffer} A buffer with output keying material\n *\n * @note Values are hardcoded with fallback for unknown algorithms.\n */\nconst hkdf_expand = ( hash, hash_len, prk, length, info ) => {\n    const b_info = Buffer.from( info || '' );\n    const info_len = b_info.length;\n\n    const steps = Math.ceil( length / hash_len );\n\n    if ( steps > 0xFF ) {\n        throw new Error( `OKM length ${length} is too long for ${hash} hash` );\n    }\n\n    // use single buffer with unnecessary create/copy/move operations\n    const t = Buffer.alloc( hash_len * steps + info_len + 1 );\n\n    for ( let c = 1, start = 0, end = 0; c <= steps; ++c ) {\n        // add info\n        b_info.copy( t, end );\n        // add counter\n        t[ end + info_len ] = c;\n\n        createHmac( hash, prk )\n            // use view: T(C) = T(C-1) | info | C\n            .update( t.slice( start, end + info_len + 1 ) )\n            .digest()\n            // put back to the same buffer\n            .copy( t, end );\n\n        start = end; // used for T(C-1) start\n        end += hash_len; // used for T(C-1) end & overall end\n    }\n\n    return t.slice( 0, length );\n};\n\n/**\n * HMAC-based Extract-and-Expand Key Derivation Function (HKDF)\n *\n * @param {Buffer|string} ikm - Initial Keying Material\n * @param {integer} length - Required byte length of output\n * @param {Buffer|string} salt='' - Optional salt (recommended)\n * @param {Buffer|string} info='' - Optional context (safe to skip)\n * @param {string} hash='SHA-256' - HMAC hash function to use\n * @returns {Buffer} Raw buffer with derived key of @p length bytes\n */\nfunction hkdf( ikm, length, { salt='', info='', hash='SHA-256' } = {} ) {\n    hash = hash.toLowerCase().replace( '-', '' );\n\n    // 0. Hash length\n    const hash_len = hash_length( hash );\n\n    // 1. extract\n    const prk = hkdf_extract( hash, hash_len, ikm, salt );\n\n    // 2. expand\n    return hkdf_expand( hash, hash_len, prk, length, info );\n}\n\nObject.defineProperties( hkdf, {\n    hash_length : {\n        configurable: false,\n        enumerable: false,\n        writable: false,\n        value: hash_length,\n    },\n    extract : {\n        configurable: false,\n        enumerable: false,\n        writable: false,\n        value: hkdf_extract,\n    },\n    expand : {\n        configurable: false,\n        enumerable: false,\n        writable: false,\n        value: hkdf_expand,\n    },\n} );\n\nmodule.exports = hkdf;\n", "\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.encode = encode;\nexports.decode = decode;\nexports.getToken = getToken;\nexports.default = void 0;\n\nvar _crypto = _interopRequireDefault(require(\"crypto\"));\n\nvar _jose = _interopRequireDefault(require(\"jose\"));\n\nvar _logger = _interopRequireDefault(require(\"./logger\"));\n\nconst DEFAULT_SIGNATURE_ALGORITHM = \"HS512\";\nconst DEFAULT_ENCRYPTION_ALGORITHM = \"A256GCM\";\nconst DEFAULT_ENCRYPTION_ENABLED = false;\nconst DEFAULT_MAX_AGE = 30 * 24 * 60 * 60;\n\nasync function encode({\n  token = {},\n  maxAge = DEFAULT_MAX_AGE,\n  secret,\n  signingKey,\n  signingOptions = {\n    expiresIn: `${maxAge}s`\n  },\n  encryptionKey,\n  encryptionOptions = {\n    alg: \"dir\",\n    enc: DEFAULT_ENCRYPTION_ALGORITHM,\n    zip: \"DEF\"\n  },\n  encryption = DEFAULT_ENCRYPTION_ENABLED\n} = {}) {\n  const _signingKey = signingKey ? _jose.default.JWK.asKey(JSON.parse(signingKey)) : getDerivedSigningKey(secret);\n\n  const signedToken = _jose.default.JWT.sign(token, _signingKey, signingOptions);\n\n  if (encryption) {\n    const _encryptionKey = encryptionKey ? _jose.default.JWK.asKey(JSON.parse(encryptionKey)) : getDerivedEncryptionKey(secret);\n\n    return _jose.default.JWE.encrypt(signedToken, _encryptionKey, encryptionOptions);\n  }\n\n  return signedToken;\n}\n\nasync function decode({\n  secret,\n  token,\n  maxAge = DEFAULT_MAX_AGE,\n  signingKey,\n  verificationKey = signingKey,\n  verificationOptions = {\n    maxTokenAge: `${maxAge}s`,\n    algorithms: [DEFAULT_SIGNATURE_ALGORITHM]\n  },\n  encryptionKey,\n  decryptionKey = encryptionKey,\n  decryptionOptions = {\n    algorithms: [DEFAULT_ENCRYPTION_ALGORITHM]\n  },\n  encryption = DEFAULT_ENCRYPTION_ENABLED\n} = {}) {\n  if (!token) return null;\n  let tokenToVerify = token;\n\n  if (encryption) {\n    const _encryptionKey = decryptionKey ? _jose.default.JWK.asKey(JSON.parse(decryptionKey)) : getDerivedEncryptionKey(secret);\n\n    const decryptedToken = _jose.default.JWE.decrypt(token, _encryptionKey, decryptionOptions);\n\n    tokenToVerify = decryptedToken.toString(\"utf8\");\n  }\n\n  const _signingKey = verificationKey ? _jose.default.JWK.asKey(JSON.parse(verificationKey)) : getDerivedSigningKey(secret);\n\n  return _jose.default.JWT.verify(tokenToVerify, _signingKey, verificationOptions);\n}\n\nasync function getToken(params) {\n  var _req$headers$authoriz;\n\n  const {\n    req,\n    secureCookie = !(!process.env.NEXTAUTH_URL || process.env.NEXTAUTH_URL.startsWith(\"http://\")),\n    cookieName = secureCookie ? \"__Secure-next-auth.session-token\" : \"next-auth.session-token\",\n    raw = false,\n    decode: _decode = decode\n  } = params;\n  if (!req) throw new Error(\"Must pass `req` to JWT getToken()\");\n  let token = req.cookies[cookieName];\n\n  if (!token && ((_req$headers$authoriz = req.headers.authorization) === null || _req$headers$authoriz === void 0 ? void 0 : _req$headers$authoriz.split(\" \")[0]) === \"Bearer\") {\n    const urlEncodedToken = req.headers.authorization.split(\" \")[1];\n    token = decodeURIComponent(urlEncodedToken);\n  }\n\n  if (raw) {\n    return token;\n  }\n\n  try {\n    return _decode({\n      token,\n      ...params\n    });\n  } catch (_unused) {\n    return null;\n  }\n}\n\nlet DERIVED_SIGNING_KEY_WARNING = false;\nlet DERIVED_ENCRYPTION_KEY_WARNING = false;\n\nfunction hkdf(secret, {\n  byteLength,\n  encryptionInfo,\n  digest = \"sha256\"\n}) {\n  if (_crypto.default.hkdfSync) {\n    return Buffer.from(_crypto.default.hkdfSync(digest, secret, Buffer.alloc(0), encryptionInfo, byteLength));\n  }\n\n  return require(\"futoin-hkdf\")(secret, byteLength, {\n    info: encryptionInfo,\n    hash: digest\n  });\n}\n\nfunction getDerivedSigningKey(secret) {\n  if (!DERIVED_SIGNING_KEY_WARNING) {\n    _logger.default.warn(\"JWT_AUTO_GENERATED_SIGNING_KEY\");\n\n    DERIVED_SIGNING_KEY_WARNING = true;\n  }\n\n  const buffer = hkdf(secret, {\n    byteLength: 64,\n    encryptionInfo: \"NextAuth.js Generated Signing Key\"\n  });\n\n  const key = _jose.default.JWK.asKey(buffer, {\n    alg: DEFAULT_SIGNATURE_ALGORITHM,\n    use: \"sig\",\n    kid: \"nextauth-auto-generated-signing-key\"\n  });\n\n  return key;\n}\n\nfunction getDerivedEncryptionKey(secret) {\n  if (!DERIVED_ENCRYPTION_KEY_WARNING) {\n    _logger.default.warn(\"JWT_AUTO_GENERATED_ENCRYPTION_KEY\");\n\n    DERIVED_ENCRYPTION_KEY_WARNING = true;\n  }\n\n  const buffer = hkdf(secret, {\n    byteLength: 32,\n    encryptionInfo: \"NextAuth.js Generated Encryption Key\"\n  });\n\n  const key = _jose.default.JWK.asKey(buffer, {\n    alg: DEFAULT_ENCRYPTION_ALGORITHM,\n    use: \"enc\",\n    kid: \"nextauth-auto-generated-encryption-key\"\n  });\n\n  return key;\n}\n\nvar _default = {\n  encode,\n  decode,\n  getToken\n};\nexports.default = _default;", "import { APIGatewayProxyEventV2 as APIGatewayProxyEvent } from 'aws-lambda';\nimport { HttpResponse } from '@architect/functions';\nimport tables from '../../../tables';\nimport handle from '../../../handle';\nimport auth from '../../../auth';\n\nconst permissionTypesToLevels = {\n  READ: 0,\n  WRITE: 1,\n  ADMIN: 2,\n};\n\nexport const handler = handle(\n  async (event: APIGatewayProxyEvent): Promise<HttpResponse> => {\n    const { user } = await auth(event);\n\n    if (!user) {\n      return {\n        statusCode: 403,\n        body: 'Forbidden',\n      };\n    }\n\n    const data = await tables();\n\n    const ids = event.pathParameters!.inviteid!.split(',');\n\n    const returns = await Promise.all(\n      ids.map(async (inviteId) => {\n        const invite = await data.invites.get({ id: inviteId });\n        if (!invite) {\n          return {\n            statusCode: 404,\n            body: 'Invite not found',\n          };\n        }\n\n        if (invite.user_id !== user.id) {\n          return {\n            statusCode: 403,\n            body: 'Forbidden',\n          };\n        }\n\n        const resource =\n          invite.resource_uri ||\n          `/${invite.resource_type}/${invite.resource_id}`;\n        const permissionId = invite.permission_id;\n\n        const oldPermission = await data.permissions.get({ id: permissionId });\n\n        if (\n          !oldPermission ||\n          firstPermissionTypeSmallerThanSecond(\n            oldPermission.type,\n            invite.permission\n          )\n        ) {\n          const newPermission = {\n            id: permissionId,\n            resource_uri: resource,\n            resource_type: invite.resource_type,\n            resource_id: invite.resource_id,\n            role_id: invite.role_id,\n            user_id: user.id,\n            type: invite.permission,\n            given_by_user_id: invite.invited_by_user_id,\n            parent_resource_uri: invite.parent_resource_uri || null,\n            can_comment: invite.can_comment || false,\n          };\n\n          await data.permissions.put(newPermission);\n        }\n\n        await data.invites.delete({ id: invite.id });\n\n        return;\n      })\n    );\n\n    const errorReturns = returns.filter((ret) => ret && ret.statusCode !== 201);\n\n    if (errorReturns.length > 0) {\n      return errorReturns[0]!;\n    }\n\n    return {\n      statusCode: 201,\n    };\n  }\n);\n\nfunction firstPermissionTypeSmallerThanSecond(\n  perm1: PermissionType,\n  perm2: PermissionType\n): boolean {\n  const level1 = permissionTypesToLevels[perm1];\n  const level2 = permissionTypesToLevels[perm2];\n\n  return level1 < level2;\n}\n", "import arc from '@architect/functions';\n\nconst observedTables = [\n  'userkeys',\n  'permissions',\n  'tags',\n  'usertaggedresources',\n];\n\nlet tablesPromise: Promise<DataTables>;\n\nexport default async function tables(): Promise<DataTables> {\n  if (tablesPromise) {\n    return tablesPromise;\n  }\n\n  const p = new Promise<DataTables>((resolve, reject) => {\n    arc\n      .tables()\n      .then((_tables) => {\n        const tables = _tables as unknown as DataTables;\n        for (const observedTable of observedTables) {\n          observe(tables, observedTable);\n        }\n        resolve(tables);\n      })\n      .catch(reject);\n  });\n\n  return p;\n}\n\nasync function observe(tables: DataTables, tableName: string) {\n  const table = tables[tableName];\n  if (!table) {\n    throw new Error('No table named ' + tableName);\n  }\n  if (table.__deci_observed__) {\n    return;\n  }\n  table.__deci_observed__ = true;\n\n  for (const methodName of ['put', 'delete']) {\n    const method = methodName === 'put' ? table.put : table.delete;\n    const replaceMethod = async (args: any) => {\n      const ret = await method.call(table, args);\n\n      await arc.queues.publish({\n        name: `${tableName}-changes`,\n        payload: {\n          table: tableName,\n          action: methodName,\n          args,\n        },\n      });\n\n      return ret;\n    };\n\n    if (methodName === 'put') {\n      table['put'] = replaceMethod;\n    } else {\n      table['delete'] = replaceMethod;\n    }\n  }\n}\n", "import { APIGatewayProxyEventV2 as APIGatewayProxyEvent } from 'aws-lambda';\nimport { HttpResponse } from '@architect/functions';\n\ntype Handler = (req: APIGatewayProxyEvent) => Promise<string | HttpResponse>\n\nexport default (fn: Handler) => {\n  return async (req: APIGatewayProxyEvent): Promise<HttpResponse> => {\n    try {\n      const result = await fn(req);\n      if (result === null || result === undefined) {\n        return {\n          statusCode: 404,\n        };\n      }\n\n      if (typeof result === 'string') {\n        return {\n          statusCode: okStatusCodeFor(req),\n          body: result,\n          headers: {\n            'content-type': 'text/plain',\n          },\n        };\n      }\n      if (isFullReturnObject(result)) {\n        return result;\n      }\n      return {\n        statusCode: okStatusCodeFor(req),\n        headers: {\n          'content-type': 'application/json; charset=utf-8',\n        },\n        body: JSON.stringify(result),\n      };\n    } catch (err) {\n      console.error(err);\n      return {\n        statusCode: 500,\n        json: {\n          name: err.name,\n          message: err.message,\n          stack: err.stack,\n        },\n      };\n    }\n  };\n};\n\nfunction isFullReturnObject(result: HttpResponse) {\n  return !!result.statusCode || !!result.json;\n}\n\nfunction okStatusCodeFor(req: APIGatewayProxyEvent) {\n  const verb = req.routeKey.split(' ')[0];\n  switch (verb) {\n    case 'PUT':\n    case 'DELETE':\n      return 202;\n    case 'POST':\n      return 201;\n  }\n  return 200;\n}\n", "import { APIGatewayProxyEventV2 as APIGatewayProxyEvent } from 'aws-lambda';\nimport { parse as parseCookie } from 'simple-cookie';\nimport NextAuthJWT from 'next-auth/jwt';\nimport tables from './tables';\nimport jwtConf from './auth-flow/jwt';\n\ntype AuthResult = {\n  user: User | null\n  token: string | null | undefined\n  secret: string | null\n  gotFromSecProtocolHeader: boolean\n};\n\ntype SessionTokenResult = {\n  token: string | null | undefined\n  gotFromSecProtocolHeader: boolean\n};\n\ntype Request = APIGatewayProxyEvent & {\n  cookies?: string[] | null\n};\n\ntype ParsedCookies = Record<string, string>;\n\nconst TOKEN_COOKIE_NAMES = [\n  'next-auth.session-token',\n  '__Secure-next-auth.session-token',\n];\n\nasync function auth(event: Request): Promise<AuthResult> {\n  const { token, gotFromSecProtocolHeader } = getSessionToken(event);\n  let user: User | null = null;\n  let secret: string | null = null;\n  if (token) {\n    const { decode: decodeJWT } = NextAuthJWT;\n    try {\n      const decoded = await decodeJWT({\n        ...jwtConf,\n        token,\n      });\n\n      if (decoded.accessToken) {\n        const userWithSecret = await findUserByAccessToken(decoded.accessToken as string);\n        if (userWithSecret) {\n          const { secret: _secret, ...userWithoutSecret } = userWithSecret;\n          secret = _secret;\n          user = userWithoutSecret;\n        }\n      }\n    } catch (err) {\n      console.error(err.message);\n      // do nothing\n    }\n  }\n\n  return { user, token, secret, gotFromSecProtocolHeader };\n}\n\n\nfunction getSessionToken(event: Request): SessionTokenResult {\n  let gotFromSecProtocolHeader = false;\n  const cookies = parseCookies(event.headers.Cookie || event.cookies || []);\n  let token =\n    cookies[TOKEN_COOKIE_NAMES[0]] ||\n    cookies[TOKEN_COOKIE_NAMES[1]] ||\n    event.headers.authorization ||\n    event.headers.Authorization;\n  if (!token) {\n    token =\n      event.headers['sec-websocket-protocol'] ||\n      event.headers['Sec-WebSocket-Protocol'];\n    if (token) {\n      gotFromSecProtocolHeader = true;\n    }\n  }\n  if (token && token.startsWith('Bearer ')) {\n    token = token.substring('Bearer '.length);\n  }\n  return { token, gotFromSecProtocolHeader };\n}\n\nfunction parseCookies(cookies: string[] | string): ParsedCookies {\n  if (!cookies) {\n    cookies = [];\n  }\n  if (!Array.isArray(cookies)) {\n    cookies = [cookies];\n  }\n  return cookies.reduce((cookies: ParsedCookies, cookie: string) => {\n    const { name, value } = parseCookie(cookie) as { name: string, value: string };\n    cookies[name] = value;\n    return cookies;\n  }, {} as ParsedCookies);\n}\n\nasync function findUserByAccessToken(accessToken: string): Promise<UserWithSecret | undefined> {\n  const data = await tables();\n\n  const foundUsers = await data.users.query({\n    IndexName: 'bySecret',\n    KeyConditionExpression: 'secret = :secret',\n    ExpressionAttributeValues: {\n      ':secret': accessToken,\n    },\n  });\n\n  return foundUsers.Items[0];\n}\n\nexport default auth;\n", "import NextAuthJWT from 'next-auth/jwt';\n\nconst maxAge = 30 * 24 * 60 * 60;\n\nexport default {\n  secret: process.env.JWT_SECRET!,\n  signingKey: Buffer.from(\n    process.env.JWT_SIGNING_PRIVATE_KEY!,\n    'base64'\n  ).toString(),\n  maxAge, // same as session maxAge,\n  encode: NextAuthJWT.encode,\n  decode: NextAuthJWT.decode,\n};\n"],
  "mappings": "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",
  "names": []
}
