"use strict";exports.id=3909,exports.ids=[3909],exports.modules={23503:(o,e,t)=>{t.r(e),t.d(e,{default:()=>L});var n=t(1943),i=t(54309),a=t(60569),r=t(1146),l=t(26056),c=t(99700),s=t(70908),d=t(1439),u=t(52521),h=t(25859),b=t(30969),p=t(56513),v=t(3241),k=t(68825),g=t(86789),m=t(65020);const y=(o,e)=>"bigint"===typeof e?e.toString():e,f=o=>JSON.stringify({children:o.children},y);var C=t(47371);const w="Published 1",P=o=>{var e,t;let{notebookId:a,editor:r,docsync:l}=o;const c=(0,k.p)(),[s]=(0,p.ry)({variables:{id:a}}),d=null===(e=s.data)||void 0===e?void 0:e.getPadById,[u,h]=(0,b.useState)(),[v,y]=(0,b.useState)(),[P,Z]=(0,b.useState)((()=>"Sulu")),F=(0,b.useMemo)((()=>null===l||void 0===l?void 0:l.hasLocalChanges()),[l]),E=(0,b.useMemo)((()=>null===l||void 0===l?void 0:l.isSavedRemotely()),[l]),S=(0,b.useMemo)((()=>!!d&&"READ"===d.myPermissionType),[d]),I=(0,b.useMemo)((()=>{var o;return!!d&&(null!==(o=d.isPublic)&&void 0!==o&&o)}),[d]),[x]=(o=>{let{editor:e,id:t}=o;const a=(0,k.p)(),r=(0,i.s0)(),[{data:l,error:c}]=(0,p.LD)(),[,s]=(0,p.bP)();if(c)throw console.error(c),new Error("Could not fetch workspaces");return[(0,b.useCallback)((async()=>{if(!e||!l)return console.error("Failed to duplicate notebook. Missing editor or workspaces data."),void a("Failed to duplicate notebook","error");try{const{data:o,error:i}=await s({id:t,targetWorkspace:l.workspaces[0].id,document:f(e)});i?(console.error("Failed to duplicate notebook. Error:",i),a("Failed to duplicate notebook","error")):o?r((0,n.Fb)({}).notebook({notebook:o.duplicatePad}).$):(console.error("Failed to duplicate notebook. Received empty response.",i),a("Failed to duplicate notebook.","error"))}catch(o){console.error("Failed to duplicate notebook. Error:",o),a("Failed to duplicate notebook.","error")}}),[l,s,e,t,r,a])]})({id:a,editor:r}),[,R]=(0,p.YL)(),[,B]=(0,p.du)(),[,T]=(0,p.cm)(),[,L]=(0,C.ck)(),[,N]=(0,p.Mu)(),[,A]=(0,p.H_)(),D=(0,b.useCallback)((async o=>{var e;const t=null===(e=(await A({notebookId:a,fileName:o.name,fileType:o.type})).data)||void 0===e?void 0:e.getCreateAttachmentForm;if(!t)return;const n=new URL(t.url),i=new FormData;for(const{key:a,value:r}of t.fields)i.set(a,r);return[n,i,t.handle]}),[A,a]),[,U]=(0,p.UF)(),H=(0,b.useCallback)((async o=>{var e,t;const n=await U({handle:o});if(n.error)throw new Error(n.error.message);const i=null===(e=n.data)||void 0===e||null===(t=e.attachFileToPad)||void 0===t?void 0:t.url;if(!i)return;return{url:new URL(i)}}),[U]),M=(0,b.useContext)(g.K),O=(0,b.useCallback)((async()=>{await x(),M({type:"action",action:"notebook duplicated"})}),[x,M]),W=(0,b.useCallback)((async()=>{await(null===l||void 0===l?void 0:l.removeLocalChanges()),await M({type:"action",action:"notebook local changes removed"}),window.location.reload()}),[l,M]);(0,b.useEffect)((()=>{s.error!==u&&h(s.error)}),[u,s]),(0,b.useEffect)((()=>{if(d){const{icon:o,iconColor:e}=(0,m.D)(d.icon);o&&v!==o&&y(o),e&&e!==P&&Z(e)}}),[v,P,d]);const Q=(0,b.useCallback)((o=>{if(o!==v&&y(o),P){const e="".concat(o,"-").concat(P);e!==(null===d||void 0===d?void 0:d.icon)&&(R({id:a,icon:e}).catch((o=>{c("Error updating icon: ".concat(o.message),"error")})),M({type:"action",action:"notebook icon changed"}))}}),[M,v,P,null===d||void 0===d?void 0:d.icon,a,R,c]),X=(0,b.useCallback)((o=>{if(o!==P&&Z(o),v){const e="".concat(v,"-").concat(o);e!==(null===d||void 0===d?void 0:d.icon)&&(R({id:a,icon:e}).catch((o=>{c("Error updating icon: ".concat(o.message),"error")})),M({type:"action",action:"notebook icon color changed"}))}}),[M,v,P,null===d||void 0===d?void 0:d.icon,a,R,c]),[z,K]=(0,b.useState)(!1),Y=null===d||void 0===d?void 0:d.snapshots.filter((o=>o.snapshotName===w))[0];(0,b.useEffect)((()=>{if(!l||!Y||!I)return;const o=o=>{"remote"===o&&K(!(null!==Y&&void 0!==Y&&Y.version&&l.equals(null===Y||void 0===Y?void 0:Y.version)))};return l.onSaved(o),o("remote"),()=>null===l||void 0===l?void 0:l.offSaved(o)}),[l,I,Y,K]);const $=(0,b.useCallback)((async o=>{await B({id:a,isPublic:o})}),[a,B]),[_,q]=(0,b.useState)(!1),j=(0,b.useCallback)((()=>{q(!0),N({notebookId:a,snapshotName:w}).then((o=>o.error?(console.error("Error publishing notebook: ".concat(o.error.message)),void c("Error publishing notebook","error")):$(!0).then((()=>{M({type:"action",action:"publish notebook",props:{id:a}})})))).catch((o=>{console.error(o),c("Error publishing notebook","error")})).finally((()=>q(!1)))}),[N,M,a,$,c]),G=(0,b.useCallback)((()=>{$(!1).then((()=>{M({type:"action",action:"unpublish notebook",props:{id:a}})}))}),[M,a,$]),J=(0,b.useCallback)((o=>T({padId:a,email:o,canComment:!0,permissionType:C.vH.Write})),[a,T]),V=(0,b.useCallback)((o=>L({userId:o,padId:a})),[a,L]);return{error:u,notebook:d,isReadOnly:S,isPublic:I,isPublishing:_,icon:v,iconColor:P,hasLocalChanges:F,isSavedRemotely:E,connectionParams:null===d||void 0===d?void 0:d.padConnectionParams,initialState:null!==(t=null===d||void 0===d?void 0:d.initialState)&&void 0!==t?t:void 0,hasUnpublishedChanges:z,duplicate:O,removeLocalChanges:W,setNotebookPublic:$,updateIcon:Q,updateIconColor:X,publishNotebook:j,unpublishNotebook:G,inviteEditorByEmail:J,removeEditorById:V,getAttachmentForm:D,onAttached:H}};var Z=t(5594);const F=()=>Promise.all([t.e(5151),t.e(247),t.e(1980),t.e(840),t.e(3658)]).then(t.bind(t,59104)),E=(0,b.lazy)(F),S=()=>Promise.all([t.e(3649),t.e(9663),t.e(2185)]).then(t.bind(t,57087)),I=(0,b.lazy)(S),x=()=>Promise.all([t.e(5151),t.e(3649),t.e(2513),t.e(3321),t.e(5195),t.e(3258),t.e(2405),t.e(9663),t.e(247),t.e(840),t.e(6896),t.e(7082),t.e(8112),t.e(8819),t.e(9209)]).then(t.bind(t,67467)),R=(0,b.lazy)(x);F().then(S).then(x);const B=()=>{var o,e,t;const[i,k]=(0,b.useState)(),[g,m]=(0,b.useState)(),{notebook:{id:y},secret:f}=(0,n.ZX)((0,n.Fb)({}).notebook),{error:C,notebook:w,initialState:F,connectionParams:S,hasLocalChanges:x,hasUnpublishedChanges:B,isReadOnly:T,isPublishing:L,icon:N,iconColor:A,updateIcon:D,updateIconColor:U,duplicate:H,removeLocalChanges:M,publishNotebook:O,unpublishNotebook:W,inviteEditorByEmail:Q,removeEditorById:X,getAttachmentForm:z,onAttached:K}=P({notebookId:y,editor:i,docsync:g}),[Y]=(0,p.LD)(),[,$]=(0,p.sT)();(0,v.U)();const _=(0,b.useCallback)((o=>{if(!(0,l.Bb)()){const e=o.trim();$({id:y,name:e}),window.history.replaceState({},e,(0,n.Fb)({}).notebook({notebook:{id:y,name:e}}).$)}}),[y,$]),q=(0,b.useMemo)((()=>({color:A})),[A]);if(C){if(/no such/i.test(null===C||void 0===C?void 0:C.message))return(0,Z.tZ)(a.mf,{Heading:"h1",wellKnown:"404"});if(/forbidden/i.test(null===C||void 0===C?void 0:C.message))return(0,Z.tZ)(a.mf,{Heading:"h1",wellKnown:"403"});throw C}return(0,Z.tZ)(r.RS.Provider,{value:q,children:(0,Z.tZ)(a.RQ,{Heading:"h1",title:null!==(o=null===w||void 0===w?void 0:w.name)&&void 0!==o?o:"",suspenseFallback:(0,Z.tZ)(c.Y,{}),children:(0,Z.tZ)(s.h,{notebook:(0,Z.tZ)(a.RQ,{Heading:"h1",title:null,suspenseFallback:(0,Z.tZ)(d.r,{}),children:(0,Z.tZ)(R,{notebookMetaLoaded:null!=w,notebookTitle:null!==(e=null===w||void 0===w?void 0:w.name)&&void 0!==e?e:"",onNotebookTitleChange:_,notebookId:y,readOnly:T,secret:f,connectionParams:S,initialState:F,onEditor:k,onDocsync:m,getAttachmentForm:z,onAttached:K})}),notebookIcon:(0,Z.tZ)(a.RQ,{Heading:"h1",title:null,suspenseFallback:(0,Z.tZ)(u.O,{}),children:(0,Z.tZ)(I,{color:A,icon:null!==N&&void 0!==N?N:"Rocket",onChangeIcon:D,onChangeColor:U,readOnly:T})}),topbar:(0,Z.tZ)(a.RQ,{Heading:"h1",title:null,suspenseFallback:(0,Z.tZ)(h.D,{}),children:(0,Z.tZ)(E,{userWorkspaces:null===(t=Y.data)||void 0===t?void 0:t.workspaces,notebook:w,hasLocalChanges:x,hasUnpublishedChanges:B,isPublishing:L,duplicateNotebook:H,removeLocalChanges:M,publishNotebook:O,unpublishNotebook:W,inviteEditorByEmail:Q,removeEditorById:X})})})})})},T=()=>{var o,e,t;const[a,r]=(0,b.useState)(!1),{notebook:{id:l},invite:{id:s}}=(0,n.ZX)((0,n.Fb)({}).acceptInvite),[d,u]=(0,p.ry)({variables:{id:l},requestPolicy:"network-only"}),h=!d.fetching,v=null===(o=d.data)||void 0===o||null===(e=o.getPadById)||void 0===e?void 0:e.myPermissionType,k=null===(t=d.error)||void 0===t?void 0:t.graphQLErrors.find((o=>{var e;return"FORBIDDEN"===(null===(e=o.extensions)||void 0===e?void 0:e.code)})),g=null!=v&&null==k,m=h&&!a&&(null==v||null!=k);return(0,b.useEffect)((()=>{if(m){const o=(o=>"".concat(window.location.origin,"/api/invites/").concat(o,"/accept"))(s);fetch(o,{method:"GET",credentials:"same-origin"}).then((o=>{o.ok?(r(!0),u({variables:{id:l}})):console.error("Failed to accept invite",o)}))}}),[s,l,u,m]),h&&g?(0,Z.tZ)(i.Fg,{replace:!0,to:"".concat((0,n.Fb)({}).$,"/").concat(l)}):(0,Z.tZ)(c.Y,{})},L=()=>{const o=(0,n.Fb)({}),{key:e}=(0,i.TH)();return(0,Z.BX)(i.Z5,{children:[(0,Z.tZ)(i.AW,{path:o.notebook.template,element:(0,Z.tZ)(a.U2,{category:"notebook",children:(0,Z.tZ)(B,{},e)})}),(0,Z.tZ)(i.AW,{path:o.acceptInvite.template,element:(0,Z.tZ)(a.U2,{category:"notebook",children:(0,Z.tZ)(a.U_,{children:(0,Z.tZ)(T,{})})})}),(0,Z.tZ)(i.AW,{path:"*",element:(0,Z.tZ)(a.U_,{children:(0,Z.tZ)(a.mf,{Heading:"h1",wellKnown:"404"})})})]})}},65020:(o,e,t)=>{t.d(e,{D:()=>a});var n=t(50470),i=t(74029);function a(o){const e=null===o||void 0===o?void 0:o.replace(" ","").split("-");if(e){if(2!==e.length)return console.error("Cannot parse notebook icon ".concat(o)),{ok:!1};const t=e[0],a=e[1];return n.x.includes(t)&&i.kV.includes(a)?{icon:t,iconColor:a,ok:!0}:{ok:!1}}return"string"===typeof o&&console.error("bad parameter for iconIdentifier ".concat(o)),{ok:!1}}},25859:(o,e,t)=>{t.d(e,{D:()=>u});t(30969);var n=t(426),i=t(66840),a=t(5594);const r=(0,n.css)({width:"100%",display:"flex",padding:"16px 0",borderBottom:"1px solid",borderColor:"".concat((0,i.g)("highlightColor")),justifyContent:"space-between"},";label:-TopbarPlaceholder--containerStyle;"),l=(0,n.css)({height:"32px",width:"32px",borderRadius:"32px",backgroundColor:"".concat((0,i.g)("highlightColor"))},";label:-TopbarPlaceholder--backButtonStyles;"),c={name:"avzwxf--TopbarPlaceholder--rightPanel",styles:"display:flex;flex-direction:row;align-items:center;gap:16px;margin-right:-1rem;label:-TopbarPlaceholder--rightPanel;"},s=(0,n.css)({height:"24px",width:"24px",borderRadius:"24px",backgroundColor:"".concat((0,i.g)("highlightColor"))},";label:-TopbarPlaceholder--avatarPlaceholderStyles;"),d=(0,n.css)({height:"33.68px",width:"64px",borderRadius:"6px",backgroundColor:"".concat((0,i.g)("highlightColor"))},";label:-TopbarPlaceholder--shareButtonPlaceholderStyles;"),u=()=>(0,a.BX)("div",{css:r,children:[(0,a.tZ)("div",{css:l}),(0,a.BX)("div",{css:c,children:[(0,a.tZ)("div",{css:s}),(0,a.tZ)("div",{css:d})]})]})}};
//# sourceMappingURL=notebooks.b5cc453c.chunk.js.map