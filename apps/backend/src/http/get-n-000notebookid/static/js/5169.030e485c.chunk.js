(()=>{"use strict";var e={83557:(e,t,n)=>{n.d(t,{G3:()=>g,v5:()=>f,Tj:()=>y,W1:()=>m});var r,s,a=n(38238),o=n.n(a),i=n(16976),u=n(55013),l=n(27597),c=n(26171);const m=e=>{const t=function(e){return e.map((0,l.ZP)((e=>{if("identified-block"===e.type){const t=e.block.args;(0,i.UT)(t[0])?t[0]=(0,i.ZW)(r||(r=o()([""," = ",""])),{name:f(e.id)},t[0]):"assign"!==t[0].type||(0,c.JL)(t[0].args[0]).trim()||(t[0].args[0].args[0]=f(e.id))}})))}(e),[n,a]=function(e,t){const n=p(e),r=new Set;return[e.map((0,l.ZP)((e=>{"identified-block"===e.type&&(0,i.cQ)(e.block,(e=>{if((0,i.iu)(e)){const s=(0,c.JL)(e);if(y(s)){const a=t.get(s);if(a)return a;{const{newName:t,wasGenerated:a}=n(s);e.args[0]=t,a&&r.add(e.args[0])}}}return e}))}))),r]}(t,function(e){return new Map(e.flatMap((e=>{var t;const n=null===(t=e.block)||void 0===t?void 0:t.args[0];if("table-column-assign"===(null===n||void 0===n?void 0:n.type)){const[t,r]=n.args,a=(0,i.ZW)(s||(s=o()(["",".",""])),{name:t.args[0]},{name:r.args[0]});return[[f(e.id),a]]}return[]})))}(e));return[n,a]};const p=e=>{const[t,n]=function(e){const t=new Map,n=new Map;for(const a of e)if("identified-block"===a.type){var r,s;const e=f(a.id);let o=null!==(r=(0,c.ZP)(null!==(s=a.block.args[0])&&void 0!==s?s:{type:"noop",args:[]},!1))&&void 0!==r?r:"";y(o)&&(o=""),t.set(e,o),o&&d(n,o,e)}return[t,n]}(e);let r=0;return(0,u.pf)((e=>{var s;g(e);const a=t.get(e);if(a&&1===(null===(s=n.get(a))||void 0===s?void 0:s.size))return{newName:a,wasGenerated:!1};const o=a?"".concat(a,"_").replace(/_+$/,"_"):"Value_";let i;do{var u;r++,i=o+r}while(null!==(u=n.get(i))&&void 0!==u&&u.size);return{newName:i,wasGenerated:!0}}))};function d(e,t,n){var r;const s=null!==(r=e.get(t))&&void 0!==r?r:new Set;e.set(t,s),s.add(n)}const f=e=>"exprRef_".concat(e.replace(/[^a-zA-Z0-9]/g,"_")),y=e=>e.startsWith("exprRef_"),g=e=>{if(!y(e))throw new Error("expected expression ref");return e}},13986:(e,t,n)=>{n.d(t,{ar:()=>G,x4:()=>r.x4,or:()=>r.or,WR:()=>r.WR,kc:()=>r.kc,ZP:()=>s.ZP,v5:()=>y.v5,tA:()=>s.tA,UT:()=>r.UT,IX:()=>r.IX,BJ:()=>r.BJ,s$:()=>r.s$,fh:()=>r.fh});var r=n(16976),s=n(26171),a=n(55013);var o=n(26290),i=n.n(o),u=n(37114),l=n(79568),c=n(27597),m=n(24161),p=n.n(m),d=n(60046),f=n(61138),y=n(83557);const g=e=>{const t=(0,s.ZP)(e);return t&&"table-column-assign"===e.type?"".concat(t,".").concat(e.args[1].args[0]):t};let h;const b=e=>{"undefined"===typeof test&&console.error(e),null!=h&&h(e)};const v=async(e,t,n)=>{const o=n.getFromCache(t);let i;if(o)return[(0,a.m0)(o.result),o.value];const u=(0,s.WV)(e,t);n.inferContext.statementId=(0,y.v5)(t);const[l,c]=await x(n.inferContext,u);(null==l.errorCause||l.functionness)&&(n.interpreterRealm.statementId=(0,y.v5)(t),i=await(0,r.h3)(n.interpreterRealm,u)),i&&(0,r.uF)(l,i.getData());const m="assign"===u.type||"table"===u.type?u.args[0].args[0]:void 0,p={type:"computer-result",id:t,get result(){var e;if("table"===u.type){const e=(0,a.m0)(n.inferContext.stack.get((0,a.m0)(m))),t=n.interpreterRealm.stack.get((0,a.m0)(m));return(0,r.os)(e,null===t||void 0===t?void 0:t.getData())}return(0,r.os)(l,null===(e=i)||void 0===e?void 0:e.getData())},get visibleVariables(){return((e,t,n)=>{const r=e.findIndex((e=>e.id===t));if(-1===r||0===e.length)return{global:new Set,local:new Set};const a=(0,s.ZP)(e[r].args[0]),o=new Set,i=new Set;for(const u of e){const{id:e,args:[t]}=u;o.add((0,y.v5)(e));const r=(0,s.ZP)(t);if(r){o.add(r);const e=n.stack.get(r,"global");if(null!=(null===e||void 0===e?void 0:e.columnNames))for(const t of e.columnNames)r===a&&i.add(t),o.add("".concat(r,".").concat(t))}}return{global:o,local:i}})(e,t,n.inferContext)},usedNames:c};return[p,i]},w=(e,t)=>{const n=e.message.replace(/^panic: (.+)$/,"Internal Error: $1. Please contact support");return e instanceof r.LH||b(e),{type:"computer-result",id:t,result:(0,r.os)(r.aX.impossible(n),null),usedNames:[]}},x=async(e,t)=>{try{e.usedNames=[];const n=await(0,r.wm)(e,t),{usedNames:s}=e;return[n,s]}finally{e.usedNames=void 0}},N=function(e,t){const n=[],r=new Map;for(var s=arguments.length,a=new Array(s>2?s-2:0),o=2;o<s;o++)a[o-2]=arguments[o];a.flatMap((s=>{var a;const o=e.getBlockIdResult$.get(s),i=null===(a=t.find((e=>e.id===s)))||void 0===a?void 0:a.block;if("computer-result"===(null===o||void 0===o?void 0:o.type)&&i){C(i).forEach((e=>{""!==e&&(e.startsWith("exprRef_")||n.push(e),r.set(e,s))}))}}));const i=t.map((t=>{var n,s,a,o;const i=t.id,u=null===(n=t.block)||void 0===n?void 0:n.args.at(0),l=e.getBlockIdResult$.get(t.id);return u&&"computer-result"===(null===l||void 0===l?void 0:l.type)&&(null===(s=l.usedNames)||void 0===s||null===(a=s.map((e=>{let[t,n]=e;return t?"".concat(t,".").concat(n):n})))||void 0===a||null===(o=a.filter((e=>r.has(e))))||void 0===o?void 0:o.map((e=>({varName:e,inBlockId:r.get(e),usedInBlockId:i}))))||[]})).flatMap((e=>e));return n.flatMap((e=>{const t=i.filter((t=>t.varName===e));if(t&&0!==t.length){const{varName:e,inBlockId:n}=t[0];return{varName:e,inBlockId:n,usedInBlockId:t.map((e=>e.usedInBlockId))}}return{varName:e,usedInBlockId:[]}}))},$=function(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),s=2;s<n;s++)r[s-2]=arguments[s];const a=N(e,t,...r);return a.filter((e=>0!==e.usedInBlockId.length))},C=e=>{var t;return e.args.flatMap((e=>{switch(e.type){case"assign":case"table":case"categories":case"function-definition":return[e.args[0].args[0]];case"table-column-assign":return["".concat(e.args[0].args[0],".").concat(e.args[1].args[0])];default:return[]}})).concat((0,y.v5)(null!==(t=e.id)&&void 0!==t?t:""))};var Q=n(13856);function k(e,t){const n=t=>{const n=e.subscribe(t);return()=>n.unsubscribe()},r=()=>e.getValue(),s=function(e){for(var s=arguments.length,a=new Array(s>1?s-1:0),o=1;o<s;o++)a[o-1]=arguments[o];return(0,Q.useSyncExternalStoreWithSelector)(n,r,r,(n=>e(t(n,...a))),l.J)};return{get:function(){for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return t(e.getValue(),...r)},observe:function(){for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return e.pipe((0,f.UI)((e=>t(e,...r))),(0,f.xb)(((e,t)=>(0,l.J)(e,t))))},observeWithSelector:function(n){for(var r=arguments.length,s=new Array(r>1?r-1:0),a=1;a<r;a++)s[a-1]=arguments[a];return e.pipe((0,f.UI)((e=>n(t(e,...s)))),(0,f.xb)(((e,t)=>(0,l.J)(e,t))))},use:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return s(a.yR,...t)},useWithSelector:s}}function B(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if("assign"===e.type){const[t,n]=e.args,r=B(n);return r?{...r,varName:t.args[0]}:void 0}if("literal"===e.type)switch(e.args[0]){case"boolean":return{kind:"boolean"};case"number":return{kind:"number"};case"string":return{kind:"string"}}if("date"===e.type){const[t,n]=(0,r.rt)(e.args);return{kind:"date",dateStr:(0,r.tz)(t,n),dateGranularity:n}}if("function-call"===e.type){const[n,r]=e.args;switch(n.args[0]){case"implicit*":case"/":case"^":case"per":case"for":{const[e,n]=r.args.map((e=>B(e,t+1)));return"number"===(null===e||void 0===e?void 0:e.kind)&&"number"===(null===n||void 0===n?void 0:n.kind)?{kind:"number"}:void 0}}}if("ref"===e.type&&t>0)return{kind:"number"}}const S=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Set,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const o=[],i=new Set([...(0,s.nk)(e,t),...n]);if((0,s.AP)(e,((t,n)=>{var a;if((0,s.Gv)(t).some((e=>i.has(e)))||i.has(null!==(a=(0,s.ZP)(t))&&void 0!==a?a:"")){o.push(n);const t=(0,s.ZP)((0,s.WV)(e,n));null!=t&&i.add(t)}for(const e of r.Fo)i.add(e)})),!a){const t=T(e,o),n=new Set([...t,...i]);return S(e,o,n,!0)}return o};function T(e,t){const n=new Set;for(const r of t){const t=(0,s.WV)(e,r);"table"!==t.type&&"table-column-assign"!==t.type||n.add((0,a.m0)((0,s.ZP)(t)))}return n}const I=(e,t)=>{const n=new Set(Array.from(e.keys()).concat(Array.from(t.keys())));return Array.from(n).filter((n=>{const r=e.get(n),s=t.get(n);return!(0,l.J)(r,s)}))},M=e=>new Map(e.map((e=>[e.id,e]))),E=(e,t)=>new Set(I(M(e),M(t))),A=e=>{const t=new Set,n=new Set,r=new Set;(0,s.AP)(e,(e=>{const a=(0,s.ZP)(e,!0);for(const t of(0,s.Gv)(e))a!==t&&(r.has(t)||n.add(t));null!=a&&(r.has(a)&&t.add(a),r.add(a))}));const a=(0,s.OV)(n,r);return new Set([...t,...a])},D=(e,t)=>{const n=E(e,t),r=Array.from(e).concat(Array.from(t)).filter((t=>n.has(t.id)||!e.some((e=>e.id===t.id))));return new Set((0,s.UH)(r))};class O{constructor(){i()(this,"inferContext",(0,r.fC)()),i()(this,"interpreterRealm",new r.B_(this.inferContext)),i()(this,"locCache",new Map),i()(this,"errorLocs",new Set)}setExternalData(e){this.interpreterRealm.externalData=e,this.inferContext.externalData=e}evictCache(e){let{oldBlocks:t,...n}=e;for(const r of this.errorLocs)this.evictStatement(t,r);for(const r of(e=>{let{oldBlocks:t,newBlocks:n,oldExternalData:r=new Map,newExternalData:a=new Map}=e;const o=E(t,n),i=new Set((0,s.P8)(t,o)),u=new Set([...I(r,a),...D(t,n),...A(t),...A(n)]),l=S(t,Array.from(i),u);for(const s of l)i.add(s);return t.flatMap((e=>i.has(e.id)?e.id:[]))})({oldBlocks:t,...n}))this.evictStatement(t,r)}evictStatement(e,t){this.errorLocs.delete(t),this.locCache.delete(t);const n=(0,s.ZP)((0,s.WV)(e,t));n&&(this.interpreterRealm.stack.delete(n,"global"),this.inferContext.stack.delete(n,"global"),this.interpreterRealm.functions.delete(n),this.inferContext.functionDefinitions.delete(n))}getFromCache(e){var t;return null!==(t=this.locCache.get(e))&&void 0!==t?t:null}getIndexLabels(){const e=new Map,t=(t,n,s)=>{if(!n||!s)return;const a=n.getData();"string"!==s.type&&"number"!==s.type||e.set(t,a.map((e=>String(e))));const{date:o}=s;o&&e.set(t,a.map((e=>(0,r.tz)(e,o))))};for(const[a,o]of this.inferContext.stack.globalVariables.entries()){const e=this.interpreterRealm.stack.get(a,"global");var n;if(e instanceof r.iA)t(a,e.columns[0],null===(n=o.columnTypes)||void 0===n?void 0:n[0]);else if(null!=e&&(0,r.LC)(e)){var s;t(a,e,null!==(s=o.cellType)&&void 0!==s?s:void 0)}}return e}addToCache(e,t){var n,r,s;"type-error"!==(null===(n=t.result)||void 0===n||null===(r=n.result)||void 0===r||null===(s=r.type)||void 0===s?void 0:s.kind)?this.locCache.set(e,t):this.errorLocs.add(e)}}const R=(e,t)=>{const n=e.findIndex((e=>e.tableName===t.tableName&&e.columnName===t.columnName));if(n>=0){!e[n].blockId&&t.blockId&&(e.splice(n,1),e.push(t))}else e.push(t);return e},P={blockResults:{},indexLabels:new Map},_=function(e){var t;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Map;if("block"===e.type)return(0,a.Tw)(e.args.flatMap((e=>_(e,n))));const r=null!==(t=U(e,n))&&void 0!==t?t:new Set,o="table"===(i=e).type||"table-column-assign"===i.type?(0,s.JL)(i.args[0]):void 0;var i;function u(e){switch(e.type){case"argument-names":case"catdef":case"coldef":case"date":case"def":case"tabledef":case"externalref":case"funcdef":case"generic-identifier":case"literal":case"noop":return[];case"block":case"argument-list":case"column-items":case"generic-list":case"matrix-matchers":case"range":case"table-column-assign":case"table-spread":case"matrix-ref":case"match":case"matchdef":case"tiered":case"tiered-def":return(0,a.Tw)(e.args.flatMap(u));case"assign":case"table":case"categories":return(0,a.Tw)(e.args.slice(1).flatMap(u));case"column":case"sequence":return u(e.args[0]);case"property-access":{const[t,r]=e.args;if("ref"===t.type)return(0,a.Tw)([...u(t),"".concat(t.args[0],"::").concat(r)]);const s=[...n].flatMap((e=>{let[t,n]=e;return n.has(r)?["".concat(t,"::").concat(r)]:[]}));return(0,a.Tw)([...s,...u(t)])}case"directive":{const[,...t]=e.args;return(0,a.Tw)(t.flatMap(u))}case"funcref":case"tablepartialdef":return e.args;case"function-call":{const[t,n]=e.args;return[...u(t),...(0,a.Tw)(n.args.flatMap(u))]}case"function-definition":{const[t,n,r]=e.args,s=u(n),a=u(r).filter((e=>!s.includes(e)));return[...u(t),...a]}case"matrix-assign":{const[,t,n]=e.args;return(0,a.Tw)([...u(t),...u(n)])}case"ref":return r.has(e.args[0])?null!=o?["".concat(o,"::").concat(e.args[0])]:[]:e.args;case"table-column":{const[,t]=e.args;return u(t)}}}return u(e)},V=e=>e.flatMap((e=>"block"===e.type?e.args:[e]));function q(e){return e.args.flatMap((e=>"table-column"===e.type?(0,s.JL)(e.args[0]):[]))}function U(e,t){const n=[];for(const a of V([e])){if("table"===a.type&&(n.push((0,s.JL)(a.args[0])),n.push(...q(a))),"table-column-assign"===a.type){var r;const e=(0,s.JL)(a.args[0]);n.push(...null!==(r=t.get(e))&&void 0!==r?r:new Set)}"function-definition"===a.type&&n.push(...a.args[1].args.map(s.JL)),"tiered-def"===a.type&&n.push("slice","tier")}return n.length>0?new Set(n):null}const F=e=>"identified-error"===e.type,L=e=>"identified-error"!==e.type,Z=e=>{let{block:t}=e;if(t.args.length<1)return null;const n=t.args[0];if(!n||!(0,r.B7)(n))return null;const a=n.args[0];return(0,s.JL)(a)},z=e=>({entity:Z(e),temporaryMark:!1,permanentMark:!1,value:e}),j=(e,t,n)=>{let r=_(e.value.block,n).flatMap((e=>t.get(e))).filter(Boolean);const{entity:s}=e;null!=s&&(r=r.filter((e=>t=>!t||t.entity!==e)(s))),e.edges=r},J=e=>({type:"identified-error",id:e,errorKind:"dependency-cycle"}),H=e=>{const t=e.filter(F),n=[],r=e.filter(L),o=r.map(z),i=o.reduce(((e,t)=>{if(null!==t.entity){var n;const r=null!==(n=e.get(t.entity))&&void 0!==n?n:[];e.set(t.entity,r.concat(t))}return e}),new Map),u=e=>{if(!e.permanentMark){if(e.temporaryMark){const n=J(e.value.id);return e.permanentMark||(e.permanentMark=!0,t.push(n)),!0}e.temporaryMark=!0;for(const n of(0,a.m0)(e.edges)){const r=u(n);if(r)return e.permanentMark||(e.permanentMark=!0,t.push(J(e.value.id))),r}e.temporaryMark=!1,e.permanentMark=!0,n.push(e.value)}},l=function(e){const t=new Map;function n(e,n){let r=t.get(e);null==r&&(r=new Set,t.set(e,r));for(const t of n)r.add(t)}for(const r of V(e))if("table"===r.type&&n((0,s.JL)(r.args[0]),q(r)),"table-column-assign"===r.type){const[e,t]=r.args;n((0,s.JL)(e),[(0,s.JL)(t)])}return t}(r.map((e=>e.block)));for(const s of o)j(s,i,l);for(const s of o)u(s);return[...n,...t]};class G{constructor(){var e=this;let{requestDebounceMs:t=100}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,"locale","en-US"),i()(this,"latestProgram",[]),i()(this,"latestExternalData",new Map),i()(this,"computationRealm",new O),i()(this,"requestDebounceMs",void 0),i()(this,"externalData",new d.BehaviorSubject(new Map)),i()(this,"automaticallyGeneratedNames",new Set),i()(this,"imperativeParseErrors",new d.BehaviorSubject(new Map)),i()(this,"computeRequests",new d.Subject),i()(this,"results",new d.BehaviorSubject(P)),i()(this,"results$",k(this.results,a.yR)),i()(this,"getBlockIdResult$",k(this.results,((e,t)=>e.blockResults[null!==t&&void 0!==t?t:""]))),i()(this,"getVarBlockId$",k(this.results,((e,t)=>this.getVarBlockId(t)))),i()(this,"getVarResult$",k(this.results,((e,t)=>{const n=this.getVarBlockId(t);return n?e.blockResults[n]:void 0}))),i()(this,"getAllColumnsIndexedBy$",k(this.results,((e,t)=>Object.values(e.blockResults).flatMap((e=>"computer-result"===e.type&&"column"===e.result.type.kind&&e.result.type.indexedBy===t?[e]:[]))))),i()(this,"getSymbolOrColumnName$",k(this.results,((e,t)=>{var n;const r=this.latestProgram.find((e=>e.id===t));return(null===r||void 0===r||null===(n=r.definesTableColumn)||void 0===n?void 0:n.join("."))||(null===r||void 0===r?void 0:r.definesVariable)||this.getSymbolDefinedInBlock(t)}))),i()(this,"isInUse$",k(this.results,(function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),s=1;s<n;s++)r[s-1]=arguments[s];return e.isInUse(...r)}))),i()(this,"blocksInUse$",k(this.results,(function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),s=1;s<n;s++)r[s-1]=arguments[s];return e.blocksInUse(...r)}))),i()(this,"programDependencies$",k(this.results,(function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),s=1;s<n;s++)r[s-1]=arguments[s];return e.programDependencies(...r)}))),i()(this,"getSymbolDefinedInBlock$",k(this.results,((e,t)=>this.getSymbolDefinedInBlock(t)))),i()(this,"getParseableTypeInBlock$",k(this.results,((e,t)=>this.getParseableTypeInBlock(t)))),i()(this,"getNamesDefined$",k(this.results,((e,t)=>this.getNamesDefined(t)))),i()(this,"getFunctionDefinition$",k(this.results,((e,t)=>this.getFunctionDefinition(t)))),i()(this,"explainDimensions$",k(this.results,((e,t)=>{const n=e=>Array.isArray(e)?[e.length,...n(e[0])]:[],s=(0,r.$S)((0,r.a0)(t.type));s.pop();const o=n(t.value);return(0,a.$R)(s,o).map((t=>{var n,r;let[s,a]=t;return{indexedBy:null!==(n=s.indexedBy)&&void 0!==n?n:void 0,labels:e.indexLabels.get(null!==(r=s.indexedBy)&&void 0!==r?r:""),dimensionLength:a}}))}))),i()(this,"getAllTables$",k(this.results,(e=>Object.entries(e.blockResults).flatMap((e=>{let[t,n]=e;return n.result&&"table"===n.result.type.kind?{id:t,tableName:n.result.type.indexName||""}:[]}))))),i()(this,"getAllColumns$",k(this.results,((e,t)=>Object.values(e.blockResults).flatMap((e=>{var n,r;if("table"===(null===(n=e.result)||void 0===n?void 0:n.type.kind)){if(t&&e.id!==t)return[];if(this.latestExternalData.has(e.id)){const t=(0,a.m0)(this.latestExternalData.get(e.id));return"table"!==t.type.kind?[]:e.result.type.columnNames.map(((n,r)=>{const s={type:{kind:"column",cellType:t.type.columnTypes[r]},value:t.value[r]},a=this.getSymbolDefinedInBlock(e.id);return{tableName:null!==a&&void 0!==a?a:"unnamed",columnName:n,result:s}}))}{var o,i,u,l;const t=null===(o=this.latestProgram.find((t=>t.id===e.id)))||void 0===o||null===(i=o.block)||void 0===i?void 0:i.args[0];if("table"!==(null===t||void 0===t?void 0:t.type)&&"assign"!==(null===t||void 0===t?void 0:t.type)||null===(u=e.result)||void 0===u||!u.value||null===(l=e.result)||void 0===l||!l.type)return[];const n=(0,s.JL)(t.args[0]);return e.result.type.columnNames.map(((t,r)=>{const s={type:{kind:"column",cellType:e.result.type.columnTypes[r]},value:e.result.value[r]};return{tableName:n,columnName:t,result:s}}))}}if("column"===(null===(r=e.result)||void 0===r?void 0:r.type.kind)){var c,m;const n=null===(c=this.latestProgram.find((t=>t.id===e.id)))||void 0===c||null===(m=c.block)||void 0===m?void 0:m.args[0];if("table-column-assign"!==(null===n||void 0===n?void 0:n.type))return[];const r=(0,s.JL)(n.args[0]);if(t){if(this.getVarBlockId(r)!==t)return[]}return[{tableName:r,columnName:(0,s.JL)(n.args[1]),result:e.result,blockId:e.id}]}return[]})).reduce(R,[])))),i()(this,"getColumnNameDefinedInBlock$",k(this.results,((e,t)=>{var n;const r=e.blockResults[t];if("column"===(null===r||void 0===r||null===(n=r.result)||void 0===n?void 0:n.type.kind)){var a,o;const e=null===(a=this.latestProgram.find((e=>e.id===r.id)))||void 0===a||null===(o=a.block)||void 0===o?void 0:o.args[0];if("table-column-assign"===(null===e||void 0===e?void 0:e.type))return(0,s.JL)(e.args[1])}}))),i()(this,"computationQueue",new(p())({concurrency:1,autostart:!0})),i()(this,"getImperativeParseError$",k(this.imperativeParseErrors,((e,t)=>e.get(t)))),this.requestDebounceMs=t,this.wireRequestsToResults()}pushCompute(e){this.computeRequests.next(e)}wireRequestsToResults(){var e;this.computeRequests.pipe((0,f.Vq)(this.externalData),(0,f.pO)(this.requestDebounceMs,void 0,{leading:!1,trailing:!0}),(0,f.UI)((e=>{let[t,n]=e;return{...t,externalData:n}})),(0,f.xb)(((e,t)=>(0,l.J)(e,t))),(e=e=>this.computeRequest(e),t=>{let n,r=!1;return new d.Observable((s=>{const a=t.subscribe({next:function t(o){if(!a.closed)if(r)n=o;else{r=!0;const i=()=>{if(r=!1,null!=n){const e=n;n=void 0,t(e)}};e(o).then((e=>{a.closed||(s.next(e),i())}),(e=>{a.closed||(s.error(e),i())}))}},complete:()=>s.complete(),error:e=>s.error(e)});return()=>{a.unsubscribe()}}))}),(0,f.wt)((e=>null==e?[]:[e])),(0,f.d)(1)).subscribe(this.results)}getVarBlockId(e){var t;const n=e.includes(".")?e.split(".")[0]:e;return null===(t=this.latestProgram.find((t=>e===(0,y.v5)(t.id)||"identified-block"===t.type&&t.block.args.length>0&&(0,s.ZP)(t.block.args[0])===n)))||void 0===t?void 0:t.id}getSymbolDefinedInBlock(e){const t=this.latestProgram.find((t=>t.id===e));if(t&&"identified-block"===t.type){const e=t.block.args[0];if(e){const t=(0,s.ZP)(e);if(t&&!this.automaticallyGeneratedNames.has(t))return t}}else if("identified-error"===(null===t||void 0===t?void 0:t.type))return t.definesVariable}isInUse(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),s=2;s<n;s++)r[s-2]=arguments[s];return 0!==$(e,t,...r).length}(this,this.latestProgram,...t)}blocksInUse(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return $(this,this.latestProgram,...t)}programDependencies(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return N(this,this.latestProgram,...t)}getParseableTypeInBlock(e){const t=this.latestProgram.find((t=>t.id===e));return t&&"identified-block"===t.type?B(t.block.args[0]):null}getNamesDefined(e){const t=(0,s.on)(this.latestProgram),n=new Set(this.automaticallyGeneratedNames);return Array.from(function*(e,t,n,s){var a;const o=new Set,{nodeTypes:i}=e.inferContext,[u,l]=null!==(a=e.inferContext.stack.getNsNameFromId((0,y.v5)(null!==s&&void 0!==s?s:"")))&&void 0!==a?a:[];for(const c of t)for(const e of c.args){const t=g(e),a=i.get(e);if(t&&!o.has(t)&&!n.has(t)&&a&&c.id!==s){if("assign"===e.type&&(yield{kind:"variable",type:(0,r.O)(a),name:e.args[0].args[0],blockId:c.id}),"table"===e.type){const[t,...n]=e.args;yield{kind:"variable",type:(0,r.O)(a),name:t.args[0],blockId:c.id};for(const s of n){const t=i.get(s);if(t){const n=e.args[0].args[0],a=s.args[0].args[0],o=u===n,i=o?a:"".concat(n,".").concat(a);yield{kind:"column",type:(0,r.O)(t),name:i,isLocal:o}}}}if("table-column-assign"===e.type){const t=e.args[0].args[0],n=e.args[1].args[0],s=u===t;if(u===t&&l===n)continue;const o=s?n:"".concat(t,".").concat(n);yield{kind:"column",type:(0,r.O)(a),name:o,blockId:c.id,isLocal:s}}"function-definition"===e.type&&(yield{kind:"function",type:(0,r.O)(a),name:e.args[0].args[0],blockId:c.id})}}}(this.computationRealm,t,n,e))}getFunctionDefinition(e){return this.computationRealm.inferContext.functionDefinitions.get(e)}variableExists(e,t){return this.latestProgram.some((n=>n.id!==t&&(!(!n.definesVariable||n.definesVariable!==e)||"identified-block"===n.type&&n.block.args.length>0&&(0,s.ZP)(n.block.args[0],!1)===e)))}expressionResultFromText$(e){const t=(0,r.s$)(e);return this.results.pipe((0,f.bJ)((async()=>this.expressionResult(t))),(0,f.xb)(((e,t)=>(0,l.J)(e,t))))}enqueueComputation(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new Promise(((n,r)=>{t?this.computationQueue.unshift((()=>e().then(n,r))):this.computationQueue.push((()=>e().then(n,r)))}))}async expressionResult(e){return this.enqueueComputation((async()=>{const t=await(0,r.jY)(this.computationRealm.inferContext,e);if(t.errorCause)return{value:null,type:(0,r.O)(t)};try{return{value:(await(0,r.h3)(this.computationRealm.interpreterRealm,e)).getData(),type:(0,r.O)(t)}}catch(n){return{value:null,type:{kind:"type-error",errorCause:{errType:"free-form",message:n.message}}}}}))}async expressionType(e){return this.enqueueComputation((async()=>{const t=await(0,r.jY)(this.computationRealm.inferContext,e);return(0,r.O)(t)}))}ingestComputeRequest(e){let{program:t,externalData:n}=e;const r=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return e.map((e=>{const n=t.find((t=>t.id===e.id));return n&&(0,l.J)(e,n)?n:e}))}(t,this.latestProgram),o=H(r),i=(0,a.VO)(null!==n&&void 0!==n?n:new Map);return this.computationRealm.evictCache({oldBlocks:(0,s.on)(this.latestProgram),newBlocks:(0,s.on)(o),oldExternalData:this.latestExternalData,newExternalData:i}),this.computationRealm.setExternalData(i),this.latestExternalData=i,this.latestProgram=o,o}async computeRequest(e){return this.enqueueComputation((async()=>{try{const[t,n]=(0,y.W1)(e.program);this.automaticallyGeneratedNames=n,this.computationRealm.inferContext.autoGeneratedVarNames=n;const r=this.ingestComputeRequest({...e,program:t}),o=(0,s.on)(r),i=await(async(e,t)=>{t.inferContext.previousStatement=void 0,t.interpreterRealm.previousStatementValue=void 0;let n=[];for(const s of e)try{const[r,a]=await v(e,s.id,t);t.inferContext.previousStatement=r.result.type,t.interpreterRealm.previousStatementValue=a,n.push({result:r,value:a})}catch(r){n.push({result:w(r,s.id)}),t.inferContext.previousStatement=void 0,t.interpreterRealm.previousStatementValue=void 0}n=n.map((e=>({result:{...e.result},value:e.value})));for(const[s,o]of(0,a.$R)(e,n))t.addToCache(s.id,o);return n.map((e=>e.result))})(o,this.computationRealm),u=[];for(const e of r)"identified-error"===e.type&&u.push(e);return u.push(...i),{blockResults:Object.fromEntries(u.map((e=>[e.id,e]))),indexLabels:this.computationRealm.getIndexLabels()}}catch(t){return console.error(t),this.reset(),b(t),null}}),!0)}pushExternalDataUpdate(e,t){const n=new Map(this.externalData.getValue());n.set(e,t),this.externalData.next(n)}pushExternalDataDelete(e){const t=new Map(this.externalData.getValue());t.delete(e),this.externalData.next(t)}reset(){this.latestProgram=[],this.latestExternalData=new Map,this.computationRealm=new O,this.results=new d.BehaviorSubject(P),this.computationQueue=new(p())({concurrency:1,autostart:!0}),this.wireRequestsToResults()}getStatement(e){var t;const n=null===(t=this.latestProgram.find((t=>t.id===e)))||void 0===t?void 0:t.block;return null===n||void 0===n?void 0:n.args[0]}getAvailableIdentifier(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=new Set([...this.computationRealm.inferContext.stack.globalVariables.keys(),...this.computationRealm.inferContext.externalData.keys(),...this.latestProgram.map((e=>e.definesVariable))]);let s=t;const a=e;if(n&&!r.has(a))return a;const o=()=>"".concat(e).concat(s);let i=o();for(;r.has(i);)s+=1,i=o();return i}async getUnitFromText(e){if("%"===e.trim())throw new Error("% is not a unit!");const t=(0,r.BJ)(e).solution;if(!t)return null;return(await this.enqueueComputation((()=>(0,r.jY)(this.computationRealm.inferContext,t)))).unit}getLatestProgram(){return this.latestProgram}updateImperativeParseError(e){const t=(0,c.ZP)(this.imperativeParseErrors.getValue(),e);this.imperativeParseErrors.next(t)}imperativelySetParseError(e,t){this.updateImperativeParseError((n=>{n.set(e,t)}))}imperativelyUnsetParseError(e){this.updateImperativeParseError((t=>{t.delete(e)}))}hasImperativelySetParseError(e){return this.imperativeParseErrors.getValue().has(e)}setLocale(e){this.locale=e}formatNumber(e,t){return(0,u.uf)(this.locale,e.unit,t,e.numberFormat,"month-day-conversion"===e.numberError)}formatUnit(e,t){return(0,u.Ac)(this.locale,e,t)}formatError(e){return(0,u.Z)(this.locale,e)}}new RegExp("^(".concat(r.PH.main.number.match.source,")(.+)?$"))},26171:(e,t,n)=>{n.d(t,{AP:()=>o,Gv:()=>f,JL:()=>u,OV:()=>y,P8:()=>i,UH:()=>p,WV:()=>a,ZP:()=>l,nk:()=>d,on:()=>m,qY:()=>c,tA:()=>g});var r=n(16976),s=n(55013);const a=(e,t)=>{var n;return(0,s.m0)(null===(n=e.find((e=>e.id===t)))||void 0===n?void 0:n.args[0],"ComputationGraph: Could not find code line at ".concat(t))},o=(e,t)=>{e.forEach((e=>{let{id:n,args:r}=e;t(r[0],n)}))},i=(e,t)=>e.flatMap((e=>t.has(e.id)?[e.id]:[])),u=e=>e.args[0],l=function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];switch(e.type){case"function-definition":case"assign":case"table":case"categories":return u(e.args[0]);case"matrix-assign":case"table-column-assign":return t?u(e.args[0]):null;default:return null}},c=e=>u(e.args[1]),m=e=>e.flatMap((e=>"identified-block"===e.type?[e.block]:[])),p=e=>e.flatMap((e=>e.args.flatMap((e=>{const t=l(e);return null!=t?[t]:[]}))));function*d(e,t){for(const n of t){const t=l(a(e,n));null!=t&&(yield t)}}const f=e=>{const t=[];return(0,r.YO)(e,(e=>{const n=(e=>{switch(e.type){case"ref":case"funcref":case"externalref":return u(e);default:return null}})(e);null!=n&&t.push(n)})),"matrix-assign"!==e.type&&"table-column-assign"!==e.type||t.push((0,s.m0)(l(e))),t},y=(e,t)=>new Set([...e].filter((e=>t.has(e)))),g=e=>{switch(e.errorKind){case"parse-error":return e.error.message;case"dependency-cycle":return"Number's value depends on itself"}}},93361:(e,t,n)=>{n.d(t,{k:()=>s});var r=n(55013);const s=e=>{const t=new URL(e),n=(0,r.m0)(t.pathname.match(/^\/n\/(.*)/),"Could not find notebook id from URL".concat(t)),s=t.hash.slice(1);let a=decodeURIComponent((0,r.m0)(n[1],"no doc id on URL ".concat(t)));return a.indexOf(":")>=0&&(a=a.slice(a.indexOf(":")+1)),{docId:a,blockId:s}}},41580:(e,t,n)=>{function r(e,t){let n;if("string"===typeof e){const t="window"in global&&"location"in window?window.location.origin:{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.DECI_APP_URL_BASE||"http://localhost:3000";n=new URL(e,t)}else n=e;const{href:r}=n;return global.fetch(r,t)}n.d(t,{h:()=>r})},37114:(e,t,n)=>{n.d(t,{Z:()=>N,uf:()=>ne,Ac:()=>h,KP:()=>w});var r=n(16976),s=n(20932),a=n(27597);const o={0:["\u2080","\u2070"],1:["\u2081","\xb9"],2:["\u2082","\xb2"],3:["\u2083","\xb3"],4:["\u2084","\u2074"],5:["\u2085","\u2075"],6:["\u2086","\u2076"],7:["\u2087","\u2077"],8:["\u2088","\u2078"],9:["\u2089","\u2079"],"+":["\u208a","\u207a"],"-":["\u208b","\u207b"],".":["\xb7","\u02d9"],"/":["/","\u141f"]},i={1e-30:["q","quecto"],1e-27:["r","ronto"],1e-24:["y","yocto"],1e-21:["z","zepto"],1e-18:["a","atto"],1e-15:["f","femto"],1e-12:["p","pico"],1e-9:["n","nano"],1e-6:["\u03bc","micro"],.001:["m","milli"],.01:["c","centi"],.1:["d","deci"],1:["",""],10:["da","deca"],100:["h","hecto"],1e3:["k","kilo"],1e6:["M","mega"],1e9:["G","giga"],1e12:["T","tera"],1e15:["P","peta"],1e18:["E","exa"],1e21:["Z","zetta"],1e24:["Y","yotta"],1e27:["R","ronna"],1e30:["Q","quetta"]};function u(e){var t;return(null===(t=o[e])||void 0===t?void 0:t[1])||e}const l=(e,t)=>Number((0,s.N)(t.exp).sub(e.exp)),c=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return(0,a.ZP)(e,(e=>{e.unit=(0,r.hP)(e.unit),t&&(e.exp=(0,s.N)(e.exp).abs())}))},m=e=>1n===e.d;function p(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"1";return"".concat(1===+n?"":n).concat(t?" \xd710":"").concat(e.replace("+","").replace(/./g,u)).trim()}const d=function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const a=(0,r.hP)(e.unit.toLowerCase()),o=(0,r.bS)(a),u=r.US[a],l="currency"===(null===o||void 0===o?void 0:o.superBaseQuantity)?"currency":(null===o||void 0===o?void 0:o.baseQuantity)||"user-defined-unit",c=(0,r.eJ)(a),d=e.multiplier?(0,s.N)(e.multiplier).valueOf():1,f=i[d],y=[];if(null!=f)c?y.push({type:"unit-prefix",value:f[0]}):y.push({type:"unit-prefix",value:f[1]});else{let e=d.toString();if(!e.includes("e")){e=(+e).toExponential().toString()}const[t,n]=e.toString().split("e");y.push({type:"unit-exponent",originalValue:d.toString(),value:p(n,!0,t)}),y.push({type:"unit-literal",value:" "})}t&&u?y.push({type:"unit",originalValue:"currency"===e.baseSuperQuantity?u:e.unit,value:u,base:l}):y.push({type:"unit",value:e.unit,base:l});const g=(0,s.N)(e.exp);if(!g.equals(s.ry)){const e=m(g)?g.toString():"".concat([-1===Math.sign(Number(g.s))&&"-",g.n,"/",g.d].filter(Boolean).join("")),r=p(e);n||(t?y.push({type:"unit-exponent",value:r,originalValue:e}):y.push({type:"unit-exponent",originalValue:e,value:"^".concat(e)}))}return e.quality&&y.push({type:"unit-quality",originalValue:e.quality,value:" of ".concat(e.quality)}),y.filter((e=>""!==e.value))},f=function(e,t){var n;let a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const i=null!==(n=null===e||void 0===e?void 0:e.length)&&void 0!==n?n:0+o;return(null!==e&&void 0!==e?e:[]).reduce(((n,o)=>{if(n.length>0){let e;2===i&&0===(0,s.N)(o.exp).compare((0,s.N)(-1))?(a&&((0,r.eJ)(o.unit)?n.push({type:"unit-group",value:"/"}):(n.push({type:"unit-literal",value:" "}),n.push({type:"unit-group",value:"per"}),n.push({type:"unit-literal",value:" "}))),d(c(o,!0),a).forEach((e=>n.push(e)))):(e=a?"\xb7":"*",n.push({type:"unit-group",value:e}),d(c(o),a).forEach((e=>n.push(e))))}else 1===i&&0===(0,s.N)(o.exp).compare((0,s.N)(-1))?(n.push({type:"unit-literal",value:" "}),n.push({type:"unit-group",value:"per"}),n.push({type:"unit-literal",value:" "}),d((0,r.jx)(o,1),a,!0).forEach((e=>n.push(e)))):d((0,r.jx)(o,e&&i>2?2:(null===t||void 0===t?void 0:t.valueOf())||2),a).forEach((e=>n.push(e)));return n}),[])};function y(e){return e.reduce(((e,t,n,r)=>e+(n>0&&("unit-prefix"===r[n-1].type||"unit-exponent"===t.type||"unit-literal"===t.type||r[n+1]&&"unit-literal"===r[n+1].type||"unit-literal"===r[n-1].type)?"":" ")+t.value),"").trim()}function g(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:s.gE,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const i=(0,r.JT)(t)||t,u=[...i].sort(l),c=f(u,n,a,o);return{type:"unit",value:y(c),partsOf:c}}function h(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:s.gE,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const o=g(e,t,n,r,a);if(o.partsOf)return o.partsOf.map((e=>e.value)).join("");throw new Error("This should not happen its a typescript imposition")}function b(e){return 1===(null===e||void 0===e?void 0:e.length)&&function(e){if(!e)return!1;const t=(0,r.bS)(e.unit);return null!=e&&!(null!==t&&void 0!==t&&t.baseQuantity)&&(0,s.N)(e.exp).equals(s.ry)&&(0,s.N)(e.multiplier).equals(s.ry)}(e[0])}function v(e){var t,n;const r=(0,s.N)(e.multiplier).valueOf(),a=null!==(t=null===(n=i[r])||void 0===n?void 0:n[0])&&void 0!==t?t:"".concat(r," * "),o=(0,s.N)(e.exp).valueOf(),u=1===o?"":"^".concat(o);return"".concat(a).concat(e.unit).concat(u)}function w(e){return e.reduce(((e,t)=>e?"".concat(e," * ").concat(v(t)):v(t)),"")}const x=(e,t)=>{switch(t.kind){case"type-error":throw new Error("toBasicString: errors not supported");case"number":return t.unit?h(e,t.unit):"number";case"date":return"date(".concat(t.date,")");default:return t.kind}},N=(e,t)=>{switch(t.errType){case"free-form":return t.message;case"missing-variable":{const[e]=t.missingVariable;return"The variable ".concat(e," is missing")}case"missing-formula":return"The formula ".concat(t.formulaName,"() does not exist");case"expected-but-got":{const[n,s]=t.expectedButGot.map((t=>"string"===typeof t?t:x(e,(0,r.O)(t))));return"This operation requires a ".concat(n," and a ").concat(s," was entered")}case"expected-primitive":{const n=x(e,(0,r.O)(t.butGot));return"This operation requires a primitive value (string, number, boolean or date) and a ".concat(n," was entered")}case"expected-unit":return"This operation requires compatible units";case"expected-arg-count":{const[e,n,r]=t.expectedArgCount;return"The function ".concat(e," requires ").concat(n," parameters and ").concat(r," parameters were entered")}case"unexpected-empty-column":return"Unexpected empty column";case"forbidden-inside-function":{const e={table:"Table",category:"Category"}[t.forbiddenThing];return"".concat(e," operations are forbidden inside functions")}case"mismatched-specificity":{const{expectedSpecificity:e,gotSpecificity:n}=t;return"Expected time specific up to the ".concat(e,", but got ").concat(n)}case"column-contains-inconsistent-type":{const{cellType:n,got:s}=t;return"Column cannot contain both ".concat(x(e,(0,r.O)(n))," and ").concat(x(e,(0,r.O)(s)))}case"bad-overloaded-builtin-call":{const n=t.gotArgTypes.map((t=>x(e,(0,r.O)(t)))).join(", ");return"The function ".concat(t.functionName," cannot be called with (").concat(n,")")}case"cannot-convert-between-units":return"Don't know how to convert between units ".concat(h(e,t.fromUnit)," and ").concat(h(e,t.toUnit));case"formula-cannot-call-itself":return"".concat(t.fname,"() cannot be used in its own definition");case"cannot-convert-to-unit":return"Cannot convert to unit ".concat(h(e,t.toUnit));case"unknown-category":return"Unknown category ".concat(t.dimensionId);case"duplicated-table-column":return"The column ".concat(t.columnName," already exists in this table");case"expected-table-and-associated-column":return"Expected table and associated column";case"duplicated-name":return"This name is already being used. You cannot have duplicated names";case"complex-expression-exponent":return"Complex expressions not supported in exponents";case"sequence-step-zero":return"Sequence step must not be zero";case"invalid-sequence-step":{const e=t.start<t.end?"ascending":"descending",n=Math.sign(t.by)>0?"positive":"negative";return"Invalid step in sequence: sequence is ".concat(e," but step is ").concat(n)}case"no-previous-statement":return"No previous statement";case"need-one-only-one-unit":return"Need one and only one unit";case"unknown-reference":return"Unknown reference";case"retired-feature":return"You're using a feature that's been retired"}};var $=n(74125),C=n.n($);const Q=(0,s.N)(1000000000000000000000n),k=(0,s.N)(1n,1000000000000000000000n),B=(e,t)=>{const n=e.toString(t),r=n.match(/^(\d+)\.(\d*\(\d+\))$/);if(r){const[,e,n]=r;return[{type:"integer",value:e},{type:"decimal",value:"."},{type:"fraction",value:n.replace(/[()]/g,"").repeat(4).slice(0,t)},{type:"ellipsis",value:"..."}]}const s=n.match(/^(\d+)\.(\d+)$/);if(s){const[,e,t]=s;return[{type:"integer",value:e},{type:"decimal",value:"."},{type:"fraction",value:t}]}return[{type:"integer",value:n}]};function S(e,t){t.colonNotation&&(t.formatSubTime=!1,t.separateTime=!1,t.verbose=!1);const n=[],r=function(e,r,s){let a,o,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.toString();if(0!==n.length&&t.colonNotation||0!==e||t.colonNotation&&"m"===s){if(t.colonNotation){a=n.length>0?":":"",o="";const e=i.includes(".")?i.split(".")[0].length:i.length,t=n.length>0?2:1;i="0".repeat(Math.max(0,t-e))+i,""!==a.trim()&&n.push({type:"unit",value:a.trim(),originalValue:o||r})}else a="",o=t.verbose?C()(r,e):s;n.push({type:"integer",value:i}),t.colonNotation||(n.push({type:"unit",value:o||r}),n.push({type:"literal",value:" "}))}},s=(a=e,{days:Math.trunc(a/864e5),hours:Math.trunc(a/36e5)%24,minutes:Math.trunc(a/6e4)%60,seconds:Math.trunc(a/1e3)%60,milliseconds:Math.trunc(a)%1e3,microseconds:Math.trunc(1e3*a)%1e3,nanoseconds:Math.trunc(1e6*a)%1e3});var a;if(r(Math.trunc(s.days/365),"year","y"),r(s.days%365,"day","d"),r(s.hours,"hour","h"),r(s.minutes,"minute","m"),t.separateTime||t.formatSubTime||!t.colonNotation&&e<1e3)if(r(s.seconds,"second","s"),t.formatSubTime)r(s.milliseconds,"millisecond","ms"),r(s.microseconds,"microsecond","\xb5s"),r(s.nanoseconds,"nanosecond","ns");else{const e=s.milliseconds+s.microseconds/1e3+s.nanoseconds/1e6,n="number"===typeof t.timeDecimalDigits?t.timeDecimalDigits:0,a=e>=1?Math.round(e):Math.ceil(e),o=n?e.toFixed(n):a;r(Number.parseFloat(o.toString()),"millisecond","ms",o.toString())}else{const n=((e,t)=>{const n=Math.floor(e*10**t+1e-7);return(Math.round(n)/10**t).toFixed(t)})(e/1e3%60,"number"===typeof t.secondsDecimalDigits?t.secondsDecimalDigits:1),s=t.keepDecimalsOnWholeTime?n:n.replace(/\.0+$/,"");r(Number.parseFloat(s),"second","s",s)}return n}function T(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=S(e,t);return n.filter(((e,t)=>t!==n.length-1||" "!==e.value))}const I=[(0,r.n2)("millisecond")];function M(e,t,n,a,o){const[i,u]=function(e,t){if("month"===e[0].baseQuantity||"week"===(0,r.Xt)(e[0].unit))return[t,!1];if((0,r.or)(e,I))return[(0,r.WR)(t,e,I),!0];throw new Error("Invalid conversion to non time unit")}(t,n),l=i.valueOf(),c=C()(t[0].unit,n.valueOf()),m="".concat(n.valueOf()," ").concat(c);return u&&0!==l?{asStringPrecise:m,isPrecise:!0,partsOf:T(l,l<1?{...a,formatSubTime:!0,verbose:!1}:a),value:i.div((0,s.N)(1e3)).valueOf()}:{...o(e,t,n),asStringPrecise:m}}function E(e){const t=e[0];return 1===(null===e||void 0===e?void 0:e.length)&&null!=t&&("second"===t.baseQuantity||"month"===t.baseQuantity)&&(0,s.N)(t.exp).equals(s.ry)}var A=n(55013);function D(e){return null!=e&&"currency"===e.baseSuperQuantity&&(0,s.N)(e.exp).equals(s.ry)}function O(e){return e?e.findIndex((e=>D(e))):-1}function R(e){const t=r.JI.units.filter((t=>t.baseQuantity===e));return t[0]&&t[0].pretty?t[0].pretty:e}const P={maximumFractionDigits:2,minimumFractionDigits:0,notation:"compact",compactDisplay:"long"},_={maximumFractionDigits:2,minimumFractionDigits:0,compactDisplay:"long",style:"currency",currencyDisplay:"narrowSymbol"},V={maximumFractionDigits:20,minimumFractionDigits:0,notation:"scientific"},q={maximumFractionDigits:20,minimumFractionDigits:0,notation:"standard"};function U(e){const t=e.reduce(((e,t)=>e||"exponentInteger"===t.type&&"0"===t.value),!1);return e.filter((e=>!t||!("exponentInteger"===e.type||"exponentSeparator"===e.type))).map((e=>{switch(e.type){case"exponentSeparator":return{type:"exponentSeparator",originalValue:e.value,value:"\xd710"};case"exponentInteger":case"exponentMinusSign":return{type:e.type,originalValue:e.value,value:p(e.value)};default:return e}}))}function F(e){return e.reduce(((e,t)=>(e+("unit"===t.type?" ":"")).replace(/  +/g," ")+t.value),"").trim()}const L=(0,s.N)(1000000000000000n);function Z(e){return e.compare(L)>0}const z=(0,s.N)(1e4);function j(e){return e.compare(z)<0}const J=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!(e=e.abs()).equals(e.round(t)))return!1;if(!n)return!0;const[r,s]=e.toString().split(".");return r.length<=3||!s&&!!/^\d\d\d0*$/.test(r)},H=(e,t,n,a)=>{var o;const[i,u]=(0,r.MC)(n),l=null!==(o=t.maximumFractionDigits)&&void 0!==o?o:r.qO;let c,m,p;if((e=>{const t=e.abs();return t.compare(Q)>=0?"large":!t.equals(s.xE)&&t.compare(k)<=0?"small":void 0})(n)){const r=99;c=new Intl.NumberFormat(e,t).formatToParts(r).flatMap((e=>"integer"===e.type&&e.value===String(r)?B(n,l):[e])),m=J(n,l,!1)}else c=new Intl.NumberFormat(e,t).formatToParts(u),m=J(n,l,"standard"!==t.notation);if(m||(c=[{type:"roughly",value:"\u2248"},...c]),Math.abs(u)>Number.MAX_SAFE_INTEGER)p=F(B(n,r.ps));else{p=F(U(new Intl.NumberFormat(e,Math.abs(u)>1e10||Math.abs(u)<1e-10?V:q).formatToParts(u)))}return{isPrecise:m,partsOf:a(c),value:i,asStringPrecise:p}};function G(e,t,n){const s=function(e){const t=e.findIndex(D),n=(0,A.m0)(t>=0&&e[t]||void 0),s=(0,r.bS)(n.unit);return{...n,...s?{baseQuantity:s.baseQuantity}:{}}}(t),a={..._,currency:(s.baseQuantity||s.unit).toLocaleUpperCase(),notation:Z(n)?"engineering":j(n)?"standard":"compact"};return H(e,a,n,(e=>e.map((e=>"currency"===e.type?{type:"currency",value:R(e.value)}:e))))}const K=(0,s.N)(10),W=(0,s.N)(1,100);function Y(e,t){const n=!t.mod(K).equals(s.xE),r=Z(t)||n&&t.compare(W)<0,a={...P,...r?{notation:"engineering"}:j(t)?{notation:"standard"}:{}};return H(e,a,t,(e=>e))}function X(e,t,n){const s={...P};return Z(n)&&(s.notation="engineering"),j(n)&&(s.notation="standard"),s.style="unit",s.unit="meter",H(e,s,n,(e=>e.map((e=>{const[,s]=(0,r.MC)(n);return"unit"===e.type?{type:"unit",value:C()(t[0].unit,s)}:e}))))}function ee(e,t,n){const r={...P};return t&&t.length>1&&(r.compactDisplay="short"),Z(n)&&(r.notation="engineering"),j(n)&&(r.notation="standard"),H(e,r,n,(r=>[...r,g(e,t,n)]))}function te(e,t,n){const r=O(t),o=[t[r]],i=[...t];i.splice(r,1);const u=i.reduce(((e,t)=>e.mul(t.multiplier)),s.ry),l=i.length>0?ee(e,i,s.ry).partsOf.filter(((e,t)=>!(0===t&&"1"===e.value))):[],c=G(e,(0,a.ZP)(o,(e=>{e[0].multiplier=s.ry})),n.mul(u));return{...c,partsOf:c.partsOf.concat(l)}}function ne(e,t,n){var a;let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const u=(0,s.N)(n);if("percentage"===o){const t=ne(e,null,u.mul((0,s.N)(100))),n=[...t.partsOf,{type:"literal",value:"%"}];return{...t,partsOf:n,asString:F(n)}}let l;if(t){const n=(0,r.WV)(t);if(-1!==O(n))l=te(e,n,u);else if(b(n))l=X(e,n,u);else if(E(n))l=M(e,n,u,{verbose:!0},ee);else{l=ee(e,n,(0,r.kc)(u,n))}}else l=Y(e,u);let{partsOf:c}=l;return c=U(c),i&&"roughly"!==(null===(a=c[0])||void 0===a?void 0:a.type)&&(c=[{type:"roughly",value:"\u2248"},...c]),{...l,asString:F(c),partsOf:c}}n(73837)},16976:(e,t,n)=>{n.d(t,{sg:()=>Sa,JI:()=>s,qO:()=>co,wY:()=>ka,ps:()=>mo,B_:()=>Zi,x4:()=>T,LH:()=>U,iA:()=>Ma,Dy:()=>js,or:()=>Vr,aX:()=>r,WR:()=>Fr,kc:()=>Js,ZW:()=>yl,a0:()=>ra,h3:()=>Li,UW:()=>L,rt:()=>lo,bS:()=>dr,jY:()=>Ni,wm:()=>Ci,B7:()=>No,LC:()=>F,UT:()=>vo,iu:()=>Co,$S:()=>ua,fC:()=>_o,cQ:()=>fo,Xt:()=>Dn,WV:()=>bs,IX:()=>hl,BJ:()=>vl,s$:()=>Ql,fh:()=>bl,hg:()=>Cl,n2:()=>is,jx:()=>ls,US:()=>ar,_R:()=>Nl,Fo:()=>si,MC:()=>Ro,os:()=>Ui,O:()=>na,JT:()=>fs,hP:()=>O.singular,tz:()=>io,PH:()=>Vu,eJ:()=>ir,uF:()=>Vi,YO:()=>po});var r={};n.r(r),n.d(r,{anything:()=>ne,boolean:()=>J,column:()=>X,date:()=>G,functionPlaceholder:()=>ee,impossible:()=>re,nothing:()=>te,number:()=>z,range:()=>H,row:()=>Y,string:()=>j,table:()=>W,timeQuantity:()=>K});var s={};n.r(s),n.d(s,{units:()=>ce});var a={};n.r(a),n.d(a,{units:()=>de});var o={};n.r(o),n.d(o,{oneFoot:()=>ye,oneInch:()=>fe,oneMile:()=>he,oneYard:()=>ge,units:()=>at});var i={};n.r(i),n.d(i,{units:()=>ht});var u={};n.r(u),n.d(u,{units:()=>bt});var l={};n.r(l),n.d(l,{units:()=>vt});var c={};n.r(c),n.d(c,{units:()=>wt});var m={};n.r(m),n.d(m,{units:()=>xt});var p={};n.r(p),n.d(p,{units:()=>Nt});var d={};n.r(d),n.d(d,{units:()=>Qt});var f={};n.r(f),n.d(f,{units:()=>kt});var y={};n.r(y),n.d(y,{units:()=>Bt});var g={};n.r(g),n.d(g,{units:()=>Tt});var h={};n.r(h),n.d(h,{units:()=>It});var b={};n.r(b),n.d(b,{units:()=>Mt});var v={};n.r(v),n.d(v,{units:()=>Zt});var w={};n.r(w),n.d(w,{units:()=>zt});var x={};n.r(x),n.d(x,{units:()=>tn});var N={};n.r(N),n.d(N,{units:()=>nn});var $={};n.r($),n.d($,{oneFoot:()=>sn,oneInch:()=>rn,oneMile:()=>on,oneYard:()=>an,units:()=>mn});var C={};n.r(C),n.d(C,{units:()=>pn});var Q={};n.r(Q),n.d(Q,{units:()=>dn});var k={};n.r(k),n.d(k,{units:()=>An});var B={};n.r(B),n.d(B,{units:()=>On});var S={};n.r(S),n.d(S,{units:()=>tr});var T={};n.r(T),n.d(T,{UnknownValue:()=>xa,resultToValue:()=>qi,serializeResult:()=>Ui,validateResult:()=>Vi});var I=n(27597),M=n(20932),E=n(55013),A=n(7929),D=n.n(A),O=n(74125),R=n.n(O),P=n(67005);const _=Symbol("unknown");var V=n(26290),q=n.n(V);class U extends Error{constructor(e){"string"===typeof e?(super(e),q()(this,"inferError",void 0)):(super("Type error"),q()(this,"inferError",void 0),this.inferError=e)}}const F=e=>"object"===typeof e&&"function"===typeof(null===e||void 0===e?void 0:e.lowLevelGet),L=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"panic: expected column-like value";if(!F(e))throw new Error(t);return e},Z=e=>(0,I.ZP)(new js,(t=>{t.type=e})),z=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;return(0,I.ZP)(Z("number"),(r=>{if(null!=e&&null!=t)throw new Error("Cannot specify both unit and numberFormat");r.unit=null!==e&&void 0!==e&&e.length?e:null,r.numberFormat=null!==t&&void 0!==t?t:null,r.numberError=null!==n&&void 0!==n?n:null}))},j=()=>Z("string"),J=()=>Z("boolean"),H=e=>(0,I.ZP)(new js,(t=>{t.rangeOf=e})),G=e=>(0,I.ZP)(new js,(t=>{t.date=e})),K=e=>(0,I.ZP)(Z("number"),(t=>{t.unit=[{unit:Ya(e),exp:(0,M.N)(1),multiplier:(0,M.N)(1),known:!0}]})),W=e=>{let{indexName:t,columnTypes:n,columnNames:r}=e;return(0,I.ZP)(new js,(e=>{e.indexName=null!==t&&void 0!==t?t:null,e.columnTypes=n,e.columnNames=r}))},Y=function(e,t){var n;let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const s=(0,I.ZP)(new js,(n=>{n.rowCellTypes=e,n.rowCellNames=t,n.rowIndexName=r})),a=null===(n=s.rowCellTypes)||void 0===n?void 0:n.find((e=>null!=e.errorCause));return null!=a?s.withErrorCause((0,E.m0)(a.errorCause)):s},X=(e,t,n,r)=>{const s=(0,I.ZP)(new js,(t=>{t.indexedBy=null!==n&&void 0!==n?n:null,t.cellType=e,t.columnSize="unknown",t.atParentIndex=null!==r&&void 0!==r?r:null}));return null!=e.errorCause?s.withErrorCause(e.errorCause):s},ee=(e,t)=>(0,I.ZP)(new js,(n=>{n.functionness=!0,n.functionName=e,n.functionArgCount=t})),te=()=>(0,I.ZP)(new js,(e=>{e.nothingness=!0})),ne=()=>(0,I.ZP)(new js,(e=>{e.anythingness=!0})),re=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return(0,I.ZP)(new js,(n=>{"string"===typeof e&&(e=new ae(e)),n.errorCause=e,n.node=t}))};var se=n(79568);class ae extends Error{constructor(e){"string"===typeof e&&(e={errType:"free-form",message:e}),super("Inference Error: ".concat(e.errType)),q()(this,I.sc,!0),q()(this,"spec",void 0),q()(this,"pathToError",[]),this.spec=e}static missingVariable(e){return new ae({errType:"missing-variable",missingVariable:[e]})}static missingFormula(e){return new ae({errType:"missing-formula",formulaName:e})}static expectedButGot(e,t){return new ae({errType:"expected-but-got",expectedButGot:[e,t]})}static expectedPrimitive(e){return new ae({errType:"expected-primitive",butGot:e})}static expectedArgCount(e,t,n){return new ae({errType:"expected-arg-count",expectedArgCount:[e,t,n]})}static expectedUnit(e,t){return new ae({errType:"expected-unit",expectedUnit:[e,t]})}static unexpectedEmptyColumn(){return new ae({errType:"unexpected-empty-column"})}static forbiddenInsideFunction(e){return new ae({errType:"forbidden-inside-function",forbiddenThing:e})}static mismatchedSpecificity(e,t){return new ae({errType:"mismatched-specificity",expectedSpecificity:e,gotSpecificity:t})}static columnContainsInconsistentType(e,t){return new ae({errType:"column-contains-inconsistent-type",cellType:e,got:t})}static badOverloadedBuiltinCall(e,t){return new ae({errType:"bad-overloaded-builtin-call",functionName:e,gotArgTypes:t})}static cannotConvertBetweenUnits(e,t){return new ae({errType:"cannot-convert-between-units",fromUnit:e,toUnit:t})}static formulaCannotCallItself(e){return new ae({errType:"formula-cannot-call-itself",fname:e})}static cannotConvertToUnit(e){return new ae({errType:"cannot-convert-to-unit",toUnit:e})}static unknownCategory(e){return new ae({errType:"unknown-category",dimensionId:e})}static duplicateTableColumn(e){return new ae({errType:"duplicated-table-column",columnName:e})}static expectedTableAndAssociatedColumn(e,t){return new ae({errType:"expected-table-and-associated-column",gotTable:null!==e&&void 0!==e?e:void 0,gotColumn:null!==t&&void 0!==t?t:void 0})}static duplicatedName(e){return new ae({errType:"duplicated-name",duplicatedName:e})}static complexExpressionExponent(){return new ae({errType:"complex-expression-exponent"})}static sequenceStepZero(){return new ae({errType:"sequence-step-zero"})}static invalidSequenceStep(e,t,n){return new ae({errType:"invalid-sequence-step",start:e,end:t,by:n})}static noPreviousStatement(){return new ae({errType:"no-previous-statement"})}static needOneAndOnlyOneUnit(){return new ae({errType:"need-one-only-one-unit"})}static retiredFeature(e){return new ae({errType:"retired-feature",featureName:e})}get url(){return"retired-feature"===this.spec.errType?"/docs/basic-concepts/retired-features#".concat(this.spec.featureName):"/docs/basic-concepts/language-errors#".concat(this.spec.errType)}}const oe=(e,t)=>("percentage"!==e||"percentage"!==t)&&("percentage"===e||"percentage"===t),ie=(e,t)=>oe(e.numberFormat,t.numberFormat)?(0,I.Uy)(e,(e=>{e.numberFormat=null})):e;(0,O.addIrregularRule)("calorie","calories"),(0,O.addIrregularRule)("celsius","celsius"),(0,O.addIrregularRule)("siemens","siemens"),(0,O.addIrregularRule)("are","ares"),(0,O.addIrregularRule)("s","s"),(0,O.addIrregularRule)("h","h"),(0,O.addIrregularRule)("psi","psi"),(0,O.addIrregularRule)("kph","kph"),(0,O.addIrregularRule)("mph","mph"),(0,O.addIrregularRule)("u","u"),(0,O.addIrregularRule)("lumen","lumen"),(0,O.addIrregularRule)("scarab","scarab"),(0,O.addIrregularRule)("previous","previous"),(0,O.addIrregularRule)("lol","lulz"),(0,O.addIrregularRule)("lul","lulz"),(0,O.addIrregularRule)("omegalul","omegalulz"),(0,O.addIrregularRule)("UwU","UwU"),(0,O.addIrregularRule)("OwO","OwO");const ue=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2n;return R()(e,Number(t))},le="currency",ce=[{name:"euro",symbols:["\u20ac","eur"],baseQuantity:"EUR",pretty:"\u20ac",toBaseQuantity:Eo,fromBaseQuantity:Eo,superBaseQuantity:le},{name:"usdollar",symbols:["$","usd"],aliases:["dollar"],baseQuantity:"USD",pretty:"$",toBaseQuantity:Eo,fromBaseQuantity:Eo,superBaseQuantity:le},{name:"britishpound",symbols:["\xa3","gbp"],baseQuantity:"GBP",pretty:"\xa3",toBaseQuantity:Eo,fromBaseQuantity:Eo,superBaseQuantity:le},{name:"swedishkrona",symbols:["sek"],baseQuantity:"SEK",pretty:"kr",toBaseQuantity:Eo,fromBaseQuantity:Eo,superBaseQuantity:le},{name:"scarab",symbols:["\xa4","xxx"],baseQuantity:"XXX",pretty:"\xa4",toBaseQuantity:Eo,fromBaseQuantity:Eo,superBaseQuantity:le},{name:"norwegiankrona",symbols:["nok"],baseQuantity:"NOK",pretty:"kr",toBaseQuantity:Eo,fromBaseQuantity:Eo,superBaseQuantity:le},{name:"japanyen",symbols:["yen","jpy"],baseQuantity:"JPY",pretty:"\xa5",toBaseQuantity:Eo,fromBaseQuantity:Eo,superBaseQuantity:le},{name:"chinayuan",symbols:["yuan","cny"],baseQuantity:"CNY",toBaseQuantity:Eo,fromBaseQuantity:Eo,superBaseQuantity:le},{name:"philippinepeso",symbols:["\u20b1","piso","php"],baseQuantity:"PHP",pretty:"\u20b1",toBaseQuantity:Eo,fromBaseQuantity:Eo,superBaseQuantity:le},{name:"indianrupee",symbols:["\u20b9","rupee","inr"],baseQuantity:"INR",pretty:"\u20b9",toBaseQuantity:Eo,fromBaseQuantity:Eo,superBaseQuantity:le},{name:"russianruble",symbols:["\u20bd","ruble","rub"],baseQuantity:"RUB",pretty:"\u20bd",toBaseQuantity:Eo,fromBaseQuantity:Eo,superBaseQuantity:le},{name:"turkishlira",symbols:["\u20ba","tl","try"],baseQuantity:"TRY",pretty:"\u20ba",toBaseQuantity:Eo,fromBaseQuantity:Eo,superBaseQuantity:le},{name:"southkoreanwon",symbols:["\u20a9","won","krw"],baseQuantity:"KRW",pretty:"\u20a9",toBaseQuantity:Eo,fromBaseQuantity:Eo,superBaseQuantity:le},{name:"thaibaht",symbols:["\u0e3f","baht","thb"],baseQuantity:"THB",pretty:"\u0e3f",toBaseQuantity:Eo,fromBaseQuantity:Eo,superBaseQuantity:le},{name:"polishz\u0142oty",symbols:["z\u0142","z\u0142oty","pln"],baseQuantity:"PLN",pretty:"z\u0142",toBaseQuantity:Eo,fromBaseQuantity:Eo,superBaseQuantity:le},{name:"israelinewshekel",symbols:["\u20aa","newshekel","ils"],baseQuantity:"ILS",pretty:"\u20aa",toBaseQuantity:Eo,fromBaseQuantity:Eo,superBaseQuantity:le},{name:"UAEdirham",symbols:["\u062f.\u0625","dirham","aed"],baseQuantity:"AED",pretty:"\u062f.\u0625",toBaseQuantity:Eo,superBaseQuantity:le,fromBaseQuantity:Eo},{name:"saudiriyal",symbols:["\ufdfc","riyal","sar"],baseQuantity:"SAR",pretty:"\ufdfc",toBaseQuantity:Eo,fromBaseQuantity:Eo,superBaseQuantity:le},{name:"australiandollar",symbols:["A$","AUD$","aud"],baseQuantity:"AUD",toBaseQuantity:Eo,fromBaseQuantity:Eo,superBaseQuantity:le},{name:"canadiandollar",symbols:["C$","CAN$","cad"],baseQuantity:"CAD",pretty:"C$",toBaseQuantity:Eo,fromBaseQuantity:Eo,superBaseQuantity:le},{name:"swissfranc",symbols:["chf"],baseQuantity:"CHF",pretty:"chf",toBaseQuantity:Eo,fromBaseQuantity:Eo,superBaseQuantity:le},{name:"hongkongdollar",symbols:["HK$","hkd"],baseQuantity:"HKD",toBaseQuantity:Eo,fromBaseQuantity:Eo,superBaseQuantity:le},{name:"newzealanddollar",symbols:["NZ$","nzd"],baseQuantity:"NZD",toBaseQuantity:Eo,fromBaseQuantity:Eo,superBaseQuantity:le},{name:"singaporedollar",symbols:["S$","sgd"],baseQuantity:"SGD",toBaseQuantity:Eo,fromBaseQuantity:Eo,superBaseQuantity:le},{name:"southafricanrand",symbols:["rand","zar"],baseQuantity:"ZAR",toBaseQuantity:Eo,fromBaseQuantity:Eo,superBaseQuantity:le},{name:"brazilianreal",symbols:["real","reais","R$","brl"],baseQuantity:"BRL",toBaseQuantity:Eo,fromBaseQuantity:Eo,superBaseQuantity:le},{name:"newtaiwandollar",symbols:["NT$","twd"],baseQuantity:"TWD",toBaseQuantity:Eo,fromBaseQuantity:Eo,superBaseQuantity:le},{name:"danishkrone",symbols:["dkk"],baseQuantity:"DKK",pretty:"kr",toBaseQuantity:Eo,fromBaseQuantity:Eo,superBaseQuantity:le},{name:"indonesianrupiah",symbols:["rp","idr","rupiah"],baseQuantity:"IDR",toBaseQuantity:Eo,fromBaseQuantity:Eo,superBaseQuantity:le},{name:"hungarianforint",symbols:["huf","forint"],baseQuantity:"HUF",toBaseQuantity:Eo,fromBaseQuantity:Eo,superBaseQuantity:le},{name:"czechkoruna",symbols:["K\u010d","czk"],baseQuantity:"CZK",pretty:"K\u010d",toBaseQuantity:Eo,fromBaseQuantity:Eo,superBaseQuantity:le},{name:"chileanpeso",symbols:["CLP$","clp"],baseQuantity:"CLP",toBaseQuantity:Eo,fromBaseQuantity:Eo,superBaseQuantity:le},{name:"colombianpeso",symbols:["COL$","cop"],baseQuantity:"COP",toBaseQuantity:Eo,fromBaseQuantity:Eo,superBaseQuantity:le},{name:"malaysianringgit",symbols:["rm","ringgit","myr"],baseQuantity:"MYR",toBaseQuantity:Eo,fromBaseQuantity:Eo,superBaseQuantity:le},{name:"romanianleu",symbols:["leu","ron"],baseQuantity:"RON",toBaseQuantity:Eo,fromBaseQuantity:Eo,superBaseQuantity:le},{name:"cryptobitcoin",symbols:["\u20bf","bitcoin","btc"],baseQuantity:"BTC",pretty:"\u20bf",toBaseQuantity:Eo,fromBaseQuantity:Eo,superBaseQuantity:le},{name:"cryptoethereum",symbols:["\u039e","ether","eth"],baseQuantity:"ETH",pretty:"\u039e",toBaseQuantity:Eo,fromBaseQuantity:Eo,superBaseQuantity:le},{name:"ukrainianhryvnia",symbols:["\u20b4","ua","uah"],baseQuantity:"UAH",pretty:"\u20b4",toBaseQuantity:Eo,fromBaseQuantity:Eo,superBaseQuantity:le}],me=(0,M.N)(0xb29430a256d21,10**15),pe=e=>e.mul(me).div((0,M.N)(180)),de=[{name:"radian",symbols:["r","rad"],pretty:"rad",baseQuantity:"angle",toBaseQuantity:Eo,fromBaseQuantity:Eo},{name:"degree",symbols:["\xb0"],pretty:"\xb0",baseQuantity:"angle",toBaseQuantity:pe,fromBaseQuantity:Ao(pe)}],fe=(0,M.N)(254,1e4),ye=fe.mul((0,M.N)(12)),ge=ye.mul((0,M.N)(3)),he=ge.mul((0,M.N)(1760)),be=(0,M.N)(201168,1e3),ve=(0,M.N)(1852),we=(0,M.N)(5556),xe=(0,M.N)(1,1e10),Ne=(0,M.N)(529177210903,1e21),$e=(0,M.N)(1,1e18),Ce=(0,M.N)(1,1e15),Qe=(0,M.N)(1702,1e3),ke=(0,M.N)(149597870700),Be=(0,M.N)(299792458),Se=(0,M.N)(9460730472580800),Te=e=>e.mul(fe),Ie=e=>e.mul(ye),Me=e=>e.mul(ge),Ee=e=>e.mul(be),Ae=e=>e.mul(he),De=e=>e.mul(ve),Oe=e=>e.mul(we),Re=e=>e.mul(xe),Pe=e=>e.mul(Ne),_e=e=>e.mul($e),Ve=e=>e.mul(Ce),qe=e=>e.mul(Qe),Ue=e=>e.mul(ke),Fe=e=>e.mul(Be),Le=e=>Fe(e).mul((0,M.N)(60)),Ze=e=>Le(e).mul((0,M.N)(60)),ze=e=>Ze(e).mul((0,M.N)(24)),je=e=>e.mul(Se),Je=e=>e.mul(ye).mul((0,M.N)(66)),He=e=>e.mul(ye).mul((0,M.N)(6)),Ge=e=>e.mul(ye).mul((0,M.N)(66)).div((0,M.N)(100)),Ke=e=>e.mul((0,M.N)(42195)),We=e=>e.mul((0,M.N)(0x6da012f95c9e88)),Ye=e=>e.mul(fe).div((0,M.N)(72272)).mul((0,M.N)(1e3)),Xe=e=>e.mul(fe).div((0,M.N)(1440)),et=e=>e.mul((0,M.N)(6096)).div((0,M.N)(1e3)),tt=e=>e.mul((0,M.N)(50292)).div((0,M.N)(1e4)),nt=e=>e.mul((0,M.N)(4828)),rt=e=>e.mul((0,M.N)(1016)).div((0,M.N)(1e4)),st=e=>e.mul((0,M.N)(12)).mul(fe).div((0,M.N)(72272)).mul((0,M.N)(1e3)),at=[{name:"meter",symbols:["m"],aliases:["metre"],baseQuantity:"length",toBaseQuantity:Eo,fromBaseQuantity:Eo},{name:"inch",symbols:["in"],baseQuantity:"length",toBaseQuantity:Te,fromBaseQuantity:Ao(Te)},{name:"foot",baseQuantity:"length",symbols:["ft"],toBaseQuantity:Ie,fromBaseQuantity:Ao(Ie)},{name:"yard",symbols:["yd"],baseQuantity:"length",toBaseQuantity:Me,fromBaseQuantity:Ao(Me)},{name:"furlong",symbols:["fur"],baseQuantity:"length",toBaseQuantity:Ee,fromBaseQuantity:Ao(Ee)},{name:"mile",symbols:["mi"],baseQuantity:"length",toBaseQuantity:Ae,fromBaseQuantity:Ao(Ae)},{name:"nauticalmile",symbols:["nmi"],baseQuantity:"length",pretty:"nautical mile",toBaseQuantity:De,fromBaseQuantity:Ao(De)},{name:"nauticalleague",symbols:["nl"],baseQuantity:"length",pretty:"nautical league",toBaseQuantity:Oe,fromBaseQuantity:Ao(Oe)},{name:"angstrom",baseQuantity:"length",symbols:["\xc5"],pretty:"\xc5",toBaseQuantity:Re,fromBaseQuantity:Ao(Re)},{name:"bohr",symbols:["a0","a\u2080"],pretty:"a\u2080",baseQuantity:"length",toBaseQuantity:Pe,fromBaseQuantity:Ao(Pe)},{name:"attometre",baseQuantity:"length",symbols:["am"],toBaseQuantity:_e,fromBaseQuantity:Ao(_e)},{name:"fermi",baseQuantity:"length",symbols:["fm"],toBaseQuantity:Ve,fromBaseQuantity:Ao(Ve)},{name:"smoot",baseQuantity:"length",toBaseQuantity:qe,fromBaseQuantity:Ao(qe)},{name:"astronomicalunit",symbols:["au"],baseQuantity:"length",pretty:"astronomic alunit",toBaseQuantity:Ue,fromBaseQuantity:Ao(Ue)},{name:"lightsecond",symbols:["ls"],baseQuantity:"length",pretty:"light second",toBaseQuantity:Fe,fromBaseQuantity:Ao(Fe)},{name:"lightminute",baseQuantity:"length",pretty:"light minute",toBaseQuantity:Le,fromBaseQuantity:Ao(Le)},{name:"lighthour",symbols:["lh"],baseQuantity:"length",pretty:"light hour",toBaseQuantity:Ze,fromBaseQuantity:Ao(Ze)},{name:"lightday",symbols:["ld"],pretty:"light day",baseQuantity:"length",toBaseQuantity:ze,fromBaseQuantity:Ao(ze)},{name:"lightyear",symbols:["ly"],pretty:"light year",baseQuantity:"length",toBaseQuantity:je,fromBaseQuantity:Ao(je)},{name:"chain",baseQuantity:"length",symbols:["ch"],toBaseQuantity:Je,fromBaseQuantity:Ao(Je)},{name:"fathom",baseQuantity:"length",symbols:["ftm"],toBaseQuantity:He,fromBaseQuantity:Ao(He)},{name:"link",baseQuantity:"length",symbols:["lnk"],toBaseQuantity:Ge,fromBaseQuantity:Ao(Ge)},{name:"marathon",baseQuantity:"length",toBaseQuantity:Ke,fromBaseQuantity:Ao(Ke)},{name:"parsec",baseQuantity:"length",symbols:["pc"],toBaseQuantity:We,fromBaseQuantity:Ao(We)},{name:"point",baseQuantity:"length",symbols:["pt"],toBaseQuantity:Ye,fromBaseQuantity:Ao(Ye)},{name:"twip",baseQuantity:"length",symbols:["twp"],toBaseQuantity:Xe,fromBaseQuantity:Ao(Xe)},{name:"rope",baseQuantity:"length",toBaseQuantity:et,fromBaseQuantity:Ao(et)},{name:"rod",baseQuantity:"length",symbols:["rd"],toBaseQuantity:tt,fromBaseQuantity:Ao(tt)},{name:"league",baseQuantity:"length",symbols:["lea"],toBaseQuantity:nt,fromBaseQuantity:Ao(nt)},{name:"hand",baseQuantity:"length",toBaseQuantity:rt,fromBaseQuantity:Ao(rt)},{name:"pica",baseQuantity:"length",toBaseQuantity:st,fromBaseQuantity:Ao(st)}],ot=(0,M.N)(40468564224),it=e=>e.mul((0,M.N)(1e6)),ut=e=>e.mul(he).mul(he),lt=e=>e.mul(ge).mul(ge),ct=e=>e.mul(ye).mul(ye),mt=e=>e.mul(fe).mul(fe),pt=e=>e.mul(ot).div((0,M.N)(1e7)),dt=e=>e.mul(ot).div((0,M.N)(1e7)).mul((0,M.N)(4e3)),ft=e=>e.div((0,M.N)(1e29)),yt=e=>e.mul((0,M.N)(100)),gt=e=>e.mul((0,M.N)(1e4)),ht=[{name:"squaremeter",symbols:["m2","m\xb2"],pretty:"m\xb2",baseQuantity:"area",toBaseQuantity:Eo,fromBaseQuantity:Eo},{name:"squarekilometre",symbols:["km2","km\xb2"],pretty:"km\xb2",baseQuantity:"area",toBaseQuantity:it,fromBaseQuantity:Ao(it)},{name:"squaremile",symbols:["mi2","mi\xb2","sqmi"],pretty:"mi\xb2",baseQuantity:"area",toBaseQuantity:ut,fromBaseQuantity:Ao(ut)},{name:"squareyard",symbols:["yd2","yd\xb2","sqyd"],pretty:"yd\xb2",baseQuantity:"area",toBaseQuantity:lt,fromBaseQuantity:Ao(lt)},{name:"squarefoot",symbols:["ft2","ft\xb2","sqft"],pretty:"ft\xb2",baseQuantity:"area",toBaseQuantity:ct,fromBaseQuantity:Ao(ct)},{name:"squareinch",symbols:["in2","in\xb2","sqin"],pretty:"in\xb2",baseQuantity:"area",toBaseQuantity:mt,fromBaseQuantity:Ao(mt)},{name:"acre",symbols:["ac"],baseQuantity:"area",toBaseQuantity:pt,fromBaseQuantity:Ao(pt)},{name:"are",baseQuantity:"area",toBaseQuantity:yt,fromBaseQuantity:Ao(yt)},{name:"hectare",symbols:["ha"],baseQuantity:"area",toBaseQuantity:gt,fromBaseQuantity:Ao(gt)},{name:"barony",baseQuantity:"area",toBaseQuantity:dt,fromBaseQuantity:Ao(dt)},{name:"barn",symbols:["b"],baseQuantity:"area",toBaseQuantity:ft,fromBaseQuantity:Ao(ft)}],bt=[{name:"coulomb",symbols:["c"],pretty:"C",baseQuantity:"electric charge",toBaseQuantity:Eo,fromBaseQuantity:Eo}],vt=[{name:"ampere",symbols:["a"],pretty:"A",baseQuantity:"electric current",toBaseQuantity:Eo,fromBaseQuantity:Eo}],wt=[{name:"farad",symbols:["f"],pretty:"F",baseQuantity:"electrical capacitance",toBaseQuantity:Eo,fromBaseQuantity:Eo}],xt=[{name:"siemens",baseQuantity:"electrical conductance",toBaseQuantity:Eo,fromBaseQuantity:Eo}],Nt=[{name:"ohm",symbols:["\u03a9"],pretty:"\u03a9",baseQuantity:"electrical resistance",toBaseQuantity:Eo,fromBaseQuantity:Eo}],$t=e=>e.mul((0,M.N)(4184)).div((0,M.N)(1e3)),Ct=e=>e.mul((0,M.N)(3600)),Qt=[{name:"joule",symbols:["j"],pretty:"J",baseQuantity:"energy",toBaseQuantity:Eo,fromBaseQuantity:Eo},{name:"calorie",symbols:["cal"],baseQuantity:"energy",toBaseQuantity:$t,fromBaseQuantity:Ao($t)},{name:"watthour",symbols:["wh"],pretty:"Wh",baseQuantity:"energy",toBaseQuantity:Ct,fromBaseQuantity:Ao(Ct)}],kt=[{name:"newton",symbols:["n"],pretty:"N",baseQuantity:"force",toBaseQuantity:Eo,fromBaseQuantity:Eo}],Bt=[{name:"hertz",symbols:["hz"],pretty:"Hz",baseQuantity:"frequency",toBaseQuantity:Eo,fromBaseQuantity:Eo}],St=e=>e.mul((0,M.N)(8)),Tt=[{name:"bit",baseQuantity:"information",toBaseQuantity:Eo,fromBaseQuantity:Eo},{name:"byte",pretty:"B",baseQuantity:"information",toBaseQuantity:St,fromBaseQuantity:Ao(St)}],It=[{name:"lumen",symbols:["lm"],baseQuantity:"luminous flow",toBaseQuantity:Eo,fromBaseQuantity:Eo}],Mt=[{name:"candela",symbols:["ca"],baseQuantity:"luminous intensity",toBaseQuantity:Eo,fromBaseQuantity:Eo}],Et=(0,M.N)(16),At=(0,M.N)(26),Dt=(0,M.N)(1e4),Ot=(0,M.N)(1e6),Rt=(0,M.N)(1e9),Pt=(0,M.N)(28349523125),_t=(0,M.N)(10160469088),Vt=e=>e.mul(Pt).div(Rt).mul(Et),qt=e=>e.mul(Pt).div(Rt),Ut=e=>e.mul(Ot),Ft=e=>e.mul(At),Lt=e=>e.mul(_t).div(Dt),Zt=[{name:"gram",symbols:["g","gr"],baseQuantity:"mass",toBaseQuantity:Eo,fromBaseQuantity:Eo},{name:"pound",symbols:["lbav"],baseQuantity:"mass",toBaseQuantity:Vt,fromBaseQuantity:Ao(Vt)},{name:"ounce",baseQuantity:"mass",symbols:["ozav"],toBaseQuantity:qt,fromBaseQuantity:Ao(qt)},{name:"ounce_us_food_nutrition_labbeling",baseQuantity:"mass",symbols:["oz"],toBaseQuantity:Ft,fromBaseQuantity:Ao(Ft)},{name:"tonne",baseQuantity:"mass",toBaseQuantity:Ut,fromBaseQuantity:Ao(Ut)},{name:"ton",baseQuantity:"mass",toBaseQuantity:Lt,fromBaseQuantity:Ao(Lt)}],zt=[{name:"watt",symbols:["w","va"],baseQuantity:"power",pretty:"W",toBaseQuantity:Eo,fromBaseQuantity:Eo}],jt=(0,M.N)(760),Jt=(0,M.N)(1e3),Ht=(0,M.N)(14696),Gt=(0,M.N)(101325),Kt=(0,M.N)(1e5),Wt=e=>e.div(Gt),Yt=e=>e.div(Gt).mul(Kt),Xt=e=>e.div(jt),en=e=>e.div(Ht).mul(Jt),tn=[{name:"atmosphere",symbols:["atm"],baseQuantity:"pressure",toBaseQuantity:Eo,fromBaseQuantity:Eo},{name:"pascal",symbols:["pa"],baseQuantity:"pressure",toBaseQuantity:Wt,fromBaseQuantity:Ao(Wt)},{name:"bar",symbols:["ba"],baseQuantity:"pressure",toBaseQuantity:Yt,fromBaseQuantity:Ao(Yt)},{name:"mmhg",baseQuantity:"pressure",symbols:["torr"],toBaseQuantity:Xt,fromBaseQuantity:Ao(Xt)},{name:"psi",baseQuantity:"pressure",toBaseQuantity:en,fromBaseQuantity:Ao(en)}],nn=[{name:"steradian",symbols:["sr"],baseQuantity:"solid angle",toBaseQuantity:Eo,fromBaseQuantity:Eo}],rn=(0,M.N)(254,1e4),sn=rn.mul((0,M.N)(12)),an=sn.mul((0,M.N)(3)),on=an.mul((0,M.N)(1760)),un=(0,M.N)(1e3),ln=e=>e.mul(on).div(un),cn=e=>e.mul((0,M.N)(1852)).div(un),mn=[{name:"kph",baseQuantity:"speed",toBaseQuantity:Eo,fromBaseQuantity:Eo},{name:"mph",baseQuantity:"speed",toBaseQuantity:ln,fromBaseQuantity:Ao(ln)},{name:"knot",baseQuantity:"speed",toBaseQuantity:cn,fromBaseQuantity:Ao(cn)}],pn=[{name:"mole",baseQuantity:"substance",symbols:["mol"],toBaseQuantity:Eo,fromBaseQuantity:Eo}],dn=[{name:"kelvin",symbols:["k"],pretty:"K",baseQuantity:"temperature",toBaseQuantity:Eo,fromBaseQuantity:Eo},{name:"celsius",symbols:["\xb0c"],pretty:"\xb0C",baseQuantity:"temperature",doesNotScaleOnConversion:!0,toBaseQuantity:e=>e.add((0,M.N)(27315,100)),fromBaseQuantity:e=>e.sub((0,M.N)(27315,100))},{name:"fahrenheit",symbols:["\xb0f"],baseQuantity:"temperature",pretty:"\xb0F",doesNotScaleOnConversion:!0,toBaseQuantity:e=>e.sub((0,M.N)(32)).mul((0,M.N)(5)).div((0,M.N)(9)).add((0,M.N)(27315,100)),fromBaseQuantity:e=>e.sub((0,M.N)(27315,100)).mul((0,M.N)(9)).div((0,M.N)(5)).add((0,M.N)(32))}],fn=(0,M.N)(10),yn=(0,M.N)(1e3),gn=(0,M.N)(60),hn=gn.mul((0,M.N)(60)),bn=hn.mul((0,M.N)(24)),vn=bn.mul((0,M.N)(7)),wn=(0,M.N)(12),xn=wn.mul(fn),Nn=xn.mul(fn),$n=Nn.mul(fn),Cn=e=>e.div(yn),Qn=e=>e.mul(gn),kn=e=>e.mul(hn),Bn=e=>e.mul(bn),Sn=e=>e.mul(vn),Tn=e=>e.mul(wn),In=e=>e.mul(xn),Mn=e=>e.mul(Nn),En=e=>e.mul($n),An=[{name:"second",baseQuantity:"second",symbols:["s"],aliases:["sec"],toBaseQuantity:Eo,fromBaseQuantity:Eo},{name:"millisecond",baseQuantity:"second",symbols:["ms"],toBaseQuantity:Cn,fromBaseQuantity:Ao(Cn)},{name:"minute",aliases:["min"],baseQuantity:"second",toBaseQuantity:Qn,fromBaseQuantity:Ao(Qn)},{name:"hour",symbols:["h"],aliases:["hr"],baseQuantity:"second",toBaseQuantity:kn,fromBaseQuantity:Ao(kn)},{name:"day",symbols:["d"],baseQuantity:"second",toBaseQuantity:Bn,fromBaseQuantity:Ao(Bn)},{name:"week",aliases:["wk"],baseQuantity:"second",toBaseQuantity:Sn,fromBaseQuantity:Ao(Sn)},{name:"month",aliases:["mo"],baseQuantity:"month",toBaseQuantity:Eo,fromBaseQuantity:Eo},{name:"year",aliases:["yr"],baseQuantity:"month",toBaseQuantity:Tn,fromBaseQuantity:Ao(Tn)},{name:"decade",baseQuantity:"month",toBaseQuantity:In,fromBaseQuantity:Ao(In)},{name:"century",baseQuantity:"month",toBaseQuantity:Mn,fromBaseQuantity:Ao(Mn)},{name:"millennium",aliases:["millenniums"],baseQuantity:"month",toBaseQuantity:En,fromBaseQuantity:Ao(En)}];function Dn(e){return(0,O.singular)(e.toLocaleLowerCase())}const On=[{name:"volt",symbols:["v"],pretty:"V",baseQuantity:"voltage",toBaseQuantity:Eo,fromBaseQuantity:Eo}],Rn=(0,M.N)(454609),Pn=e=>e.div((0,M.N)(1e3)),_n=e=>e.mul((0,M.N)(99108963072)).div((0,M.N)(1e11)),Vn=e=>e.mul((0,M.N)(250)).div((0,M.N)(1e6)),qn=e=>e.mul((0,M.N)(15)).div((0,M.N)(1e6)),Un=e=>e.mul((0,M.N)(284130625)).div((0,M.N)(1e13)),Fn=e=>e.mul((0,M.N)(56826125)).div((0,M.N)(1e11)),Ln=e=>e.mul((0,M.N)(5)).div((0,M.N)(1e6)),Zn=e=>e.mul((0,M.N)(5)).div((0,M.N)(1e6)).div((0,M.N)(16)),zn=e=>e.mul((0,M.N)(5)).div((0,M.N)(1e6)).div((0,M.N)(16)).div((0,M.N)(2)),jn=e=>e.mul((0,M.N)(16365924)).div((0,M.N)(1e8)),Jn=e=>e.mul((0,M.N)(Rn)).div((0,M.N)(1e8)),Hn=e=>e.mul((0,M.N)(Rn)).div((0,M.N)(1e8)).mul((0,M.N)(8)),Gn=e=>e.mul(Rn).div((0,M.N)(1e8)).mul((0,M.N)(4)),Kn=e=>e.mul((0,M.N)(0x702f3cad2800)).div((0,M.N)(1e14)),Wn=e=>e.mul(fe).mul(fe).mul(fe),Yn=e=>e.mul(ye).mul(ye).mul(ye),Xn=e=>e.mul(ge).mul(ge).mul(ge),er=e=>e.mul(he).mul(he).mul(he),tr=[{name:"cubicmeter",baseQuantity:"volume",symbols:["m3","m\xb3"],aliases:["cubicmetre"],pretty:"m\xb3",toBaseQuantity:Eo,fromBaseQuantity:Eo},{name:"cubicinch",baseQuantity:"volume",symbols:["in3","in\xb3","cuin"],pretty:"in\xb3",toBaseQuantity:Wn,fromBaseQuantity:Ao(Wn)},{name:"cubicfoot",baseQuantity:"volume",symbols:["ft3","ft\xb3","cuft"],pretty:"ft\xb3",toBaseQuantity:Yn,fromBaseQuantity:Ao(Yn)},{name:"cubicyd",baseQuantity:"volume",symbols:["yd3","yd\xb3","cuyd"],pretty:"yd\xb3",toBaseQuantity:Xn,fromBaseQuantity:Ao(Xn)},{name:"cubicmile",baseQuantity:"volume",symbols:["cumi"],pretty:"cu mi",toBaseQuantity:er,fromBaseQuantity:Ao(er)},{name:"liter",baseQuantity:"volume",symbols:["l"],aliases:["litre"],toBaseQuantity:Pn,fromBaseQuantity:Ao(Pn)},{name:"ton_displacement",baseQuantity:"volume",toBaseQuantity:_n,fromBaseQuantity:Ao(_n)},{name:"cup",baseQuantity:"volume",toBaseQuantity:Vn,fromBaseQuantity:Ao(Vn)},{name:"tablespoon",baseQuantity:"volume",symbols:["tbsp"],toBaseQuantity:qn,fromBaseQuantity:Ao(qn)},{name:"ounce_fluid_imperial",baseQuantity:"volume",symbols:["floz"],toBaseQuantity:Un,fromBaseQuantity:Ao(Un)},{name:"pint",baseQuantity:"volume",toBaseQuantity:Fn,fromBaseQuantity:Ao(Fn)},{name:"teaspoon",baseQuantity:"volume",symbols:["tsp"],toBaseQuantity:Ln,fromBaseQuantity:Ao(Ln)},{name:"pinch",baseQuantity:"volume",toBaseQuantity:Zn,fromBaseQuantity:Ao(Zn)},{name:"dash",baseQuantity:"volume",toBaseQuantity:zn,fromBaseQuantity:Ao(zn)},{name:"barrel",baseQuantity:"volume",symbols:["bl"],toBaseQuantity:jn,fromBaseQuantity:Ao(jn)},{name:"gallon",baseQuantity:"volume",symbols:["gal"],toBaseQuantity:Jn,fromBaseQuantity:Ao(Jn)},{name:"bushel",baseQuantity:"volume",symbols:["bu"],toBaseQuantity:Hn,fromBaseQuantity:Ao(Hn)},{name:"bucket",baseQuantity:"volume",symbols:["bkt"],toBaseQuantity:Gn,fromBaseQuantity:Ao(Gn)},{name:"acrefoot",baseQuantity:"volume",symbols:["acft"],toBaseQuantity:Kn,fromBaseQuantity:Ao(Kn)}],nr=[o,i,S,x,d,f,v,Q,k,g,C,l,u,B,c,p,m,w,y,$,s,b,h,N,a],rr=new Set,sr=[],ar={};function or(e,t){t&&(ar[e.toLowerCase()]=t)}nr.map((e=>{e.units.map((e=>{if(rr.has(e.name))throw new Error("Trying to declare twice ".concat(e.name));rr.add(e.name),or(e.name,e.pretty),(e.aliases||[]).forEach((t=>{if(rr.has(t))throw new Error("Trying to declare twice ".concat(t));rr.add(t),or(t,e.pretty)})),(e.symbols||[]).forEach((t=>{if(rr.has(t))throw new Error("Trying to declare twice ".concat(t));sr.push(t),rr.add(t),or(t,e.pretty)}))}))}));const ir=e=>sr.some((t=>t===e));sr.map((e=>{!function(e){const t=e.toLocaleLowerCase();(0,O.addIrregularRule)(t,t)}(e)}));const ur=nr.flatMap((e=>e.units)),lr=new Set;lr.add("area"),lr.add("volume"),lr.add("speed");const cr=new Map,mr=ur.reduce(((e,t)=>{if(e.set(t.name,t),t.symbols)for(const n of t.symbols)cr.set(n,t),e.set(n.toLowerCase(),t);if(t.aliases)for(const n of t.aliases)e.set(n.toLowerCase(),t);return e}),new Map);function pr(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return!!e&&cr.has(e.toLowerCase())}function dr(e){const t=Dn(e);return mr.get(t)}function fr(e,t){const n=dr(e),r=dr(t);return n||r?!(!n||!r)&&n.baseQuantity===r.baseQuantity:Dn(e)===Dn(t)}const yr=(0,M.N)(10),gr=(0,M.N)(36),hr=(0,M.N)(1e3),br=(0,M.N)(101325),vr={force:{expandedUnits:[{baseQuantity:"mass",exp:(0,M.N)(1)},{baseQuantity:"length",exp:(0,M.N)(1)},{baseQuantity:"second",exp:(0,M.N)(-2)}],convertToExpanded:e=>e.mul(hr)},pressure:{expandedUnits:[{baseQuantity:"force",exp:(0,M.N)(1)},{baseQuantity:"area",exp:(0,M.N)(-1)}],convertToExpanded:e=>e.mul(br)},area:{expandedUnits:[{baseQuantity:"length",exp:(0,M.N)(2)}],convertToExpanded:E.yR},volume:{expandedUnits:[{baseQuantity:"length",exp:(0,M.N)(3)}],convertToExpanded:E.yR},frequency:{expandedUnits:[{baseQuantity:"second",exp:(0,M.N)(-1)}],convertToExpanded:E.yR},energy:{expandedUnits:[{baseQuantity:"mass",exp:(0,M.N)(1)},{baseQuantity:"length",exp:(0,M.N)(2)},{baseQuantity:"second",exp:(0,M.N)(-2)}],convertToExpanded:e=>e.mul(hr)},power:{expandedUnits:[{baseQuantity:"mass",exp:(0,M.N)(1)},{baseQuantity:"length",exp:(0,M.N)(2)},{baseQuantity:"second",exp:(0,M.N)(-3)}],convertToExpanded:e=>e.mul(hr)},"electric charge":{expandedUnits:[{baseQuantity:"second",exp:(0,M.N)(1)},{baseQuantity:"electric current",exp:(0,M.N)(1)}],convertToExpanded:E.yR},"luminous flow":{expandedUnits:[{baseQuantity:"luminous intensity",exp:(0,M.N)(1)},{baseQuantity:"solid angle",exp:(0,M.N)(1)}],convertToExpanded:E.yR},speed:{expandedUnits:[{baseQuantity:"length",exp:(0,M.N)(1)},{baseQuantity:"second",exp:(0,M.N)(-1)}],convertToExpanded:e=>e.mul(yr).div(gr)},voltage:{expandedUnits:[{baseQuantity:"mass",exp:(0,M.N)(1)},{baseQuantity:"length",exp:(0,M.N)(2)},{baseQuantity:"second",exp:(0,M.N)(-3)},{baseQuantity:"electric current",exp:(0,M.N)(-1)}],convertToExpanded:e=>e.mul(hr)},"electrical capacitance":{expandedUnits:[{baseQuantity:"mass",exp:(0,M.N)(-1)},{baseQuantity:"length",exp:(0,M.N)(-2)},{baseQuantity:"second",exp:(0,M.N)(4)},{baseQuantity:"electric current",exp:(0,M.N)(2)}],convertToExpanded:e=>e.div(hr)},"electrical resistance":{expandedUnits:[{baseQuantity:"mass",exp:(0,M.N)(1)},{baseQuantity:"length",exp:(0,M.N)(2)},{baseQuantity:"second",exp:(0,M.N)(-3)},{baseQuantity:"electric current",exp:(0,M.N)(-2)}],convertToExpanded:e=>e.mul(hr)},"electrical conductance":{expandedUnits:[{baseQuantity:"mass",exp:(0,M.N)(-1)},{baseQuantity:"length",exp:(0,M.N)(-2)},{baseQuantity:"second",exp:(0,M.N)(3)},{baseQuantity:"electric current",exp:(0,M.N)(2)}],convertToExpanded:e=>e.div(hr)}},wr={length:"meter",area:"squaremeter",volume:"cubicmeter",pressure:"atmosphere",force:"newton",energy:"joule",mass:"gram",temperature:"kelvin",second:"second",month:"month",substance:"mole","electric current":"ampere","electric charge":"coulomb",voltage:"volt",power:"watt","electrical capacitance":"farad","electrical resistance":"ohm","electrical conductance":"siemens",frequency:"hertz",information:"bit","luminous intensity":"candela","luminous flow":"lumen","solid angle":"steradian",angle:"radian",speed:"kph",EUR:"EUR",USD:"USD",GBP:"GBP",SEK:"SEK",XXX:"XXX",NOK:"NOK",JPY:"JPY",CNY:"CNY",PHP:"PHP",INR:"INR",RUB:"RUB",TRY:"TRY",KRW:"KRW",THB:"THB",PLN:"PLN",ILS:"ILS",AED:"AED",SAR:"SAR",AUD:"AUD",CAD:"CAD",CHF:"CHF",HKD:"HKD",NZD:"NZD",SGD:"SGD",ZAR:"ZAR",BRL:"BRL",TWD:"TWD",DKK:"DKK",IDR:"IDR",HUF:"HUF",CZK:"CZK",CLP:"CLP",COP:"COP",MYR:"MYR",RON:"RON",BTC:"BTC",ETH:"ETH",UAH:"UAH"};function xr(e){return wr[e]}function Nr(e){const t=(0,E.m0)(dr(e.unit)),n=xr(t.baseQuantity);return[(0,I.Uy)(e,(e=>{e.unit=n})),t.toBaseQuantity]}function $r(e){const t=dr(e.unit);return!!t&&!!t.doesNotScaleOnConversion}function Cr(e,t){let n=!0;return t.expandedUnits.map((t=>{const r={unit:xr(t.baseQuantity),exp:t.exp.mul(e.exp),multiplier:n?e.multiplier.pow(t.exp):M.ry,known:!0};return n=!1,r}))}function Qr(e,t){const n=xr(e.baseQuantity);if(n===e.name)return[t,E.yR];const r=(0,I.Uy)(t,(e=>{e.unit=n})),s=e.toBaseQuantity(M.ry).pow(t.exp);var a;return[r,(a=s,e=>e.mul(a))]}function kr(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Nr,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:E.yR;if(e.unit){const r=dr(e.unit);if(r){if($r(e)){const[n,r]=t(e);return[[n],r]}const s=vr[r.baseQuantity],[a,o]=Qr(r,e);if(s){const t=Cr(a,s),r=s.convertToExpanded(M.ry).pow(e.exp);return[t,n((e=>o(e).mul(r)))]}return[[a],n(o)]}}return[[e],E.yR]}function Br(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Nr,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:E.yR,r=e,s=E.yR,a=r.length;for(;;){var o;const[e,i]=r.map((e=>kr(e,t,n))).reduce(((e,t)=>{let[n,r]=e,[s,a]=t;return[[...n,...s],e=>r(a(e))]}),[[],s]);if(r=null!==(o=bs(e))&&void 0!==o?o:[],s=i,r.length===a)break;a=r.length}return[r,s]}function Sr(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Nr,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:E.yR;if(null===e||void 0===e||!e.length)return[null,E.yR];const[r,s]=Br(gs(e),t,n);return[null!==r&&void 0!==r?r:[],s]}function Tr(e){return t=>{if(t.isZero())return t;const n=e(M.ry);return t.div(n)}}function Ir(e){return[e,(0,E.m0)(dr(e.unit)).fromBaseQuantity]}function Mr(e){if(null===e||void 0===e||!e.length)return[null,E.yR];const[,t]=Sr(e,Ir,Tr);return[e,t]}const Er=(0,M.N)(2592e3),Ar={month:{second:Er},second:{month:(0,M.N)(1).div(Er)}},Dr=(e,t)=>{var n;return null!=e&&null!=t?null===(n=Ar[e])||void 0===n?void 0:n[t]:void 0},Or=e=>{var t;return null===(t=dr(e.unit))||void 0===t?void 0:t.baseQuantity};function Rr(e,t){let{tolerateImprecision:n}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(e.unit===t.unit&&e.exp.equals(t.exp))return!0;if(n&&e.exp.equals(t.exp)){const n=Or(e),r=Or(t);return null!=Dr(n,r)}return!1}function Pr(e,t){if(!e||!t)return!1;const n=bs(_r(e)),r=bs(_r(t));return n.length===r.length&&So(n,r).every((e=>{let[t,n]=e;return t.unit===n.unit&&t.exp.equals(n.exp.neg())}))}function _r(e){return null!==e&&void 0!==e&&e.length?fs(e.map((0,I.ZP)((e=>{const t=dr(e.unit);e.unit=t?t.baseQuantity:e.unit})))):e}function Vr(e,t){let{tolerateImprecision:n}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const[r]=Sr(e),[s]=Sr(t),a=_r(r),o=_r(s);if((null!==a&&void 0!==a?a:[]).length!==(null!==o&&void 0!==o?o:[]).length)return!1;if(Pr(r,s))return!0;const i=new Set(null!==o&&void 0!==o?o:[]);for(const u of null!==a&&void 0!==a?a:[])for(const e of i)if(Rr(u,e,{tolerateImprecision:n})){i.delete(e);break}return 0===i.size}function qr(e,t){const[n,r]=Sr(t);return[n,r(e)]}function Ur(e,t){const[,n]=Mr(t);return[t,n(e)]}function Fr(e,t,n){let{tolerateImprecision:r}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(!Vr(t,n,{tolerateImprecision:r}))throw ae.cannotConvertBetweenUnits(t,n);if(r&&!Vr(t,n))return Lr(e,t,n);const[s,a]=qr(e,t),[o,i]=Ur(a,n);if(Pr(s,o)){const[,e]=Ur(a.inverse(),n);return e}return i}function Lr(e,t,n){for(const r of t)for(const t of n){if(Rr(r,t))continue;const n=dr(r.unit),s=dr(t.unit),a=(null===n||void 0===n?void 0:n.baseQuantity)&&(null===s||void 0===s?void 0:s.baseQuantity)&&Dr(n.baseQuantity,s.baseQuantity);a&&(e=s.fromBaseQuantity(n.toBaseQuantity(e).mul(a)))}return e}const Zr=e=>e.cellType?[e.indexedBy,...Zr(e.cellType)]:[],zr=(e,t)=>{const n=e.map(((e,n)=>(e=>null!=e.cellType)(e)&&oa(e)>t[n])),r=e.map(Zr),s=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Set;const r=new Set;for(const[s,a]of Io(e))if(t[s])for(const e of a)if(null!=e){if(r.has(e)&&!n.has(e))return e;r.add(e)}return null}(r,n);if(s)return r.map(((e,t)=>e.includes(s)&&n[t]));const a=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Set;for(const[r,s]of Io(e))if(t[r])for(const e of s)if("string"===typeof e&&e.startsWith&&!e.startsWith("\0")&&!n.has(e))return e;return null}(r,n);return a?r.map(((e,t)=>e.includes(a)&&n[t])):n},jr=(e,t)=>{var n;return null!==(n=e.indexedBy)&&void 0!==n?n:t};function Jr(){const e=new Map;for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(const a of n)for(const[t,n]of Io(a)){var s;const r=jr(n,t),a=null!==(s=e.get(r))&&void 0!==s?s:[];a.push(n),e.set(r,a)}return[...e.values()]}const Hr=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:aa(e.length);const r=ia(e,n);if(r)return r.expected(X(ne()));if(n.every((e=>1===e))){const n=e.map((e=>ua(e))),r=n.map((e=>e[e.length-1])),s=Jr(...n.map((e=>e.slice(0,-1))));return la([...s.map((e=>e[0])),t(r)])}return zr(e,n).every((e=>!1===e))?t(e):re("Operating upon multiple dimensional values is not supported yet")},Gr=function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:aa(t.length);if(ia(e,r))throw new Error("panic: one or more cardinalities are too low");if(r.every((e=>1===e))){const s=Kr(e,r);return fa((e=>n(e,s)),t,e)}if(zr(e,r).every((e=>!1===e)))return n(t,e);throw new Error("panic: Operating upon multiple dimensional values is not supported yet")},Kr=(e,t)=>{let n=[];return Hr(e,(e=>(n=e,te())),t),n},Wr=(e,t)=>{const n=ia([e],[2]);if(n)return n.expected(X(ne()));if(2===oa(e))return t([e]);if(null!=e.columnSize)return X(Wr(e.reduced(),t),e.columnSize,e.indexedBy);throw new Error("panic: unreachable")},Yr=(e,t,n)=>{if(ia([e],[2]))throw new Error("panic: cardinality is too low");if(2===oa(e))return n([t],[e]);{const r=L(t,"reducers always take columnar arguments");return Sa.fromValues(r.values.map((t=>Yr(e.reduced(),L(t),n))),r.dimensions.slice(1))}},Xr=(e,t)=>t.isColumn().mapType((t=>{const n=ua(t),r=(0,E.m0)(n.pop()),s=n.findIndex((t=>t.indexedBy===e));return-1===s?re(ae.unknownCategory(e)):la([...ca(s,n),r])})),es=(e,t,n)=>{const r=ua(t).slice(0,-1);if(r.length!==n.dimensions.length)throw new Error("panic: incorrect amount of dimensions");const s=r.findIndex((t=>t.indexedBy===e));if(0===s)return n;if(s<0)throw new Error("panic: dominant dimension not found");return new ba(L(n),s)};function ts(e,t){return ns(t),e.indexToLabelIndex?ns(e.indexToLabelIndex(t)):t}const ns=e=>{if(null==e||e<0)throw new Error("getLabelIndex got an invalid index ".concat(e));return e};function rs(e,t){return So(e,t).map((e=>{let[t,n]=e;return function(e,t){const n=t.reducedToLowest();if(n.unit){const[,r]=Sr((0,E.m0)(n.unit));return Gr([t],[e],(e=>{let[t]=e;return t instanceof $a?$a.fromValue(r(t.value)):t}))}return e}(t,n)}))}const ss={q:"quecto",r:"ronto",y:"yocto",z:"zepto",a:"atto",f:"femto",p:"pico",n:"nano","\u03bc":"micro",m:"milli",c:"centi",d:"deci",da:"deca",h:"hecto",k:"kilo",M:"mega",G:"giga",T:"tera",P:"peta",E:"exa",Z:"zetta",Y:"yotta",R:"ronna",Q:"quetta"},as={quecto:(0,M.N)(1,1000000000000000000000000000000n),ronto:(0,M.N)(1,1000000000000000000000000000n),yocto:(0,M.N)(1,1000000000000000000000000n),zepto:(0,M.N)(1,1000000000000000000000n),atto:(0,M.N)(1,1000000000000000000n),femto:(0,M.N)(1,1000000000000000n),pico:(0,M.N)(1,1000000000000n),nano:(0,M.N)(1,1000000000n),micro:(0,M.N)(1,1000000n),milli:(0,M.N)(1,1000n),centi:(0,M.N)(1,100n),deci:(0,M.N)(1,10n),deca:(0,M.N)(10n),hecto:(0,M.N)(100n),kilo:(0,M.N)(1000n),mega:(0,M.N)(1000000n),giga:(0,M.N)(1000000000n),tera:(0,M.N)(1000000000000n),peta:(0,M.N)(1000000000000000n),exa:(0,M.N)(1000000000000000000n),zetta:(0,M.N)(1000000000000000000000n),yotta:(0,M.N)(1000000000000000000000000n),ronna:(0,M.N)(1000000000000000000000000000n),quetta:(0,M.N)(1000000000000000000000000000000n)},os=Object.keys(as);function is(e){const t=dr(e);var n,r;if(t)return{unit:e,exp:M.ry,multiplier:M.ry,known:!0,baseQuantity:t.baseQuantity,baseSuperQuantity:null!==(n=t.superBaseQuantity)&&void 0!==n?n:t.baseQuantity};{const t=function(e){for(const t of os)if(e.startsWith(t))return[as[t],e.substring(t.length)];if(e.startsWith("da"))return[as.deca,e.slice(2)];if(e[0]in ss){const t=ss[e[0]];return[as[t],e.slice(1)]}return[M.ry,e]}(e);let n=t[0],s=t[1];const a=1,o=(r=s,mr.has(Dn(r))),i=e.length-s.length<3;if(!o&&i&&(s=e,n=M.ry),!function(e){const t=dr(e);return!t||!lr.has(t.baseQuantity)}(s)){const e=s.match(/(.*)([0-9])+$/);if(e){const[,t,r]=e;return{unit:t,exp:(0,M.N)(r),multiplier:n,known:o}}}const u={unit:s,exp:(0,M.N)(a),multiplier:n,known:o};if(o){const e=dr(s);return e&&"currency"===e.superBaseQuantity?{...u,baseSuperQuantity:"currency"}:u}return u}}const us=new Set(["millennium","millenniums","millennia","century","centuries","decade","decades","year","years","quarter","quarters","month","months","day","days","hour","hours","minute","minutes","second","seconds","millisecond","milliseconds"]),ls=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2n;const{unit:n}=e;if(pr(n))return e;const r=ue(n,t);return r===n?e:(0,I.Uy)(e,(e=>{e.unit=r}))},cs=(e,t)=>null==e&&null==t||e===t,ms=(e,t)=>{const[n]=Sr(e),r=null!==n&&void 0!==n?n:[],[s]=Sr(t),a=null!==s&&void 0!==s?s:[];if(r.length!==a.length)return!1;const o=Array.from(a);for(const i of r){let e;for(const t of o)if(0===i.exp.compare(t.exp)&&fr(i.unit,t.unit)){e=t;break}if(!e)return!1;o.splice(o.indexOf(e),1)}return 0===o.length},ps=(e,t)=>{var n,r;const s=null!==(n=bs(e))&&void 0!==n?n:[],a=null!==(r=bs(t))&&void 0!==r?r:[];return 0===s.length!==(0===a.length)||(0,E.x8)(s,a).every((e=>{let[t,n]=e;return null!=t&&null!=n&&(t.unit===n.unit&&0===t.multiplier.compare(n.multiplier)&&0===t.exp.compare(n.exp))}))},ds=(e,t)=>{e=ie(e,t),e=(0,I.Uy)(e,(e=>{var n;null!==(n=e.numberError)&&void 0!==n||(e.numberError=t.numberError)}));if(ms(e.unit,t.unit))return e;const n=((e,t)=>{const n="number"===e.type&&"number"===t.type,r=null==e.unit!==(null==t.unit);var s;return n&&r?ko(null!==(s=e.unit)&&void 0!==s?s:t.unit):null})(e,t);return n?Ns(e,n):e.withErrorCause(ae.expectedUnit(t.unit,e.unit))},fs=e=>e.map((e=>ls(e))).reduce(((e,t)=>{const n=e.findIndex((e=>t.unit===e.unit&&cs(t.quality,e.quality)));if(n>=0){const r=e[n];return e[n]=(0,I.Uy)(r,(e=>{e.exp=e.exp.add(t.exp),e.multiplier=e.multiplier.mul(t.multiplier.pow(t.exp))})),e}return[...e,t]}),[]).filter((e=>0!==(0,M.N)(e.exp).compare(M.xE))),ys=e=>{const t=dr(e.unit);return t?(0,I.Uy)(e,(e=>{e.unit=t.name})):e},gs=e=>e.map(ys),hs=(e,t)=>e.unit>t.unit?1:e.unit<t.unit?-1:0,bs=function(e){let{mult:t=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(null===e||void 0===e||!e.length)return null;const n=fs(e);return 0===n.length?null:t?n:n.sort(hs)},vs=(0,I.Uy)(((e,t)=>{e.exp=t})),xs=function(e,t){var n,r;let{mult:s=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const a=null!==(n=bs(e,{mult:s}))&&void 0!==n?n:[],o=null!==(r=bs(t,{mult:s}))&&void 0!==r?r:[],i=s?[...a]:[...o],u=s?o:a;for(const l of u){const e=i.findIndex((e=>cs(e.quality,l.quality)&&fr(e.unit,l.unit)));e>=0?i[e]=(0,I.Uy)(i[e],(e=>{e.exp=e.exp.add(l.exp)})):i.push(l)}return bs(i,{mult:s})},Ns=(e,t)=>(0,I.Uy)(e,(e=>{"number"===e.type&&(e.unit=t)})),$s=e=>function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];const s=n.find((e=>e instanceof js&&null!=e.errorCause));return null!==s&&void 0!==s?s:e(...n)},Cs=$s(((e,t)=>t===e.type?e:e.expected(r[t]()))),Qs=$s(((e,t)=>{const n=null!=e.type,r=null!=e.type;if(n&&r){return e.type===t.type?"number"===e.type?ds(e,t):e:e.expected(t)}return n||r?e.expected(t):e})),ks=$s(((e,t)=>"number"===e.type&&"number"===t.type?ie(e,t):e)),Bs=$s((e=>null!=e.columnSize?e:e.expected("column"))),Ss=$s((e=>null!=e.columnNames&&null!=e.columnTypes?e:e.expected("table"))),Ts=$s((e=>null!=e.columnNames&&null!=e.columnTypes||null!=e.rowCellTypes&&null!=e.rowCellNames?e:e.expected("table or row"))),Is=$s((e=>null!=e.cellType?e.cellType:e.expected("column"))),Ms=$s((e=>{for(;e.cellType;)e=e.cellType;return e})),Es=$s(((e,t)=>{var n;return(null!==(n=e.columnTypes)&&void 0!==n?n:[]).length>=t?e:e.withErrorCause("Expected table with at least ".concat(t," column").concat(1===t?"":"s"))})),As=$s((e=>null!=e.atParentIndex?e:e.withErrorCause(ae.expectedTableAndAssociatedColumn(null,e)))),Ds=$s(((e,t)=>null!=e.columnSize&&null!=t.columnSize?e.reduced().sameAs(t.reduced()).mapType((()=>e)):null==e.columnSize&&null==t.columnSize?e:e.expected(t))),Os=$s((e=>null!=e.rangeOf?e:e.expected("range"))),Rs=$s((e=>{var t;return null!==(t=e.rangeOf)&&void 0!==t?t:e.expected("range")})),Ps=$s(((e,t)=>null!=e.rangeOf&&null!=t.rangeOf?e.rangeOf.sameAs(t.rangeOf).mapType((()=>e)):null==e.rangeOf&&null==t.rangeOf?e:e.expected(t))),_s=$s(((e,t)=>null!=e.columnTypes&&null!=t.columnTypes?(0,se.J)(e.columnNames,t.columnNames)&&So(e.columnTypes,t.columnTypes).every((e=>{let[t,n]=e;return null==t.sameAs(n).errorCause}))?e:e.expected(t):null==e.columnTypes&&null==t.columnTypes?e:e.expected(t))),Vs=$s((e=>null!=e.unit&&0!==e.unit.length&&e.unit.every((e=>us.has(e.unit)))?e:e.expected("time quantity"))),qs=$s(((e,t)=>null==e.date||null!=t&&e.date!==t?e.expected(t?G(t):"date"):e)),Us=$s(((e,t)=>e.date===t.date?e:e.expected(t))),Fs=$s(((e,t)=>Ns(e,xs(e.unit,t,{mult:!0})))),Ls=$s(((e,t)=>{if("number"===typeof t){const n=1/t;return e.unit?Ns(e,(r=e.unit,s=n,bs((0,I.Uy)(r,(e=>{for(const n of e)try{n.exp=n.exp.mul((0,M.N)(s))}catch(t){throw new Error("error multiplying ".concat(n.exp," by ").concat(s,": ").concat(t.message))}}))))):e}{var n;const r=null!==(n=null===t||void 0===t?void 0:t.map((e=>{return vs(t=e,t.exp.neg());var t})))&&void 0!==n?n:[],s=xs(e.unit,r);return Ns(e,s)}var r,s})),Zs=$s(((e,t)=>{const n=[Qs,Ds,Us,Ps,_s];let r=e;for(const s of n)if(r=s(r,t),r.errorCause)return r;return r})),zs=$s((e=>js.either(e.isDate(),e.isScalar("string"),e.isScalar("number"),e.isScalar("boolean")).errorCause?re(ae.expectedPrimitive(e)):e));class js{constructor(){q()(this,I.sc,!0),q()(this,"node",null),q()(this,"errorCause",null),q()(this,"type",null),q()(this,"unit",null),q()(this,"numberFormat",null),q()(this,"numberError",null),q()(this,"date",null),q()(this,"rangeOf",null),q()(this,"indexName",null),q()(this,"indexedBy",null),q()(this,"cellType",null),q()(this,"columnSize",null),q()(this,"atParentIndex",null),q()(this,"columnTypes",null),q()(this,"columnNames",null),q()(this,"rowIndexName",null),q()(this,"rowCellTypes",null),q()(this,"rowCellNames",null),q()(this,"functionness",!1),q()(this,"functionName",void 0),q()(this,"functionArgCount",void 0),q()(this,"nothingness",!1),q()(this,"anythingness",!1),q()(this,"symbol",null)}static combine(e){let t=e;if(null!=t.errorCause)return t;for(var n=arguments.length,r=new Array(n>1?n-1:0),s=1;s<n;s++)r[s-1]=arguments[s];for(const a of r){const e="function"===typeof a?t.mapType(a):a;if(null!=e.errorCause)return e;t=e}return t}static either(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=t.find((e=>!e.errorCause));return null!==r&&void 0!==r?r:t[0]}mapType(e){return this.errorCause?this:e(this)}inNode(e){return(0,I.Uy)(this,(t=>{t.node=e}))}withErrorCause(e){const{node:t,errorCause:n}=this;return n?this:re(e,t)}expected(e){return this.mapType((()=>this.withErrorCause(ae.expectedButGot(e,this))))}sameAs(e){return Zs(this,e)}isScalar(e){return Cs(this,e)}isColumn(){return Bs(this)}isTable(){return Ss(this)}isTableOrRow(){return Ts(this)}reduced(){return Is(this)}reducedToLowest(){return Ms(this)}withAtParentIndex(){return As(this)}withMinimumColumnCount(){return Es(this,arguments.length>0&&void 0!==arguments[0]?arguments[0]:1)}isPrimitive(){return zs(this)}isRange(){return Os(this)}getRangeOf(){return Rs(this)}isTimeQuantity(){return Vs(this)}isDate(e){return qs(this,e)}multiplyUnit(e){return Fs(this,e)}divideUnit(e){return Ls(this,e)}sharePercentage(e){return ks(this,e)}}function Js(e,t){if(!t)return e;const n=function(e){let t=M.ry;for(const n of e)t=t.mul(n.multiplier.pow(n.exp));return t}(t);return e.div(n)}function Hs(e,t){const n=t(e);switch(n.kind){case"nothing":case"anything":case"type-error":case"boolean":case"string":case"number":case"date":return n;case"range":{const{rangeOf:e}=n;return(0,I.ZP)(n,(n=>{n.rangeOf=Hs(e,t)}))}case"column":{const{cellType:e}=n;return(0,I.ZP)(n,(n=>{n.cellType=Hs(e,t)}))}case"table":case"row":case"function":throw new Error("cannot traverse type ".concat(n.kind))}}function Gs(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Map,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];if(e.errorCause)return e;if(t.errorCause)return t;e.symbol&&(n.has(e.symbol)?e=(0,E.m0)(n.get(e.symbol)):n.set(e.symbol,t));const s=na(e),a=na(t);if("anything"===s.kind)return t;if("anything"===a.kind)return e;const o=(()=>{if(s.kind!==a.kind)return t.expected(s.kind);switch(s.kind){case"nothing":case"boolean":case"type-error":case"string":return e;case"number":return oe(e.numberFormat,t.numberFormat)?(0,I.ZP)(e,(e=>{e.numberFormat=null})):ds(e,t);case"date":{const n=a;return s.date!==n.date?t.expected(s.date):e}case"range":{const s=Gs((0,E.m0)(e.rangeOf),(0,E.m0)(t.rangeOf),n,[...r,"range"]);return s.errorCause?s:(0,I.ZP)(e,(e=>{e.rangeOf=s}))}case"column":{const o=a,i=Gs((0,E.m0)(e.cellType),(0,E.m0)(t.cellType),n,[...r,"column"]);return i.errorCause?i:Mo(s.indexedBy,o.indexedBy)?(0,I.ZP)(e,(e=>{e.columnSize="unknown"===s.columnSize?o.columnSize:s.columnSize,e.cellType=i})):e.withErrorCause("mismatched index name")}case"table":throw new Error("tables cannot be narrowed");case"row":throw new Error("rows cannot be narrowed");case"function":throw new Error("functions cannot be narrowed")}})();return(0,I.ZP)(o,(e=>{e.errorCause&&!e.errorCause.pathToError.length&&(e.errorCause.pathToError=r)}))}function Ks(e){let{args:t,expectedArgs:n,returnType:r}=e;const s=new Map,a=(0,E.$R)(t,n).map((e=>{let[t,n]=e;return Gs(n,t,s)})).find((e=>e.errorCause));if(a)return a;return ra(Hs(na(r),(e=>{if(e.symbol){const t=(0,E.m0)(s.get(e.symbol));return na((0,I.ZP)(t,(e=>{e.symbol=null})))}return e})))}var Ws=n(13224),Ys=n.n(Ws);const Xs=Ys().compile({lt:"<",gt:">",comma:",",colon:":",arrow:"->",number:/\d+/,word:/\w+/,WS:{match:/\s+/,lineBreaks:!0}});function ea(e){let{token:t,next:n,error:s,ensure:a}=e;const o=e=>{const r=t();if(!r)return e;if("colon"===r.type){n();const t=a("word");return(0,I.ZP)(e,(e=>{e.symbol=(0,E.m0)(t).text}))}return e},i=()=>{var e;const{text:u}=null!==(e=n())&&void 0!==e?e:(0,E.FL)("unexpected end");if("string"===u||"number"===u||"boolean"===u)return o(r[u]());if("column"===u){var l;a("lt");const e=i();let r="unknown";"comma"===(null===(l=t())||void 0===l?void 0:l.type)&&(n(),r=(()=>{var e;const{type:t,text:r}=null!==(e=n())&&void 0!==e?e:(0,E.FL)(s());if("number"===t)return Number(r);if("unknown"===r)return"unknown";throw s()})());const u=X(e,r);return a("gt"),o(u)}if("range"===u){a("lt");const e=i();return a("gt"),o(H(e))}if("anything"===u)return o(ne());if("nothing"===u)return o(te());if(/^[A-Z]+$/.test(u))return(0,I.ZP)(ne(),(e=>{e.symbol=u}));throw s()};return i()}function ta(e){Xs.reset(e);let t=Xs.next();const n=()=>{const e=t;do{var n;t=Xs.next()}while("WS"===(null===(n=t)||void 0===n?void 0:n.type));return e},r=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"unexpected ";const n=t?'"'.concat(t.text,'"'):"<end>";return new Error(e+n)};return{token:()=>t,next:n,error:r,ensure:e=>{var s;if((null===(s=t)||void 0===s?void 0:s.type)!==e)throw r("expected ".concat(e,", got "));return n()},assertAllConsumed:()=>{if(null!=t)throw r("unexpected garbage at the end: ")}}}function na(e){if(!(e instanceof js))return e;const t=(()=>{if(e.cellType&&e.columnSize)return{kind:"column",indexedBy:e.indexedBy,cellType:na(e.cellType),columnSize:e.columnSize};if(e.columnTypes&&e.columnNames)return{kind:"table",indexName:e.indexName,columnTypes:e.columnTypes.map((e=>na(e))),columnNames:e.columnNames};if(e.rowCellTypes&&e.rowCellNames)return{kind:"row",rowIndexName:e.rowIndexName,rowCellTypes:e.rowCellTypes.map((e=>na(e))),rowCellNames:e.rowCellNames};if("number"===e.type){var t,n,r;if("percentage"===e.numberFormat&&null!==(t=e.unit)&&void 0!==t&&t.length)throw new Error("Cannot serialize a percentage number with a unit");return e.numberFormat?{kind:"number",numberFormat:e.numberFormat}:e.numberError?{kind:"number",unit:null!==(r=e.unit)&&void 0!==r&&r.length?e.unit:null,numberError:e.numberError}:{kind:"number",unit:null!==(n=e.unit)&&void 0!==n&&n.length?e.unit:null}}return"boolean"===e.type?{kind:"boolean"}:"string"===e.type?{kind:"string"}:e.date?{kind:"date",date:e.date}:e.rangeOf?{kind:"range",rangeOf:na(e.rangeOf)}:e.nothingness?{kind:"nothing"}:e.anythingness?{kind:"anything"}:e.functionness?{kind:"function",name:(0,E.m0)(e.functionName),argCount:e.functionArgCount,ast:e.node}:e.errorCause?{kind:"type-error",errorCause:e.errorCause.spec}:null})();if(null!=t)return sa(e,t);throw console.error(e),new Error("panic: serializing invalid type ".concat(e.type))}function ra(e){return e instanceof js?e:sa(e,(()=>{switch(e.kind){case"number":return z(e.unit,e.numberFormat,e.numberError);case"string":return j();case"boolean":return J();case"date":return G(e.date);case"range":return H(ra(e.rangeOf));case"column":return X(ra(e.cellType),e.columnSize,e.indexedBy);case"table":const{columnTypes:t,columnNames:n}=e;return W({columnTypes:t.map((e=>ra(e))),columnNames:n});case"row":return Y(e.rowCellTypes.map((e=>ra(e))),e.rowCellNames,e.rowIndexName);case"nothing":case"anything":return te();case"function":return ee(e.name,e.argCount);case"type-error":return re(new ae(e.errorCause))}})())}function sa(e,t){return e.symbol?{...t,symbol:e.symbol}:t}const aa=e=>Array.from({length:e},(()=>1)),oa=e=>null!=e.cellType?1+oa(e.cellType):1,ia=(e,t)=>e.find(((e,n)=>oa(e)<t[n])),ua=e=>e.cellType?[e,...ua(e.cellType)]:[e],la=e=>{const[t,...n]=e;return js.combine(t,...n).mapType((()=>1===e.length?t:(0,I.Uy)(e[0],(e=>{e.cellType=la(n)}))))},ca=(e,t)=>[t[e],...t.filter(((t,n)=>n!==e))];const ma=pa(class{constructor(e,t){q()(this,"index",void 0),q()(this,"innerHC",void 0),this.innerHC=e,this.index=t;const{dimensionLength:n}=this.innerHC.dimensions[0];if(t<0||t>=n)throw new Error("panic: index ".concat(t," out of bounds"))}get dimensions(){return this.innerHC.dimensions.slice(1)}lowLevelGet(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.innerHC.lowLevelGet(this.index,...t)}});function pa(e){return class extends e{get values(){const e=[];for(let t=0;t<this.rowCount;t++)e.push(this.atIndex(t));return e}get rowCount(){return(0,E.m0)(this.dimensions[0],"panic: getting row count from non-dimensional value").dimensionLength}atIndex(e){return 1===this.dimensions.length?this.lowLevelGet(e):new ma(this,e)}getData(){return function(e){if(e.dimensions.some((e=>0===e.dimensionLength)))return[];const t=e.dimensions.map((()=>0));return function n(r,s){if(r.length>0){const[e,...a]=r;return Array.from({length:e.dimensionLength},((e,r)=>(t[s]=r,n(a,s+1))))}return e.lowLevelGet(...t).getData()}(e.dimensions,0)}(this)}}}const da=pa(class{constructor(e){q()(this,"op",void 0),q()(this,"args",void 0),q()(this,"dimensions",void 0),q()(this,"dimensionIds",void 0),this.op=e;for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this.args=n.map(ya);const[s,a]=ga(this.args);this.dimensionIds=s,this.dimensions=a}lowLevelGet(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(this.dimensions.length!==t.length)throw new Error("panic: mismatched dimensions in core lazy operation");const r=this.args.map((e=>{let[n,r]=e;if(F(n)){const e=r.map((e=>{const n=this.dimensionIds.findIndex((t=>t===e));return(0,E.m0)(t[n],"index out of bounds in core lazy operation")}));return n.lowLevelGet(...e)}return n}));return this.op(r)}}),fa=(e,t,n)=>{const r=new da(e,...So(t,n));return r.dimensions.length?r:r.lowLevelGet()},ya=e=>{let[t,n]=e;const r=Array.isArray(n)?n:ua(n).slice(0,-1).map(((e,t)=>{var n;return null!==(n=e.indexedBy)&&void 0!==n?n:t}));return[t,r]},ga=e=>{const t=new Map;for(const[n,r]of e)if(F(n))for(const[e,s]of So(n.dimensions,r))t.has(s)||t.set(s,e);return[[...t.keys()],[...t.values()]]},ha=pa(class{constructor(e){q()(this,"dimensions",void 0),this.dimensions=[{dimensionLength:0},...e]}lowLevelGet(){throw new Error("panic: Attempting to access an empty column")}indexToLabelIndex(){throw new Error("panic: Attempting to get source index on an empty column")}}),ba=pa(class{constructor(e,t){q()(this,"unswappedHC",void 0),q()(this,"dimensions",void 0),q()(this,"dominantDimensionIndex",void 0),this.unswappedHC=e,this.dominantDimensionIndex=t,this.dimensions=ca(this.dominantDimensionIndex,e.dimensions)}lowLevelGet(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.unswappedHC.lowLevelGet(...(r=this.dominantDimensionIndex,s=t,s.flatMap(((e,t)=>0===t?0===r?[e]:[]:t===r?[e,s[0]]:[e]))));var r,s}});function va(e,t){if((0,E.m0)(e,"panic: lowLevelGet called with undefined value"),F(e))return e.lowLevelGet(...t);if(t.length)throw new Error("panic: lowLevelGet called with too many coordinates");return e}const wa=pa(class{constructor(e,t){q()(this,"dimensions",void 0),q()(this,"column1",void 0),q()(this,"column2",void 0);const[n,...r]=e.dimensions,s={dimensionLength:n.dimensionLength+t.dimensions[0].dimensionLength};this.dimensions=[s,...r],this.column1=e,this.column2=t}lowLevelGet(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const[r,...s]=t;return va(r<this.column1.rowCount?this.column1.atIndex(r):this.column2.atIndex(r-this.column1.rowCount),s)}indexToLabelIndex(e){return e<this.column1.rowCount?ts(this.column1,e):ts(this.column2,e-this.column1.rowCount)}});(0,I.MD)();const xa={getData:()=>_};class Na{static fromValue(e){if(e instanceof Date)return ka.fromDateAndSpecificity(e.getTime(),"millisecond");if(e instanceof M.ZP)return $a.fromValue(e);const t=typeof e;return"number"===t||"bigint"===t?$a.fromValue(e):"boolean"===t?Qa.fromValue(e):Ca.fromValue(e)}}class $a{constructor(e){q()(this,"value",void 0);const t=typeof e;this.value="number"===t||"bigint"===t?(0,M.N)(e):e}getData(){return this.value}static fromValue(e){return new $a(e)}}class Ca{constructor(e){q()(this,"value",void 0),this.value=e}static fromValue(e){return new Ca(e)}getData(){return this.value}}class Qa{constructor(e){q()(this,"value",void 0),this.value=e}static fromValue(e){return new Qa(e)}getData(){return this.value}}class ka{constructor(e,t){q()(this,"specificity",void 0),q()(this,"moment",void 0),this.moment=e,this.specificity=t}static fromDateAndSpecificity(e,t){return new ka(ro(e,t),t)}getData(){return this.moment}getEnd(){return Za(this.moment,this.specificity,1n)-1n}getEndDate(){const e=this.getEnd();return new ka(e,this.specificity)}}class Ba{constructor(e){let{start:t,end:n}=e;q()(this,"start",void 0),q()(this,"end",void 0),this.start=t,this.end=n}static fromBounds(e,t){if(e instanceof ka&&t instanceof ka)return new Ba({start:e,end:t.getEndDate()});if(e instanceof $a&&t instanceof $a)return new Ba({start:e,end:t});throw new Error("panic: bad Range.fromBounds arguments ".concat(e.constructor.name," and ").concat(t.constructor.name))}getData(){return[this.start.getData(),this.end.getData()]}}class Sa{constructor(e){q()(this,"_values",void 0),this._values=e}get dimensions(){const e=this.values[0];return F(e)?[{dimensionLength:this.rowCount},...e.dimensions]:[{dimensionLength:this.rowCount}]}lowLevelGet(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return va(this.atIndex(t[0]),t.slice(1))}static fromValues(e,t){if(0===e.length){if(t)return new ha(t);throw new Error("panic: Empty columns are forbidden")}return new Sa(e)}get values(){return this._values}get rowCount(){return this.values.length}atIndex(e){return(0,E.m0)(this.values[e],"index ".concat(e," out of bounds"))}getData(){return this.values.map((e=>e.getData()))}}class Ta extends Sa{constructor(e,t){super(e.values),q()(this,"map",void 0),q()(this,"sourceColumn",void 0),this.sourceColumn=e,this.map=t}get values(){return this.map.map((e=>this._values[e]))}static fromColumnAndMap(e,t){return new Ta(e,t)}get rowCount(){return this.map.length}atIndex(e){return this._values[this.map[e]]}indexToLabelIndex(e){return ts(this.sourceColumn,this.map[e])}}class Ia extends Sa{constructor(e,t){super(e.values),q()(this,"map",void 0),q()(this,"sourceColumn",void 0),this.sourceColumn=e,this.map=t}get values(){const{map:e}=this;let t=-1;return Array.from({length:this.map.filter(Boolean).length},(()=>{for(t+=1;!e[t];)t+=1;return this._values[t]}))}static fromColumnAndMap(e,t){return new Ia(e,t)}get rowCount(){let e=0;for(const t of this.map)e+=Number(t);return e}getSourceIndex(e){let t=-1;for(let n=0;n<this.map.length;n++)if(!0===this.map[n]&&(t++,t===e))return n;throw new Error("panic: index not found: ".concat(e))}atIndex(e){return this._values[this.getSourceIndex(e)]}indexToLabelIndex(e){const t=this.getSourceIndex(e);return ts(this.sourceColumn,t)}}class Ma{constructor(e,t){q()(this,"columns",void 0),q()(this,"columnNames",void 0),this.columns=e,this.columnNames=t}static fromNamedColumns(e,t){return new Ma(e.map((e=>L(e))),t)}get tableRowCount(){var e;return null===(e=this.columns.at(0))||void 0===e?void 0:e.rowCount}static fromMapping(e){const[t,n]=(0,E.Ri)((0,E.VO)(e).entries());return new Ma(n,t)}getColumn(e){const t=this.columnNames.indexOf(e);if(t<0||t>=this.columns.length)throw new U("Missing column ".concat(e));return this.columns[t]}getData(){return this.columns.map((e=>e.getData()))}mapColumns(e){return Ma.fromNamedColumns(this.columns.map(e),this.columnNames)}filterColumns(e){const[t,n]=To(this.columnNames,this.columns,e);return Ma.fromNamedColumns(n,t)}}class Ea{constructor(e,t){q()(this,"cells",void 0),q()(this,"cellNames",void 0),this.cells=e,this.cellNames=t}static fromNamedCells(e,t){return new Ea(e,t)}getCell(e){const t=this.cellNames.indexOf(e);if(t<0||t>=this.cells.length)throw new U("Missing cell ".concat(e));return this.cells[t]}getData(){return this.cells.map((e=>e.getData()))}}const Aa=e=>{if(null==e)throw new TypeError("result cannot be null");return Array.isArray(e)?0===e.length?Sa.fromValues([],[]):Sa.fromValues(e.map((e=>Aa(e)))):Na.fromValue(e)},Da=1e4;function Oa(e,t){if((0,M.V)(e)&&(0,M.V)(t))return(0,M.N)(e).compare((0,M.N)(t));if("string"===typeof e&&"string"===typeof t)return e>t?1:e===t?0:-1;if("number"===typeof e&&"number"===typeof t)return e-t;if("boolean"===typeof e&&"boolean"===typeof t)return Number(e)-Number(t);if("bigint"===typeof e&&"bigint"===typeof t)return e-t;if(e instanceof $a&&t instanceof $a)return e.value.compare(t.value);if(e instanceof Ca&&t instanceof Ca)return e.value===t.value?0:e.value<t.value?-1:1;if(e instanceof Qa&&t instanceof Qa)return(e.value?1:0)-(t.value?1:0);if(e instanceof ka&&t instanceof ka)return e.moment<t.moment?-1:e.moment===t.moment?0:1;if(F(e)&&F(t))return Oa(e.values,t.values);if(Array.isArray(e)&&Array.isArray(t)){const n=e.length-t.length;if(0===n)for(const[r,s]of(0,E.$R)(e,t)){const e=Ra(r,s);if(0!==e)return e}return n}throw console.log(e,t),new U("Don't know how to compare ".concat(e," (").concat(typeof e,") against ").concat(t," (").concat(typeof t,")"))}function Ra(e,t){return"number"===typeof(n=Oa(e,t))?n>0?1:n<0?-1:0:n>0n?1:n<0n?-1:0;var n}const Pa=pa(class{constructor(e,t,n){q()(this,"begin",void 0),q()(this,"end",void 0),q()(this,"sourceColumn",void 0),q()(this,"dimensions",void 0),this.sourceColumn=e,this.begin=t,this.end=n,this.dimensions=[{dimensionLength:this.end-this.begin},...e.dimensions.slice(1)]}static fromColumnAndRange(e,t,n){return new Pa(e,t,n)}lowLevelGet(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const[r,...s]=t;if(r<0||r>this.dimensions[0].dimensionLength)throw new Error("panic: index ".concat(r," out of bounds"));return va(this.sourceColumn,[r+this.begin,...s])}indexToLabelIndex(e){return ts(this.sourceColumn,e+this.begin)}});function _a(e){const t=Array.from({length:e.rowCount},((e,t)=>t));return t.sort(((t,n)=>Ra(e.atIndex(t),e.atIndex(n))))}function Va(e){return Ta.fromColumnAndMap(e,_a(e))}function qa(e){const t=Va(e);return Fa(t,function(e){const t=[];let n,r=0;e.values.forEach(((e,s)=>{n&&0!==Ra(n,e)&&(t.push([r,s-1]),r=s),n=e})),r<=e.rowCount-1&&t.push([r,e.rowCount-1]);return t}(t).map((e=>{let[t]=e;return t})))}function Ua(e){return Ta.fromColumnAndMap(e,function(e){const t=e.rowCount;return Array.from({length:t},((e,n)=>t-n-1))}(e))}function Fa(e,t){return Ta.fromColumnAndMap(e,t)}function La(e,t){return Ia.fromColumnAndMap(e,t)}const Za=(e,t,n)=>{const[r,s]=ko(Ha[t],"bad time unit ".concat(t)),a=ja(e).plus({[r]:Number(BigInt(n)*s)});return BigInt(a.toMillis())};function za(e){if(1!==e.length)throw new U("Cannot construct time quantity from more than one unit of time");const t=(0,O.singular)(e[0].unit);return eo(t)}const ja=e=>{if(e instanceof ka&&(e=e.getData()),"bigint"===typeof e&&(e=Number(e)),e instanceof P.ou)return e.toUTC();if("number"!==typeof e)throw new Error("panic: toLuxon(date) passed an invalid date");return P.ou.fromMillis(e).toUTC()},Ja=["year","month","day","hour","minute","second","millisecond"],Ha={millennium:["year",1000n],century:["year",100n],decade:["year",10n],year:["year",1n],quarter:["month",3n],month:["month",1n],week:["day",7n],day:["day",1n],hour:["hour",1n],minute:["minute",1n],second:["second",1n],millisecond:["millisecond",1n]},Ga=new Set(Object.keys(Ha)),Ka={year:0,month:1,day:2,hour:3,minute:4,second:5,millisecond:6},Wa={millennium:0,century:1,decade:2,year:3,quarter:4,month:5,week:6,day:7,hour:8,minute:9,second:10,millisecond:11},Ya=e=>{var t;const n=(0,O.singular)(null!==(t=e.unit)&&void 0!==t?t:e);if(!Ga.has(n))throw new Error("Expected time unit and got ".concat(n));return n},Xa=e=>{let t="string"===typeof e?e:e&&e.unit;if(t){if(t=(0,O.singular)(t),"millennium"===t)return"year";if("century"===t)return"year";if("decade"===t)return"year";if("quarter"===t)return"month";if("week"===t)return"day";if(Ja.includes(t))return t}throw new Error("panic: Expected Time.JSDateUnit, got ".concat(t))},eo=e=>{if(e in Ha)return e;throw new Error("panic: Expected Time.Unit, got ".concat(e))},to=(e,t)=>{const n=Ja.indexOf(Xa(e)),r=Ja.indexOf(Xa(t));return Math.sign(n-r)},no=e=>ko((e=>Array.from(new Set(e.map((e=>Xa(e))))).sort(((e,t)=>to(e,t))))(e).pop()),ro=(e,t)=>ao(so(e).slice(0,Ka[t]+1)),so=e=>{const t=new Date(Number(e));return[BigInt(t.getUTCFullYear()),BigInt(t.getUTCMonth()+1),BigInt(t.getUTCDate()),BigInt(t.getUTCHours()),BigInt(t.getUTCMinutes()),BigInt(t.getUTCSeconds()),BigInt(t.getUTCMilliseconds())]};function ao(e){const t=[["year",e[0]],["month",e[1]],["day",e[2]],["hour",e[3]],["minute",e[4]],["second",e[5]],["millisecond",e[6]]],n=[];for(const[i,u]of t){const e=(s="month"===i,"string"===typeof(r=u)&&(r=BigInt(r.replace(/^0+/,""))),"bigint"===typeof r?r-(s?1n:0n):null);if(null==e)break;n.push(e)}var r,s;const a=[Number(n[0]),Number(n[1]||0n),...n.slice(2).map(Number)],o=Date.UTC(a[0],a[1],...a.slice(2));return BigInt(o)}const oo=e=>String(e).padStart(2,"0");function io(e,t){const n=so(e);let r=String(n[0]);return"year"===t?r:(r+="-".concat(oo(n[1])),"month"===t?r:(r+="-".concat(oo(n[2])),"day"===t||(r+=" ".concat(oo(n[3]),":").concat(oo(n[4]))),r))}const uo=e=>{let t="year";for(const[n]of function*(e){for(let t=0;t<e.length-1;t+=2)yield[e[t],e[t+1]]}(e))t=n;return t},lo=e=>{return[ao([e[1],e[3],e[5],e[7],e[9],e[11]]),(t=e,Xa(uo(t)))];var t},co=10,mo=15,po=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];t(e,n);for(let r=0;r<e.args.length;r++){const s=e.args[r];ho(s)&&po(s,t,[...n,r])}},fo=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];const r=t(e,n);if(r!==e)return r;for(let s=0;s<e.args.length;s++){const r=e.args[s];if(ho(r)){const a=fo(r,t,[...n,s]);e.args[s]=a}}return e};function yo(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];const s={type:e,args:n};return s}function go(e,t){if(ko(t).type!==e)throw new Error("getOfType: expected ".concat(e,", found ").concat(t.type));return t}const ho=e=>{if(null==e||"object"!==typeof e||Array.isArray(e))return!1;{const t=e;return"string"===typeof t.type&&Array.isArray(t.args)}},bo=new Set(["function-call","ref","external-ref","property-access","literal","column","range","sequence","date","matrix-ref","directive","match","tiered"]),vo=e=>ho(e)&&bo.has(e.type),wo=new Set(["matrix-assign","categories","assign","table","function-definition"]),xo=new Set(["assign","table","matrix-assign","function-definition","table-column-assign"]),No=e=>ho(e)&&xo.has(e.type),$o=new Set(["ref","catdef","def","tabledef","tablepartialdef","funcdef","generic-identifier","funcref","coldef","externalref"]),Co=e=>ho(e)&&$o.has(e.type);const Qo=e=>{!function(e){if(!Co(e))throw new TypeError("panic: identifier expected on node of type ".concat(null===e||void 0===e?void 0:e.type," and arg[0] of type ").concat(typeof(null===e||void 0===e?void 0:e.args[0])))}(e);const{args:t}=e;return t[0]},ko=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"getDefined did not expect null or undefined";if(null==e)throw new Error("panic: ".concat("function"===typeof t?t():t));return e},Bo=(e,t,n)=>{if(e instanceof t)return e;var r,s;throw new Error("panic: ".concat(null!==n&&void 0!==n?n:"getInstanceof expected an instance of ".concat(null!==(r=null===t||void 0===t?void 0:t.name)&&void 0!==r?r:"a specific class"," and got ").concat(null===e||void 0===e||null===(s=e.constructor)||void 0===s?void 0:s.name)))},So=(e,t)=>{if(e.length!==t.length)throw new Error("panic: cannot zip arrays of different lengths");const n=[];for(let r=0;r<e.length;r++){const s=[e[r],t[r]];n.push(s)}return n},To=(e,t,n)=>{if(e.length!==t.length)throw new Error("panic: cannot filter arrays of different lengths");const r=[],s=[];for(let a=0;a<e.length;a++)n(e[a],t[a])&&(r.push(e[a]),s.push(t[a]));return[r,s]};function*Io(e){let t=0;for(const n of e)yield[t,n],t++}function Mo(e,t){return null==e||null==t||e===t}function Eo(e){return e}function Ao(e){const t=e(M.ry).inverse();return e=>e.mul(t)}function Do(e,t){return(Array.isArray(e)?e:[e]).map((e=>function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return"string"===typeof e&&(e={unit:e,exp:(0,M.N)(1),multiplier:(0,M.N)(1),known:!0}),{...e,...t}}(e,t)))}function Oo(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:M.ry;if(!e)return t;let n=t;for(const r of e)n=n.mul(r.multiplier.pow(r.exp));return n}function Ro(e){const t=e.round(mo).valueOf(),n=e.valueOf();return[t,Number.isNaN(n)||!Number.isFinite(n)?t:n]}class Po{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e=>e;q()(this,"globalScope",void 0),q()(this,"functionScope",void 0),q()(this,"temporaryScopes",[]),q()(this,"namespaceJoiner",void 0),q()(this,"namespaceSplitter",void 0),q()(this,"namespaceRetriever",void 0),q()(this,"idMap",new Map),this.globalScope=new Map([["",(0,E.VO)(null!==e&&void 0!==e?e:new Map)]]),this.namespaceJoiner=t,this.namespaceSplitter=n,this.namespaceRetriever=r}getVisibleScopes(){var e=this;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"lexical";return function*(){if("lexical"===t)for(let t=e.temporaryScopes.length-1;t>=0;t--)yield e.temporaryScopes[t];!e.functionScope||"lexical"!==t&&"function"!==t||(yield e.functionScope),yield e.globalScope}()}getAssignmentScope(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"lexical";return"lexical"===e&&this.temporaryScopes.length?this.temporaryScopes[this.temporaryScopes.length-1]:!this.functionScope||"function"!==e&&"lexical"!==e?this.globalScope:this.functionScope}get isInGlobalScope(){return!this.functionScope}isNameGlobal(e){let[t,n]=e,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"lexical";for(const a of this.getVisibleScopes(r)){var s;if(""===t&&a.has(n)||null!==(s=a.get(t))&&void 0!==s&&s.has(n))return a===this.globalScope}return!1}get globalVariables(){const e=new Map;for(const[t,n]of this.globalScope.entries())if(""!==t)e.set(t,this.namespaceJoiner(n,t));else for(const[r,s]of n.entries())e.set(r,s);return e}get namespaces(){return function*(e){for(const[t,n]of e.entries())""!==t&&(yield[t,n])}(this.globalScope)}getNamespace(e,t){for(const n of this.getVisibleScopes(t)){const t=n.get(e);if(t)return t}}getNsNameFromId(e){return this.idMap.get(e)}createNamespace(e){var t;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"lexical";const r=this.getAssignmentScope(n);if(null!==(t=r.get(""))&&void 0!==t&&t.get(e))throw new Error("panic: cannot create the namespace ".concat(e));r.has(e)||r.set(e,new Map)}set(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"lexical",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0;return this.setNamespaced(["",e],t,n,r)}setNamespaced(e,t,n){let r,[s,a]=e,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0;if(""===s&&(r=this.namespaceSplitter(t))){this.createNamespace(a);for(const[e,t]of r)this.setNamespaced([a,e],t,n,o);return}o&&this.isInGlobalScope&&!this.temporaryScopes.length&&this.idMap.set(o,[s,a]);const i=this.getAssignmentScope(n);if(""===s&&i.has(a))throw new Error("panic: assigning a value to an existing namespace ".concat(a));let u=i.get(s);u||i.set(s,u=new Map),u.set(a,t)}setMulti(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"lexical";for(const[n,r]of(0,E.VO)(e).entries())this.set(n,r,t)}has(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"lexical";return this.hasNamespaced(["",e],t)}hasNamespaced(e,t){let[n,r]=e;for(const a of this.getVisibleScopes(t)){var s;if(""===n&&a.has(r))return!0;if(null!==(s=a.get(n))&&void 0!==s&&s.has(r))return!0}return!1}get(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"lexical";return this.getNamespaced(["",e],t)}getNamespaced(e,t){let[n,r]=e;const s=""===n&&this.idMap.get(r);if(s)return this.getNamespaced(s,t);for(const i of this.getVisibleScopes(t)){var a;if(""===n&&i.has(r))return this.namespaceJoiner((0,E.m0)(i.get(r)),r);if(null!==(a=i.get(n))&&void 0!==a&&a.has(r)){var o;let e=(0,E.m0)(null===(o=i.get(n))||void 0===o?void 0:o.get(r));return""!==n&&(e=this.namespaceRetriever(e,(0,E.m0)(this.get(n,t)))),(0,E.m0)(e)}}return null}delete(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"lexical";return this.deleteNamespaced(["",e],t)}deleteNamespaced(e,t){let[n,r]=e;for(const o of this.getVisibleScopes(t)){var s,a;if(""===n&&o.has(r)&&o.delete(r),null!==(s=o.get(n))&&void 0!==s&&s.has(r))return void(null===(a=o.get(n))||void 0===a||a.delete(r))}}async withPush(e){this.temporaryScopes.push(new Map);try{return await e()}finally{(0,E.m0)(this.temporaryScopes.pop())}}async withPushCall(e){const t=this.temporaryScopes,n=this.functionScope;this.temporaryScopes=[],this.functionScope=new Map;try{return await e()}finally{this.temporaryScopes=t,this.functionScope=n}}}const _o=function(){let{initialGlobalScope:e=new Map,externalData:t=new Map,autoGeneratedVarNames:n=new Set}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{stack:new Po(e,Vo,qo,Uo),functionDefinitions:new Map,nodeTypes:new Map,externalData:(0,E.VO)(t),autoGeneratedVarNames:n,usedNames:void 0}},Vo=(e,t)=>W({indexName:t,columnNames:[...e.keys()],columnTypes:[...e.values()]}),qo=e=>{if(e.columnNames&&e.columnTypes)return(0,E.$R)(e.columnNames,e.columnTypes)},Uo=(e,t)=>X(e,void 0,t.indexName),Fo=async(e,t,n)=>{const r=e.previous,s=e.inTableBraces;e.inTableBraces=t;try{return await e.stack.withPush(n)}finally{e.previous=r,e.inTableBraces=s}},Lo=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"lexical";const r="string"===typeof t?["",t]:t,s=""===r[0]?r[1]:r[0];e.usedNames&&e.stack.isNameGlobal(r,n)&&s!==e.inTableBraces&&e.usedNames.push(r)},Zo=(e,t)=>Array.from({length:t},(()=>e)),zo=(e,t)=>{if(null!=t&&t!==e.rowCount)throw new U("Inconsistent table column sizes");return e};async function jo(e,t){let{columnAst:n,tableName:r,columnName:s}=t;e.stack.createNamespace(r,"function");const a=(0,E.m0)(e.stack.getNamespace(r,"function")),o="table-column"===n.type?n.args[1]:n.args[2],i=await Fo(e,r,(async()=>Jo(o,a)?async function(e,t,n){for(const[r,s]of t.entries())e.stack.set(r,s);return Ni(e,n)}(e,a,o):((e,t)=>null==e.columnSize?e:ua(e).some((e=>e.indexedBy===t))?Xr(t,e).reduced():e.reduced())(await Ni(e,o),r)));return wi(e,n,i),i.errorCause||e.stack.setNamespaced([r,s],i,"function",e.statementId),i}function Jo(e,t){let n=!1;return po(e,(e=>{if("ref"===e.type){const r=Qo(e);t.has(r)&&(n=!0)}})),n}const Ho=(e,t,n)=>{const r=e.inferContext.stack.getNamespaced([t,n],"function");return null!=r&&null==r.errorCause},Go=e=>{let t=!1;return po(e,(e=>{vo(e)&&(e=>"function-call"===e.type&&"previous"===Qo(e.args[0]))(e)&&(t=!0)})),t},Ko=async(e,t,n,r,s)=>Jo(n,t)||Go(n)?Wo(e,t,n,null!==s&&void 0!==s?s:1):((e,t,n,r)=>F(t)?ua(e).some((e=>e.indexedBy===n))?zo(es(n,e,t),r):zo(t,r):Sa.fromValues(Zo(t,null!==r&&void 0!==r?r:1)))(e.getTypeAt(n),await Fi(e,n),r,s),Wo=async(e,t,n,r)=>e.stack.withPush((async()=>{const s=await(async(e,t)=>{const n=[],r=e.previousValue;e.previousValue=null;for await(const s of t())n.push(s),e.previousValue=s;return e.previousValue=r,n})(e,(async function*(){for(let s=0;s<r;s++){for(const[n,r]of t)e.stack.set(n,r.atIndex(s));yield Fi(e,n)}}));return Sa.fromValues(s)}));const Yo=(e,t,n)=>{const r=e.compare(t);return 0===r?void 0:n.equals(M.xE)?ae.sequenceStepZero():Math.sign(r)===n.compare(M.xE)?ae.invalidSequenceStep(e.valueOf(),t.valueOf(),n.valueOf()):r>0?Yo(t,e,n.neg()):void 0},Xo=(e,t,n)=>Yo((0,M.N)(e),(0,M.N)(t),(0,M.N)(n)),ei={year:["month",12],hour:["millisecond",36e5],minute:["millisecond",6e4],second:["millisecond",1e3]},ti=(e,t,n,r)=>{t=ka.fromDateAndSpecificity(t,n).getEnd();let[s,a]=Ha[r];if(e>t&&(a=-a),s in ei){const[e,t]=ei[s];s=e,a*=BigInt(t)}switch(s){case"month":{const[n,r]=so(e),[s,o]=so(t);return Xo(0,12n*(s-n)+(o-r),a)}case"day":{const n=Math.round(Number(t-e)/864e5);return Xo(0,n-1,a)}case"millisecond":return Xo(e,t,a);default:throw new Error("panic: unexpected step unit ".concat(s))}},ni=e=>{if("literal"===e.type&&"number"===e.args[0])return e.args[1]},ri=(e,t,n)=>{return e?eo(Qo(go("ref",e))):(0,E.m0)((r=[t,n],Array.from(new Set(r)).sort(((e,t)=>{const n=Ya(e),r=Ya(t);return Math.sign(Wa[n]-Wa[r])}))).pop());var r},si=new Set(["_","previous"]);function ai(e){return si.has(e)}const oi=e=>{var t,n;return null!==(t=null!==(n=e.indexedBy)&&void 0!==n?n:e.indexName)&&void 0!==t?t:null},ii=(e,t,n)=>{const r=e.stack.get(li(t));if(r){if(n&&oi(r)!==n){const t=n?e.stack.get(n):void 0;return re(ae.expectedTableAndAssociatedColumn(t,r))}return r.isColumn()}return re(ae.missingVariable(li(t)))},ui=(e,t)=>{const n=e.stack.get(li(t));if(n){if(F(n))return n;throw new U("Expected column")}throw new U(ae.missingVariable(li(t)))},li=e=>"string"===typeof e?e:Qo(e),ci=(e,t)=>{if("ref"===t.type){const n=Qo(t);return Lo(e,n),[n,null]}{const[e,n]=go("function-call",t).args[1].args;return[Qo(e),n]}},mi=async(e,t,n)=>{const r=(0,E.xF)(n.args),[s,a]=ci(e,r),o=ui(t,s);if(null==a){const{length:e}=o.values;return[e,Array.from({length:e},(()=>!0))]}{const e=(e,t)=>Ra(e.getData(),t.getData());let n=0;const r=await D()(o.values.map((r=>async()=>{const s=0===e(r,await Fi(t,a));return s&&n++,s})));return[n,r]}},pi=async(e,t)=>{const n=(0,E.xF)(t.args),[r,s]=ci(e,n);Lo(e,r);const a=e.stack.get(r);return a?2===oa(a)||oi(a)?null==s?a.reduced().isPrimitive():(await Ni(e,s)).isPrimitive().sameAs(a.reduced()):re(ae.expectedTableAndAssociatedColumn(a,void 0)):re(ae.missingVariable(r))};function di(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.columnSize,r=arguments.length>3?arguments[3]:void 0,s=t;return s=null!=t.cellType?t.reduced():t,r&&(s=s.sameAs(r.reduced())),X(s,(0,E.m0)(n),oi(e))}async function fi(e,t){const[n,r]=t.args,s=Qo(n),a=(0,E.xF)(r.args),[o,i]=ci(e.inferContext,a),u=ui(e,null==i?o:s),l=await async function(e,t,n){const[,r,s]=t.args,[a,o]=await mi(e.inferContext,e,r),i=await Fi(e,s);let u=()=>i;if(F(i)){if(i.values.length!==a)throw new U(new ae("Mismatched column sizes"));let e=0;u=()=>i.atIndex(e++)}return Sa.fromValues(n.values.map(((e,t)=>o[t]?u():e)))}(e,t,u);return e.stack.set(s,l,"function",e.statementId),l}const yi=new Set;async function gi(e,t){const n=Qo(t.args[0]),r=go("argument-list",t.args[1]).args,s=await D()(r.map((t=>()=>Ni(e,t))));if(((e,t)=>{e.usedNames&&e.functionDefinitions.has(t)&&e.usedNames.push(["",t])})(e,n),"previous"===n)return s[0];const a=e.functionDefinitions.get(n);if(null==a)return ku(e,n,s,r);if(yi.has(n))return re(ae.formulaCannotCallItself(n));try{return yi.add(n),await(async(e,t,n)=>e.stack.withPushCall((async()=>{const[r,s,a]=t.args;if(n.length!==s.args.length){const e=ae.expectedArgCount(Qo(r),s.args.length,n.length);return re(e)}for(const[t,i]of So(s.args,n))e.stack.set(Qo(t),i);let o;for(const t of a.args)o=await Ci(e,t);return ko(o,"panic: function did not return")})))(e,a,s)}finally{yi.delete(n)}}const hi=async(e,t)=>{const[n,r]=t.args,s=(await Ni(e,n)).isScalar("boolean");return s.errorCause?s:Ni(e,r)},bi=new Set(["rest","max","min"]),vi=async(e,t,n)=>t.stack.withPush((async()=>{var r;t.stack.set("tier",e),t.stack.set("slice",e);const[s,a]=n.args;let o;var i;"ref"===(i=s).type&&bi.has(Qo(i))||(o=(await Ni(t,s)).isScalar("number").sameAs(e));const u=await Ni(t,a);return null!==(r=o)&&void 0!==r&&r.errorCause?o:u})),wi=(e,t,n)=>(e.nodeTypes.set(t,n),null!=n.errorCause&&null==n.node?n.inNode(t):n),xi=e=>async(t,n,r)=>{let s=await e(t,n);return r&&(s=s.sameAs(r)),wi(t,n,s)},Ni=xi((async(e,t)=>{switch(t.type){case"noop":return te();case"ref":{const n=Qo(t);if(ai(n))return e.previousStatement&&ra(e.previousStatement)||re(ae.noPreviousStatement());const r=Eu(n);if(r)return r.type;const s=e.stack.get(n);return s?(Lo(e,n),s):e.autoGeneratedVarNames.has(n)?re(new ae({errType:"unknown-reference"}),t):z([is(n)])}case"externalref":{const[n]=t.args,r=e.externalData.get(n);return r?ra(r.type):re(new ae({errType:"unknown-reference"}),t)}case"literal":{const[e]=t.args;return"number"===e?z(null,t.args[2]):r[e]()}case"range":{const[n,r]=await D()(t.args.map((t=>()=>Ni(e,ko(t)))));return js.combine(n,r).mapType((()=>{const e=null!=n.date?n.sameAs(r):n.isScalar("number").sameAs(r);return H(e)}))}case"sequence":return(async(e,t,n)=>{const[r,s,a]=t.args,o=await n(e,r),i=await n(e,s),u=o.sameAs(i);if(null!=u.errorCause)return u;if("date"===r.type&&"date"===s.type){const[e,t]=lo(r.args),[n]=lo(s.args),o=Xa(t);let i,u;try{i=ri(a,uo(r.args),uo(s.args)),u=Xa(i)}catch{return re("Invalid increment clause in date sequence")}if(to(u,o)<0)return re("An increment clause of ".concat(i," is too broad"));const l=ti(e,n,o,i);return l?re(l):X(G(u))}{const e=o.isScalar("number");if(e.errorCause)return e;const t=ni(r),n=ni(s);if(t&&n){const e=a?ni(a):t.compare(n)<0?M.ry:(0,M.N)(-1n);if(e){const r=Yo(t,n,e);return r instanceof ae?re(r):X(u,r)}}return X(u,"unknown")}})(e,t,Ni);case"date":{const[,e]=lo(t.args);return G(e)}case"column":{const[n,r]=t.args;if(0===n.args.length)return re(ae.unexpectedEmptyColumn());const[s,...a]=n.args,o=await Ni(e,s),i=await D()(a.map((t=>()=>Ni(e,t,o)))),u=[o,...i].find((e=>null!=e.errorCause));if(null!=u)return u;for(const e of i)if(!ps(o.reducedToLowest().unit,e.reducedToLowest().unit))return re(ae.columnContainsInconsistentType(o,e));return X(o,n.args.length,null===r||void 0===r?void 0:r.args[0])}case"property-access":{const[n,r]=t.args,s=(await Ni(e,n)).isTableOrRow(),a="ref"===n.type?n.args[0]:s.indexName,o=(t,n)=>{const o=t.indexOf(r);if(o<0)return[re("A column named ".concat(r," does not exist in ").concat(a)),o];const i=s.indexName||s.rowIndexName;return i&&Lo(e,[i,r]),[n[o],o]};if(s.errorCause)return s;if(null!=s.columnNames&&null!=s.columnTypes){const[e,t]=o(s.columnNames,s.columnTypes);return X(e,"unknown",s.indexName,t)}{const{rowCellNames:e,rowCellTypes:t}=s,[n]=o(ko(e),ko(t));return n}}case"matrix-ref":return async function(e,t){const{args:[n,r]}=t,s=ii(e,Qo(n)),a=await pi(e,r);return js.combine(s,a).mapType((()=>(0,I.ZP)(s,(e=>{e.columnSize="unknown"}))))}(e,t);case"function-call":return gi(e,t);case"directive":return Ii(e,t);case"match":return(async(e,t)=>{if(t.args.length<1)return te();let n;for(const r of t.args){const t=await hi(e,r);if(n=n?n.sameAs(t):t,n.errorCause)return n}return(0,E.m0)(n)})(e,t);case"tiered":return(async(e,t)=>{const[n,...r]=t.args,s=(await Ni(e,n)).isScalar("number");return r.length?(await Promise.all(r.map((t=>vi(s,e,t))))).reduce(((e,t)=>e.sameAs(t))):re("tiered definitions are empty")})(e,t)}})),$i=xi((async(e,t)=>{switch(t.type){case"assign":{const[n,r]=t.args,s=Qo(n),a=Eu(s)||e.stack.has(s,"function")?re(ae.duplicatedName(s)):await Ni(e,r);return e.stack.set(s,a,"function",e.statementId),a}case"table":return(async(e,t)=>{if(!e.stack.isInGlobalScope)return re(ae.forbiddenInsideFunction("table"));const n=Qo(t.args[0]);if(e.stack.has(n,"function"))return re(ae.duplicatedName(n));if(t.args.some((e=>"table-spread"===e.type))){const t=re(ae.retiredFeature("table-spread"));return e.stack.set(n,t,"function",e.statementId),t}return Fo(e,n,(async()=>{e.stack.createNamespace(n,"function");for(const r of t.args.slice(1)){if("table-column"!==r.type)throw new Error("panic: unreachable");await jo(e,{tableName:n,columnAst:r,columnName:Qo(r.args[0])})}return(0,E.m0)(e.stack.get(n,"function"))}))})(e,t);case"table-column-assign":return(async(e,t)=>{var n;if(!e.stack.isInGlobalScope)return re(ae.forbiddenInsideFunction("table"));const[r,s]=t.args,a=Qo(r),o=Qo(s),i=null===(n=e.stack.get(a))||void 0===n?void 0:n.isTable();if(null==i||null!==i&&void 0!==i&&i.errorCause)return null!==i&&void 0!==i?i:re(ae.missingVariable(a));if(e.stack.hasNamespaced([a,o],"function"))return re(ae.duplicateTableColumn(o));const u=ko(i.columnNames).length,l=await jo(e,{columnAst:t,tableName:a,columnName:o});return l.errorCause?l:X(l,"unknown",a,u)})(e,t);case"matrix-assign":return async function(e,t){const{args:[n,r,s]}=t,a=Qo(n),o=await pi(e,r),i=await Ni(e,s),u=(0,E.xF)(r.args),[l,c]=ci(e,u),m=null==c?ii(e,l):ii(e,a,l);let p;return p=null==c?js.combine(o,m).mapType((e=>di(e,i))):js.combine(m,o,i).mapType((()=>di(m,i,"unknown",m))).mapType((e=>m.sameAs(e))),e.stack.set(a,p,"function",e.statementId),p}(e,t);case"categories":return(async(e,t)=>{if(!e.stack.isInGlobalScope)return re(ae.forbiddenInsideFunction("category"));const[n,r]=t.args,s=Qo(n),a=await Ni(e,r),o=a.isColumn().reduced().isPrimitive().mapType((t=>e.stack.has(s)?re(ae.duplicatedName(s)):X(t,(0,E.m0)(a.columnSize),s)));return e.stack.set(s,o,"function",e.statementId),o})(e,t);case"function-definition":return function(e,t){const[n,r]=t.args,s=Qo(n);return e.functionDefinitions.set(s,t),ee(s,r.args.length)}(e,t);default:return Ni(e,t)}})),Ci=async function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const[r]=t,{usedNames:s}=r;if(null==s)return $i(...t);r.usedNames=[...s];const a=await $i(...t);return a.errorCause&&(r.usedNames=s),a};function Qi(e){return e?e.reduce(((e,t)=>{if(null!=t.aliasFor){const n=(0,E.m0)(Qi(t.aliasFor));for(const t of n)e.push((0,I.ZP)(t,(e=>{e.enforceMultiplier=!0})))}else e.push(t);return e}),[]):null}const ki={getType:async(e,t)=>{let{args:[,n,r]}=t;const s=await Ni(e,n);if(s.errorCause)return s;if(Bi(r))return Hr([s.isScalar("number")],(()=>z(null,"percentage")));const a=(await Ni(e,r)).isScalar("number");if(a.errorCause)return a;const{unit:o}=a.reducedToLowest();let i=o;"ref"===r.type&&o&&function(e,t){if("ref"!==e.type)return!1;const n=[is(Qo(e))];return!ms(n,t)}(r,o)&&(i=Do(Qo(r),{known:!1,aliasFor:o}));const u=Hr([s],(e=>{let[t]=e;const n=t.unit;return n&&0!==n.length&&o&&!Vr(n,o)?Vr(n,o,{tolerateImprecision:!0})?z(i,void 0,"month-day-conversion"):re(ae.cannotConvertBetweenUnits(n,o)):z(i)}));return u},getValue:async(e,t)=>{const[,n,r]=t.args,s=e.getTypeAt(n),a=await Fi(e,n),o=Qi(s.reducedToLowest().unit);if(Bi(r))return Gr([s],[a],((e,t)=>{let[n]=e,[r]=t;const s=Js(Bo(n,$a).value,r.unit);return $a.fromValue(s)}));const i=await Fi(e,r),u=Bo(i.getData(),M.ZP,"units needs to be a number"),l=function(e){return(e||[]).reduce(((e,t)=>t.enforceMultiplier?e.mul(t.multiplier.pow(t.exp)):e),(0,M.N)(1))}(Qi(e.getTypeAt(t).unit)),c=Qi(e.getTypeAt(r).unit),m=function(e){return(e||[]).reduce(((e,t)=>e.mul(t.multiplier.pow(t.exp))),(0,M.N)(1))}(c),p=u.div(m).mul(l);return Gr([s],[a],(e=>{let[t]=e;if(t instanceof $a){if(!c||!o||o.length<1)return Aa(t.getData().div(p));const e=Fr(t.getData(),o,c,{tolerateImprecision:!0});return Aa(e.div(p))}throw c?ae.cannotConvertToUnit(c):new U("Don't know how to convert value to ".concat(t.getData().toString()))}))}};function Bi(e){return"generic-identifier"===e.type}const Si={getType:async(e,t)=>{let{args:[,n,r]}=t;const s=await Ni(e,n);return s.errorCause?s:Hr([s],(e=>{let[t]=e;return t.isScalar("number").mapType((e=>e.unit&&1===e.unit.length?(0,I.ZP)(e,(e=>{e.unit&&(e.unit[0]=(0,I.ZP)(e.unit[0],(e=>{e.quality=Qo(r)})))})):re(ae.needOneAndOnlyOneUnit())))}))},getValue:(e,t)=>{let{args:[,n]}=t;return Fi(e,n)}},Ti={as:ki,over:{async getType(e,t){const[,n,r]=t.args;return Xr(Qo(r),await Ni(e,n))},async getValue(e,t){const[,n,r]=t.args,s=await Fi(e,n),a=e.getTypeAt(n);return es(Qo(r),a,L(s))}},select:{getType:async()=>re(ae.retiredFeature("select")),async getValue(){throw new Error("unreachable")}},of:Si},Ii=(e,t)=>Ti[t.args[0]].getType(e,t),Mi=async(e,t)=>{const[n,r]=t.args;if((await Fi(e,n)).getData())return Fi(e,r)},Ei=(e,t,n)=>t&&n?Fr(e,t,n):e,Ai=e=>{const[t,n]=e.args,r=(e=>{const t="ref"===e.type&&Qo(e);if(t&&bi.has(t))return t})(t);return r?[r,n]:[t,n]},Di=async(e,t,n,r)=>{const s=ko(e.inferContext.nodeTypes.get(t)),a=$a.fromValue(n),o=await e.stack.withPush((async()=>(e.stack.set("tier",a),e.stack.set("slice",a),Fi(e,t))));return Ei(Bo(o.getData(),M.ZP),s.unit,r.unit)},Oi=async(e,t,n,r,s,a,o)=>{const[i,u]=r,l=ko(e.inferContext.nodeTypes.get(i)),c=Ei(Bo((await Fi(e,i)).getData(),M.ZP),l.unit,t.unit),m=c.sub(o);if(m.compare(M.xE)<0)throw new U("Error on tier definition number ".concat(s,". Each tier level needs to be bigger than the previous one"));const p=(0,M.VV)(a,m);return{tierResult:await Di(e,u,p,n),slice:p,tierCutOff:c}},Ri=async(e,t)=>{const[n,...r]=t.args,s=Bo((await Fi(e,n)).getData(),M.ZP),a=ko(e.inferContext.nodeTypes.get(n)),o=ko(e.inferContext.nodeTypes.get(t)),{predicates:i,tiers:u}=(e=>{const t={},n=[];for(const r of e){const[e,s]=Ai(r);"string"===typeof e?t[e]=s:n.push([e,s])}return{predicates:t,tiers:n}})(r);let l=s,c=M.xE,m=M.xE,p=0;for(;l.compare(M.xE)>0&&u.length;){p+=1;const t=u.shift();if(t){const{slice:n,tierResult:r,tierCutOff:s}=await Oi(e,a,o,t,p,l,m);c=c.add(r),l=l.sub(n),m=s}}if(l.compare(M.xE)>0){const{rest:t}=i;if(t){const n=await Di(e,t,l,o);c=c.add(n)}}if(i.min){const t=ko(e.inferContext.nodeTypes.get(i.min)),n=Ei(Bo((await Fi(e,i.min)).getData(),M.ZP),t.unit,o.unit);c=(0,M.Fp)(c,n)}if(i.max){const t=ko(e.inferContext.nodeTypes.get(i.max)),n=Ei(Bo((await Fi(e,i.max)).getData(),M.ZP),t.unit,o.unit);c=(0,M.VV)(c,n)}return $a.fromValue(c)};function Pi(e,t){const n=(n,r)=>{if(n)return!0;throw _i(e,t),new Error(r)},r=n=>{if(Array.isArray(n))return n;throw _i(e,t),new Error("panic: expected array")};switch(e.kind){case"number":return n(t instanceof M.ZP,"panic: expected fraction");case"boolean":case"string":return n(typeof t===e.kind,"panic: expected ".concat(e.kind));case"date":return n(Xa(e.date)===e.date,"invalid date specificity ".concat(e.date))&&n("bigint"===typeof t||t instanceof M.ZP,"expected date to be represented as a bigint");case"range":{const s=r(t);n(2===s.length,"panic: expected range to be represented by an array of 2");const a=function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),s=1;s<n;s++)r[s-1]=arguments[s];if(r.includes(e.kind))return e;throw _i(e,t),new Error("panic: wanted ".concat(r.join("/")," and got ").concat(e.kind))}(e.rangeOf,"date","number");return Pi(a,s[0])&&Pi(a,s[1])}case"column":return r(t).every((t=>Pi(e.cellType,t)));case"table":return(0,E.x8)(e.columnTypes,r(t)).every((e=>{let[t,n]=e;if(t){Pi({kind:"column",cellType:t,columnSize:"unknown",indexedBy:null},n)}}));case"row":return(0,E.$R)(e.rowCellTypes,r(t)).every((e=>{let[t,n]=e;return Pi(t,n)}));case"nothing":case"function":return n(null==t||t===_,"expected no value")}return!0}const _i=(e,t)=>{console.error("Failed to validate a Result:"),console.error({type:e,value:t})};function Vi(e,t){e instanceof js&&(e=na(e));try{return Pi(e,t)}catch(n){throw _i(e,t),n}}const qi=e=>{const{type:t,value:n}=e;switch(t.kind){case"type-error":case"nothing":case"function":case"anything":return xa;case"table":{const e=n,r=t,s=r.columnTypes.map(((t,n)=>qi({type:{kind:"column",indexedBy:r.columnNames[0],cellType:t,columnSize:"unknown"},value:e[n]})));return Ma.fromNamedColumns(s,r.columnNames)}case"column":{const e=n;if(null==e)return Sa.fromValues([Aa(0)]);const r=t;return Sa.fromValues(e.map((e=>qi({type:r.cellType,value:e}))))}case"number":return Na.fromValue((0,M.N)(n));case"date":{let e=n;return"bigint"!==typeof e&&(e=BigInt(e)),Na.fromValue(e)}case"boolean":return Na.fromValue(n);case"string":return Na.fromValue(n.toString());case"range":const e=n,[r,s]=e.map(Na.fromValue);return Ba.fromBounds(r,s);case"row":const a=n,o=t;return Ea.fromNamedCells(a.map(((e,t)=>qi({type:o.rowCellTypes[t],value:e}))),o.rowCellNames)}};function Ui(e,t){Vi(e,t);return{value:t,type:na(e)}}async function Fi(e,t){switch(t.type){case"noop":return xa;case"literal":switch(t.args[0]){case"number":{const n=e.maybeGetTypeAt(t);return n&&n.unit?Na.fromValue(Oo(n.unit,t.args[1])):Na.fromValue(t.args[1])}case"string":case"boolean":return Na.fromValue(t.args[1]);default:throw new Error("not implemented: literals with type ".concat(t.args[0]))}case"assign":{const n=Qo(t.args[0]),r=await Fi(e,t.args[1]);return e.stack.set(n,r,"function",e.statementId),r}case"ref":{const n=Qo(t);if(ai(n)){if(null==e.previousStatementValue)throw new U("No previous value");return e.previousStatementValue}const r=Eu(n);if(r)return r.value;const s=e.stack.get(n);if(null!=s)return s;const a=e.getTypeAt(t),o=ko(a.unit,"no unit for ".concat(n,", which probably means that ").concat(n," is not a number"));return Na.fromValue(Oo(o))}case"externalref":{const n=e.externalData.get(t.args[0]);return n?qi(n):xa}case"function-call":{const r=Qo(t.args[0]),s=go("argument-list",t.args[1]).args,a=await D()(s.map((t=>()=>Fi(e,t))));var n;if("previous"===r)return null!==(n=e.previousValue)&&void 0!==n?n:a[0];if(e.functions.has(r)){const t=ko(e.functions.get(r));return e.stack.withPushCall((async()=>{for(let r=0;r<a.length;r++){const n=Qo(t.args[1].args[r]);e.stack.set(n,a[r])}const n=t.args[2];for(let t=0;t<n.args.length;t++){const r=await Fi(e,n.args[t]);if(t===n.args.length-1)return r}throw new Error("function is empty")}))}{const n=s.map((t=>ko(e.inferContext.nodeTypes.get(t),(()=>"Could not get type for node ".concat(Nl(t)))))),o=ko(e.inferContext.nodeTypes.get(t));return Iu(e,r,a,n,o)}}case"range":{const[n,r]=await D()(t.args.map((t=>()=>Fi(e,ko(t)))));return Ba.fromBounds(n,r)}case"sequence":{const n=await Fi(e,ko(t.args[0])),r=await Fi(e,ko(t.args[1]));if(n instanceof ka&&r instanceof ka){const e=uo(go("date",t.args[0]).args),s=uo(go("date",t.args[1]).args);return function(e,t,n){let r=e.getData(),s=t.getData();s>=r?s=t.getEnd():r=e.getEnd();const a=Xa(n),o=[],i=(e,t,n)=>e<t?n<=t:n>=t,u=1*(r<s?1:-1);let l=0;for(let c=r;i(r,s,c);c=Za(c,n,BigInt(u))){if(++l>Da)throw new U("A maximum number of ".concat(Da," has been reached in sequence. Check for an unbounded sequence in your code."));o.push(ka.fromDateAndSpecificity(c,a))}return Sa.fromValues(o)}(n,r,ri(t.args[2],e,s))}return function(e,t,n){const[r,s]=[e,t].map((e=>e.getData())),a=n?n.getData():r.compare(s)<0?(0,M.N)(1):(0,M.N)(-1),o=[],i=(e,t,n)=>e.compare(t)<0?n.compare(t)<=0:n.compare(t)>=0;let u=0;for(let l=r;i(r,s,l);l=l.add(a)){if(++u>Da)throw new U("A maximum number of ".concat(Da," has been reached in sequence. Check for an unbounded sequence in your code."));o.push(Na.fromValue(l))}return Sa.fromValues(o)}(n,r,t.args[2]?await Fi(e,t.args[2]):void 0)}case"date":{const[e,n]=lo(t.args);return ka.fromDateAndSpecificity(e,n)}case"column":{const n=await D()(t.args[0].args.map((t=>()=>Fi(e,t))));return Sa.fromValues(n)}case"table":return(async(e,t)=>{const n=new Map,{args:[r,...s]}=t,a=Qo(r),o=(0,E.m0)(e.getTypeAt(t).indexName);let i;return e.stack.createNamespace(a,"function"),e.stack.withPush((async()=>{const t=(t,r)=>{var s;null!==(s=i)&&void 0!==s||(i=r.rowCount),n.set(t,r),e.stack.setNamespaced([a,t],r,"function",e.statementId)};for(const r of s){if("table-column"!==r.type)throw"table-spread"===r.type?new Error("unreachable retired feature"):new Error("panic: unreachable");{const[s,u]=r.args,l=Qo(s);if(!Ho(e,a,l))continue;t(l,await Ko(e,n,u,o,i))}}return Bo((0,E.m0)(e.stack.get(a,"function")),Ma)}))})(e,t);case"property-access":{const n=await Fi(e,t.args[0]);return r=n,s=t.args[1],r instanceof Ea?r.getCell(s):Bo(r,Ma).getColumn(s)}case"table-column-assign":return async function(e,t){const[n,r,s]=t.args,a=Qo(n),o=Qo(r);if(!Ho(e,a,o))return xa;const i=Bo(ko(e.stack.get(a)),Ma),u=new Map((0,E.$R)(i.columnNames,i.columns)),l=await Ko(e,u,s,a,i.tableRowCount);return e.stack.setNamespaced([a,o],l,"function",e.statementId),ko(e.stack.getNamespaced([a,o],"function"))}(e,t);case"matrix-assign":return fi(e,t);case"matrix-ref":return async function(e,t){const{args:[n,r]}=t,s=ui(e,Qo(n)),[,a]=await mi(e.inferContext,e,r);return La(s,a)}(e,t);case"categories":return(async(e,t)=>{const[n,r]=t.args,s=Qo(n),a=await Fi(e,r),o=L(a);return e.stack.set(s,o,"function",e.statementId),o})(e,t);case"function-definition":{const n=Qo(ko(t.args[0]));return e.functions.set(n,t),xa}case"directive":return((e,t)=>Ti[t.args[0]].getValue(e,t))(e,t);case"match":return(async(e,t)=>{for(const n of t.args){const t=await Mi(e,n);if(null!=t)return t}throw new U("None of the match condition were true. At least one of the conditions must be true.")})(e,t);case"tiered":return Ri(e,t)}var r,s}async function Li(e,t){return await Fi(e,t)}class Zi{get externalData(){return this.inferContext.externalData}set externalData(e){this.inferContext.externalData=e}maybeGetTypeAt(e){return this.inferContext.nodeTypes.get(e)}getTypeAt(e){return ko(this.maybeGetTypeAt(e),"Could not find type for ".concat(e.type))}constructor(e){q()(this,"stack",new Po(void 0,zi,ji)),q()(this,"functions",new Map),q()(this,"previousValue",null),q()(this,"inferContext",void 0),q()(this,"previousStatementValue",void 0),q()(this,"statementId",void 0),this.inferContext=e}}const zi=e=>{for(const t of e.values())if(!F(t))throw new Error("expected column-like");return Ma.fromMapping(e)},ji=e=>{if(e instanceof Ma)return(0,E.$R)(e.columnNames,e.columns)};const Ji=e=>{const{expectedArgs:t,returnType:n}=(e=>{const t=ta(e),n=[ea(t)];for(;"comma"===(null===(r=t.token())||void 0===r?void 0:r.type);){var r;t.next(),n.push(ea(t))}t.ensure("arrow");const s=ea(t);return t.assertAllConsumed(),{expectedArgs:n,returnType:s}})(e);return e=>Ks({args:e,expectedArgs:t,returnType:n})},Hi=(e,t,n,r)=>{const s=new Map(n.map((e=>[Gi(e.argTypes),e])));return{argCount:t,fnValues:(t,n)=>function(t){const n=t.map(Ki);return ko(s.get(Gi(n)),"panic: did not find version of function ".concat(e," for arg types ").concat(n.join(", ")))}(t).fnValues(t,n),functor:t=>{const n=t.map(Wi),r=s.get(Gi(n));if(null==r)return re(ae.badOverloadedBuiltinCall(e,t));var a;return(null!==(a=r.functor)&&void 0!==a?a:Ji(r.functionSignature))(t)},operatorKind:r}},Gi=e=>e.join(";"),Ki=e=>e instanceof Ca?"string":e instanceof Qa?"boolean":e instanceof $a?"number":e instanceof ka?"date":e instanceof Ba?"range":null,Wi=e=>null!=e.type?e.type:null!=e.date?"date":e.rangeOf?"range":null,Yi=(e,t,n)=>{const r=Za(e.getData(),t,n);return ka.fromDateAndSpecificity(r,e.specificity)},Xi=e=>{let[t,n]=e;return js.combine(t.isDate(),n.isTimeQuantity()).mapType((()=>{const e=ko(t.date),r=no(ko(n.unit));return to(e,r)<0?re(ae.mismatchedSpecificity(e,r)):t}))},eu={"+":[{argTypes:["date","number"],fnValues:function(e){let[t,n]=e,[,r]=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return Yi(Bo(t,ka),za(ko(null===r||void 0===r?void 0:r.unit)),BigInt(Bo(n,$a).getData().valueOf()))},functor:e=>{let[t,n]=e;return js.combine(n.isTimeQuantity(),(()=>Xi([t,n])))}},{argTypes:["number","date"],fnValues:function(e){let[t,n]=e,[r]=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return Yi(Bo(n,ka),za(ko(null===r||void 0===r?void 0:r.unit)),BigInt(Bo(t,$a).getData().valueOf()))},functor:e=>{let[t,n]=e;return js.combine(t.isTimeQuantity(),(()=>Xi([n,t])))}}],"-":[{argTypes:["date","number"],fnValues:function(e){let[t,n]=e,[,r]=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];const s=Bo(n,$a),a=BigInt(s.getData().neg().valueOf());return Yi(Bo(t,ka),za(ko(null===r||void 0===r?void 0:r.unit)),a)},functor:Xi},{argTypes:["date","date"],fnValues:e=>{let[t,n]=e;const r=Bo(t,ka),s=((e,t,n)=>{const r=ja(e.getData()),s=ja(t.getData());switch(n){case"year":return(0,M.N)(12*r.diff(s,"years").years);case"month":return(0,M.N)(r.diff(s,"months").months);default:return(0,M.N)(r.diff(s,"milliseconds").milliseconds,1000n)}})(r,Bo(n,ka),r.specificity);return $a.fromValue(s)},functor:e=>{let[t,n]=e;const r=ko(t.date),s=ko(n.date);return 0!==to(r,s)?re(ae.mismatchedSpecificity(r,s)):js.combine(t.isDate(),n.isDate(),z([{unit:r,exp:(0,M.N)(1),multiplier:(0,M.N)(1),known:!0}]))}}]};function tu(e,t){switch(t.type){case"literal":if("number"===t.args[0])return $a.fromValue(t.args[1]);throw ae.expectedButGot("number",t.args[0]);case"function-call":{const n=Qo(t.args[0]),r=go("argument-list",t.args[1]).args,s=r.map((t=>tu(e,t))),a=r.map((t=>ko(e.inferContext.nodeTypes.get(t),"exponent type should be defined"))),o=ko(e.inferContext.nodeTypes.get(t)),i=Iu(e,n,s,a,o);if(!(i instanceof $a))throw ae.complexExpressionExponent();return i}default:throw ae.complexExpressionExponent()}}const nu=e=>{let[t,n]=e;return js.combine(t.isScalar("number"),n.sameAs(t))},ru=(0,I.ZP)((e=>{"number"===e.type&&(e.unit=null)})),su=e=>{let[t,n=z()]=e;return js.combine(n.isScalar("number"),t.isScalar("number"))},au=e=>function(t){let[n,r]=t,[s]=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];const a=Bo(n,M.ZP),o=Oo(s.unit),i=r?Bo(r,M.ZP):M.xE;return e(a.div(o),i.valueOf()).mul(o)},ou=e=>{let[t]=e;return t.reduced()},iu=e=>Bo(e,M.ZP),uu=e=>null==(null===e||void 0===e?void 0:e[0].numberFormat)&&"percentage"===(null===e||void 0===e?void 0:e[1].numberFormat),lu={abs:{argCount:1,noAutoconvert:!0,fn:e=>{let[t]=e;return Math.abs(t)},functionSignature:"number:R -> R"},round:{argCount:[1,2],noAutoconvert:!0,functor:su,fn:au(((e,t)=>e.round(t)))},roundup:{argCount:[1,2],noAutoconvert:!0,functor:su,fn:au(((e,t)=>e.ceil(t)))},ceil:{aliasFor:"roundup"},rounddown:{argCount:[1,2],noAutoconvert:!0,functor:su,fn:au(((e,t)=>e.floor(t)))},floor:{aliasFor:"rounddown"},max:{argCount:1,argCardinalities:[2],isReducer:!0,functor:ou,fnValues:e=>{let t,[n]=e;if(!F(n))return n;for(let r=0;r<n.rowCount;r+=1){const e=n.atIndex(r);t?Ra(e,t)>0&&(t=e):t=e}if(null==t)throw new U("max: no elements");return t}},min:{argCount:1,argCardinalities:[2],isReducer:!0,functor:ou,fnValues:e=>{let t,[n]=e;if(!F(n))return n;for(let r=0;r<n.rowCount;r+=1){const e=n.atIndex(r);t?Ra(e,t)<0&&(t=e):t=e}if(null==t)throw new U("min: no elements");return t}},average:{argCount:1,argCardinalities:[2],isReducer:!0,fnValues:e=>{let[t]=e;const n=t.getData().map(iu);if(0===n.length)throw new U("average needs at least one element");return Aa(n.reduce(((e,t)=>e.add(t)),M.xE).div((0,M.N)(n.length)))},functionSignature:"column<R> -> R"},avg:{aliasFor:"average"},mean:{aliasFor:"average"},averageif:{argCount:2,noAutoconvert:!0,argCardinalities:[2,2],fnValues:e=>{let[t,n]=e;const r=t.getData(),s=n.getData();if(0===r.length)throw new U("average: cannot compute average on zero elements");let a=M.xE,o=(0,M.N)(0);for(const[i,u]of(0,E.$R)(s,r))i&&(a=a.add(M.ry),o=o.add(u));return Aa(o.div(a))},functor:e=>{let[t,n]=e;return js.combine(n.reduced().isScalar("boolean"),t.reduced().isScalar("number"))}},avgif:{aliasFor:"averageif"},meanif:{aliasFor:"averageif"},median:{argCount:1,argCardinalities:[2],isReducer:!0,fnValues:e=>{let[t]=e;const n=t.getData().map(iu);if(0===n.length)throw new U("median needs at least one element");const r=n.sort(((e,t)=>e.compare(t))),{length:s}=r,a=Math.floor(s/2),o=r[a];if(s%2===1)return Aa(o);const i=r[a-1];return Aa(i.add(o).div(M.gE))},functionSignature:"column<R> -> R"},sqrt:{argCount:1,fn:e=>{let t,[n]=e;try{t=Bo(n,M.ZP).pow((0,M.N)(1,2))}catch(r){console.error(r)}if(null==t){const e=n.valueOf()**.5;if(Number.isNaN(e))throw new U("square root of ".concat(n.toString()," is not a number"));t=(0,M.N)(e)}return t},functor:e=>{let[t]=e;return js.combine(t.isScalar("number"),t.divideUnit(2))}},ln:{argCount:1,noAutoconvert:!0,fn:e=>{let[t]=e;return Math.log(t)},functionSignature:"number:R -> R"},factorial:{argCount:1,fnValues:(()=>{const e=Array(1e5);return t=>{let[n]=t;const r=Bo(n.getData(),M.ZP);if(r.compare(M.xE)<0)throw new U("factorial() requires a positive number or zero");if(r.compare((0,M.N)(1e5))>0)throw new U("factorial() number too large");if(r.compare(M.gE)<0)return new $a(M.ry);if(r.valueOf()!==Math.round(r.valueOf()))throw new U("factorial() number not an integer");if(e[r.valueOf()])return new $a((0,M.N)(e[r.valueOf()]));let s=BigInt(r.valueOf()-1),a=BigInt(r.valueOf());for(;s>=1;s--)a*=s;return e[r.valueOf()]=a,new $a((0,M.N)(a))}})(),functor:e=>{let[t]=e;return t}},"+":Hi("+",2,[{argTypes:["number","number"],fnValues:(e,t)=>{let[n,r]=e;return uu(t)?Na.fromValue(n.getData().mul(r.getData().add(M.ry))):Na.fromValue(n.getData().add(r.getData()))},functor:nu},{argTypes:["string","string"],fnValues:e=>{let[t,n]=e;return Na.fromValue(String(t.getData())+String(n.getData()))},functor:e=>{let[t,n]=e;return js.combine(t.isScalar("string"),n.isScalar("string"))}},...eu["+"]],"infix"),"-":Hi("-",2,[{argTypes:["number","number"],fnValues:(e,t)=>{let[n,r]=e;return uu(t)?Na.fromValue(n.getData().mul(M.ry.sub(r.getData()))):Na.fromValue(n.getData().sub(r.getData()))},functor:nu},...eu["-"]],"infix"),"unary-":{argCount:1,noAutoconvert:!0,fn:e=>{let[t]=e;return t.neg()},functionSignature:"number:R -> R",operatorKind:"prefix"},"*":{argCount:2,fn:e=>{let[t,n]=e;return Bo(t,M.ZP).mul(n)},functor:e=>{let[t,n]=e;return js.combine(t.isScalar("number"),n.isScalar("number"),t.sharePercentage(n).multiplyUnit(n.unit))},operatorKind:"infix"},"implicit*":{aliasFor:"*",operatorKind:"prefix"},for:{aliasFor:"*",operatorKind:"prefix"},"/":{argCount:2,fn:e=>{let[t,n]=e;return Bo(t,M.ZP).div(n)},functor:e=>{let[t,n]=e;return js.combine(t.isScalar("number"),n.isScalar("number"),t.sharePercentage(n).divideUnit(n.unit))},operatorKind:"infix"},per:{aliasFor:"/",operatorKind:"infix"},mod:{argCount:2,fn:e=>{let[t,n]=e;return t.mod(n)},functor:nu,operatorKind:"infix"},modulo:{aliasFor:"mod",operatorKind:"infix"},"**":{argCount:2,fn:e=>{let[t,n]=e;return Bo(t,M.ZP).pow(n)},noAutoconvert:!0,absoluteNumberInput:!0,functor:(e,t,n)=>{let[r,s]=e;const a=(0,E.m0)(null===t||void 0===t?void 0:t[1]),o=(0,E.m0)(n,"context should be defined");let i;if(r.unit&&r.unit.length>0){const e=new Zi(o);try{i=tu(e,a).getData()}catch(u){if(u instanceof ae)return re(u);throw u}return nu([r,ru(s)]).mapType((0,I.ZP)((e=>{for(const n of null!==(t=e.unit)&&void 0!==t?t:[]){var t;n.exp=(n.exp||(0,M.N)(1)).mul(i)}})))}return nu([r,ru(s)])},operatorKind:"infix"},"^":{aliasFor:"**"},smooth:{argCount:2,fn:()=>69,functor:()=>z()}},cu=e=>{let[t,n]=e;return"boolean"===t.type?re(ae.expectedButGot("number",t)):js.combine(n.sameAs(t),J())},mu={"<":{argCount:2,fn:e=>{let[t,n]=e;return Ra(t,n)<0},functor:cu,operatorKind:"infix"},">":{argCount:2,fn:e=>{let[t,n]=e;return Ra(t,n)>0},functor:cu,operatorKind:"infix"},"<=":{argCount:2,fn:e=>{let[t,n]=e;return Ra(t,n)<=0},functor:cu,operatorKind:"infix"},">=":{argCount:2,fn:e=>{let[t,n]=e;return Ra(t,n)>=0},functor:cu,operatorKind:"infix"}},pu=(e,t)=>"boolean"===typeof e&&"boolean"===typeof t?e===t:0===Ra(e,t),du={"==":{argCount:2,fn:e=>{let[t,n]=e;return pu(t,n)},functionSignature:"A, A -> boolean",operatorKind:"infix"},"!=":{argCount:2,fn:e=>{let[t,n]=e;return!pu(t,n)},functionSignature:"A, A -> boolean",operatorKind:"infix"}},fu={len:{argCount:1,isReducer:!0,noAutoconvert:!0,argCardinalities:[2],fnValues:e=>{let[t]=e;return Aa(L(t).rowCount)},functionSignature:"column<A> -> number"},cat:{argCount:2,argCardinalities:[2,2],fnValues:e=>{let[t,n]=e;return new wa(L(t),L(n))},functor:e=>{let[t,n]=e;return js.combine(t.reduced().sameAs(n.reduced())).mapType((()=>{const e="unknown"===t.columnSize||"unknown"===n.columnSize?"unknown":(t.columnSize||1)+(n.columnSize||1);return X(t.reduced(),e)}))}},first:{argCount:1,argCardinalities:[2],isReducer:!0,fnValues:e=>{let[t]=e;return L(t).atIndex(0)},functionSignature:"column<A> -> A"},last:{argCount:1,argCardinalities:[2],isReducer:!0,fnValues:e=>{let[t]=e;const n=L(t);return n.atIndex(n.rowCount-1)},functionSignature:"column<A> -> A"},count:{aliasFor:"len"},countif:{argCount:1,argCardinalities:[2],isReducer:!0,fnValues:e=>{let[t]=e;const n=L(t).getData();return Aa(n.reduce(((e,t)=>t.valueOf()?e+1:e),0))},functionSignature:"column<boolean> -> number"},stepgrowth:{argCount:1,argCardinalities:[2],fn:e=>{let[t]=e;return t.map(((e,n)=>{var r;return e-(null!==(r=t[n-1])&&void 0!==r?r:0)}))},functionSignature:"column<number>:A -> A"},grow:{argCount:3,argCardinalities:[1,1,2],fn:e=>{let[t,n,{length:r}]=e;return Array.from({length:r},((e,r)=>t*(1+n)**r))},functor:e=>{let[t,n,r]=e;return js.combine(t.isScalar("number"),n.isScalar("number"),r.isColumn()).mapType((()=>X(t,(0,E.m0)(r.columnSize))))}},transpose:{argCount:1,argCardinalities:[3],fnValues:e=>{let[t]=e;return new ba(L(t),1)},functor:e=>{let[t]=e;return js.combine(t.isColumn().reduced().isColumn().reduced()).mapType((e=>{const n=(0,E.m0)(t.columnSize),r=(0,E.m0)(t.reduced().columnSize);return X(X(e,n),r)}))}},sort:{argCount:1,argCardinalities:[2],fnValues:e=>{let[t]=e;return Va(L(t))},functionSignature:"column<A>:R -> R"},unique:{argCount:1,argCardinalities:[2],fnValues:e=>{let[t]=e;return qa(L(t))},functionSignature:"column<A> -> column<A>"},reverse:{argCount:1,functorNoAutomap:e=>{let[t]=e;return js.either(t.isColumn(),t.isTable())},fnValuesNoAutomap:e=>{let[t]=e;return t instanceof Ma?t.mapColumns((e=>Ua(e))):Ua(L(t))}},approximatesubsetsum:{argCount:3,fnValues:e=>{let[t,n,r]=e;const s=Bo(n,Ma),{columnNames:a}=s,o=a.indexOf(r.getData());if(o<0)throw new U("Column ".concat(r," does not exist"));const i=((e,t,n)=>{let r=[{value:0,rows:[]}];for(let s=0;s<t[n].length;s++){const a=[...r,...r.map((e=>{let{value:r,rows:a}=e;return{value:r+t[n][s],rows:[...a,s]}}))].sort(((e,t)=>{let{value:n}=e,{value:r}=t;return n-r}));r=[];let o=a[0];r.push(o);for(const t of a)o.value+.01<t.value&&(0,M.N)(e).compare((0,M.N)(t.value))>=0&&(o=t,r.push(t))}return r.slice(-1)[0].rows})(t.getData(),s.getData(),o);return s.mapColumns((e=>Sa.fromValues(e.values.filter(((e,t)=>i.includes(t))),[])))},functor:e=>{let[t,n,r]=e;return js.combine(t.isScalar("number"),n.isTable(),r.isScalar("string")).mapType((()=>W({columnNames:(0,E.m0)(n.columnNames),columnTypes:(0,E.m0)(n.columnTypes)})))}}},yu={total:{noAutoconvert:!0,argCount:1,argCardinalities:[2],isReducer:!0,fn:e=>{let[t]=e;return t.reduce(((e,t)=>e.add(t)),M.xE)},functionSignature:"column<number:R> -> R"},sum:{aliasFor:"total"},sumif:{argCount:2,noAutoconvert:!0,argCardinalities:[2,2],fnValues:e=>{let[t,n]=e;const r=t.getData(),s=n.getData();return Aa(r.reduce(((e,t,n)=>s[n]?e.add(t):e),M.xE))},functionSignature:"column<number:R>, column<boolean> -> R"}},gu={lookup:{argCount:2,functorNoAutomap:e=>{let[t,n]=e;const r=n.isColumn().reduced().isScalar("boolean");return null!=t.cellType?t.isColumn().reduced():(e=>e.isTable().withMinimumColumnCount(1).mapType((e=>{const t=(0,E.m0)(e.columnTypes),s=(0,E.m0)(e.columnNames);return js.either(r,t[0].sameAs(n)).mapType((()=>Y(t,s,e.indexName)))})))(t)},fnValuesNoAutomap:function(e){let[t,n]=e,[r]=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],s=arguments.length>2?arguments[2]:void 0;const a=e=>{const t=n.getData();return e.columns[0].values.findIndex((e=>0===Ra(e.getData(),t)))};if(F(t)){const e=a(Bo((0,E.m0)(s).stack.get((0,E.m0)(r.indexedBy),"global"),Ma));if(-1===e)throw new U("Could not find a row with the given condition");return t.atIndex(e)}const o=Bo(t,Ma);let i;if(i=F(n)?n.getData().findIndex(Boolean):a(o),-1===i)throw new U("Could not find a row with the given condition");return Ea.fromNamedCells(o.columns.map((e=>e.atIndex(i))),o.columnNames)}},concatenate:{argCount:2,functor:e=>{let[t,n]=e;return js.combine(t.isTable(),n.isTable()).mapType((()=>(0,se.J)(t.columnNames,n.columnNames)&&(0,se.J)(t.columnTypes,n.columnTypes)?t:re("Incompatible tables")))},fnValues:e=>{let[t,n]=e;const{columns:r,columnNames:s}=Bo(t,Ma),{columns:a}=Bo(n,Ma);return Ma.fromNamedColumns(So(r,a).map((e=>{let[t,n]=e;return new wa(t,n)})),(0,E.m0)(s))}},sortby:{argCount:2,argCardinalities:[1,2],functor:e=>{let[t,n]=e;return js.combine(n.isColumn().withAtParentIndex(),t.isTable())},fnValues:e=>{let[t,n]=e;const r=_a(L(n));return Bo(t,Ma).mapColumns((e=>Fa(e,r)))}},filter:{argCount:2,functorNoAutomap:e=>{let[t,n]=e;return js.combine(n.isColumn().reduced().isScalar("boolean"),t.isTable(),(0,I.ZP)((e=>{e.indexName=null})))},fnValuesNoAutomap:e=>{let[t,n]=e;const r=L(n).getData();return Bo(t,Ma).mapColumns((e=>La(e,r)))}},grab:{aliasFor:"filter"}},hu={splitby:{argCount:2,hidden:!0,functor:()=>re(ae.retiredFeature("splitby")),fnValuesNoAutomap:()=>{throw new Error("unreachable")}}},bu={if:{argCount:3,fnValues:e=>{let[t,n,r]=e;return t.getData()?n:r},functor:e=>{let[t,n,r]=e;return js.combine(t.isScalar("boolean"),r.sameAs(n))}},contains:Hi("contains",2,[{argTypes:["range","number"],fnValues:e=>{let[t,n]=e;const[r,s]=t.getData(),a=n.getData();return Aa(Ra(a,r)>=0&&Ra(a,s)<=0)},functor:e=>{let[t,n]=e;return js.combine(t.isRange(),n.isScalar("number").sameAs(t.getRangeOf()),J())}},{argTypes:["date","date"],fnValues:e=>{let[t,n]=e;const r=Bo(t,ka),s=Bo(n,ka);return Aa(r.getData()<=s.getData()&&r.getEnd()>=s.getEnd())},functor:e=>{let[t,n]=e;return js.combine(t.isDate(),n.isDate(),J())}},{argTypes:["range","date"],fnValues:e=>{let[t,n]=e;const{start:r,end:s}=Bo(t,Ba),a=Bo(r,ka),o=Bo(s,ka),i=Bo(n,ka);return Aa(a.getData()<=i.getData()&&o.getData()>=i.getEnd())},functor:e=>{let[t,n]=e;return js.combine(t.isRange(),n.isDate(),J())}}])},vu={assert:{argCount:1,fn:e=>{let[t]=e;if(!t)throw new U("User defined pre-condition was not met");return!0},functionSignature:"boolean -> boolean"}};var wu=n(20548);const xu=(0,wu.IHq)((()=>z([{unit:"radian",exp:(0,M.N)(1),multiplier:(0,M.N)(1),known:!0}]))),Nu=e=>{let[t]=e;return t.isScalar("number").sameAs(xu()).mapType((()=>z()))},$u=e=>{let[t]=e;return t.isScalar("number").mapType((()=>xu()))},Cu={...lu,...mu,...du,"!":{argCount:1,fn:e=>{let[t]=e;return!t},functionSignature:"boolean -> boolean",operatorKind:"prefix"},not:{aliasFor:"!"},"&&":{argCount:2,fn:e=>{let[t,n]=e;return t&&n},functionSignature:"boolean, boolean -> boolean",operatorKind:"infix"},and:{aliasFor:"&&"},"||":{argCount:2,fn:e=>{let[t,n]=e;return t||n},functionSignature:"boolean, boolean -> boolean",operatorKind:"infix"},or:{aliasFor:"||"},...fu,...yu,...gu,...hu,...bu,...vu,...{sin:{argCount:1,autoConvertArgs:!0,fn:e=>{let[t]=e;return Math.sin((0,M.N)(t).valueOf())},functor:Nu},asin:{argCount:1,autoConvertArgs:!0,fn:e=>{let[t]=e;return Math.asin((0,M.N)(t).valueOf())},functor:$u},cos:{argCount:1,autoConvertArgs:!0,fn:e=>{let[t]=e;return Math.cos((0,M.N)(t).valueOf())},functor:Nu},acos:{argCount:1,autoConvertArgs:!0,fn:e=>{let[t]=e;return Math.acos((0,M.N)(t).valueOf())},functor:$u},tan:{argCount:1,autoConvertArgs:!0,fn:e=>{let[t]=e;return Math.tan((0,M.N)(t).valueOf())},functor:Nu},atan:{argCount:1,autoConvertArgs:!0,fn:e=>{let[t]=e;return Math.atan((0,M.N)(t).valueOf())},functor:$u}}};function Qu(e){const t=Cu[function(e){return e.toLowerCase()}(e)];return null!==t&&void 0!==t&&t.aliasFor?Qu(t.aliasFor):null!==t&&void 0!==t?t:null}const ku=(e,t,n,r)=>{const s=n.find(Bu);if(s)return s;const a=Qu(t);if(null==a)return re(ae.missingFormula(t));{let{argCount:s=[]}=a;if("number"===typeof s&&(s=[s]),s.indexOf(n.length)<0)return re("The function ".concat(t," requires ").concat(a.argCount," parameters and ").concat(n.length," parameters were entered"));if(a.isReducer){const t=Su(a),s=(0,E.xF)(n,"panic: isReducer used in a function with multiple arguments");return Wr(s,(n=>t(n,r,e)))}return null!=a.functorNoAutomap?a.functorNoAutomap(n,r,e):Hr(n,(t=>{let[n,...s]=t;return js.combine(n,...s).mapType((()=>Su(a)([n,...s],r,e)))}),a.argCardinalities)}};function Bu(e){return null!=e.errorCause}const Su=e=>{if(e.functor)return e.functor;if(e.functionSignature)return Ji(e.functionSignature);throw new Error("must either specify a functor or a functionSignature")};const Tu=["autoConvertArguments","builtin","autoConvertResult"];function Iu(e,t,n,r,s){const a=ko(Qu(t),"panic: builtin not found: ".concat(t));let o=0;try{const i=!!a.autoConvertArgs||!a.noAutoconvert&&function(e){if(1===e.length)return!1;if(2===e.length){const[t,n]=e.map((e=>e.reducedToLowest()));if(t.unit&&!n.unit||n.unit&&!t.unit)return!1}return!0}(r);let u=i?rs(n,r):n;a.absoluteNumberInput&&!s.unit&&(u=u.map(((e,t)=>{const n=r[t];if("number"===n.type){const t=e.getData();if(t instanceof M.ZP)return Aa(Js(t,n.unit))}return e}))),o+=1;const l=function(e,t,n,r,s){if(n.fnValuesNoAutomap)return n.fnValuesNoAutomap(r,s,e);const a=(r,s)=>{if(null==n.fn){if(null!=n.fnValues)return n.fnValues(r,s,e);throw new Error("unreachable")}{const e=r.map((e=>ko(e.getData())));try{return Aa(n.fn(e,s))}catch(a){if(a instanceof U)throw a;throw console.error(a),new TypeError("Error calling builtin ".concat(t,": ").concat(a.message))}}};if(n.isReducer){const e=(0,E.xF)(s,"panic: isReducer used in a function with multiple arguments"),t=(0,E.xF)(r,"panic: isReducer used in a function with multiple arguments");return Yr(e,t,a)}return Gr(s,r,a,n.argCardinalities)}(e,t,a,u,r);return o+=1,i?function(e,t){const n=t.reducedToLowest();if(n.unit){const[,r]=Mr((0,E.m0)(n.unit));return Gr([t],[e],(e=>{let[t]=e;return t instanceof $a?$a.fromValue(r(t.value)):t}))}return e}(l,s):l}catch(i){throw"undefined"===typeof jest&&console.error("Error at stage ".concat(Tu[o]),i),new U((null===i||void 0===i?void 0:i.message)||"Unknown error")}}const Mu=(0,wu.IHq)((()=>{const e={type:z(),value:Aa((0,M.N)(0xb29430a256d21,10**15))};return{e:{type:z(),value:Aa((0,M.N)(0x9a8434ec8e225,10**15))},pi:e,"\u03c0":e}})),Eu=e=>Mu()[e.toLowerCase()],Au={leftParen:"Paren",leftSquareBracket:"SquareBracket",leftCurlyBracket:"CurlyBracket","if keyword":"PartialIf"},Du={rightParen:"Paren",rightSquareBracket:"SquareBracket",rightCurlyBracket:"CurlyBracket","else keyword":"PartialIf"};class Ou{constructor(){q()(this,"openStack",[]),q()(this,"validationError",void 0)}get isValid(){return!this.validationError}feed(e){if(null===e||void 0===e||!e.type||!this.isValid)return;const t=Au[e.type],n=Du[e.type];if(t&&this.openStack.push(e),n){var r;const t=this.openStack.pop(),s=Au[null!==(r=null===t||void 0===t?void 0:t.type)&&void 0!==r?r:""];t?s!==n&&(this.validationError={type:"mismatched-brackets",open:t,close:e}):this.validationError={type:"never-opened",close:e}}}noBrackets(){return!this.isValid||0===this.openStack.length}finalize(){this.isValid&&this.openStack.length&&(this.validationError={type:"never-closed",open:(0,E.m0)(this.openStack.pop())})}}const Ru=Ys().keywords(Object.fromEntries(["if","then","else","true","false","and","in","is","by","date","through","fetch","categories","mod","modulo"].map((e=>["".concat(e," keyword"),e])))),Pu=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"u";return new RegExp(e,t)},_u=Pu("[\\p{L}\\p{Sc}\\p{Emoji_Presentation}_\u03bc\xb0][\\p{L}\\p{Nd}\\p{Sc}\\p{Emoji_Presentation}_\u03bc\xb0]*"),Vu=(Pu(_u.source,"".concat(_u.flags,"g")),{main:{ws:{match:Pu("[ \\t\\n\\v\\f]+"),lineBreaks:!0},notEquals:"!=",equals:"==",lessThanOrEquals:"<=",greaterThanOrEquals:">=",arrow:"=>",twoStars:"**",threeDots:"...",threeDotsEllipsis:"\u2026",twoDots:"..",dot:".",bang:"!",percent:"%",permille:"\u2030",permyriad:"\u2031",leftParen:"(",rightParen:")",leftSquareBracket:"[",rightSquareBracket:"]",leftCurlyBracket:"{",rightCurlyBracket:"}",minus:Pu("-"),plus:"+",times:"*",caret:"^",slash:"/",lessThan:"<",greaterThan:">",colon:":",comma:",",equalSign:"=",andSign:"&&",orSign:"||",beginDate:{match:Pu("date *\\("),push:"date"},numberWithScientificNotation:{match:Pu("[0-9]+(?:[ _]*[0-9]+)*(?:\\.[0-9]+)?(?:e|E)-?[0-9]+"),value:e=>e.replace(/[_ ]+/g,"")},number:{match:Pu("[0-9]+(?:[ _]*[0-9]+)*(?:\\.[0-9]+)?"),value:e=>e.replace(/[_ ]+/g,"")},currency:["r$","R$","$","\xa3","\u20ac"],identifier:{match:_u,type:Ru},string:{match:Pu('"(?:\\\\["bfnrt/\\\\]|\\\\u[a-fA-F0-9]{4}|[^\n"\\\\])*"'),value:e=>JSON.parse(e)},error:Ws.error},date:{digits:Pu("[0-9]+"),punc:Pu("[T.:/+-]"),ws:Pu("[ \\t]+"),monthName:Pu("[a-zA-Z]+"),endDate:{match:Pu("\\)"),pop:1},error:Ws.error}}),qu=Ys().states(Vu),Uu=(()=>{let e,t,n=new Ou;return Object.assign(Object.create(qu),{next(){const r=(()=>{if(e){const t=e;return e=void 0,t}return qu.next()})();return n.feed(r),r&&(e=>{let{tok:t,prevTok:n,nextTok:r,openCounter:s}=e;const{type:a,text:o}=t;var i;return!("ws"!==a||!o.includes("\n")||!s.noBrackets())&&!["then keyword","else keyword"].includes(null!==(i=null===r||void 0===r?void 0:r.type)&&void 0!==i?i:"")&&"arrow"!==(null===n||void 0===n?void 0:n.type)})({tok:r,prevTok:this.prev(),nextTok:this.peek(),openCounter:n})?(n=new Ou,t=Object.assign(Object.create(r),{type:"statementSep"})):t=r,t},peek:()=>e||(e=qu.next(),e),prev:()=>t,reset(t,r){return n=new Ou,qu.reset(t,r),e=void 0,this}})})();function Fu(e){return e[0]}const Lu=new Set(["in","as","to","of","by","contains","where","given","per","set","categories","true","false","for","if","then","else","through","select","range","date","and","not","or","with","when","over","smooth"]),Zu=(new Set(["Jan","January","Feb","February","Mar","March","Apr","April","May","Jun","June","Jul","July","Aug","August","Sep","September","Oct","October","Nov","November","Dec","December"]),new Set(["millennium","millenniums","millennia","century","centuries","decade","decades","year","years","quarter","quarters","month","months","weeks","week","day","days","hour","hours","minute","minutes","second","seconds","millisecond","milliseconds"]),new Set(Lu));const zu=e=>null!=e.offset?e.offset:e.start,ju=e=>null!=e.offset?e.offset+e.text.length-1:e.end;Symbol("no end token was passed");function Ju(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t;if(e.start=zu(t),e.end=ju(n),"number"!==typeof e.start||"number"!==typeof e.end)throw new Error("Bad start or end at "+JSON.stringify(e,null,2)+"\n\n-- given: "+JSON.stringify({start:t,end:n},null,2));return e}function Hu(e){const t=e[0]&&zu(e[0]),n=e[e.length-1]&&ju(e[e.length-1]);if(null!=n&&null!=t)return[t,n];let r=null,s=null;return function e(t){if(null!=t)if(Array.isArray(t))for(const n of t)e(n);else(e=>{if(null!=e){const t=zu(e),n=ju(e);null!=t&&null!=n&&(null==r&&(r=t),s=n)}})(t)}(e),[r,s]}function Gu(e,t){const[n,r]=Hu(t);if(e.start=n,e.end=r,"number"!==typeof e.start||"number"!==typeof e.end)throw new Error("Bad start or end at "+JSON.stringify(e,null,2)+"\n\n-- given: "+JSON.stringify({start:n,end:r},null,2));return e}function Ku(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;const r=(0,M.N)(t),s={type:"literal",args:n?["number",r,n]:["number",r]};return Array.isArray(e)?Gu(s,e):Ju(s,e)}const Wu=e=>()=>({month:e}),Yu=e=>{let t=e.args;return e.nextDateInner&&(t=t.concat(Yu(e.nextDateInner))),e.timezone&&(t=t.concat(e.timezone)),t},Xu=(e,t,n,r)=>(s,a,o)=>{let[{text:i}]=s;try{const s=BigInt(i);return i.length!==t||s<n||s>r?o:{[e]:s}}catch(u){return o}},el=(e,t,n)=>{const r=e[0],s=e[2]||e[1];if("function-call"===s.type){const e=s.args[0];if("funcref"===e.type){if("unary-"===e.args[0])return n}}return Gu({type:"function-call",args:[Gu({type:"funcref",args:["implicit*"]},e),Gu({type:"argument-list",args:[r,s]},e)]},e)},tl=e=>{e[2];return Gu({type:"function-call",args:[Ju({type:"funcref",args:["unary-"]},e[0]),Ju({type:"argument-list",args:[e[2]]},e[2])]},e)};function nl(e){let[t,n,r,s,a]=e;return Ju({type:"function-call",args:[Ju({type:"funcref",args:[r.name]},r),Ju({type:"argument-list",args:[t,a]},t,a)]},t,a)}function rl(e){const t=e[0][0];return Ju({name:t.value},t)}let sl=Uu,al=[{name:"_$ebnf$1",symbols:[Uu.has("ws")?{type:"ws"}:ws],postprocess:Fu},{name:"_$ebnf$1",symbols:[],postprocess:function(e){return null}},{name:"_",symbols:["_$ebnf$1"],postprocess:Fu},{name:"__",symbols:[Uu.has("ws")?{type:"ws"}:ws],postprocess:Fu},{name:"__n",symbols:[Uu.has("ws")?{type:"ws"}:ws],postprocess:(e,t,n)=>e[0].value.includes("\n")?e[0]:n},{name:"assign",symbols:["assignTarget","equalSign","expression"],postprocess:e=>Gu({type:"assign",args:[e[0],e[2]]},e)},{name:"assignTarget",symbols:["identifier"],postprocess:e=>Ju({type:"def",args:[e[0].name]},e[0])},{name:"columnAssign",symbols:["identifier","_",{literal:"."},"_","identifier","equalSign","expression"],postprocess:e=>Gu({type:"table-column-assign",args:[Ju({type:"tablepartialdef",args:[e[0].name]},e[0]),Ju({type:"coldef",args:[e[4].name]},e[4]),e[6]]},e)},{name:"categories",symbols:["identifier","equalSign",{literal:"categories"},"_","expression"],postprocess:e=>Gu({type:"categories",args:[Ju({type:"catdef",args:[e[0].name]},e[0]),e[4]]},e)},{name:"matrixMatchers$ebnf$1",symbols:[{literal:","}],postprocess:Fu},{name:"matrixMatchers$ebnf$1",symbols:[],postprocess:function(e){return null}},{name:"matrixMatchers",symbols:[{literal:"["},"_","matrixMatchersInner","_","matrixMatchers$ebnf$1","_",{literal:"]"}],postprocess:e=>Gu({type:"matrix-matchers",args:[...e[2]]},e)},{name:"matrixMatchersInner",symbols:["matcherExp"],postprocess:e=>[e[0]]},{name:"matrixMatchersInner$subexpression$1",symbols:["_",{literal:","},"_"]},{name:"matrixMatchersInner",symbols:["matrixMatchersInner","matrixMatchersInner$subexpression$1","matcherExp"],postprocess:e=>{let[t,n,r]=e;return[...t,r]}},{name:"matrixAssign",symbols:["assignTarget","_","matrixMatchers","equalSign","expression"],postprocess:e=>Gu({type:"matrix-assign",args:[e[0],e[2],e[4]]},e)},{name:"matrixRef",symbols:["ref","matrixMatchers"],postprocess:e=>Gu({type:"matrix-ref",args:[e[0],e[1]]},e)},{name:"matcherExp",symbols:["ref"],postprocess:Fu},{name:"matcherExp",symbols:["ref","_",{literal:"=="},"_","expression"],postprocess:e=>Gu({type:"function-call",args:[Gu({type:"funcref",args:["=="]},e),Gu({type:"argument-list",args:[e[0],e[4]]},e)]},e)},{name:"literal",symbols:["boolean"],postprocess:Fu},{name:"literal",symbols:["string"],postprocess:Fu},{name:"literal",symbols:["number"],postprocess:Fu},{name:"literal",symbols:["percentage"],postprocess:Fu},{name:"literal",symbols:["permille"],postprocess:Fu},{name:"literal",symbols:["permyriad"],postprocess:Fu},{name:"literal",symbols:["column"],postprocess:Fu},{name:"literal",symbols:["date"],postprocess:Fu},{name:"literal",symbols:["range"],postprocess:Fu},{name:"literal",symbols:["sequence"],postprocess:Fu},{name:"boolean",symbols:[{literal:"true"}],postprocess:e=>Ju({type:"literal",args:["boolean",!0]},e[0])},{name:"boolean",symbols:[{literal:"false"}],postprocess:e=>Ju({type:"literal",args:["boolean",!1]},e[0])},{name:"number",symbols:["negPosNumber"],postprocess:Fu},{name:"number",symbols:[Uu.has("numberWithScientificNotation")?{type:"numberWithScientificNotation"}:numberWithScientificNotation],postprocess:e=>{const[t,n]=e[0].text.split(/e|E/);return Ku(e,(0,M.N)(t).mul((0,M.N)(10).pow((0,M.N)(n))))}},{name:"number",symbols:[{literal:"-"},Uu.has("numberWithScientificNotation")?{type:"numberWithScientificNotation"}:numberWithScientificNotation],postprocess:e=>{const[t,n]=e[1].text.split(/e|E/);return Ku(e,(0,M.N)(t).mul((0,M.N)(10).pow((0,M.N)(n))).neg())}},{name:"number",symbols:["currency","negPosNumber"],postprocess:e=>{const[t,n]=e;return Gu({type:"function-call",args:[Gu({type:"funcref",args:["implicit*"]},e),Gu({type:"argument-list",args:[t,n]},e)]},e)}},{name:"number",symbols:["negPosNumber","currency"],postprocess:e=>{const[t,n]=e;return Gu({type:"function-call",args:[Gu({type:"funcref",args:["implicit*"]},e),Gu({type:"argument-list",args:e},e)]},e)}},{name:"negPosNumber",symbols:["unsignedNumber"],postprocess:e=>Ku(e,e[0].n)},{name:"negPosNumber",symbols:[{literal:"-"},"unsignedNumber"],postprocess:e=>Ku(e,(0,M.N)(e[1].n).neg())},{name:"percentage",symbols:[{literal:"-"},"decimal","_",{literal:"%"}],postprocess:e=>{const t=(0,M.N)(e[1].n.neg()).div((0,M.N)(100));return Ku(e,t,"percentage")}},{name:"percentage",symbols:["decimal","_",{literal:"%"}],postprocess:e=>Ku(e,(0,M.N)(e[0].n).div((0,M.N)(100)),"percentage")},{name:"permille",symbols:[{literal:"-"},"decimal",{literal:"\u2030"}],postprocess:e=>Ku(e,(0,M.N)(e[1].n.neg()).div((0,M.N)(1e3)))},{name:"permille",symbols:["decimal",{literal:"\u2030"}],postprocess:e=>Ku(e,(0,M.N)(e[0].n).div((0,M.N)(1e3)))},{name:"permyriad",symbols:[{literal:"-"},"decimal",{literal:"\u2031"}],postprocess:e=>Ku(e,(0,M.N)(e[1].n.neg()).div((0,M.N)(1e4)))},{name:"permyriad",symbols:["decimal",{literal:"\u2031"}],postprocess:e=>Ku(e,(0,M.N)(e[0].n).div((0,M.N)(1e4)))},{name:"unsignedNumber",symbols:[Uu.has("number")?{type:"number"}:number],postprocess:e=>{let[t]=e;return Ju({n:t.value},t)}},{name:"int",symbols:[Uu.has("number")?{type:"number"}:number],postprocess:(e,t,n)=>{let[r]=e;return Ju({n:BigInt(r.value)},r)}},{name:"int",symbols:[{literal:"-"},"int"],postprocess:e=>Gu({n:-e[1].n},e)},{name:"decimal",symbols:[Uu.has("number")?{type:"number"}:number],postprocess:(e,t,n)=>{let[r]=e;return Ju({n:(0,M.N)(r.value)},r)}},{name:"string",symbols:[Uu.has("string")?{type:"string"}:string],postprocess:e=>{let[t]=e;return Ju({type:"literal",args:["string",t.value]},t)}},{name:"date",symbols:[Uu.has("beginDate")?{type:"beginDate"}:beginDate,"_","dateInner","_",Uu.has("endDate")?{type:"endDate"}:endDate],postprocess:e=>Ju({type:"date",args:Yu(e[2])},e[0],e[4])},{name:"dateInner$ebnf$1",symbols:["dateInnerMonth"],postprocess:Fu},{name:"dateInner$ebnf$1",symbols:[],postprocess:function(e){return null}},{name:"dateInner",symbols:["dateYear","dateInner$ebnf$1"],postprocess:e=>({type:"date",args:["year",e[0].year],nextDateInner:e[1]})},{name:"dateInnerMonth$ebnf$1",symbols:["dateInnerDay"],postprocess:Fu},{name:"dateInnerMonth$ebnf$1",symbols:[],postprocess:function(e){return null}},{name:"dateInnerMonth",symbols:["dateSeparator","dateMonth","dateInnerMonth$ebnf$1"],postprocess:e=>({type:"date",args:["month",e[1].month],nextDateInner:e[2]})},{name:"dateInnerDay$ebnf$1",symbols:["dateInnerHour"],postprocess:Fu},{name:"dateInnerDay$ebnf$1",symbols:[],postprocess:function(e){return null}},{name:"dateInnerDay",symbols:["dateSeparator","dateDay","dateInnerDay$ebnf$1"],postprocess:e=>({type:"date",args:["day",e[1].day],nextDateInner:e[2]})},{name:"dateInnerHour$subexpression$1",symbols:[{literal:" "}]},{name:"dateInnerHour$subexpression$1",symbols:[{literal:"T"}]},{name:"dateInnerHour$ebnf$1",symbols:["dateInnerMinute"],postprocess:Fu},{name:"dateInnerHour$ebnf$1",symbols:[],postprocess:function(e){return null}},{name:"dateInnerHour$ebnf$2",symbols:["dateTimeZone"],postprocess:Fu},{name:"dateInnerHour$ebnf$2",symbols:[],postprocess:function(e){return null}},{name:"dateInnerHour",symbols:["dateInnerHour$subexpression$1","dateHour","dateInnerHour$ebnf$1","dateInnerHour$ebnf$2"],postprocess:e=>({type:"date",args:["hour",e[1].hour],nextDateInner:e[2],timezone:e[3]?["timezone",e[3].timezone]:[]})},{name:"dateInnerMinute$ebnf$1",symbols:["dateInnerSecond"],postprocess:Fu},{name:"dateInnerMinute$ebnf$1",symbols:[],postprocess:function(e){return null}},{name:"dateInnerMinute",symbols:[{literal:":"},"dateMinute","dateInnerMinute$ebnf$1"],postprocess:e=>({type:"date",args:["minute",e[1].minute],nextDateInner:e[2]})},{name:"dateInnerSecond$ebnf$1",symbols:["dateInnerMillisecond"],postprocess:Fu},{name:"dateInnerSecond$ebnf$1",symbols:[],postprocess:function(e){return null}},{name:"dateInnerSecond",symbols:[{literal:":"},"dateSecond","dateInnerSecond$ebnf$1"],postprocess:e=>({type:"date",args:["second",e[1].second],nextDateInner:e[2]})},{name:"dateInnerMillisecond",symbols:[{literal:"."},"dateMillisecond"],postprocess:e=>({type:"date",args:["millisecond",e[1].millisecond],nextDateInner:null})},{name:"dateYear",symbols:[Uu.has("digits")?{type:"digits"}:digits],postprocess:Xu("year",4,0,9999)},{name:"dateMonth",symbols:[Uu.has("digits")?{type:"digits"}:digits],postprocess:Xu("month",2,1,12)},{name:"dateMonth",symbols:["literalMonth"],postprocess:Fu},{name:"dateDay",symbols:[Uu.has("digits")?{type:"digits"}:digits],postprocess:Xu("day",2,1,31)},{name:"dateHour",symbols:[Uu.has("digits")?{type:"digits"}:digits],postprocess:Xu("hour",2,0,23)},{name:"dateMinute",symbols:[Uu.has("digits")?{type:"digits"}:digits],postprocess:Xu("minute",2,0,59)},{name:"dateSecond",symbols:[Uu.has("digits")?{type:"digits"}:digits],postprocess:Xu("second",2,0,59)},{name:"dateMillisecond",symbols:[Uu.has("digits")?{type:"digits"}:digits],postprocess:Xu("millisecond",3,0,999)},{name:"literalMonth$subexpression$1",symbols:[{literal:"Jan"}]},{name:"literalMonth$subexpression$1",symbols:[{literal:"January"}]},{name:"literalMonth",symbols:["literalMonth$subexpression$1"],postprocess:Wu(1n)},{name:"literalMonth$subexpression$2",symbols:[{literal:"Feb"}]},{name:"literalMonth$subexpression$2",symbols:[{literal:"February"}]},{name:"literalMonth",symbols:["literalMonth$subexpression$2"],postprocess:Wu(2n)},{name:"literalMonth$subexpression$3",symbols:[{literal:"Mar"}]},{name:"literalMonth$subexpression$3",symbols:[{literal:"March"}]},{name:"literalMonth",symbols:["literalMonth$subexpression$3"],postprocess:Wu(3n)},{name:"literalMonth$subexpression$4",symbols:[{literal:"Apr"}]},{name:"literalMonth$subexpression$4",symbols:[{literal:"April"}]},{name:"literalMonth",symbols:["literalMonth$subexpression$4"],postprocess:Wu(4n)},{name:"literalMonth",symbols:[{literal:"May"}],postprocess:Wu(5n)},{name:"literalMonth$subexpression$5",symbols:[{literal:"Jun"}]},{name:"literalMonth$subexpression$5",symbols:[{literal:"June"}]},{name:"literalMonth",symbols:["literalMonth$subexpression$5"],postprocess:Wu(6n)},{name:"literalMonth$subexpression$6",symbols:[{literal:"Jul"}]},{name:"literalMonth$subexpression$6",symbols:[{literal:"July"}]},{name:"literalMonth",symbols:["literalMonth$subexpression$6"],postprocess:Wu(7n)},{name:"literalMonth$subexpression$7",symbols:[{literal:"Aug"}]},{name:"literalMonth$subexpression$7",symbols:[{literal:"August"}]},{name:"literalMonth",symbols:["literalMonth$subexpression$7"],postprocess:Wu(8n)},{name:"literalMonth$subexpression$8",symbols:[{literal:"Sep"}]},{name:"literalMonth$subexpression$8",symbols:[{literal:"September"}]},{name:"literalMonth",symbols:["literalMonth$subexpression$8"],postprocess:Wu(9n)},{name:"literalMonth$subexpression$9",symbols:[{literal:"Oct"}]},{name:"literalMonth$subexpression$9",symbols:[{literal:"October"}]},{name:"literalMonth",symbols:["literalMonth$subexpression$9"],postprocess:Wu(10n)},{name:"literalMonth$subexpression$10",symbols:[{literal:"Nov"}]},{name:"literalMonth$subexpression$10",symbols:[{literal:"November"}]},{name:"literalMonth",symbols:["literalMonth$subexpression$10"],postprocess:Wu(11n)},{name:"literalMonth$subexpression$11",symbols:[{literal:"Dec"}]},{name:"literalMonth$subexpression$11",symbols:[{literal:"December"}]},{name:"literalMonth",symbols:["literalMonth$subexpression$11"],postprocess:Wu(12n)},{name:"dateTimeZone",symbols:[{literal:"Z"}],postprocess:e=>({timezone:{hours:0,minutes:0}})},{name:"dateTimeZone$subexpression$1",symbols:[{literal:"+"}]},{name:"dateTimeZone$subexpression$1",symbols:[{literal:"-"}]},{name:"dateTimeZone$ebnf$1$subexpression$1",symbols:[{literal:":"},Uu.has("digits")?{type:"digits"}:digits]},{name:"dateTimeZone$ebnf$1",symbols:["dateTimeZone$ebnf$1$subexpression$1"],postprocess:Fu},{name:"dateTimeZone$ebnf$1",symbols:[],postprocess:function(e){return null}},{name:"dateTimeZone",symbols:["dateTimeZone$subexpression$1",Uu.has("digits")?{type:"digits"}:digits,"dateTimeZone$ebnf$1"],postprocess:e=>{let[t,n,r]=e,s=Number(n.value),a=r?Number(r[1].value):0;return"-"===t[0].value&&(s=-s,a=-a),{timezone:{hours:s,minutes:a}}}},{name:"dateSeparator$subexpression$1",symbols:[{literal:"-"}]},{name:"dateSeparator$subexpression$1",symbols:[{literal:"/"}]},{name:"dateSeparator",symbols:["dateSeparator$subexpression$1"],postprocess:Fu},{name:"column",symbols:[{literal:"["},"_",{literal:"]"}],postprocess:e=>{var t;return Ju({type:"column",args:[Ju({type:"column-items",args:[]},null!==(t=e[1])&&void 0!==t?t:e[0])]},e[0],e[2])}},{name:"column",symbols:[{literal:"["},"columnItems",{literal:"]"}],postprocess:(e,t,n)=>Gu({type:"column",args:[e[1]]},e)},{name:"columnItems$ebnf$1",symbols:[]},{name:"columnItems$ebnf$1$subexpression$1",symbols:["_",{literal:","},"_","expression"]},{name:"columnItems$ebnf$1",symbols:["columnItems$ebnf$1","columnItems$ebnf$1$subexpression$1"],postprocess:function(e){return e[0].concat([e[1]])}},{name:"columnItems$ebnf$2$subexpression$1",symbols:["_",{literal:","}]},{name:"columnItems$ebnf$2",symbols:["columnItems$ebnf$2$subexpression$1"],postprocess:Fu},{name:"columnItems$ebnf$2",symbols:[],postprocess:function(e){return null}},{name:"columnItems",symbols:["_","expression","columnItems$ebnf$1","columnItems$ebnf$2","_"],postprocess:(e,t,n)=>Gu({type:"column-items",args:[e[1],...e[2].map((e=>e[3]))]},e)},{name:"table",symbols:["identifier","equalSign",{literal:"{"},"tableContents",{literal:"}"}],postprocess:e=>Gu({type:"table",args:[Ju({type:"tabledef",args:[e[0].name]},e[0]),...e[3]]},e)},{name:"tableContents",symbols:["_"],postprocess:e=>[]},{name:"tableContents$ebnf$1",symbols:[]},{name:"tableContents$ebnf$1$subexpression$1",symbols:["tableSep","tableItem"]},{name:"tableContents$ebnf$1",symbols:["tableContents$ebnf$1","tableContents$ebnf$1$subexpression$1"],postprocess:function(e){return e[0].concat([e[1]])}},{name:"tableContents",symbols:["_","tableItem","tableContents$ebnf$1","_"],postprocess:e=>{let[t,n,r]=e;const s=[n];for(const[a,o]of null!==r&&void 0!==r?r:[])s.push(o);return s}},{name:"tableItem",symbols:["identifier"],postprocess:e=>{let[t]=e;return Ju({type:"table-column",args:[Ju({type:"coldef",args:[t.name]},t),Ju({type:"ref",args:[t.name]},t)]},t)}},{name:"tableItem$subexpression$1",symbols:[{literal:"\u2026"}]},{name:"tableItem$subexpression$1",symbols:[{literal:"..."}]},{name:"tableItem",symbols:["tableItem$subexpression$1","_","ref"],postprocess:e=>Gu({type:"table-spread",args:[e[2]]},e)},{name:"tableItem",symbols:["identifier","equalSign","expression"],postprocess:e=>{const t=e[0];return Gu({type:"table-column",args:[Ju({type:"coldef",args:[t.name]},t),e[2]]},e)}},{name:"tableSep$subexpression$1",symbols:["__n"]},{name:"tableSep$subexpression$1",symbols:["_",{literal:","},"_"]},{name:"tableSep",symbols:["tableSep$subexpression$1"],postprocess:Fu},{name:"tiered",symbols:["tieredKeyword","_","expression","_",{literal:"{"},"tieredContents",{literal:"}"}],postprocess:e=>Gu({type:"tiered",args:[e[2],...e[5]]},e)},{name:"tieredKeyword",symbols:[{literal:"tiered"}]},{name:"tieredKeyword",symbols:[{literal:"tiers"}]},{name:"tieredKeyword",symbols:[{literal:"sliced"}]},{name:"tieredKeyword",symbols:[{literal:"slices"}],postprocess:Fu},{name:"tieredContents",symbols:["_"],postprocess:e=>[]},{name:"tieredContents$ebnf$1",symbols:[]},{name:"tieredContents$ebnf$1$subexpression$1",symbols:["tieredSep","tieredDef"]},{name:"tieredContents$ebnf$1",symbols:["tieredContents$ebnf$1","tieredContents$ebnf$1$subexpression$1"],postprocess:function(e){return e[0].concat([e[1]])}},{name:"tieredContents",symbols:["_","tieredDef","tieredContents$ebnf$1","_"],postprocess:e=>{let[t,n,r]=e;const s=[n];for(const[a,o]of null!==r&&void 0!==r?r:[])s.push(o);return s}},{name:"tieredDef",symbols:["expression","_",{literal:":"},"_","expression"],postprocess:e=>Gu({type:"tiered-def",args:[e[0],e[4]]},e)},{name:"tieredSep$subexpression$1",symbols:["__n"]},{name:"tieredSep$subexpression$1",symbols:["_",{literal:","},"_"]},{name:"tieredSep",symbols:["tieredSep$subexpression$1"],postprocess:Fu},{name:"select",symbols:[{literal:"select"},"_",{literal:"("},"_","selectedColumns","_",{literal:")"}],postprocess:e=>Gu({type:"directive",args:["select",...e[4]]},e)},{name:"selectedColumns$ebnf$1",symbols:[{literal:","}],postprocess:Fu},{name:"selectedColumns$ebnf$1",symbols:[],postprocess:function(e){return null}},{name:"selectedColumns$ebnf$2$subexpression$1$ebnf$1",symbols:[{literal:","}],postprocess:Fu},{name:"selectedColumns$ebnf$2$subexpression$1$ebnf$1",symbols:[],postprocess:function(e){return null}},{name:"selectedColumns$ebnf$2$subexpression$1",symbols:["genericIdentifier","_","selectedColumns$ebnf$2$subexpression$1$ebnf$1","_"]},{name:"selectedColumns$ebnf$2",symbols:["selectedColumns$ebnf$2$subexpression$1"]},{name:"selectedColumns$ebnf$2$subexpression$2$ebnf$1",symbols:[{literal:","}],postprocess:Fu},{name:"selectedColumns$ebnf$2$subexpression$2$ebnf$1",symbols:[],postprocess:function(e){return null}},{name:"selectedColumns$ebnf$2$subexpression$2",symbols:["genericIdentifier","_","selectedColumns$ebnf$2$subexpression$2$ebnf$1","_"]},{name:"selectedColumns$ebnf$2",symbols:["selectedColumns$ebnf$2","selectedColumns$ebnf$2$subexpression$2"],postprocess:function(e){return e[0].concat([e[1]])}},{name:"selectedColumns",symbols:["ref","_","selectedColumns$ebnf$1","_","selectedColumns$ebnf$2"],postprocess:e=>[e[0],Gu({type:"generic-list",args:e[4].map((e=>{let[t]=e;return t}))},e[4])]},{name:"match",symbols:[{literal:"match"},"_",{literal:"{"},"matchContents",{literal:"}"}],postprocess:e=>Gu({type:"match",args:e[3]},e)},{name:"matchContents",symbols:["_"],postprocess:e=>[]},{name:"matchContents$ebnf$1",symbols:[]},{name:"matchContents$ebnf$1$subexpression$1",symbols:["matchDefSep","matchDef"]},{name:"matchContents$ebnf$1",symbols:["matchContents$ebnf$1","matchContents$ebnf$1$subexpression$1"],postprocess:function(e){return e[0].concat([e[1]])}},{name:"matchContents",symbols:["_","matchDef","matchContents$ebnf$1","_"],postprocess:e=>{const[t,n,r]=e,s=[n];for(const[a,o]of null!==r&&void 0!==r?r:[])s.push(o);return s}},{name:"matchDef",symbols:["expression","_",{literal:":"},"_","expression"],postprocess:e=>Gu({type:"matchdef",args:[e[0],e[4]]},e)},{name:"matchDefSep$subexpression$1",symbols:["__n"]},{name:"matchDefSep$subexpression$1",symbols:["_",{literal:","},"_"]},{name:"matchDefSep",symbols:["matchDefSep$subexpression$1"],postprocess:Fu},{name:"expression",symbols:["tiered"],postprocess:Fu},{name:"expression",symbols:["match"],postprocess:Fu},{name:"expression",symbols:["overExp"],postprocess:Fu},{name:"overExp",symbols:["asExp"],postprocess:Fu},{name:"overExp",symbols:["overExp","_",{literal:"over"},"_","genericIdentifier"],postprocess:e=>Gu({type:"directive",args:["over",e[0],e[4]]},e)},{name:"asExp",symbols:["orOp"],postprocess:Fu},{name:"asExp",symbols:["asExp","_","asWord","_","orOp"],postprocess:e=>Gu({type:"directive",args:["as",e[0],e[4]]},e)},{name:"asExp",symbols:["asExp","_","asWord","_",{literal:"%"}],postprocess:e=>{const t=Ju({type:"generic-identifier",args:["%"]},e[4]);return Gu({type:"directive",args:["as",e[0],t]},e)}},{name:"asWord$subexpression$1",symbols:[{literal:"as"}]},{name:"asWord$subexpression$1",symbols:[{literal:"to"}]},{name:"asWord$subexpression$1",symbols:[{literal:"in"}]},{name:"asWord",symbols:["asWord$subexpression$1"],postprocess:Fu},{name:"orOp",symbols:["andOp"],postprocess:Fu},{name:"orOp",symbols:["orOp","_","orOperator","_","andOp"],postprocess:nl},{name:"andOp",symbols:["equalityOp"],postprocess:Fu},{name:"andOp",symbols:["andOp","_","andOperator","_","equalityOp"],postprocess:nl},{name:"equalityOp",symbols:["compareOp"],postprocess:Fu},{name:"equalityOp",symbols:["equalityOp","_","eqDiffOperator","_","compareOp"],postprocess:nl},{name:"compareOp",symbols:["smoothOp"],postprocess:Fu},{name:"compareOp",symbols:["compareOp","_","cmpOperator","_","smoothOp"],postprocess:nl},{name:"smoothOp",symbols:["addSubOp"],postprocess:Fu},{name:"smoothOp",symbols:["smoothOp","_","smoothOperator","_","addSubOp"],postprocess:nl},{name:"addSubOp",symbols:["divMulOp"],postprocess:Fu},{name:"addSubOp",symbols:["addSubOp","_","additiveOperator","_","divMulOp"],postprocess:(e,t,n)=>{const r=e[0],s=e[2],a=e[4];return"+"===s.name&&"date"===r.type&&"literal"===a.type&&"number"===a.args[0]?n:nl(e)}},{name:"divMulOp",symbols:["ofExp"],postprocess:Fu},{name:"divMulOp",symbols:["divMulOp","_","divMulOperator","_","ofExp"],postprocess:nl},{name:"divMulOp",symbols:["divMulOp","ref"],postprocess:el},{name:"divMulOp",symbols:["divMulOp","__","ofExp"],postprocess:el},{name:"ofExp",symbols:["powOp"],postprocess:Fu},{name:"ofExp",symbols:["ofExp","_",{literal:"of"},"_","genericIdentifier"],postprocess:e=>Gu({type:"directive",args:["of",e[0],e[4]]},e)},{name:"powOp",symbols:["primary"],postprocess:Fu},{name:"powOp",symbols:["primary","_","powOperator","_","powOp"],postprocess:(e,t,n)=>{const r=e[0];e[4];if("function-call"===r.type){const e=r.args[0];if("funcref"===e.type){if("unary-"===e.args[0])return n}}return nl(e)}},{name:"primary",symbols:["literal"],postprocess:Fu},{name:"primary",symbols:["functionCall"],postprocess:Fu},{name:"primary",symbols:["select"],postprocess:Fu},{name:"primary",symbols:["matrixRef"],postprocess:Fu},{name:"primary",symbols:["ref"],postprocess:Fu},{name:"primary",symbols:["currency"],postprocess:Fu},{name:"primary",symbols:["parenthesizedExpression"],postprocess:Fu},{name:"primary",symbols:[{literal:"-"},"_","parenthesizedExpression"],postprocess:tl},{name:"primary",symbols:[{literal:"-"},"_","ref"],postprocess:tl},{name:"primary$subexpression$1",symbols:[{literal:"!"}]},{name:"primary$subexpression$1",symbols:[{literal:"not"}]},{name:"primary",symbols:["primary$subexpression$1","_","expression"],postprocess:e=>Gu({type:"function-call",args:[Ju({type:"funcref",args:["not"]},e[0][0]),Ju({type:"argument-list",args:[e[2]]},e[2])]},e)},{name:"primary$subexpression$2",symbols:["ref"]},{name:"primary$subexpression$2",symbols:["functionCall"]},{name:"primary$subexpression$2",symbols:["parenthesizedExpression"]},{name:"primary$subexpression$2",symbols:["select"]},{name:"primary",symbols:["primary$subexpression$2","_",{literal:"."},"_",Uu.has("identifier")?{type:"identifier"}:identifier],postprocess:e=>Gu({type:"property-access",args:[e[0][0],e[4].value]},e)},{name:"parenthesizedExpression",symbols:[{literal:"("},"_","expression","_",{literal:")"}],postprocess:e=>Gu(e[2],e)},{name:"orOperator$subexpression$1",symbols:[{literal:"||"}]},{name:"orOperator$subexpression$1",symbols:[{literal:"or"}]},{name:"orOperator",symbols:["orOperator$subexpression$1"],postprocess:rl},{name:"andOperator$subexpression$1",symbols:[{literal:"&&"}]},{name:"andOperator$subexpression$1",symbols:[{literal:"and"}]},{name:"andOperator",symbols:["andOperator$subexpression$1"],postprocess:rl},{name:"eqDiffOperator$subexpression$1",symbols:[{literal:"=="}]},{name:"eqDiffOperator$subexpression$1",symbols:[{literal:"!="}]},{name:"eqDiffOperator",symbols:["eqDiffOperator$subexpression$1"],postprocess:rl},{name:"cmpOperator$subexpression$1",symbols:[{literal:">"}]},{name:"cmpOperator$subexpression$1",symbols:[{literal:"<"}]},{name:"cmpOperator$subexpression$1",symbols:[{literal:"<="}]},{name:"cmpOperator$subexpression$1",symbols:[{literal:">="}]},{name:"cmpOperator",symbols:["cmpOperator$subexpression$1"],postprocess:rl},{name:"smoothOperator$subexpression$1",symbols:[{literal:"smooth"}]},{name:"smoothOperator",symbols:["smoothOperator$subexpression$1"],postprocess:rl},{name:"additiveOperator$subexpression$1",symbols:[{literal:"-"}]},{name:"additiveOperator$subexpression$1",symbols:[{literal:"+"}]},{name:"additiveOperator",symbols:["additiveOperator$subexpression$1"],postprocess:rl},{name:"divMulOperator$subexpression$1",symbols:[{literal:"for"}]},{name:"divMulOperator$subexpression$1",symbols:[{literal:"*"}]},{name:"divMulOperator$subexpression$1",symbols:[{literal:"/"}]},{name:"divMulOperator$subexpression$1",symbols:[{literal:"per"}]},{name:"divMulOperator$subexpression$1",symbols:[{literal:"contains"}]},{name:"divMulOperator",symbols:["divMulOperator$subexpression$1"],postprocess:rl},{name:"divMulOperator$subexpression$2",symbols:[{literal:"mod"}]},{name:"divMulOperator$subexpression$2",symbols:[{literal:"modulo"}]},{name:"divMulOperator",symbols:["__","divMulOperator$subexpression$2"],postprocess:e=>Gu({name:"mod"},e)},{name:"powOperator$subexpression$1",symbols:[{literal:"**"}]},{name:"powOperator$subexpression$1",symbols:[{literal:"^"}]},{name:"powOperator",symbols:["powOperator$subexpression$1"],postprocess:rl},{name:"range",symbols:[{literal:"range"},"_",{literal:"("},"_","rangeInner","_",{literal:")"}],postprocess:e=>Gu({type:"range",args:e[4]},e)},{name:"rangeInner",symbols:["expression","rangeParcelSeparator","expression"],postprocess:e=>{let[t,n,r]=e;return[t,r]}},{name:"rangeParcelSeparator$subexpression$1",symbols:[{literal:"through"}]},{name:"rangeParcelSeparator$subexpression$1",symbols:[{literal:".."}]},{name:"rangeParcelSeparator$subexpression$1",symbols:[{literal:"to"}]},{name:"rangeParcelSeparator",symbols:["_","rangeParcelSeparator$subexpression$1","_"],postprocess:()=>null},{name:"sequence",symbols:[{literal:"["},"_","sequenceInner","_",{literal:"]"}],postprocess:e=>Gu(e[2],e)},{name:"sequenceInner",symbols:["expression","sequenceThrough","expression","sequenceBy"],postprocess:e=>{const[t,n,r,s]=e,a=[t,r];return s&&a.push(s),Gu({type:"sequence",args:a},e)}},{name:"sequenceBy$ebnf$1$subexpression$1",symbols:["_",{literal:"by"},"_","expression"]},{name:"sequenceBy$ebnf$1",symbols:["sequenceBy$ebnf$1$subexpression$1"],postprocess:Fu},{name:"sequenceBy$ebnf$1",symbols:[],postprocess:function(e){return null}},{name:"sequenceBy",symbols:["sequenceBy$ebnf$1"],postprocess:e=>{var t,n;return null!==(t=null===(n=e[0])||void 0===n?void 0:n[3])&&void 0!==t?t:null}},{name:"sequenceThrough$subexpression$1",symbols:[{literal:"through"}]},{name:"sequenceThrough$subexpression$1",symbols:[{literal:".."}]},{name:"sequenceThrough",symbols:["_","sequenceThrough$subexpression$1","_"],postprocess:()=>null},{name:"functionDef",symbols:["functionDefName","_","functionDefArgs","equalSign","functionBody"],postprocess:e=>Gu({type:"function-definition",args:[e[0],e[2],e[4]]},e)},{name:"functionDefName",symbols:["identifier"],postprocess:e=>Ju({type:"funcdef",args:[e[0].name]},e[0])},{name:"functionDefArgs$ebnf$1",symbols:[]},{name:"functionDefArgs$ebnf$1$subexpression$1",symbols:["optionalComma","argName"]},{name:"functionDefArgs$ebnf$1",symbols:["functionDefArgs$ebnf$1","functionDefArgs$ebnf$1$subexpression$1"],postprocess:function(e){return e[0].concat([e[1]])}},{name:"functionDefArgs$ebnf$2$subexpression$1",symbols:["_",{literal:","}]},{name:"functionDefArgs$ebnf$2",symbols:["functionDefArgs$ebnf$2$subexpression$1"],postprocess:Fu},{name:"functionDefArgs$ebnf$2",symbols:[],postprocess:function(e){return null}},{name:"functionDefArgs",symbols:[{literal:"("},"_","argName","functionDefArgs$ebnf$1","functionDefArgs$ebnf$2","_",{literal:")"}],postprocess:e=>Gu({type:"argument-names",args:[e[2],...e[3].map((e=>{let[t,n]=e;return n}))]},e)},{name:"optionalComma$subexpression$1",symbols:["_",{literal:","},"_"]},{name:"optionalComma$subexpression$1",symbols:["__"]},{name:"optionalComma",symbols:["optionalComma$subexpression$1"],postprocess:Fu},{name:"argName",symbols:["identifier"],postprocess:e=>Ju({type:"def",args:[e[0].name]},e[0])},{name:"functionBody",symbols:["expression"],postprocess:e=>{let[t]=e;return Ju({type:"block",args:[t]},t)}},{name:"functionCall",symbols:["identifier","_","callArgs"],postprocess:e=>{const t=e[0],n=e[2];return Gu({type:"function-call",args:[Ju({type:"funcref",args:[t.name]},t),Ju({type:"argument-list",args:n.args},n)]},e)}},{name:"callArgs$ebnf$1",symbols:[]},{name:"callArgs$ebnf$1$subexpression$1",symbols:["_",{literal:","},"_","expression"]},{name:"callArgs$ebnf$1",symbols:["callArgs$ebnf$1","callArgs$ebnf$1$subexpression$1"],postprocess:function(e){return e[0].concat([e[1]])}},{name:"callArgs$ebnf$2$subexpression$1",symbols:["_",{literal:","}]},{name:"callArgs$ebnf$2",symbols:["callArgs$ebnf$2$subexpression$1"],postprocess:Fu},{name:"callArgs$ebnf$2",symbols:[],postprocess:function(e){return null}},{name:"callArgs",symbols:[{literal:"("},"_","expression","callArgs$ebnf$1","callArgs$ebnf$2","_",{literal:")"}],postprocess:e=>Gu({type:"argument-list",args:[e[2],...e[3].map((e=>{let[t,n,r,s]=e;return s}))]},e)},{name:"block$ebnf$1$subexpression$1",symbols:[Uu.has("statementSep")?{type:"statementSep"}:statementSep]},{name:"block$ebnf$1$subexpression$1",symbols:[Uu.has("ws")?{type:"ws"}:ws]},{name:"block$ebnf$1",symbols:["block$ebnf$1$subexpression$1"],postprocess:Fu},{name:"block$ebnf$1",symbols:[],postprocess:function(e){return null}},{name:"block$ebnf$2",symbols:[]},{name:"block$ebnf$2$subexpression$1",symbols:[Uu.has("statementSep")?{type:"statementSep"}:statementSep,"statement"]},{name:"block$ebnf$2",symbols:["block$ebnf$2","block$ebnf$2$subexpression$1"],postprocess:function(e){return e[0].concat([e[1]])}},{name:"block$ebnf$3$subexpression$1",symbols:[Uu.has("statementSep")?{type:"statementSep"}:statementSep]},{name:"block$ebnf$3$subexpression$1",symbols:[Uu.has("ws")?{type:"ws"}:ws]},{name:"block$ebnf$3",symbols:["block$ebnf$3$subexpression$1"],postprocess:Fu},{name:"block$ebnf$3",symbols:[],postprocess:function(e){return null}},{name:"block",symbols:["block$ebnf$1","statement","block$ebnf$2","block$ebnf$3"],postprocess:e=>{const t=e[1],n=e[2].map((e=>{let[t,n]=e;return n}));return Gu({type:"block",args:[t,...n]},e)}},{name:"statement",symbols:["assign"],postprocess:Fu},{name:"statement",symbols:["table"],postprocess:Fu},{name:"statement",symbols:["columnAssign"],postprocess:Fu},{name:"statement",symbols:["matrixAssign"],postprocess:Fu},{name:"statement",symbols:["functionDef"],postprocess:Fu},{name:"statement",symbols:["expression"],postprocess:Fu},{name:"statement",symbols:["categories"],postprocess:Fu},{name:"identifier",symbols:[Uu.has("identifier")?{type:"identifier"}:identifier],postprocess:(e,t,n)=>{const r=e[0].value;return s=r,Zu.has(s)?n:Ju({name:r},e[0]);var s}},{name:"currency",symbols:[Uu.has("currency")?{type:"currency"}:currency],postprocess:e=>{let[t]=e;return Ju({type:"ref",args:[t.value]},t)}},{name:"genericIdentifier",symbols:[Uu.has("identifier")?{type:"identifier"}:identifier],postprocess:e=>Gu({type:"generic-identifier",args:[e[0].value]},e)},{name:"ref",symbols:[Uu.has("identifier")?{type:"identifier"}:identifier],postprocess:(e,t,n)=>{const r=e[0].value;return Zu.has(r)?n:Ju({type:"ref",args:[r]},e[0])}},{name:"equalSign$subexpression$1",symbols:[{literal:"="}]},{name:"equalSign$subexpression$1",symbols:[{literal:"is"}]},{name:"equalSign",symbols:["_","equalSign$subexpression$1","_"],postprocess:e=>e[1]},{name:"expression",symbols:[{literal:"if"},"__","expression","__",{literal:"then"},"__","expression","__",{literal:"else"},"__","expression"],postprocess:e=>Gu({type:"function-call",args:[Ju({type:"funcref",args:["if"]},e[0]),Gu({type:"argument-list",args:[e[2],e[6],e[10]]},e.slice(2))]},e)}];const ol={Lexer:sl,ParserRules:al,ParserStart:"block"};var il=n(66556),ul=n.n(il);const ll=new Set(["argument-list","function-call","assign","table-column-assign","categories","matrix-ref","matrix-assign","argument-names","function-definition","block","column","column-items","table","table-column","table-spread","generic-list","range","sequence"]);function cl(e,t){for(const[n,r]of e)if(t<=n)return r;return-1}class ml extends Error{constructor(e){super(e.message),q()(this,"detailMessage",void 0),q()(this,"token",void 0),q()(this,"source",void 0),q()(this,"line",void 0),q()(this,"column",void 0),q()(this,"posistionedCaret",void 0),q()(this,"expected",void 0);const{detailMessage:t,source:n,line:r,column:s,posistionedCaret:a,expected:o,token:i}=e;this.token=i,this.detailMessage=t,this.source=n,this.line=r,this.column=s,this.posistionedCaret=a,this.expected=o}static fromNearleySyntaxError(e){return new ml(e)}}const pl=ul().Grammar.fromCompiled(ol);class dl extends il.Parser{reportErrorCommon(e,t){const n=this,[r,,s,a]=e.split("\n"),o={message:"Syntax error",source:s,posistionedCaret:a},i=n.table.length-2,u=n.table[i],l=u.states.filter((e=>{const t=e.rule.symbols[e.dot];return t&&"string"!==typeof t})),[c,m]=function(e){const t=e.match(/line (\d+) col (\d+)/);if(!t)return[void 0,void 0];const[,n,r]=t;return[Number(n),Number(r)]}(r);if(o.line=c,o.column=m,0===l.length){o.detailMessage="Unexpected ".concat(t,". I did not expect any more input.\n");const e=[];n.displayStateStack(u.states,e),o.detailMessage+=e.join("\n")}else{o.detailMessage="Unexpected ".concat(t,".");const e=l.map((e=>n.buildFirstStateStack(e,[])||[e]),n);o.expected=e.map((e=>{const t=e[0],r=t.rule.symbols[t.dot];return n.getSymbolDisplay(r)}))}return JSON.stringify(o)}}function fl(e){const t=new dl(pl);t.feed(e),t.finish();const n=t.results.map(function(e){const t=e.split("\n"),n=[],r=[];let s=0,a=0;for(const i of t)s++,r.push([s,a]),a+=i.length+1,n.push([a-1,s]);return e=>o(e);function o(e){const t=cl(n,e.start),s=e.start-cl(r,t)+1;e.start={char:e.start,line:t,column:s};const a=e.end,i=cl(n,a),u=a-cl(r,i)+1;if(e.end={char:a,line:i,column:u},ll.has(e.type))e.args=e.args.map((e=>o(e)));else if("property-access"===e.type)e.args[0]=o(e.args[0]);else if("directive"===e.type){const[t,...n]=e.args;e.args=[t,...n.map(o)]}return e}}(e));if(n.length>1){const t=n.map((e=>Nl(e)));throw console.error(["Source: ".concat(e),...t].join("\n\n---\n\n")),new ml({message:"panic: multiple solutions"})}if(0===n.length){const t=(e=>Array.from(Uu.reset(e)))(e).pop();throw new ml({message:"No solutions",token:t})}return(0,E.m0)(n[0])}const yl=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];const s=new Map,a=e.map(((e,t)=>{const r=n[t];if(!r)return e;const a="id__".concat(Math.floor(9999999*Math.random()));return s.set(a,r),"".concat(e).concat(a)})).join(""),o=Cl(a);return gl(o,s)},gl=(e,t)=>fo(e,(e=>{"property-access"===e.type&&t.has(e.args[1])&&(e.args[1]=t.get(e.args[1]).name);const n=Co(e)&&t.get(e.args[0]);if(!n)return e;if(ho(n))return n;if("object"===typeof n&&"name"in n)return e.args[0]=n.name,e;throw new Error("unreachable")}));function hl(e,t){if(""===e.trim())return{solution:yo("block",yo("noop"))};{const r=function(e){const t=new Ou;for(const n of Uu.reset(e))t.feed(n);return t.finalize(),t.validationError}(e);if(r)return{error:{message:"Bracket error",bracketError:r}};try{const n=function(e){try{return fl(e)}catch(t){if(!(t instanceof ml)){let e;try{e=JSON.parse(t.message)}catch(n){console.warn("Error trying to parse",t.message),console.warn(n)}if(e)throw ml.fromNearleySyntaxError({...t,...e})}throw t}}(e.trimEnd());return t&&(n.id=t),{solution:n}}catch(n){return{error:wl(n)}}}}function bl(e){const t=hl(e);return t.error?t:{solution:t.solution.args[0]}}function vl(e,t){const n=bl(e);if(n.error)return n;if(!vo(n.solution))return{error:{message:"Expected expression",isEmptyExpressionError:!0}};if(t)try{po(n.solution,(e=>{if(t.includes(e.type))throw new Error("Invalid node type")}))}catch{return{error:{message:"Invalid expression in this context",isDisallowedNodeType:!0}}}return{solution:n.solution}}function wl(e){const t={message:e.message,token:e.token};return e instanceof ml&&(t.detailMessage=e.detailMessage,t.line=e.line,t.column=e.column,t.expected=e.expected,t.source=e.source,t.expected=e.expected),t}const xl=(e,t)=>{const n=ho(r=e)&&wo.has(r.type)||["block","table"].includes(e.type);var r;let s,a;switch(e.type){case"literal":{const[,t]=e.args;return t instanceof M.ZP?t.toString():JSON.stringify(t)}case"property-access":{const[n,r]=e.args;return"(prop ".concat(xl(n,t+1),".").concat(r,")")}case"function-call":[a]=e.args[0].args,s=e.args[1].args.map((e=>xl(e,t+1)));break;case"table":{const[n,...r]=e.args;a="table ".concat(n.args[0]),s=Array.from(r,(e=>{if("table-column"===e.type){const[n,r]=e.args;return"".concat(n.args[0]," ").concat(xl(r,t+1))}return"...".concat(Qo(e.args[0]))}));break}case"column":a="column",s=Array.from(e.args[0].args,(e=>xl(e,t+1)));break;default:a=e.type,s=e.args.flatMap((function e(n){return ho(n)?xl(n,t+1):Array.isArray(n)?n.flatMap(e):String(n)}))}if(n&&s.length>0){const e=s.map((e=>"  ".repeat(t+1)+e));return"(".concat(a,"\n").concat(e.join("\n"),")")}return s.length?"(".concat(a," ").concat(s.join(" "),")"):"(".concat(a,")")},Nl=e=>xl(e,0),$l=e=>{const t=hl(e);if(t.error)throw new TypeError(t.error.message);return t.solution},Cl=e=>$l(e).args[0],Ql=e=>{const t=$l(e).args[0];if(!vo(t))throw new TypeError("Expected expression");return t}},96206:(e,t,n)=>{global.document={documentElement:{currentStyle:"fake"},getElementsByTagName:()=>[]},global.window={navigator:{platform:"fake"},addEventListener:()=>{}},global.Element={prototype:{matches:()=>!1}},global.requestAnimationFrame=e=>setTimeout(e,0),global.cancelAnimationFrame=e=>clearTimeout(e),global.window=global;var r=n(55013),s=n(13986),a=n(85996);const o=require("querystring");var i=n(20548);const u={REACT_APP_SENTRY_DSN:"",REACT_APP_GOOGLE_SHEETS_API_KEY:"AIzaSyC1rl_w_G-RMx6hJJZRJ9rSbyD00POLIEM"};const l=(e,t)=>t||function(e){return u[e]}(e),c=(0,i.IHq)((()=>({googleSheets:{apiKey:l("REACT_APP_GOOGLE_SHEETS_API_KEY")}})));var m=n(68685),p=n.n(m),d=n(26290),f=n.n(d);class y extends Error{constructor(e,t){super(e),f()(this,"code",500),this.code=Number(t)}static fromResponse(e){let{message:t,code:n}=e;return new y(t,n)}}async function g(e){var t,n;const r=await e.text();let s;try{s=JSON.parse(r)}catch(a){}throw null!==(t=s)&&void 0!==t&&t.error?y.fromResponse(null===(n=s)||void 0===n?void 0:n.error):new Error(r)}const h=async e=>{const{googleSheets:t}=c(),n=(0,o.stringify)({key:t.apiKey}),r=new URL("https://sheets.googleapis.com/v4/spreadsheets/".concat(e,"?").concat(n));return(await async function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n={method:"GET",headers:{Referer:global.location.toString()}},r=await p()(e.toString(),n);return r.ok||await g(r),{contentType:r.headers.get("content-type"),statusCode:r.status,body:await(t?r.json():r.text())}}(r,!0)).body},b=e=>"content-sheets.googleapis.com"===e.hostname?(e=>{const t=e.pathname.match(/^\/v4\/spreadsheets\/([^/]+)\/values\/([^/]+)/);if(!t)throw new Error("Could not extract request data from ".concat(e));const[,n,r]=t;return{sheetId:n,gid:r}})(e):(e=>{var t;const n=e.pathname.match(/^\/spreadsheets\/d\/([^/]+)\/edit/);if(!n)throw new Error("Could not extract sheet id from ".concat(e));const[,r]=n;if(!r)throw new Error("Could not extract sheet id from ".concat(e));const s=e.hash.match(/gid=([0-9]+)/);return{sheetId:r,gid:null!==(t=s&&s[1])&&void 0!==t?t:""}})(e),v=(e,t,n)=>{var r,s;const{googleSheets:a}=c(),i=(0,o.stringify)({majorDimension:"COLUMNS",valueRenderOption:"UNFORMATTED_VALUE",dateTimeRenderOption:"FORMATTED_STRING",key:a.apiKey}),u=null!==(r=n.sheets.find((e=>e.properties.sheetId===t||e.properties.sheetId===Number(t))))&&void 0!==r?r:n.sheets[Number(t)],l=null!==(s=(null===u||void 0===u?void 0:u.properties.title)&&encodeURIComponent(u.properties.title))&&void 0!==s?s:t;return new URL("https://content-sheets.googleapis.com/v4/spreadsheets/".concat(e,"/values/").concat(l,"?").concat(i))},w=e=>"string"===typeof e&&0===e.trim().length,x=e=>null!=e.find((e=>!w(e))),N=e=>{let t=!1,n=0,r=0;for(const s of e){const e=w(s);t?e?r+=1:r=0:e?n+=1:r=0,e||(t=!0)}return{trimTopRowCount:n,trimBottomRowCount:r,finalRowCount:e.length-n-r}},$=e=>{const t=e.values.filter(x),n=t.map(N),r=(e=>{let{finalTrimTopRowCount:t,finalTrimBottomRowCount:n,finalRowCount:r}=e;return e=>((e,t,n,r)=>{let s=e.slice(t);n>0&&(s=s.slice(0,-n));const a=r-s.length;if(a)for(let o=0;o<a;o+=1)s.push("");return s})(e,t,n,r)})({finalTrimTopRowCount:Math.min(...n.map((e=>e.trimTopRowCount))),finalTrimBottomRowCount:Math.min(...n.map((e=>e.trimBottomRowCount))),finalRowCount:Math.max(...n.map((e=>e.finalRowCount)))});return{values:t.map(r)}};var C=n(79568);const Q=e=>{let t,n="",r=Math.floor(Math.abs(e));for(;r>0;)t=(r-1)%26,n=String.fromCharCode(65+t)+n,r=parseInt("".concat((r-t)/26),10);return n},k=(e,t,n,r)=>{var s,a;const{googleSheets:i}=c(),u=(0,o.stringify)({majorDimension:"COLUMNS",valueRenderOption:"UNFORMATTED_VALUE",dateTimeRenderOption:"FORMATTED_STRING",key:i.apiKey}),l=null!==(s=n.sheets.find((e=>e.properties.sheetId===t||e.properties.sheetId===Number(t))))&&void 0!==s?s:n.sheets[Number(t)],m=((e,t)=>"".concat(e,"!").concat(Q(t.firstCol+1)).concat(t.firstRow+1,":").concat(Q(t.lastCol+1)).concat(t.lastRow+1))(null!==(a=null===l||void 0===l?void 0:l.properties.title)&&void 0!==a?a:"Sheet1",r);return new URL("https://content-sheets.googleapis.com/v4/spreadsheets/".concat(e,"/values/").concat(encodeURIComponent(m),"?").concat(u))},B=[[-1,-1],[0,-1],[1,-1],[-1,0],[1,0],[-1,1],[0,1],[1,1]],S=(e,t)=>{if("table"!==t.result.type.kind)return[];const n=t.result,s=n.type.columnTypes.length,a=Math.max(...n.value.map((e=>e.length))),o=((e,t,n)=>{const r=Array.from({length:e});for(let s=0;s<e;s+=1)r[s]=Array.from({length:t}).fill(n);return r})(s,a,!1),{value:i}=n,u=new Set,l=(e,t,n)=>{const r=((e,t,n)=>({...e,firstCol:Math.min(t,e.firstCol),lastCol:Math.max(t,e.lastCol),firstRow:Math.min(n,e.firstRow),lastRow:Math.max(n,e.lastRow)}))(e,t,n);return(0,C.J)(e,r)?e:r},c=(e,t)=>{const n=i[e][t];return null!=n&&("string"===typeof n?n.trim().length>0:"number"===typeof n)},m=(e,t,n)=>{for(const u of B){const l=e+u[0],m=t+u[1];i=m,(r=l)>=0&&r<s&&i>=0&&i<a&&!o[l][m]&&c(l,m)&&n.push({col:l,row:m})}var r,i},p=(e,t,n)=>{let s=((e,t,n)=>({sheetName:e,firstCol:t,lastCol:t,firstRow:n,lastRow:n}))(e,t,n);const a=[{col:t,row:n}];do{const{col:e,row:t}=(0,r.m0)(a.pop());!o[e][t]&&c(e,t)&&(o[e][t]=!0,s=l(s,e,t),m(e,t,a))}while(a.length>0);return s};for(let r=0;r<s;r+=1)for(let t=0;t<a;t+=1)if(!o[r][t]&&c(r,t)){const n=p(e,r,t);u.add(n)}const d=[...u].map((e=>{const s=(e=>t=>({type:{...e.type,columnNames:e.type.columnNames.slice(t.firstCol,t.lastCol+1),columnTypes:e.type.columnTypes.slice(t.firstCol,t.lastCol+1)},value:e.value.filter(((e,n)=>n>=t.firstCol&&n<=t.lastCol)).map((e=>e.slice(t.firstRow,t.lastRow+1)))}))(n)(e),a=(0,r.m0)(t.meta),{sheetId:o}=a;return{result:s,meta:{...a,sourceUrl:k((0,r.m0)(o),e.sheetName,(0,r.m0)(a.sourceMeta),e)}}}));return d},T=(e,t)=>e+t.length,I=e=>({result:{type:{kind:"type-error",errorCause:{errType:"free-form",message:e}},value:s.x4.UnknownValue.getData()}}),M=async(e,t,n)=>{const{identifyIslands:r=!1,maxCellCount:s}=n,o=await t.json();if(s){if(o.values.reduce(T,0)>s)return I("Too many cells to import. maximum is ".concat(s)).result}const i=r?o:$(o);return(0,a.Z)(e,i,{...n,doNotTryExpressionNumbersParse:!0})},E=async(e,t,n)=>{const{sheetId:r}=b(t),s=await h(r),a=((e,t)=>async n=>M(e,await fetch(n),t))(e,n),o=[];for(const u of s.sheets){const e=v(s.spreadsheetId,u.properties.sheetId,s);try{const t=await a(e),n={title:u.properties.title,importedAt:new Date,sourceUrl:e,sheetId:r,gid:u.properties.sheetId,sourceMeta:s};o.push({meta:n,result:t})}catch(i){o.push(I(i.message))}}return o},A=async(e,t,n)=>(await E(e,t,n)).flatMap((e=>{var t,n;return n=(0,r.m0)(null===(t=e.meta)||void 0===t?void 0:t.gid).toString(),S(n,e)})),D=async(e,t,n)=>{const{sheetId:r,gid:s}=b(t),a=await h(r),o=v(r,s,a);let i;try{i=await fetch(o)}catch(l){return[I(l.message)]}if(!i.ok)return[I(i.statusText||await i.text())];const u=await M(e,i,n);return[{meta:{title:a.properties.title,importedAt:new Date},result:u}]},O={name:"gsheets",matchUrl:e=>"docs.google.com"===e.hostname,import:async(e,t,n)=>(n.identifyIslands?A:D)(e,t,n),parseSourceUrl:e=>{const{sheetId:t,gid:n}=b(new URL(e)),r=n.indexOf("!"),s=n.substring(0,r)||"0",a=r>0,o=decodeURIComponent(n.slice(r+1)||"").split(":"),i=((e,t)=>"https://docs.google.com/spreadsheets/d/".concat(encodeURIComponent(e),"/edit#gid=").concat(encodeURIComponent(t)))(t,s);return{isRange:a,range:o,subsheetName:s,userUrl:i}}},R={name:"decipad",matchUrl:e=>("localhost"===e.hostname||e.hostname.endsWith(".decipad.com"))&&e.pathname.startsWith("/n/"),import:()=>{throw new Error("Decipad notebooks are not meant to be imported statically. Use a live connection instead")}};new Map([[".csv","csv"],[".arrow","arrow"],[".json","json"]]),new Map([["text/csv","csv"],["application/json","json"],["application/vnd.apache.arrow","arrow"]]);var P=n(20932),_=n(19015),V=n(17905);const q=e=>({type:{kind:"type-error",errorCause:{errType:"free-form",message:e}},value:s.x4.UnknownValue.getData()});function U(e){let t=e;switch("object"===typeof e&&"function"===typeof e.toString&&(t=e.toString()),t){case"Bool":case _.Dy.Bool:return{kind:"boolean"};case"Date":case"DateMillisecond":case"Date64<MILLISECOND>":case _.Dy.DateMillisecond:return{kind:"date",date:"millisecond"};case"Float":case"Float16":case"Float32":case"Float64":case _.Dy.Float:case _.Dy.Float16:case _.Dy.Float32:case _.Dy.Float64:return{kind:"number",unit:null};case"Dictionary<Int32, Utf8>":case"Utf8":case _.Dy.Utf8:return{kind:"string"};default:return{kind:"type-error",errorCause:{errType:"free-form",message:"Don't know how to convert from arrow type ".concat(t," to internal type")}}}}const F=e=>{const t=typeof e;if(null==e)return s.x4.UnknownValue.getData();if("number"===t)return(0,P.N)(e);if("boolean"===t||"string"===t)return e;if("object"===typeof e){if(e instanceof Date)return BigInt(e.getTime());if("toString"in e&&"function"===typeof e.toString)return e.toString()}return s.x4.UnknownValue.getData()},L=(e,t)=>{const n=[];for(let s=0;s<t.numCols;s+=1){const e=(0,r.m0)(t.getChildAt(s),"expected column at ".concat(s)),a=[];for(let t=0;t<e.length;t+=1)a.push(F(e.get(t)));n.push(a)}return n},Z=async e=>{const t=await(0,V.p)(e),n=(e=>{const t=[],n=[];for(let a=0;a<e.numCols;a+=1){const o=e.schema.fields[a];try{const s=U((0,r.m0)(e.getChildAt(a)).type);t.push(s),n.push(o.name)}catch(s){return{kind:"type-error",errorCause:{errType:"free-form",message:"Error inferring type of column ".concat(o.name,": ").concat(s.message)}}}}return{kind:"table",indexName:n[0],columnTypes:t,columnNames:n}})(t);return"table"===n.kind?{type:n,value:L(0,t)}:"type-error"===n.kind?{type:n,value:s.x4.UnknownValue.getData()}:q("Unexpected result of type ".concat(n.kind))};var z=n(43121);const j=e=>{const t=[];for(const n of e)n.forEach(((e,n)=>{const r=t[n]||[];r.push(e),t[n]=r}));return t},J=async(e,t,n)=>{const r=await t.text();return new Promise(((t,s)=>{const o=[],i=(0,z.Qc)({cast:!0,trim:!0,delimiter:[",",";"],relax_quotes:!0,relax_column_count:!0,skip_empty_lines:!0});let u=!1;i.on("readable",(()=>{let e;for(;e=i.read();)u||o.push(e)})),i.once("end",(async()=>{u=!0;try{const r=$({values:j(o)});t(await(0,a.Z)(e,r,{...n,doNotTryExpressionNumbersParse:!0}))}catch(r){s(r)}})),i.once("error",s),i.end(r)}))},H=(e,t)=>{if(0===e.length)return{type:{kind:"anything"},value:s.x4.UnknownValue.getData()};if(e.some((e=>Array.isArray(e))))return((e,t)=>0===e.length?q("Don`t know how to import empty array"):G(Object.fromEntries(e.map(((e,t)=>[(0,a.PU)(t),e]))),t))(e,t);const n=e.map((e=>K(e,t)));return(e=>{if(0===e.length)return!0;const t=e[0];for(const n of e.slice(1))if(!(0,C.J)(n,t))return!1;return!0})(n.map((e=>{let{type:t}=e;return t})))?{type:{kind:"column",indexedBy:null,cellType:n[0].type,columnSize:"unknown"},value:n.map((e=>e.value))}:q("not all elements of array are of same type")},G=(e,t)=>{const n=Object.entries(e);if(n.length<0)return q("Don`t know how to import an empty object");const r=n.map(((e,t)=>{let[,n]=e;return[t,n]})).map((e=>{var n;let[r,s]=e;return K(s,t,null===(n=t.columnTypeCoercions)||void 0===n?void 0:n[r])})),a=r.map((e=>null==e.value?s.x4.UnknownValue.getData():"column"===e.type.kind||"type-error"===e.type.kind?e.value:[e.value])),o=Object.keys(e);return{type:{kind:"table",columnNames:o,columnTypes:r.map((e=>"column"===e.type.kind?e.type.cellType:e.type)),indexName:o[0]},value:a}},K=(e,t,n)=>{if(Array.isArray(e))return H(e,t);const r=typeof e;if("string"===(null===n||void 0===n?void 0:n.kind))return{type:{...n},value:e.toString()};if(("number"===r||"bigint"===r)&&"date"===(null===n||void 0===n?void 0:n.kind))return{type:{...n},value:BigInt(e)};if("number"===r||"bigint"===r||"string"===r&&"number"===(null===n||void 0===n?void 0:n.kind))return{type:{kind:"number",unit:null},value:(0,P.N)(e)};if("boolean"===r||"string"===r&&"boolean"===(null===n||void 0===n?void 0:n.kind))return{type:{kind:"boolean"},value:"boolean"===r?e:(0,a.gx)(e)};if("string"===r){const t=e.trim();if(t){if("date"===(null===n||void 0===n?void 0:n.kind)){const e=(0,a.sG)(t,n.date);if(e)return{type:{...n},value:BigInt(e.date.getTime())}}return{type:{kind:"string"},value:e}}return{type:{kind:"anything"},value:s.x4.UnknownValue.getData()}}return"object"===r&&null!=e?G(e,t):{type:{kind:"anything"},value:s.x4.UnknownValue.getData()}},W=async(e,t,n,r)=>{if(!t.ok)throw new Error("failed to fetch from ".concat(r," with response ").concat(t.status,": ").concat(t.statusText));const s=t.headers.get("content-type");let a;return a=null!==s&&void 0!==s&&s.startsWith("application/json")?K(await t.json(),n):null!==s&&void 0!==s&&s.startsWith("text/csv")?await J(e,t,n):null!==s&&void 0!==s&&s.startsWith("application/vnd.apache.arrow")?await Z(t):{type:{kind:"string"},value:await t.text()},[{meta:{sourceUrl:r},result:a}]},Y=(e,t,n)=>t instanceof URL?async function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{return W(e,await fetch(t),n,t)}catch(r){throw console.error("Error making request to ".concat(t),r),r}}(e,t,n):W(e,t,n),X=function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(n)switch(n){case"gsheets":return O.import(e,t,r);case"decipad":return R.import()}return Y(e,t,r)};var ee=n(93361),te=n(41580);var ne=n(97350),re=n(25555);const se=new ne.RPC({target:{postMessage:e=>{self.postMessage(e)}},receiver:{readMessages:e=>{const t=t=>{e(t)};return self.addEventListener("message",t),()=>self.removeEventListener("message",t)}},serviceId:"live-connect"}),ae=new Map,oe=async(e,t)=>{const n=ae.get(t);if(n)try{const r=await async function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const{identifyIslands:s,...a}=r;let o=await X(e,t,n,r);return 1===o.length&&s&&(o=await X(e,t,n,a)),o}(e,new URL(n.params.url),n.params.source,{useFirstRowAsHeader:n.params.useFirstRowAsHeader,columnTypeCoercions:n.params.columnTypeCoercions,maxCellCount:n.params.maxCellCount});for(const e of r)n.notify(e)}catch(r){console.error("subscription ".concat(t,": caught error while trying to import from ").concat(n.params.url),r),me(t,n.params)(r)}finally{ie(e,t)}},ie=(e,t)=>{const n=ae.get(t);n&&setTimeout((()=>oe(e,t)),1e3*(n.params.pollIntervalSeconds||30))},ue=e=>async t=>{let n;if(!(0,C.J)(n,t)){n=t;const r=t;await se.call("notify",{subscriptionId:e,newResponse:r})}},le=e=>{const t=ae.get(e);t&&(t.timer&&clearTimeout(t.timer),t.subscription&&t.subscription.unsubscribe(),ae.delete(e))},ce=e=>{for(const t of ae.values())if(t.params.source===e.params.source&&t.params.url===e.params.url)return!0;return!1},me=(e,t)=>n=>{console.error("Worker: error caught on worker ".concat(t.url,": ").concat(n.message),n),se.call("notify",{subscriptionId:e,error:n.message})},pe=async(e,t)=>{const r=((e,t)=>n=>{setTimeout((()=>{me(e,t)(new Error(n))}),0)})(e,t.params);ae.set(e,t);const{params:a}=t;if("decipad"===a.source){const{startNotebook:s}=await Promise.all([n.e(3321),n.e(9306),n.e(6896),n.e(7082),n.e(7872)]).then(n.bind(n,17872)),{docId:i}=(0,ee.k)(t.params.url),{hasAccess:u,exists:l}=await(async e=>{const t=await(0,te.h)("/api/pads/".concat(encodeURIComponent(e)));if(403===t.status)return{hasAccess:!1,exists:!0,isPublic:!1};if(404===t.status)return{hasAccess:!1,exists:!1,isPublic:!1};const n=await t.json();return n?{exists:!0,hasAccess:!0,isPublic:!!n.isPublic}:{exists:!1,hasAccess:!1,isPublic:!1}})(i),c=l?u?void 0:"You don't have access to this notebook":"Notebook does not exist";if(c)return void r(c);await s(t,(o=e,async function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{if(ce(e))throw new Error("Circular dependency detected for ".concat(e.params.url));const t=(0,re.x0)();await pe(t,e);let n=!1;return{get closed(){return n},unsubscribe:()=>{n=!0,le(t)}}}catch(n){if(t)throw n;se.call("notify",{subscriptionId:o,error:n.message})}}),me(e,a))}else{const t=new s.ar;ie(t,e),setTimeout((()=>{oe(t,e)}),0)}var o};se.expose("subscribe",(async e=>{const t=(0,re.x0)(),n={params:e,notify:ue(t)};return await pe(t,n),t})),se.expose("unsubscribe",(async e=>{let{subscriptionId:t}=e;le(t)}))},20932:(e,t,n)=>{n.d(t,{N:()=>N,ry:()=>k,gE:()=>B,xE:()=>Q,ZP:()=>E,V:()=>w,xV:()=>g,Rg:()=>h,o8:()=>y,Fp:()=>M,VV:()=>T});var r=n(26290),s=n.n(r),a=n(27367),o=n.n(a);const i=["n","d","s"],u=e=>"object"===typeof e&&null!=e&&i.every((t=>((e,t)=>{if(!(t in e))return!1;const n=typeof e[t];return"number"===n||"bigint"===n||"string"===n})(e,t))),l=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(t.length<1)throw new Error("dont know the minimum of an empty set of fractions");const[r,...s]=t;return s.reduce(((e,t)=>e.compare(t)<0?e:t),r)},c=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(t.length<1)throw new Error("dont know the maximum of an empty set of fractions");const[r,...s]=t;return s.reduce(((e,t)=>e.compare(t)>0?e:t),r)};BigInt.prototype.toJSON=function(){return this.toString()},o().prototype[Symbol.for("nodejs.util.inspect.custom")]=function(e,t){return"Fraction { ".concat(t.stylize(this.toString(),"number")," }")};const m=e=>{const t=typeof e;return"number"===t||"bigint"===t},p=(e,t)=>null!=t?p(e).div(p(t)):e instanceof o()?e:"string"===typeof e?new(o())(e):u(e)&&m(e.s)&&m(e.n)&&(void 0===e.d||m(e.d))?new(o())(BigInt(e.s)*BigInt(e.n),e.d):new(o())(e),d=o(),f=(p(0),p(1),e=>p(e)),y=e=>e instanceof $&&null==e.n&&null==e.d&&null==e.s,g=e=>e instanceof $&&!y(e)&&!h(e),h=e=>e instanceof $&&!!e.infinite,b=e=>g(e)&&0n===e.n,v=(e,t,n)=>{if(y(e)||h(e))return e;if(t instanceof $&&(y(t)||h(t)))return t;const r=n.call(e,t);return x(r)},w=e=>"bigint"===typeof e||"object"===typeof e&&null!=e&&(e instanceof $||"n"in e&&("number"===typeof e.n||"bigint"===typeof e.n||"string"===typeof e.n)||"infinite"in e&&"boolean"===typeof e.infinite),x=(e,t)=>{if(null==e)return new $({});if(e instanceof $)return null==t?e:e.div(x(t));const n=typeof e;if("number"===n||"bigint"===n||"string"===n)return null==t?new $(e):x(e).div(x(t));if(u(e)||w(e))return new $(e);throw new Error("Could not convert ".concat(e," of type ").concat(typeof e," to number"))},N=x;class ${constructor(e){if(s()(this,"n",void 0),s()(this,"d",void 0),s()(this,"s",void 0),s()(this,"infinite",!1),null!=e){if("string"===typeof e||"bigint"===typeof e||"number"===typeof e){if("number"===typeof e){if(Number.isNaN(e))return;if(!Number.isFinite(e))return this.s=BigInt(Math.sign(e)),void(this.infinite=!0)}const t=f(e);return this.n=t.n,this.d=t.d,void(this.s=t.s)}if(null!=e.d||null!=e.n||e.infinite)if("number"!==typeof e.n||Number.isFinite(e.n)){if("number"===typeof e.d&&!Number.isFinite(e.d))return this.n=0n,this.d=1n,void(this.s=BigInt(Math.sign(Number(e.n))*Math.sign(Number(e.d))));if(!e.d){if(e.n)return this.infinite=!0,void(this.s=BigInt(Math.sign(Number(e.n))*Math.sign(Number(e.d))));if(!e.infinite)return}if(u(e)){const t=f(e);this.n=t.n,this.d=t.d,this.s=t.s}else{var t;this.s=BigInt(Number(null!==(t=e.s)&&void 0!==t?t:1)),this.infinite=!!e.infinite}}else{if(Number.isNaN(e.n))return;Number.isFinite(e.d)&&(this.infinite=!0,this.s=null!=e.s?BigInt(e.s):1n)}}}abs(){return y(this)||h(this)?this:x(d.prototype.abs.call(this))}neg(){return y(this)?this:h(this)?new $({infinite:!0,s:-this.s}):x(d.prototype.neg.call(this))}add(e){return v(this,e,d.prototype.add)}sub(e){return v(this,e,d.prototype.sub)}mul(e){return v(this,e,d.prototype.mul)}div(e){var t,n,r;return g(e)&&b(e)?g(this)&&b(this)?new $({n:void 0,d:void 0,s:null!==(n=this.s)&&void 0!==n?n:0n*e.s,infinite:!1}):new $({n:void 0,d:void 0,s:null!==(t=this.s)&&void 0!==t?t:0n*e.s,infinite:!0}):h(this)&&g(e)?new $({n:void 0,d:void 0,s:null!==(r=this.s)&&void 0!==r?r:0n*e.s,infinite:!0}):h(e)?g(this)?Q:new $({}):v(this,e,d.prototype.div)}fractionPow(e){return((e,t)=>{const n=d.prototype.pow.call(e,t);if(null==n||0===n.compare(0)){const n=e.valueOf()**t.valueOf();if(Number.isNaN(n))throw new TypeError("**: result of raising to ".concat(t.toString()," is not rational"));return p(n)}return n})(this,e)}pow(e){return v(this,e,$.prototype.fractionPow)}gcd(e){return v(this,e,d.prototype.gcd)}lcm(e){return v(this,e,d.prototype.lcm)}mod(e){return v(this,e,d.prototype.mod)}ceil(e){return v(this,e,d.prototype.ceil)}floor(e){return v(this,e,d.prototype.floor)}round(e){return v(this,e,d.prototype.round)}inverse(){return v(this,void 0,d.prototype.inverse)}simplify(e){return v(this,e,d.prototype.simplify)}compare(e){const t=g(this)?this:Q.mul("number"===typeof this.s||"bigint"===typeof this.s?N(this.s):N(1)),n=g(e)?e:Q;return d.prototype.compare.call(t,n)}equals(e){return y(this)||y(e)?y(this)&&y(e):h(this)||h(e)?h(this)&&h(e)&&(t=e,this.s===t.s)||!1:d.prototype.equals.call(this,e);var t}divisible(e){return g(this)&&g(e)&&d.prototype.divisible.call(this,e)}valueOf(){return y(this)?NaN:h(this)?this.s<0?-1/0:1/0:d.prototype.valueOf.call(this)}toString(e){return y(this)?"?":h(this)?"".concat(this.s<0?"-":"","\u221e"):d.prototype.toString.call(this,e)}toLatex(e){return y(this)||h(this)?this.toString():d.prototype.toLatex.call(this,e)}toFraction(e){return y(this)||h(this)?this.toString():d.prototype.toFraction.call(this,e)}toContinued(){return y(this)?[]:h(this)?[Number(this.s)*(1/0),1]:d.prototype.toContinued.call(this)}clone(){return x(this)}isZero(){return this.equals(Q)}static undefined(){return C}static infinite(){return N({infinite:!0,s:arguments.length>0&&void 0!==arguments[0]?arguments[0]:1})}}const C=N(void 0),Q=N(0),k=N(1),B=N(2),S=e=>h(e)&&e.s<0n,T=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(const r of t){if(y(r))return E.undefined();if(S(r))return E.infinite(-1)}return N(l(...t.filter(g)))},I=e=>h(e)&&e.s<0n,M=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(const r of t){if(y(r))return E.undefined();if(I(r))return E.infinite()}return N(c(...t.filter(g)))},E=$},85996:(e,t,n)=>{n.d(t,{PU:()=>O,Wg:()=>j,$F:()=>E,Z:()=>q,O3:()=>B,gx:()=>a,B1:()=>z,sG:()=>h,yb:()=>J,JO:()=>K});var r=n(55013);const s=e=>{switch(e.toLowerCase().trim()){case"true":case"yes":return"true";default:return"false"}},a=e=>{switch(e.toLowerCase()){case"true":case"yes":return!0}return!1},o=e=>{switch(e.toLowerCase()){case"true":case"false":return{type:{kind:"boolean"},coerced:s(e)}}};var i=n(93492),u=n(25151),l=n(20856);const c=new Map(Object.entries({year:1,month:2,day:3,hour:4,minute:5,second:6,millisecond:6})),m=function(){let e,t=-1;for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];for(const a of r){const n=c.get(a);n&&n>t&&(t=n,e=a)}return e},p=(e,t)=>{const n=[];for(const r of e)for(const e of t)n.push("".concat(r," ").concat(e));return n},d=["dd-MM-yyyy","yyyy-MM-dd","dd/MM/yyyy","yyyy/MM/dd","P","PP","PPP"],f=["HH:mm","HHmm","h:m aaa","hh:mm aaa","hhmm aaa"],y=["s","ss"],g={year:["yy","yyyy"],month:["yyyy-MM","MM-yyyy","yyyy/MM","MM/yyyy","MMM yyyy","MMMM yyyy","MMM/yyyy","MMMM/yyyy","MMM-yyyy","MMMM-yyyy"],day:d,hour:p(d,["HH"]),minute:p(d,f),second:p(p(d,f),y),millisecond:p(p(p(d,f),y),["S","SS","SSS","SSSS"])},h=(e,t,n)=>{const r=n&&t?{[t]:n}:t?(e=>Object.fromEntries(Object.entries(g).filter((t=>{let[n]=t;return e===n}))))(t):g;for(const a of Object.keys(r)){const t=r[a];for(const n of t){const t=(0,l.Z)(e,n,new Date);if(null!=(s=t)&&!Number.isNaN(s.valueOf()))return{format:n,specificity:a,date:t}}}var s},b=(e,t)=>{if(!(0,i.Z)(e))throw new Error("invalid date");switch(t){case"year":return"date(".concat((0,u.Z)(e,"yyyy"),")");case"month":return"date(".concat((0,u.Z)(e,"yyyy-MM"),")");case"day":return"date(".concat((0,u.Z)(e,"yyyy-MM-dd"),")");case"hour":return"date(".concat((0,u.Z)(e,"yyyy-MM-dd HH"),")");case"minute":return"date(".concat((0,u.Z)(e,"yyyy-MM-dd HH:mm"),")");default:return"date(".concat((0,u.Z)(e,"yyyy-MM-dd HH:mm:ss"),")")}},v=(e,t,n)=>{const r=h(e,t,n);if(r)return{type:{kind:"date",date:r.specificity},coerced:b(r.date,r.specificity)}};var w=n(13986);const x=e=>JSON.stringify(e),N=e=>({type:{kind:"string"},coerced:x(e)}),$=e=>{const t=Number(e);if(!Number.isNaN(t))return{type:{kind:"number",unit:null},coerced:e}},C=async function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(n.doNotTryExpressionNumbersParse)return $(t);if((0,r.zg)(t))try{const n=(0,w.s$)(t),r=await e.expressionType(n);if("number"===(await r).kind)return{type:r,coerced:t}}catch(s){}},Q=(e,t)=>({type:{kind:"type-error",errorCause:{errType:"free-form",message:t?"Cannot parse ".concat(t,' out of "').concat(e,'"'):'Cannot parse "'.concat(e,'"')}},coerced:e}),k=async(e,t,n)=>{var s,a,i,u,l,c;let m=null!==(s=null!==(a=null!==(i=null!==(u=null!==(l=null!==(c=v(t,"month"))&&void 0!==c?c:v(t,"day"))&&void 0!==l?l:o(t))&&void 0!==u?u:await C(e,t,n))&&void 0!==i?i:v(t))&&void 0!==a?a:n.doNotTryExpressionNumbersParse?void 0:await(async(e,t)=>{try{const n=(0,w.s$)(t),r=await e.expressionType(n);if("noop"!==n.type)return{type:r,coerced:t}}catch{}})(e,t))&&void 0!==s?s:{type:{kind:"string"},coerced:t};return"number"!==m.type.kind||(0,r.zg)(t)||(m={type:{kind:"string"},coerced:t}),m},B=async function(e,t){var n,r,s,a;let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const u=t.trim(),{type:l}=i;switch(null===l||void 0===l?void 0:l.kind){case"boolean":return null!==(n=o(u))&&void 0!==n?n:Q(u,l.kind);case"date":return null!==(r=v(u))&&void 0!==r?r:Q(u,l.kind);case"number":return null!==(s=await C(e,u,i))&&void 0!==s?s:Q(u,l.kind);case"string":return null!==(a=N(u))&&void 0!==a?a:Q(u,l.kind);case"anything":case"nothing":case void 0:return u?k(e,u,i):{type:{kind:"anything"},coerced:u};default:return{type:null!==l&&void 0!==l?l:Q(u)}}};var S=n(79568),T=n(50096);const I={isEqual:(e,t)=>e instanceof w.ar&&t instanceof w.ar?e===t:(0,S.J)(e,t),maxSize:1e4},M=(e,t)=>(0,T.Z)(e,{...I,...t}),E=M((async function(e,t){var n,s;let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=a.userType;if(o&&"anything"!==(null===(n=o)||void 0===n?void 0:n.kind))return o;const i=e=>{const t="type-error"===e.kind?{kind:"string"}:e;if("anything"!==t.kind&&"nothing"!==t.kind)if(o&&"anything"!==o.kind&&"nothing"!==o.kind)if(t.kind!==o.kind)o={kind:"string"};else if("date"===t.kind){const e=o;if(t.date!==e.date){const n=m(e.date,t.date);n&&(o={kind:"date",date:n})}}else"number"===t.kind&&("number"!==o.kind?o={kind:"string"}:!o.unit&&t.unit?o=t:t.unit&&o.unit&&!(0,w.or)(t.unit,o.unit)&&(o={kind:"string"}));else o=t};for(const u of t.slice(0,100))switch(typeof u){case"boolean":i({kind:"boolean"});break;case"number":"string"!==typeof u||(0,r.zg)(u)?i({kind:"number",unit:null}):i({kind:"string"});break;case"string":i((await B(e,u,a)).type);break;case"undefined":case"object":null==u&&i({kind:"nothing"});break;default:throw new Error("Unexpected type of value: ".concat(typeof u))}return null!==(s=o)&&void 0!==s?s:{kind:"string"}}),{maxSize:1e3}),A="ABCDEFGHIJKLMNOPQRSTUVWXYZ",D=A.length;function O(e){const t=A[e%A.length];if(e>=D){return O(Math.floor(e/D)-1)+t}return t}var R=n(20932);const P=e=>{if("number"===typeof e||"bigint"===typeof e)return e;const t=Number(e.replaceAll(/[^.0-9]/g,""));if(!Number.isNaN(t))return t;console.warn('"'.concat(t,'" was not parsable to a number'))},_=e=>{var t;const n=P(e);if(null==n)return[0,void 0];if(Math.floor(Number(n.valueOf()))===Number(n.valueOf()))return[0,void 0];const r=n.toString(10);if(r.indexOf("e")>=0){const e=r.split("e"),[t,n]=_(Number(e[0]));return[-Number(e[1])+t,n]}const s=r.split(".");return[(null===(t=s[1])||void 0===t?void 0:t.length)||0,s.join("")]};function V(e,t){return t.map(((t,n)=>{const r=e[n];return t.map((e=>{var t,n,s;switch(null===r||void 0===r?void 0:r.kind){case"number":return(e=>{if("string"===typeof e&&e.length<1)return R.xE;const[t,n]=_(e);try{return"string"===typeof n&&n.length<1?R.xE:0===t?(0,R.N)(P(e)):(0,R.N)(P(null!==n&&void 0!==n?n:""),BigInt(10**t))}catch(r){throw console.error("Error trying to convert to number",e,[t,n],r),r}})(e);case"date":return BigInt(null!==(t=null===(n=h(e))||void 0===n?void 0:n.date.getTime())&&void 0!==t?t:0);case"string":return null!==(s=e)&&void 0!==s?s:"";default:return e.toString()}}))}))}const q=async(e,t,n)=>{const{columnNames:s,columnValues:a}=((e,t)=>t.useFirstRowAsHeader?{columnNames:e.values.map((e=>{var t;return(0,r.pG)((null!==(t=e[0])&&void 0!==t?t:"_").toString())})),columnValues:e.values.map((e=>e.slice(1)))}:{columnNames:e.values.map(((e,t)=>O(t))),columnValues:e.values})(t,n),o=await Promise.all(a.map((async(t,r)=>{var s,a,o;return null!==(s=null===(a=n.columnTypeCoercions)||void 0===a?void 0:a[r])&&void 0!==s?s:E(e,t,{doNotTryExpressionNumbersParse:n.doNotTryExpressionNumbersParse,userType:null===(o=n.columnTypeCoercions)||void 0===o?void 0:o[r]})})));return{type:{kind:"table",columnTypes:o,columnNames:s,indexName:s[0]},value:V(o,a)}};var U=n(37114);const F=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return{type:e,args:n}},L=(e,t)=>{const n=[];return n.push("year",BigInt(t.getUTCFullYear())),"date"===e.kind&&"year"===e.date||(n.push("month",BigInt(t.getUTCMonth()+1)),"date"===e.kind&&"month"===e.date||(n.push("day",BigInt(t.getUTCDate())),"date"===e.kind&&"day"===e.date||(n.push("hour",BigInt(t.getUTCHours())),n.push("minute",BigInt(t.getUTCMinutes()))))),F("date",...n)},Z="en-US";const z=M((async(e,t,n)=>{if("table-formula"===t.kind||"series"===t.kind||"dropdown"===t.kind||!n.trim())return null;try{return await(async(e,t,n,s)=>{const a=await B(e,n,{type:t});if("type-error"===a.type.kind)return new Error((0,U.Z)(Z,a.type.errorCause));if(!a.coerced)return null;const o=(0,w.fh)(a.coerced);if(o.error)return new Error(o.error.message);if(!o.solution||!(0,w.UT)(o.solution))return new Error("is not a valid expression");"literal"===o.solution.type&&"number"===t.kind&&"percentage"===t.numberFormat&&"number"===o.solution.args[0]&&"percentage"!==o.solution.args[2]&&(o.solution.args[2]="percentage",o.solution.args[1]=o.solution.args[1].div((0,R.N)("100")));let i=await e.expressionResult(o.solution);if("type-error"===i.type.kind)return new Error((0,U.Z)(Z,i.type.errorCause));if(t.kind&&"anything"!==t.kind&&t.kind!==i.type.kind)return new Error('Could not parse "'.concat(n,'" into a ').concat(t.kind));"number"!==i.type.kind||(0,r.zg)(n)||(i={type:{kind:"string"},value:n});try{return s(i)}catch(u){return u}})(e,t,n,(async e=>{const{type:r}=e;switch(r.kind){case"number":{if(function(e,t){if(e.kind&&e.kind!==t)throw new Error("Expected input of type ".concat(t))}(t,"number"),!t.unit&&r.unit)return new Error("unexpected unit in number");const n=t.unit&&(e=>e.map((e=>({...e,multiplier:(0,R.N)(e.multiplier),exp:(0,R.N)(e.exp)}))))(t.unit);if(r.unit&&n){if(!(0,w.or)(r.unit,n))return new Error("cannot convert ".concat((0,U.Ac)("en-US",r.unit)," to ").concat((0,U.Ac)("en-US",n)," "));e.value=(0,w.kc)((0,w.WR)(e.value,r.unit,n),n)}if(r.numberFormat)return F("literal","number",(0,R.N)(e.value),r.numberFormat);const s=F("literal","number",(0,R.N)(e.value)),a=(e=>{if(null==e)return null;const t=(0,U.KP)(e),n=(0,w.IX)(t).solution;return n&&n.args.length>0?n.args[0]:null})(n);return null==a?s:F("function-call",F("funcref","implicit*"),F("argument-list",s,a))}case"date":return L(t,new Date(Number(e.value)));case"boolean":return F("literal","boolean","true"===n||"yes"===n);case"string":return F("literal","string",n)}return new Error("Could not parse a ".concat(t.kind,' out of "').concat(n,'"'))}))}catch(s){throw console.error("error parsing cell:",s),s}})),j=e=>"date"===e.kind?L(e,new Date("2020-01-01")):"number"===e.kind?F("literal","number",R.xE):"boolean"===e.kind?F("literal","boolean",!1):"dropdown"===e.kind&&"number"===e.type?F("literal","number",R.xE):F("literal","string",""),J=(e,t)=>{if("date"===e){const n=h(t);return n?{type:e,granularity:n.specificity,value:BigInt(n.date.getTime())}:{type:e,error:"Could not parse date"}}throw new Error("unknown series type ".concat(e))};var H=n(53445);const G={year:{years:1},month:{months:1},day:{days:1},hour:{hours:1},minute:{minutes:1},second:{seconds:1},millisecond:{seconds:.001}},K=(e,t,n)=>{if(null==t)throw new Error("Date series requires granularity");if("date"===e)return((e,t)=>{const n=h(t,e);if(!n)throw new Error("Could not parse date ".concat(t));const{format:r}=n;let s=n.date;const a=G[e];return{next:()=>(s=(0,H.Z)(s,a),{value:(0,u.Z)(s,r)})}})(t,n)}},55013:(e,t,n)=>{n.d(t,{VO:()=>r,zg:()=>s,m0:()=>a,xF:()=>o,yR:()=>i,x8:()=>u,pf:()=>l,LH:()=>h,FL:()=>c,Tw:()=>m,Ri:()=>p,pG:()=>f,$R:()=>y});const r=e=>e instanceof Map||Array.isArray(e)?new Map(e):new Map(Object.entries(e)),s=e=>!!e.match(/[0-9]+/);function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"is not defined";if(null==e)throw new TypeError(t);return e}function o(e,t){if(1!==e.length)throw new TypeError(null!==t&&void 0!==t?t:"panic: getOnly() expected an array with a single item, got ".concat(e.length));return e[0]}const i=e=>e,u=(e,t)=>{const n=[];for(let r=0;r<e.length;r+=1){const s=[e[r],t[r]];n.push(s)}return n};function l(e){const t=new Map;return function(n){if(t.has(n))return t.get(n);for(var r=arguments.length,s=new Array(r>1?r-1:0),a=1;a<r;a++)s[a-1]=arguments[a];const o=e(n,...s);return t.set(n,o),o}}function c(e){if("string"===typeof e)throw new Error(e);throw e}function m(e){return Array.from(new Set(e))}const p=e=>{const t=[],n=[];for(const[r,s]of e)t.push(r),n.push(s);return[t,n]};var d=n(50576);const f=e=>(e=>{var t,n;return(null!==(t=null===(n=e[0])||void 0===n?void 0:n.toUpperCase())&&void 0!==t?t:"")+e.slice(1)})((0,d.camelCase)(e.replaceAll(" ","_"))),y=(e,t)=>{if(e.length!==t.length)throw new Error("panic: cannot zip arrays of different lengths");return u(e,t)};function g(){return this.toString()}const h=(0,n(20548).IHq)((()=>{BigInt.prototype.toJSON=g}))},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},71017:e=>{e.exports=require("path")},4074:e=>{e.exports=require("perf_hooks")},77282:e=>{e.exports=require("process")},85477:e=>{e.exports=require("punycode")},12781:e=>{e.exports=require("stream")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")}},t={};function n(r){var s=t[r];if(void 0!==s)return s.exports;var a=t[r]={id:r,loaded:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.loaded=!0,a.exports}n.m=e,n.x=()=>{var e=n.O(void 0,[5151,2513,7350,9314],(()=>n(96206)));return e=n.O(e)},(()=>{var e=[];n.O=(t,r,s,a)=>{if(!r){var o=1/0;for(c=0;c<e.length;c++){for(var[r,s,a]=e[c],i=!0,u=0;u<r.length;u++)(!1&a||o>=a)&&Object.keys(n.O).every((e=>n.O[e](r[u])))?r.splice(u--,1):(i=!1,a<o&&(o=a));if(i){e.splice(c--,1);var l=s();void 0!==l&&(t=l)}}return t}a=a||0;for(var c=e.length;c>0&&e[c-1][2]>a;c--)e[c]=e[c-1];e[c]=[r,s,a]}})(),n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},(()=>{var e,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__;n.t=function(r,s){if(1&s&&(r=this(r)),8&s)return r;if("object"===typeof r&&r){if(4&s&&r.__esModule)return r;if(16&s&&"function"===typeof r.then)return r}var a=Object.create(null);n.r(a);var o={};e=e||[null,t({}),t([]),t(t)];for(var i=2&s&&r;"object"==typeof i&&!~e.indexOf(i);i=t(i))Object.getOwnPropertyNames(i).forEach((e=>o[e]=()=>r[e]));return o.default=()=>r,n.d(a,o),a}})(),n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.f={},n.e=e=>Promise.all(Object.keys(n.f).reduce(((t,r)=>(n.f[r](e,t),t)),[])),n.u=e=>"static/js/"+e+"."+{2513:"c96caaff",3321:"a7706e63",5151:"0d79bbbb",6896:"82550df3",7082:"8c9fd82c",7350:"41baa7e8",7872:"0cd9dd2a",9306:"eace2a0a",9314:"f0f0b16d"}[e]+".chunk.js",n.miniCssF=e=>{},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),n.p="/",n.nc=void 0,(()=>{var e={5169:1};n.O.require=t=>e[t];n.f.require=(t,r)=>{e[t]||(t=>{var r=t.modules,s=t.ids,a=t.runtime;for(var o in r)n.o(r,o)&&(n.m[o]=r[o]);a&&a(n);for(var i=0;i<s.length;i++)e[s[i]]=1;n.O()})(require("../../"+n.u(t)))}})(),(()=>{var e=n.x;n.x=()=>(n.e(5151),n.e(2513),n.e(7350),n.e(9314),e())})();var r=n.x(),s=exports;for(var a in r)s[a]=r[a];r.__esModule&&Object.defineProperty(s,"__esModule",{value:!0})})();
//# sourceMappingURL=5169.030e485c.chunk.js.map