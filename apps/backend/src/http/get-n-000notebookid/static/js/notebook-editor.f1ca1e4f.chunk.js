"use strict";exports.id=9209,exports.ids=[9209],exports.modules={67467:(e,o,t)=>{t.r(o),t.d(o,{default:()=>he});var r=t(30969),n=t(78819),i=t(27103),s=t(83527),l=t(60357),a=t(60046),c=t(13986),d=t(85663),p=t(5594);const{Provider:u,useStore:h}=(0,s.Z)(),g=()=>{let e;const o=new Promise((o=>{e=o}));return{syncClientState:"idle",editor:void 0,computer:new c.ar,loadedFromLocal:!1,loadedFromRemote:!1,timedOutLoadingFromRemote:!1,hasLocalChanges:!1,initialFocusDone:!1,notebookLoadedPromise:o,resolveNotebookLoadedPromise:()=>e}},m=()=>(0,i.Ue)(((e,o)=>({...g(),initEditor:(t,r,i)=>{let{plugins:s,docsync:c}=r;if(null==c.initialState)return;const{editor:p,syncClientState:u}=o();if(p){if("created"===u&&p.id===t&&p.isReadOnly===c.readOnly&&!p.destroyed)return;try{p.disconnect(),p.destroy()}catch(y){console.error("error destroying old docsync instance",y)}}const h=(0,d.Y_)({id:t,plugins:s,disableCorePlugins:{history:!0}}),g=setTimeout((()=>{e({timedOutLoadingFromRemote:!0});const{resolveNotebookLoadedPromise:t}=o();t()()}),5e3),m=(0,n.L)(t,{...c,editor:h,onError:l.Tb},i),f=t=>{if("local"===t)e({loadedFromLocal:!0});else if("remote"===t){clearTimeout(g),e({loadedFromRemote:!0}),m.offLoaded(f);const{resolveNotebookLoadedPromise:t}=o();setTimeout((()=>{t()()}),0)}};m.onLoaded(f),m.hasLocalChanges().pipe((0,a.take)(1)).subscribe((()=>{e({hasLocalChanges:!0})})),e({editor:m,notebookHref:window.location.pathname,syncClientState:"created",loadedFromLocal:!1,loadedFromRemote:!1,timedOutLoadingFromRemote:!1,hasLocalChanges:!1})},setInitialFocusDone:()=>{e({initialFocusDone:!0})},destroy:()=>{const{syncClientState:t,editor:r}=o();"created"===t&&(null===r||void 0===r||r.disconnect(),null===r||void 0===r||r.destroy(),e(g()))}}))),f=e=>{let{children:o}=e;return(0,p.tZ)(u,{createStore:m,children:o})},y=()=>h();var b=t(1146),v=t(53559),Z=t(33639),D=t(27597),w=t(58299),S=t(82302),C=t(68825),k=t(88310),x=t(426),E=t(57481),L=t(79820);const P=(0,x.css)({width:"100%",backgroundColor:E.ZP.rgb,borderRadius:16},";label:-Progress--wrapper;"),R=(0,x.css)({minWidth:30,height:20,borderRadius:16,backgroundColor:E.$c.rgb,display:"flex",justifyContent:"end",alignItems:"center",padding:"2px 6px 2px 0px",marginTop:8,transition:"width 0.5s"},";label:-Progress--progressStyles;"),T=e=>{let{progress:o,label:t}=e;return(0,p.tZ)("div",{css:P,children:(0,p.tZ)("div",{css:[{width:"".concat(o,"%")},R,";label:-Progress--Progress;"],children:(0,p.tZ)("span",{css:L.KY,children:t})})})},F=e=>{let{files:o}=e;return(0,p.BX)(k.u,{children:[(0,p.tZ)("p",{children:"Uploading"}),o.map(((e,o)=>(0,p.tZ)("div",{children:(0,p.tZ)(T,{label:e.name,progress:e.progress})},o)))]})};var O=t(94866),B=t(74673),A=t(89203),I=t(84951);const z=["text/csv","application/json","image/"],W=e=>z.some((o=>e.startsWith(o))),U=1e6,H=e=>{const o=e.getAsFile();if(!o){if(!W(e.type))throw new Error("Cannot import file of type ".concat(e.type));return!0}if(!W(o.type))throw console.warn("Expected one of types",z,"but received file",o,"with type",o.type),new Error("Cannot import file of type ".concat(o.type));if(o.size>U)throw console.warn("Expected only files smaller than",U,"bytes but received file",o,"with size",o.size),new Error("File too big (".concat(o.size," bytes). Will only accept files smaller than ").concat(U," bytes."));return o},_=()=>({uploading:[]});var M=t(66840);const N="10px",K=e=>{let{connectDropTarget:o,isOver:t}=e;const n=(0,A.k5)(!t),[i,s]=(0,r.useState)(!0);return(0,r.useEffect)((()=>{const e=setTimeout((()=>{s(!1)}),2e3);return()=>clearTimeout(e)}),[n]),(0,p.BX)("div",{css:[j,!i&&!n&&X,";label:-DropZoneDetector--DropZoneDetector;"],ref:o,children:[!i&&!n&&(0,p.BX)("div",{css:Y,children:[(0,p.tZ)("h1",{css:(0,x.css)(L.ts,{color:(0,M.g)("backgroundColor")},";label:-DropZoneDetector--DropZoneDetector;"),children:"Upload images or data"}),(0,p.tZ)("span",{css:(0,x.css)(L.yw,{color:(0,M.g)("weakerSlashIconColor")},";label:-DropZoneDetector--DropZoneDetector;"),children:".csv, .json, .gif, .jpg, 1MB max"})]}),(0,p.tZ)("div",{css:$,ref:o}),(0,p.tZ)("div",{css:q,ref:o}),(0,p.tZ)("div",{css:G,ref:o}),(0,p.tZ)("div",{css:Q,ref:o})]})},j={name:"1q2aw9p--DropZoneDetector--dropZoneWrapperStyles",styles:"position:absolute;top:0;left:0;height:100vh;width:100%;label:-DropZoneDetector--dropZoneWrapperStyles;"},Y=(0,x.css)({position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"300px",backgroundColor:(0,M.g)("strongSlashIconColor"),display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",padding:"40px 50px",gap:4,borderRadius:16,isolation:"isolate"},";label:-DropZoneDetector--warningForDNDStyles;"),X=(0,x.css)({zIndex:3,backgroundColor:(0,E.KZ)(E.Sn,E.L9).rgba,boxShadow:"0px 3px 24px -4px ".concat(E.ip.rgba)},";label:-DropZoneDetector--isOverDropZoneStyles;"),V={name:"1m7af1k--DropZoneDetector--dropZoneBorderDetector",styles:"position:absolute;z-index:3;label:-DropZoneDetector--dropZoneBorderDetector;"},$=(0,x.css)(V,{top:0,width:"100%",height:N},";label:-DropZoneDetector--dropZoneTopBorderDetectorTop;"),q=(0,x.css)(V,{bottom:0,width:"100%",height:N},";label:-DropZoneDetector--dropZoneTopBorderDetectorBottom;"),G=(0,x.css)(V,{left:0,height:"100vh",width:N},";label:-DropZoneDetector--dropZoneTopBorderDetectorLeft;"),Q=(0,x.css)(V,{right:0,height:"100vh",width:N},";label:-DropZoneDetector--dropZoneTopBorderDetectorRight;");const J={name:"1i7z4pt--EditorAttachmentsHandler--uploadProgressWrapperStyles",styles:"z-index:3;label:-EditorAttachmentsHandler--uploadProgressWrapperStyles;"},ee=e=>{let{getAttachmentForm:o,onAttached:t,children:n}=e;const i=(0,C.p)(),s=(0,b.Iy)(),{editor:l}=y(),[a,c]=(0,r.useState)(_),d=(0,r.useCallback)((e=>o=>{c((0,D.Uy)(a,(t=>{const r=t.uploading.find((o=>o.file===e));var n;r&&(r.progress=o.loaded/(null!==(n=o.total)&&void 0!==n?n:e.size)*100)})))}),[a]),u=(0,r.useCallback)((async e=>{const r=await o(e);if(!r)return;const[n,i,s]=r;i.append("file",e),await w.Z.post(n.toString(),i,{onUploadProgress:d(e)});const l=await t(s);return l?{url:l.url.toString()}:void 0}),[o,t,d]),h=(0,r.useCallback)((async e=>{const o="/api/pads/".concat(null===l||void 0===l?void 0:l.id,"/images");return{url:(await w.Z.post(o,e,{onUploadProgress:d(e)})).data}}),[null===l||void 0===l?void 0:l.id,d]),g=(0,r.useCallback)(((e,o)=>{l&&(0,B.kRc)(l,(()=>{let t;if(l.selection&&(0,B.zbr)(l.selection))t=l.selection.anchor.path;else{const e=(0,B.plg)(l,[l.children.length-1]);(0,B.$Rk)(l,e),t=e.path}e.type.startsWith("image/")?(0,I.tN)(l,t,o,e.name):(0,O.Q)({computer:s,editor:l,url:o})}))}),[s,l]),m=(0,r.useCallback)((async e=>{if(null!==l&&void 0!==l&&l.id){c((0,D.Uy)(a,(o=>{o.uploading.push({file:e,progress:0})})));try{const o=await(e.type.startsWith("image/")?h(e):u(e));if(null==o)return;const{url:t}=o;c((0,D.Uy)(a,(o=>{const t=o.uploading.findIndex((o=>o.file===e));t>=0&&o.uploading.splice(t,1)}))),g(e,t)}catch(o){console.error(o),i("Error uploading file","error"),c((0,D.Uy)(a,(o=>{const t=o.uploading.findIndex((o=>o.file===e));t>=0&&o.uploading.splice(t,1)})))}}}),[u,h,a,null===l||void 0===l?void 0:l.id,g,i]),[{isOver:f},k]=(0,v.L)({accept:[Z.FILE],drop:e=>{S.yW.set.isDragging(!1);const o=(null===e||void 0===e?void 0:e.items)||[];Array.from(o).forEach((async e=>{try{const o=H(e);o instanceof File&&m(o)}catch(o){console.warn("Did not import invalid item",e)}}))},canDrop:e=>{const o=(null===e||void 0===e?void 0:e.items)||[];return Array.from(o).some((e=>{try{if(H(e))return!0}catch{}return!1}))},collect:e=>({isOver:e.isOver()})}),x=(0,A.k5)(a.uploading.length>0);return!l||l.isReadOnly||{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_E2E?(0,p.tZ)(p.HY,{children:n}):(0,p.BX)(p.HY,{children:[(0,p.tZ)(K,{connectDropTarget:k,isOver:f}),n,x?(0,p.tZ)("div",{css:J,children:(0,p.tZ)(F,{files:a.uploading.map((e=>({name:e.file.name,progress:e.progress})))})}):null]})};var oe=t(1439),te=t(68160),re=t(54309),ne=t(64753),ie=t(49031),se=t(26056);var le=t(25200);const ae=[1],ce=e=>{try{const o=(0,B.plg)(e,ae);return{focus:o,anchor:o}}catch(o){return}},de=(e,o)=>{const t=(0,b.LU)((e=>e.selection)),{initialFocusDone:n,setInitialFocusDone:i}=y(),s=(0,b.VY)();(0,r.useEffect)((()=>{let r;if(!n&&o&&e){const e=(e=>{const{selection:o}=e;return{...o,...ce(e),...(0,le.bN)(e)}})(o);e&&null!==e&&void 0!==e&&e.anchor&&null!==e&&void 0!==e&&e.focus&&(0,B.uEZ)(o,null===e||void 0===e?void 0:e.anchor.path)&&(0,B.uEZ)(o,null===e||void 0===e?void 0:e.focus.path)&&!t&&!s&&(i(),r=setTimeout((()=>{try{const t=e.focus;if(!t)return;const r=null===t||void 0===t?void 0:t.path;if(!r)return;const n=(0,B.MkB)(o,r);if(!n)return;const i=r.slice(0,-1),s=(0,B.GsE)(n)?(0,B.MkB)(o,i):n;if(!s||!(0,B.kKo)(s))return;if((0,B.njR)(o,s))return;const l=(0,B.rwb)(o,s);if(!l)return;const a=((e,o,t)=>{try{return(0,B.F8P)(e,o,t)}catch(r){return}})(o,e.focus);if(!a)return;l.getBoundingClientRect().top>window.innerHeight&&l.scrollIntoView(),(0,B.$Rk)(o,{path:a.path,offset:0})}catch(t){console.warn("error setting the initial selection",t)}}),500))}return()=>{r&&clearTimeout(r)}}),[o,n,e,s,t,i])},pe=e=>{let{editor:o,loaded:t}=e;return de(t,o),(0,p.tZ)(p.HY,{})},ue=e=>{let{notebookId:o,notebookMetaLoaded:t,notebookTitle:n,onNotebookTitleChange:i,readOnly:s,secret:l,connectionParams:a,initialState:c,onEditor:d,onDocsync:u}=e;const h=(0,C.p)(),{data:g}=(0,te.useSession)(),{notebookLoadedPromise:m,initEditor:f,editor:v,computer:Z,loadedFromRemote:D,timedOutLoadingFromRemote:w,hasLocalChanges:S,destroy:k}=y(),x=D||w,E=(0,b.wr)(),L=(0,ne.BU)({notebookId:o,computer:Z,readOnly:s,notebookTitle:n,onNotebookTitleChange:i,interactions:E});(0,r.useEffect)((()=>{v&&d(v)}),[v,d]),t&&L&&(0,se.Bb)()&&f(o,{plugins:L,docsync:{readOnly:s,authSecret:l,connectionParams:a,initialState:c,protocolVersion:2}},(()=>null!==g&&void 0!==g?g:void 0)),(0,r.useEffect)((()=>{t&&L&&f(o,{plugins:L,docsync:{readOnly:s,authSecret:l,connectionParams:a,initialState:c,protocolVersion:2}},(()=>null!==g&&void 0!==g?g:void 0))}),[a,f,c,o,t,L,s,l,g]),(e=>{let{loaded:o,loadedPromise:t}=e;const n=(0,r.useRef)(o);if((0,se.Bb)()){if(!n.current)throw t.then((()=>{n.current=!0})),t}else n.current||(n.current=!0)})({loaded:x,loadedPromise:m});const P=(0,re.TH)();(0,r.useEffect)((()=>k),[k,P]),(0,r.useEffect)((()=>{v&&u(v)}),[v,u]);const R=s&&"Changes to this notebook are not saved".concat((null===g||void 0===g?void 0:g.user)?". Please duplicate to customize and make it your own.":""),[T,F]=(0,r.useState)(!1);return(0,r.useEffect)((()=>{R&&S&&!T&&(F(!0),h(R,"warning",{autoDismiss:!1}))}),[v,S,h,T,R]),(()=>{const e=(0,C.p)(),{data:o}=(0,te.useSession)(),{editor:t,hasLocalChanges:n}=y(),i=null!=t&&(t.isReadOnly||!1)&&"Changes to this notebook are not saved".concat((null===o||void 0===o?void 0:o.user)?". Please duplicate to customize and make it your own.":""),[s,l]=(0,r.useState)(!1);(0,r.useEffect)((()=>{i&&n&&!s&&(l(!0),e(i,"warning",{autoDismiss:!1}))}),[t,n,e,s,i])})(),(0,p.tZ)(b.Au,{computer:Z,children:(0,p.tZ)(ie.ML,{notebookId:o,isSavedRemotely:null===v||void 0===v?void 0:v.isSavedRemotely(),editor:v,readOnly:s,children:(0,p.tZ)(pe,{loaded:x,editor:v})})})},he=e=>{let{getAttachmentForm:o,onAttached:t,...n}=e;return(0,p.tZ)(f,{children:(0,p.BX)(b.S3,{children:[(0,p.tZ)(ee,{getAttachmentForm:o,onAttached:t}),(0,p.tZ)(r.Suspense,{fallback:(0,p.tZ)(oe.r,{}),children:(0,p.tZ)(ue,{...n})})]})},n.notebookId)}},88310:(e,o,t)=>{t.d(o,{u:()=>h});var r=t(426),n=t(57481),i=t(22605),s=t(5594);const l=(0,r.css)({cursor:"unset",backgroundColor:(0,n.KZ)(n.lz,.16).rgba},";label:-Overlay--styles;"),a=e=>{let{closeAction:o}=e;return"string"===typeof o?(0,s.tZ)(i.e,{css:l,"aria-label":"Close",href:o,children:null}):(0,s.tZ)("button",{css:l,"aria-label":"Close",disabled:!o,onClick:o})};var c=t(66840);const d={name:"1dv6zu--Modal--pageCoverStyles",styles:"position:fixed;width:100%;height:100%;top:0;left:0;display:grid;grid-template:100% / 100%;overflow:hidden;label:-Modal--pageCoverStyles;"},p={name:"bwh7x5--Modal--overlayStyles",styles:"grid-area:1 / 1;display:grid;label:-Modal--overlayStyles;"},u=(0,r.css)({gridArea:"1 / 1",justifySelf:"center",alignSelf:"center",maxWidth:"min(100% - 24px, 480px)",maxHeight:"75%",overflowY:"auto",padding:"24px",backgroundColor:(0,c.g)("backgroundColor"),border:"1px solid ".concat((0,c.g)("borderColor")),borderRadius:"10px",width:"480px",boxShadow:"\n    0px 2px 20px ".concat((0,n.KZ)(n.ou,.04).rgba,",\n    0px 2px 8px ").concat((0,n.KZ)(n.lz,.02).rgba,"\n  ")},";label:-Modal--dialogStyles;"),h=e=>{let{children:o,...t}=e;return(0,s.BX)("div",{css:d,children:[(0,s.tZ)("div",{css:p,children:(0,s.tZ)(a,{...t})}),(0,s.tZ)("div",{role:"dialog",css:u,children:o})]})}}};
//# sourceMappingURL=notebook-editor.f1ca1e4f.chunk.js.map