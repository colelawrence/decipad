"use strict";exports.id=5098,exports.ids=[5098],exports.modules={85217:(e,t,o)=>{o.r(t),o.d(t,{default:()=>U});var r=o(94866),s=o(85663),l=o(24217),n=o(96294),c=o(82623),u=o(85510),i=o(30969);const a=e=>{let{blockId:t,value:o,deleted:r,cacheKey:s="cache"}=e;const[l,n]=(0,i.useState)((()=>o)),c=(0,i.useMemo)((()=>"".concat(t,":").concat(s)),[s,t]);return(0,i.useEffect)((()=>{r&&localStorage.removeItem(c)}),[r,c]),(0,i.useEffect)((()=>{l||n((e=>{try{const t=localStorage.getItem(e);if(t)return JSON.parse(t)}catch(t){console.error("Error fetching value:",t)}})(c))}),[l,c]),(0,i.useEffect)((()=>{o&&(n(o),requestAnimationFrame((()=>{((e,t)=>{try{const o=JSON.stringify(t);localStorage.setItem(e,o)}catch(o){console.error("Error storing value:",o)}})(c,o)})))}),[c,o]),(0,i.useEffect)((()=>{l&&r&&localStorage.removeItem(c)})),l};var d=o(37114);const m=e=>!e.includes("querySelectorAll is not a")&&!e.includes("Uncaught"),p=e=>{let{url:t,source:r,options:s,useFirstRowAsHeader:l,columnTypeCoercions:n,timeoutMs:c=5e3,maxCellCount:u}=e;const a=(()=>{const e=(0,i.useRef)(),[t,r]=(0,i.useState)();return(0,i.useEffect)((()=>{let t=!1;return e.current||(async()=>{const{createWorker:s}=await Promise.all([o.e(7350),o.e(8248)]).then(o.bind(o,58248)),l=await s();e.current=l,t||r(l)})(),()=>{t=!0;const o=e.current;o&&(e.current=void 0,r(void 0),o.terminate())}}),[]),t})(),[p,v]=(0,i.useState)(),[C,y]=(0,i.useState)();return(0,i.useEffect)((()=>{let e,o=!1;return(async()=>{if(a)try{e=await a.subscribe({url:t,options:s,source:r,useFirstRowAsHeader:l,columnTypeCoercions:n,maxCellCount:u},((e,t)=>{if(!o){if(e&&!m(e.message))return;v(e),t&&("type-error"===t.result.type.kind?v(new Error((0,d.Z)("en-US",t.result.type.errorCause))):y(t))}}))}catch(c){if(c&&!m(c.message))return;console.error(c),v(c)}})(),()=>{o=!0,e&&e()}}),[n,u,s,r,t,l,a]),(0,i.useEffect)((()=>{null===a||void 0===a||a.worker.addEventListener("error",(e=>{m(e.message)&&(console.error("Error detected on worker",e),v(new Error(e.message)))}))}),[null===a||void 0===a?void 0:a.worker]),(0,i.useEffect)((()=>{const e=setTimeout((()=>{C||p||v(new Error("Could not find the result you're looking for"))}),c);return()=>clearTimeout(e)}),[p,C,c]),{error:p,result:C}};var v=o(1146),C=o(55013),y=o(426),f=o(20548),w=o(8243),h=o(33062),g=o(66159),b=o(57219),R=o(71799),T=o(99072),I=o(91745),E=o(5594);const S=(0,f.IHq)((()=>(0,y.css)({display:"grid",gridTemplate:'\n      ".                          handle                             " '.concat(R.bX(),'\n      "menu                       .                                  " auto\n      /minmax(max-content, 144px) ').concat(R.s1(),"\n    "),justifyContent:"end"},";label:-ImportTableRowControls--gridStyles;"))),Z=(0,y.css)({"*:hover > &":{opacity:"unset"},transition:"opacity ".concat(b.Ju," ease-in-out ").concat(b.DL),verticalAlign:"middle"},";label:-ImportTableRowControls--importTableRowControlsWrapperStyles;"),k={name:"19gxh2o--ImportTableRowControls--menuOpenedStyles",styles:"opacity:1;label:-ImportTableRowControls--menuOpenedStyles;"},x={name:"15x25bk--ImportTableRowControls--menuClosedStyles",styles:"opacity:0;label:-ImportTableRowControls--menuClosedStyles;"},F=e=>{let{isFirstRow:t=!1,toggleFirstRowIsHeader:o}=e;const[r,s]=(0,i.useState)(!1),l=(0,E.tZ)("button",{onClick:()=>{s(!r)},css:T.vr,children:(0,E.tZ)(h.D,{})});return(0,E.tZ)("th",{contentEditable:!1,css:[Z,r?k:x,";label:-ImportTableRowControls--ImportTableRowControls;"],children:t&&(0,E.tZ)("div",{css:S(),children:(0,E.tZ)(I.q,{root:!0,open:r,onChangeOpen:s,trigger:l,dropdown:!0,children:(0,E.tZ)(w.s,{icon:(0,E.tZ)(g._,{}),onSelect:()=>o(!0),selected:!1,children:"Make this the header row"})})})})};var H=o(53393),L=o(79820);const O=e=>{let{result:t,isFirstRowHeaderRow:o,setIsFirstRowHeader:r=C.ZT,onChangeColumnType:s=C.ZT,element:l}=e;return t&&(0,E.tZ)("div",{css:(0,y.css)(L.TU,";label:-LiveConnectionResult--LiveConnectionResult;"),children:(0,E.tZ)(H.X,{type:t.type,value:t.value,variant:"block",isLiveResult:!0,firstTableRowControls:(0,E.tZ)(F,{isFirstRow:!o,toggleFirstRowIsHeader:r}),onChangeColumnType:s,element:l})})};var A=o(28438),D=o(38643),N=o(74673);const M=()=>new WeakMap,q=e=>{var t,o;let{element:r,deleted:d}=e;(0,l.I)(r,s.cL);const m=(0,s.l3)(),y=(0,v.Iy)(),f=(0,n.m)(r),{error:w,result:h}=((e,t)=>{let{blockId:o,url:r,options:s,source:l,useFirstRowAsHeader:n,columnTypeCoercions:c,maxCellCount:u,deleted:d}=t;const{error:m,result:v}=p({url:r,options:s,source:l,useFirstRowAsHeader:n,columnTypeCoercions:c,maxCellCount:u}),C=a({blockId:o,deleted:d,value:v});return(0,i.useEffect)((()=>{const t=null===C||void 0===C?void 0:C.result;null!=(null===t||void 0===t?void 0:t.value)&&"symbol"!==typeof t.value?e.pushExternalDataUpdate(o,t):e.pushExternalDataDelete(o)}),[o,e,C]),(0,i.useEffect)((()=>()=>{e.pushExternalDataDelete(o)}),[e,o]),{error:m,result:C}})(y,{blockId:r.id,url:r.url,source:r.source,useFirstRowAsHeader:r.isFirstRowHeaderRow,columnTypeCoercions:r.columnTypeCoercions,maxCellCount:3e3,deleted:d}),g=(0,i.useCallback)(((e,t)=>{f&&(0,N.fLV)(m,{columnTypeCoercions:{...r.columnTypeCoercions,[e]:t}},{at:f})}),[m,r.columnTypeCoercions,f]),b=(0,c.Z)(m,r,"isFirstRowHeaderRow");(0,i.useEffect)((()=>{if(f&&h){const t=r.children[0];if(!(0,N.qcw)(t)){var e;const t=(null===(e=h.meta)||void 0===e?void 0:e.title)||"LiveConnection";(0,N.OmN)(m,y.getAvailableIdentifier((0,C.pG)(t),1),{at:[...f,0]})}}}),[y,m,r.children,f,h]);const R=(0,i.useMemo)((()=>(0,u.x)(m,"PLUGIN_LIVE_CONNECTION_COMPONENT",M)),[m]),[,T]=(0,i.useState)(0);(0,i.useEffect)((()=>{const e=R.get(r);h&&(null===e||void 0===e?void 0:e.result)!==h.result?(R.set(r,{result:h.result,error:void 0}),T((e=>e+1))):w&&(null===e||void 0===e?void 0:e.error)!==w&&(R.set(r,{result:void 0,error:w}),T((e=>e+1)))}),[r,w,h,R]);const{result:I=(null===h||void 0===h?void 0:h.result),error:S=w}=null!==(t=R.get(r))&&void 0!==t?t:{};return(0,E.BX)("div",{contentEditable:!1,children:[I&&(0,E.tZ)(O,{result:I,isFirstRowHeaderRow:r.isFirstRowHeaderRow,setIsFirstRowHeader:b,onChangeColumnType:g,element:r}),S?null!==(o=S.message)&&void 0!==o&&o.includes("Could not find the result")?(0,E.tZ)(A.s,{message:"We don't support importing this block type yet",url:"/docs/"}):(0,E.tZ)(A.s,{message:(null===S||void 0===S?void 0:S.message)||"There's an error in the source document",defaultDocsMessage:"Go to source",url:r.url||"/docs/"}):null,!S&&!I&&(0,E.tZ)("div",{children:(0,E.tZ)(D.$,{})})]})},U=e=>{let{attributes:t,children:o,element:n}=e;(0,l.I)(n,s.cL);const[c,u]=(0,i.useState)(!1),a=(0,i.useCallback)((()=>u(!0)),[]);return(0,E.tZ)(r.vL,{blockKind:"editorTable",element:n,...t,onceDeleted:a,dependencyId:n.id,children:(0,E.BX)(r.Tp,{element:n,children:[o,(0,E.tZ)(q,{element:n,deleted:c})]})})}}};
//# sourceMappingURL=editor-live-connection.b7c34d06.chunk.js.map