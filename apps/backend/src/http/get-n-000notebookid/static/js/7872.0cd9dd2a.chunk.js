"use strict";exports.id=7872,exports.ids=[7872],exports.modules={85663:(e,t,s)=>{s.d(t,{ZV:()=>r.DEPRECATED_ELEMENT_CODE_BLOCK,lZ:()=>r.DEPRECATED_ELEMENT_TABLE_INPUT,ah:()=>r.ELEMENT_BLOCKQUOTE,SD:()=>r.ELEMENT_CALLOUT,Zv:()=>r.ELEMENT_CODE_LINE,l7:()=>r.ELEMENT_CODE_LINE_V2,VE:()=>r.ELEMENT_COLUMNS,ZH:()=>r.ELEMENT_EVAL,aY:()=>r.ELEMENT_FETCH,GD:()=>r.ELEMENT_H1,oG:()=>r.ELEMENT_H2,o3:()=>r.ELEMENT_H3,cI:()=>r.ELEMENT_HR,IV:()=>r.ELEMENT_IMAGE,f8:()=>r.ELEMENT_LI,wl:()=>r.ELEMENT_LIC,cL:()=>r.ELEMENT_LIVE_CONNECTION,kN:()=>r.ELEMENT_OL,JB:()=>r.ELEMENT_PARAGRAPH,QC:()=>r.ELEMENT_PLOT,bM:()=>r.ELEMENT_SMART_REF,tW:()=>r.ELEMENT_STRUCTURED_IN,L7:()=>r.ELEMENT_TABLE,We:()=>r.ELEMENT_TABLE_COLUMN_FORMULA,Ht:()=>r.ELEMENT_UL,qu:()=>r.ELEMENT_VARIABLE_DEF,Ee:()=>o,Y_:()=>a});var n=s(74673);const o="magicnumberz";var r=s(51923);r.ELEMENT_H1,r.ELEMENT_H2,r.ELEMENT_H3,r.ELEMENT_HR,r.ELEMENT_PARAGRAPH,r.ELEMENT_CALLOUT,r.ELEMENT_BLOCKQUOTE,r.ELEMENT_IMAGE,r.DEPRECATED_ELEMENT_CODE_BLOCK,r.ELEMENT_CODE_LINE,r.ELEMENT_CODE_LINE_V2,r.ELEMENT_STRUCTURED_IN,r.ELEMENT_UL,r.ELEMENT_OL,r.DEPRECATED_ELEMENT_TABLE_INPUT,r.ELEMENT_TABLE,r.ELEMENT_DATA_VIEW,r.ELEMENT_FETCH,r.ELEMENT_PLOT,r.ELEMENT_COLUMNS,r.ELEMENT_EVAL,r.ELEMENT_VARIABLE_DEF,r.ELEMENT_LIVE_CONNECTION,r.ELEMENT_IMPORT,r.ELEMENT_DRAW;const a=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,n.JIX)(e)},i=Object.values(r);r.ELEMENT_TABLE,r.ELEMENT_VARIABLE_DEF,r.ELEMENT_COLUMNS,Object.freeze(Object.values(i))},17872:(e,t,s)=>{s.r(t),s.d(t,{startNotebook:()=>Te});var n=s(79568),o=s(61138),r=s(50576),a=s(90224),i=s(42515),c=s(41580),d=s(58834),l=s(93351),u=s(18157),h=s(74673),E=s(33058),y=s(12666);const f=new WeakSet,w=new WeakMap,_=new WeakMap,v={synchronizeValue:e=>{(0,h.kRc)(e,(()=>{e.children=(0,y.HQ)(e.sharedType),e.onChange()}))},sharedType:e=>{const t=_.get(e);return(0,E.Z)(t,"YjsEditor without attached shared type"),t},isRemote:e=>f.has(e),asRemote:(e,t)=>{const s=v.isRemote(e);f.add(e),t(),s||f.delete(e)},asLocal:(e,t)=>{const s=v.isRemote(e);s&&f.delete(e);const n=t();return s&&f.add(e),n}};function p(e){const t=w.get(e);return(0,E.Z)(t,"YjsEditor without attached local operations"),t}const m=(e,t)=>(0,h.kRc)(e,(()=>v.asRemote(e,(()=>{try{(0,d.c)(e,t.filter((e=>{var t;return(null===(t=e.transaction)||void 0===t?void 0:t.origin)!==u.DI})))}catch(s){throw console.error("Error applying remote event",s),s}}))));function L(e,t){const s=e;s.sharedType=t,_.set(e,t),w.set(e,new Set);const n=e=>function(e,t){try{(0,h.sGH)(e)?(0,h.Qds)(e,(()=>{m(e,t)})):m(e,t)}catch(s){console.error("Error applying remote events",{error:s,events:t})}}(s,e);t.observeDeep(n);const{apply:o,onChange:r,destroy:a}=s;return s.apply=e=>{!function(e,t){v.isRemote(e)||p(e).add(t)}(s,e),o(e)},s.onChange=()=>{!function(e){const t=p(e),s=Array.from(t).flat();(0,l.Z)(v.sharedType(e),s,u.DI),t.clear()}(s),r()},s.destroy=()=>{t.unobserveDeep(n),s.apply=o,s.onChange=r,a.call(s)},s.synchronizeValue=()=>{v.synchronizeValue(s)},s}const b=new WeakMap,g={awareness(e){const t=b.get(e);return(0,E.Z)(t,"CursorEditor without attaches awareness"),t},updateCursor:(e,t)=>{try{const{selection:s}=e,{anchor:n}=null!==s&&void 0!==s?s:{},{focus:o}=null!==s&&void 0!==s?s:{},r=g.awareness(e),a=r.getLocalState(),{user:i}=null!==t&&void 0!==t?t:{},c={...a,anchor:n,focus:o,user:i&&{email:i.email,name:i.name}};r.setLocalState(c)}catch(s){console.error(s)}}};function T(e,t,s){const n=e;b.set(n,t),n.awareness=t;const{onChange:o,destroy:a}=e,i=(0,r.debounce)((async()=>{try{g.updateCursor(n,s())}catch(e){}}),2e3);return n.onChange=()=>{i(),o()},n.destroy=()=>{n.onChange=o,a.call(n)},n}var M=s(26290),N=s.n(M),C=s(18138),O=s(83994),I=s(55013),U=s(11307),S=s(14300).Buffer;const A="updates";async function R(e){return e._mux.push((async()=>{await k(e,!1,(async t=>{const s=await C.go(t,C.sc(e._dbref,!1));e._destroyed||(e.doc.transact((()=>s.forEach((t=>i.NG(e.doc,t))))),await k(e,!1,(async t=>{const s=await C.S_(t);e._dbref=s+1,await k(e,!1,(async t=>{const s=await C.QX(t);e._dbsize=s}))})))}))}))}function D(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{const[s]=C.ay((0,I.m0)(e.db),[A],t?"readwrite":"readonly");return s}catch(s){if("InvalidStateError"===s.name)return null;throw s}}async function k(e,t,s){if(e._destroyed)return;const n=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{const[s]=C.ay((0,I.m0)(e.db),[A],t?"readwrite":"readonly");return s}catch(s){if("InvalidStateError"===s.name)return null;throw s}}(e,t);return n?s(n):void 0}class H extends O.y{constructor(e,t){let{readOnly:s=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};super(),N()(this,"db",null),N()(this,"doc",void 0),N()(this,"name",void 0),N()(this,"synced",!1),N()(this,"whenSynced",void 0),N()(this,"_dbref",0),N()(this,"_dbsize",0),N()(this,"_mux",(0,U.l)()),N()(this,"_destroyed",!1),N()(this,"_db",void 0),N()(this,"_storeTimeoutId",void 0),N()(this,"_storeTimeout",1e3),this.doc=t,this.name=s?"".concat(e,":readonly"):e,this._db=C.X3(this.name,(e=>C._w(e,[["updates",{autoIncrement:!0}]]))),this.whenSynced=this._init(),this._storeUpdate=this._storeUpdate.bind(this),this.destroy=this.destroy.bind(this),t.on("update",this._storeUpdate),t.on("destroy",this.destroy)}async _init(){this.db=await this._db;const e=i.D$(this.doc);return await R(this),k(this,!0,(async t=>(await C.yP(t,e),this))).then((e=>(this._destroyed||(this.emit("synced",[this]),this.synced=!0),new Promise((t=>{e&&t(e)})))))}async _storeUpdate(e,t,s,n){await this._mux.push((async()=>{await this.whenSynced,await k(this,!0,(async t=>{await C.yP(t,e),this.emit("saved",[this,n.local]),this._dbsize+=1,this._dbsize>=500&&(this._storeTimeoutId&&clearTimeout(this._storeTimeoutId),this._storeTimeoutId=setTimeout((async()=>{await async function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];await R(e),(t||e._dbsize>=500)&&await k(e,!0,(async t=>{await C.yP(t,i.D$(e.doc)),e.emit("saved",[e]),await k(e,!0,(async t=>{await C.IV(t,C.UE(e._dbref,!0)),await k(e,!1,(async t=>{e._dbsize=await C.QX(t)}))}))}))}(this,!1),this._storeTimeoutId=void 0}),this._storeTimeout))}))}))}async destroy(){this._destroyed=!0,this._storeTimeoutId&&clearTimeout(this._storeTimeoutId),this.doc.off("update",this._storeUpdate),this.doc.off("destroy",this.destroy);const e=await this._db;await e.close()}async remove(){await k(this,!0,(async e=>{e.clear()}))}async markVersion(e){const t=(0,I.m0)(D(this,!0)),s={name:e,version:S.from(i.gJ(this.doc)).toString("hex"),createdAt:Date.now()};await C.IH(t,JSON.stringify(s),e)}async sameVersion(e){const t=(0,I.m0)(D(this,!1)),s=await C.U2(t,e);if(s&&"string"===typeof s){const e=JSON.parse(s),t=S.from(i.gJ(this.doc)).toString("hex");return e.version!==t}return!1}}var x=s(14300),P=s(67837),V=s(24320),B=s(62637),W=s(84069),G=s(68352),z=s(77805),j=s(11471);const J={1:z.F,2:j.T};var Z=s(19848),F=s(74881);const Q=(e,t)=>console.warn("Permission denied to access ".concat(e.url,".\n").concat(t)),K=[];K[F.Mr]=(e,t,s,n)=>{V.uE(e,F.Mr);const o=G.zu(t,e,s.doc,s);n&&o===G.Px&&!s.synced&&(s.synced=!0)},K[F.J9]=(e,t,s)=>{V.uE(e,F.RO),V.mP(e,a.xq(s.awareness,Array.from(s.awareness.getStates().keys())))},K[F.RO]=(e,t,s)=>{a.oy(s.awareness,P.HN(t),s)},K[F.r9]=(e,t,s)=>{Z.nw(t,s.doc,Q)};var q=s(77282);const Y=e=>"string"===typeof e?Y(x.Buffer.from(e,"base64")):x.Buffer.from(e),X=(e,t,s)=>{if((e=>"string"===typeof e||x.Buffer.isBuffer(e)||e instanceof Uint8Array)(t))try{const n=x.Buffer.from(t),o=P.l1(n),r=V.Mf(),a=P.yg(o),i=e.messageHandlers[a];return i?i(r,o,e,s,a):console.error("Could not find handler for message of type ".concat(a)),r}catch(n){console.error("Error trying to decode message",n)}else console.warn("message is unnacceptable",t)},$=async e=>{const t=()=>{if(e.shouldConnect){const t=Math.min(2**e.wsUnsuccessfulReconnects*2e3,2e4);setTimeout($,t,e)}};try{if(e.shouldConnect&&!e.ws&&!e.wsconnecting){e.beforeConnect&&await e.beforeConnect(e),e.emit("status",[{status:"connecting"}]);const s=new e._WS((0,I.m0)(e.url),e.protocol);s.binaryType="arraybuffer",e.ws=s,e.wsconnecting=!0,e.wsconnected=!1,e.synced=!1,s.onerror=e=>{console.warn("Error caught on websocket:",e)};const{message:n,receive:o}=(e=>{const t=J[e];if(!t)throw new Error("Invalid protocol version: ".concat(e));return t()})(e.protocolVersion),r=n.subscribe((t=>{try{const s=X(e,t,!0);if(!e.readOnly&&s&&V.kE(s)>1){const t=V._f(s);e.send(t)}}catch(n){var s;console.error("An error was detected while reading a message from a websocket"),console.error(n),null===(s=e.onError)||void 0===s||s.call(e,n)}}));s.onmessage=t=>{!e.destroyed&&t.data&&(e.wsLastMessageReceived=W.ZG(),o(Y(t.data)))},s.onclose=s=>{console.info("WS closed",s),r.unsubscribe(),e.ws=void 0,e.wsconnecting=!1,!e.destroyed&&e.wsconnected?(e.wsconnected=!1,e.synced=!1,a.Ag(e.awareness,Array.from(e.awareness.getStates().keys()).filter((t=>t!==e.doc.clientID)),e),e.emit("status",[{status:"disconnected"}])):e.wsUnsuccessfulReconnects+=1,e.shouldConnect&&t()},s.onopen=()=>{console.info("WS: opened"),e.wsLastMessageReceived=W.ZG(),e.wsconnecting=!1,e.wsconnected=!0,e.wsUnsuccessfulReconnects=0,e.emit("status",[{status:"connected"}]);const t=V.Mf();if(V.uE(t,F.Mr),G._J(t,e.doc),e.send(V._f(t)),null!=e.awareness.getLocalState()){const t=V.Mf();V.uE(t,F.RO),V.mP(t,a.xq(e.awareness,[e.doc.clientID])),e.send(V._f(t))}}}}catch(s){console.error(s),e.ws&&e.ws.readyState===e.ws.OPEN&&e.ws.close(),e.ws=void 0,e.wsconnecting=!1,t()}},ee=(e,t)=>{if(!e.destroyed&&!e.readOnly&&e.wsconnected)try{e.send(t)}catch(s){if("WebSocket is already in CLOSING or CLOSED state"!==s.message)throw s}};class te extends O.y{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{protocolVersion:1};super(),N()(this,"doc",void 0),N()(this,"protocol",void 0),N()(this,"protocolVersion",void 0),N()(this,"beforeConnect",void 0),N()(this,"_WS",void 0),N()(this,"awareness",void 0),N()(this,"url",void 0),N()(this,"readOnly",void 0),N()(this,"shouldConnect",void 0),N()(this,"onError",void 0),N()(this,"ws",void 0),N()(this,"wsconnected",!1),N()(this,"wsconnecting",!1),N()(this,"wsLastMessageReceived",0),N()(this,"wsUnsuccessfulReconnects",0),N()(this,"messageHandlers",void 0),N()(this,"mux",void 0),N()(this,"destroyed",!1),N()(this,"outUpdates",[]),N()(this,"debouncedBroadcastUpdateMessage",(0,r.debounce)(this.broadcastPendingUpdateMessages.bind(this),1e3)),N()(this,"outAwarenessUpdates",[]),N()(this,"debouncedBroadcastAwarenessUpdateMessage",(0,r.debounce)(this.broadcastPendingAwarenessUpdateMessages.bind(this),1e3)),N()(this,"_selfAwareness",!1),N()(this,"_synced",!1),N()(this,"_resyncInterval",0),N()(this,"_checkInterval",void 0),N()(this,"_onOfflineOnlineStatusChange",(()=>{var e;if(!navigator.onLine&&this.ws&&(this.ws.CONNECTING||null!==(e=this.ws)&&void 0!==e&&e.OPEN)){this.shouldConnect=!0;try{console.info("WS: closing websocket because offline"),this.ws.close()}catch(t){console.warn("Error closing websocket:",t)}}}));const{readOnly:s=!1,connect:n=!0,awareness:o,WebSocketPolyfill:i=WebSocket,resyncInterval:c=-1,protocol:d,beforeConnect:l,onError:u,protocolVersion:h}=t;this.readOnly=s,this.doc=e,this.protocol=d,this.beforeConnect=l,this._WS=i,this.onError=u,this.protocolVersion=h,o?this.awareness=o:(this.awareness=new a.GL(e),this._selfAwareness=!0),this.messageHandlers=K.slice(),this.mux=B.M(),this.shouldConnect=n,c>0&&(this._resyncInterval=setInterval((()=>{if(this.ws&&this.wsconnected&&!this.readOnly){const s=V.Mf();V.uE(s,F.Mr),G._J(s,e);try{this.send(V._f(s))}catch(t){if("WebSocket is already in CLOSING or CLOSED state"!==t.message)throw t}}}),c)),"addEventListener"in global&&(global.addEventListener("online",this._onOfflineOnlineStatusChange),global.addEventListener("offline",this._onOfflineOnlineStatusChange)),this._updateHandler=this._updateHandler.bind(this),this._beforeUnloadHandler=this._beforeUnloadHandler.bind(this),this._awarenessUpdateHandler=this._awarenessUpdateHandler.bind(this),this.readOnly||this.doc.on("update",this._updateHandler),"undefined"!==typeof window?window.addEventListener("beforeunload",this._beforeUnloadHandler):"undefined"!==typeof q&&q.on("exit",(()=>this._beforeUnloadHandler)),s||this.awareness.on("update",this._awarenessUpdateHandler),this._checkInterval=setInterval((()=>{var e;this.wsconnected&&3e4<W.ZG()-this.wsLastMessageReceived&&(this.shouldConnect=!0,null===(e=this.ws)||void 0===e||e.close())}),3e3),n&&this.connect()}set serverUrl(e){if(e){const t=new URL(e).href;this.url=t}}get serverUrl(){return this.url}send(e){this.wsconnected&&this.ws&&this.ws.send((e=>x.Buffer.from(e).toString("base64"))(e))}_updateHandler(e,t){t!==this&&!this.readOnly&&this.wsconnected&&(this.outUpdates.push(e),this.debouncedBroadcastUpdateMessage())}broadcastPendingUpdateMessages(){const e=Array.from(this.outUpdates);this.outUpdates=[];const t=V.Mf();V.uE(t,F.Mr),G.lr(t,(0,i.kp)(e)),V.kE(t)>1&&ee(this,V._f(t)),this.emit("saved",[this])}_awarenessUpdateHandler(e){const{added:t,updated:s,removed:n}=e,o=t.concat(s).concat(n);this.outAwarenessUpdates=this.outAwarenessUpdates.concat(o),this.debouncedBroadcastAwarenessUpdateMessage()}broadcastPendingAwarenessUpdateMessages(){const e=Array.from(this.outAwarenessUpdates);if(e.length>0){this.outAwarenessUpdates=[];const t=a.xq(this.awareness,e),s=V.Mf();V.uE(s,F.RO),V.mP(s,t),V.kE(s)>1&&ee(this,V._f(s))}}_beforeUnloadHandler(){a.Ag(this.awareness,[this.doc.clientID],"window unload")}get synced(){return this._synced}set synced(e){this._synced!==e&&(this._synced=e,this.emit("synced",[e]),this.emit("sync",[e]))}destroy(){this.destroyed=!0,0!==this._resyncInterval&&clearInterval(this._resyncInterval),this._checkInterval&&clearInterval(this._checkInterval),this.disconnect(),"undefined"!==typeof window?window.removeEventListener("beforeunload",this._beforeUnloadHandler):"undefined"!==typeof q&&q.off("exit",(()=>this._beforeUnloadHandler)),this.awareness.off("update",this._awarenessUpdateHandler),this._selfAwareness&&this.awareness.destroy(),this.doc.off("update",this._updateHandler),"removeEventListener"in global&&(global.removeEventListener("online",this._onOfflineOnlineStatusChange),global.removeEventListener("offline",this._onOfflineOnlineStatusChange)),super.destroy()}disconnect(){if(this.wsconnected&&this.broadcastPendingUpdateMessages(),this.shouldConnect=!1,null!=this.ws){try{this.ws.close()}catch(e){}this.emit("status",[{status:"disconnected"}])}}async connect(){this.shouldConnect=!0,this.wsconnected||this.ws||await $(this)}}const se=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{protocolVersion:1};return new te(e,t)};s(3192);const ne=e=>{switch(e){case"websockets":return"undefined"!==typeof WebSocket;case"indexeddb":return"undefined"!==typeof indexedDB}};var oe=s(82361),re=s.n(oe),ae=s(16318),ie=s.n(ae),ce=s(60046);function de(e,t,s,n){const o=new(re());null===s||void 0===s||s.on("synced",(function(){o.emit("loaded","local")})),null===s||void 0===s||s.on("saved",(function(e,t){const s=t?"local":"remote";o.emit("saved",s)})),n&&(n.on("synced",(function(e){e&&(o.emit("loaded","remote"),a.next(!0))})),n.on("saved",(function(){o.emit("saved","remote"),a.next(!0)})),n.on("status",(function(e){"connected"===e.status&&o.emit("connected")})),n.on("error",(e=>{console.error("Error caught in websocket:",e)})));const r=new ce.BehaviorSubject(!1),a=new ce.BehaviorSubject(!1),i=()=>{let e=0;o.on("saved",(t=>{e+=1,e>1&&(e=1,"local"===t&&(r.next(!0),a.next(!1)))}))};s?s.once("synced",i):i();let c=!1;o.once("destroyed",(()=>{c=!0}));return Object.assign(e,{onLoaded(e){o.on("loaded",e)},offLoaded(e){o.removeListener("loaded",e)},onSaved(e){o.on("saved",e)},offSaved(e){o.removeListener("saved",e)},onConnected(e){o.on("connected",e)},onDestroyed(e){o.on("destroyed",e)},offDestroyed(e){o.removeListener("destroyed",e)},destroy(){o.emit("destroyed"),o.removeAllListeners(),t.destroy(),null===s||void 0===s||s.destroy(),null===n||void 0===n||n.destroy()},connect(){null===n||void 0===n||n.connect()},disconnect(){null===n||void 0===n||n.disconnect()},hasLocalChanges:()=>r,isSavedRemotely:()=>a,removeLocalChanges:()=>(null===s||void 0===s?void 0:s.remove())||Promise.resolve(),setLoadedRemotely(){o.emit("loaded","remote")},isDocSyncEnabled:!0,markVersion:e=>(null===s||void 0===s?void 0:s.markVersion(e))||Promise.resolve(),sameVersion:e=>(null===s||void 0===s?void 0:s.sameVersion(e))||Promise.resolve(!1),equals:e=>ie()(JSON.stringify((0,y.HQ)(t.getArray())))===e,get destroyed(){return c}})}(0,I.LH)();var le=s(25555);function ue(e){const{children:t}=e;t.length>1||0===t.length&&(0,h.kRc)(e,(()=>{(0,h.s2K)(e,{type:h.GDC,children:[{text:"My notebook title"}],id:(0,le.x0)()},{at:[0]}),(0,h.s2K)(e,{type:h.JBe,children:[{text:""}],id:(0,le.x0)()},{at:[1]})}))}const he=e=>{let t=!0;const s=new i.H6(e.sharedType,{trackedOrigins:new Set([u.DI]),captureTransaction:()=>t,captureTimeout:200});return e.undo=()=>{s.undo()},e.redo=()=>{s.redo()},e.withoutCapturingUndo=e=>{const s=t;t=!1;try{e()}finally{t=s}},e.undoManager=s,e},Ee=(e,t)=>v.asLocal(e,t);var ye=s(14300).Buffer;async function fe(){const e=await(0,c.h)("/api/auth/token?for=pubsub");if(null===e||void 0===e||!e.ok)throw new Error("Error fetching token: response code was ".concat(e.status,": ").concat(e.statusText,". response was ").concat(await(null===e||void 0===e?void 0:e.text())||JSON.stringify(e)));return null===e||void 0===e?void 0:e.text()}async function we(e){var t;return"".concat(await(null===(t=await(0,c.h)("/api/ws"))||void 0===t?void 0:t.text()),"?doc=").concat(encodeURIComponent(e),"&protocol=2")}var _e=s(62425),ve=s(13986),pe=s(85663),me=s(93361),Le=s(24217);const be=e=>e.type===pe.cL,ge=async(e,t,s)=>{const n=await(async(e,t,s)=>{const n=new Map(e),o=Array.from(t.entries()).filter((t=>{let[s]=t;return!e.has(s)}));for(const[r,a]of o){const e=new ce.BehaviorSubject(void 0),t=await s({params:{url:a.url,source:a.source,useFirstRowAsHeader:a.isFirstRowHeaderRow,columnTypeCoercions:a.columnTypeCoercions},notify:t=>{e.next({source:a,result:t})}},!0);t&&n.set(r,{...a,result:{subject:e,subscription:t}})}return n})(e,t,s);return((e,t)=>{const s=Array.from(e.entries()).filter((e=>{let[s]=e;return!t.has(s)}));for(const[,o]of s){var n;null===(n=o.result)||void 0===n||n.subscription.unsubscribe()}})(e,t),n},Te=async(e,t,s)=>{const{docId:c,blockId:d}=(0,me.k)(e.params.url),l=(0,pe.Y_)();l.normalizeNode=r.noop;const u=function(e,t){let{editor:s,readOnly:n=!1,authSecret:o,onError:r,ws:c=!0,connect:d=c,WebSocketPolyfill:l,connectionParams:u,initialState:h,protocolVersion:E}=t,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};s.children=[];const f=new i.QW,w=ne("indexeddb")?new H(e,f,{readOnly:n}):void 0,_=Date.now(),v=()=>Date.now()-_>6e4,p=()=>v()||null===u||void 0===u?void 0:u.token,m=async t=>{try{t.serverUrl=null!==u&&void 0!==u&&u.url?"".concat(u.url):await we(e),t.protocol=o||p()||await fe()}catch(s){console.error(s)}};let b,g;!c||!ne("websockets")||n&&null!=h?g=new a.GL(f):(b=se(f,{WebSocketPolyfill:l,readOnly:n,connect:!1,beforeConnect:m,resyncInterval:6e4,onError:r,protocolVersion:E}),g=b.awareness);const M=f.getArray(),N=L(s,M);N.synchronizeValue();let C=!1,O=!1;const I=()=>{if(!O&&(O=!0,d&&!C)){var e;if(null!=h)try{const e=ye.from(h,"base64");(0,i.NG)(f,e),setTimeout((()=>A.setLoadedRemotely()),0)}catch(t){console.error("Error applying initial update",t)}null===(e=b)||void 0===e||e.connect()}};w?w.once("synced",I):setTimeout(I,0);const U=T(N,g,y),{normalizeNode:S}=U;U.normalizeNode=e=>Ee(U,(()=>S(e)));let A=de(U,f,w,b);A.destroy=()=>{var e;C=!0,null===w||void 0===w||w.destroy(),null===(e=b)||void 0===e||e.destroy()},A.isDocSyncEnabled=!0;let R=!1,D=!1;const k=e=>{n||C||D||c&&"remote"!==e||ue(s),"remote"===e&&(D=!0),"local"===e&&(R=!0),D&&R&&A.offLoaded(k)};return A.onLoaded(k),A=he(A),A.isReadOnly=n,A}(c,{readOnly:!0,editor:l,protocolVersion:2}),h=new ve.ar,{unsubscribe:E}=h.results.pipe((0,o.UI)((e=>e.blockResults[d])),(0,o.bh)(250),(0,o.xb)(((e,t)=>(0,n.J)(e,t)))).subscribe((t=>{if(t){const n=h.getSymbolDefinedInBlock(d);"identified-error"===t.type?s(new Error((0,ve.tA)(t))):"computer-result"===t.type&&e.notify({meta:{title:n},result:t.result})}})),{update:y,destroy:f,getExternalData$:w}=(e=>{let t=new Map;const s=new Map,n=new Map,o=new ce.BehaviorSubject(new Map);return{update:async r=>{const a=r.filter(be).reduce(((e,t)=>((0,Le.I)(t,pe.cL),e.set(t.id,t),e)),new Map);t=await ge(t,a,e);for(const[e,d]of t)if(!s.has(e)){var i,c;const t=null===(i=d.result)||void 0===i?void 0:i.subject.subscribe((t=>{t?n.set(e,t):n.delete(e),o.next(n)}));t&&s.set(e,t);const r=null===(c=d.result)||void 0===c?void 0:c.subject.getValue();r&&(n.set(e,r),o.next(n))}for(const[e,n]of s)t.has(e)||(n.unsubscribe(),s.delete(e))},getExternalData$:o,destroy:()=>{for(const[,e]of s)e.unsubscribe();s.clear(),n.clear()}}})(t),_=(0,r.debounce)((async()=>{h.pushCompute(await(0,_e.I)(u,h))}),500),v=w.subscribe((t=>{t.has(d)&&e.notify((0,I.m0)(t.get(d)).result),_()}));let p=!1;e.subscription={get closed(){return p},unsubscribe:()=>{p=!0,v.unsubscribe(),E(),f(),u.disconnect(),u.destroy()}},u.onLoaded(_);const{onChange:m}=u;return u.onChange=()=>{(async()=>{try{await y(u.children),_()}catch(e){s(e)}})(),m()},h}}};
//# sourceMappingURL=7872.0cd9dd2a.chunk.js.map