"use strict";exports.id=6896,exports.ids=[6896],exports.modules={62425:(e,r,n)=>{n.d(r,{I:()=>S});var t={};n.r(t),n.d(t,{CodeLine:()=>u,CodeLineV2:()=>f,Column:()=>x,Eval:()=>M,LiveConnection:()=>U,Paragraph:()=>g,StructuredInput:()=>q,Table:()=>O,VariableDef:()=>F,getUnparsedBlockFromCodeLine:()=>d,getUnparsedBlockFromEval:()=>h,parseStructuredCodeLine:()=>y});var o=n(74673),i=n(85663),a=n(84529),E=n(13986);function c(e,r,n,t){return{type:"identified-block",id:e,block:{id:e,type:"block",args:[r]},...t&&n?{definesTableColumn:[n,t]}:n?{definesVariable:n}:{}}}function l(e,r){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"statement";const{solution:t,error:o}="statement"===n?(0,E.fh)(r):(0,E.BJ)(r);return o?[{type:"identified-error",errorKind:"parse-error",id:e,source:r,error:o}]:[c(e,t)]}const s=e=>{const r=new WeakMap;return async(n,t,o)=>{var i;const a=null!==(i=r.get(o))&&void 0!==i?i:await e(n,t,o);return r.set(o,a),a}},d=async(e,r,n)=>n.type===i.Zv?l(n.id,(0,a.c)(n)):[],u={type:i.Zv,getParsedBlockFromElement:s(d)};var p=n(24217),m=n(20932),T=n(85996);function _(e,r,n,t){const{solution:o,error:i}="string"===typeof n?""===n.trim()?(0,E.BJ)("0"):(0,E.BJ)(n,t):{solution:n,error:void 0};if(i)return[{type:"identified-error",errorKind:"parse-error",id:e,source:"string"===typeof n?n:"",error:i,definesVariable:r}];return[c(e,r?{type:"assign",args:[{type:"def",args:[r]},o]}:o,r)]}const L=["range","sequence","match","tiered"],N=s((async(e,r,n)=>{const[t,i]=n.children,E=(0,o.qcw)(i);if(null!==E&&void 0!==E&&E.trim()){var c,l;const e="%"===n.unit?{kind:"number",unit:null,numberFormat:"percentage"}:{kind:"number",unit:"string"===typeof n.unit?await r.getUnitFromText(null!==(c=n.unit)&&void 0!==c?c:""):null!==(l=n.unit)&&void 0!==l?l:null},s=await(0,T.B1)(r,e,E);if(!(s instanceof Error||null==s))return _(n.id,(0,o.qcw)(t),(0,a.c)(i),L)}return[]})),y=s((async(e,r,n)=>{var t;(0,p.I)(n,i.l7);const[E,c]=n.children;if(null!==(t=(0,a.c)(n.children[1]))&&void 0!==t&&t.trim()){const t=await N(e,r,n);return t.length?{interpretedAs:"literal",programChunk:t}:{interpretedAs:"code",programChunk:_(n.id,(0,o.qcw)(E),(0,a.c)(c),L)}}return{interpretedAs:"empty",programChunk:_(n.id,(0,o.qcw)(E),{type:"literal",args:["number",(0,m.N)(0)]})}})),f={type:i.l7,getParsedBlockFromElement:async(e,r,n)=>{(0,p.I)(n,i.l7);const{programChunk:t}=await y(e,r,n);return t}},h=async(e,r,n)=>n.type!==i.ZH?[]:l(n.id,n.result),M={type:i.ZH,getParsedBlockFromElement:s(h)};var w=n(98672);const g={type:[i.JB,i.SD,i.f8,i.kN,i.wl,i.Ht],isStructural:!0,getParsedBlockFromElement:s((async(e,r,n)=>n.children.flatMap(((e,r)=>i.Ee in e?l((0,w.b)(n,r),(0,o.qcw)(e),"expression"):[]))))};var v=n(26171);const I=function(e){for(var r=arguments.length,n=new Array(r>1?r-1:0),t=1;t<r;t++)n[t-1]=arguments[t];return{type:e,args:n}},A=function(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return I("column",I("column-items",...r))};var k=n(61294);var C=n(55013);const b=(e,r)=>({type:"identified-error",errorKind:"parse-error",id:e,error:{message:r},source:""}),D=e=>{let{table:r,th:n}=e;const t=(0,o.qcw)(n),c=r.children[0].children.find((e=>e.type===i.We&&e.columnId===n.id));return(0,k.M)(c,i.We)?function(e,r,n){const{solution:t,error:o}=(0,E.BJ)(n);return{errors:o?[{type:"identified-error",errorKind:"parse-error",id:r,error:o,source:n}]:[],expression:t,columnName:e,elementId:r}}(t,n.id,(0,a.c)(c)):{columnName:t,errors:[b(n.id,"Could not find a formula for this column")]}},R=async e=>{let{columnIndex:r,computer:n,th:t,dataRows:i}=e;if("series"!==t.cellType.kind)throw new Error("Expected series");const a=i[0];if(!a)throw new Error("Expected first data row");const c=(0,o.qcw)(a.children[r]),l=await async function(e,r,n,t){try{const{granularity:o}=(0,T.yb)(r,n),i=(0,T.JO)(r,(0,C.m0)(o),n);let a=n.trim();const c=(await Promise.all(Array.from({length:t},(async()=>{const r=a;return a=i.next().value,(0,C.m0)(await(0,T.B1)(e,{kind:"date",date:(0,C.m0)(o)},r))})))).filter(E.UT);return A(...c)}catch(o){const e=Array.from({length:t},(()=>I("date","year",2020n)));return A(...e)}}(n,t.cellType.seriesType,c,i.length);return{elementId:t.id,expression:l,columnName:(0,o.qcw)(t),errors:[]}},B=async e=>{const{th:r,dataRows:n}=e,{cellType:t}=r;return"table-formula"===t.kind?D(e):"series"===t.kind&&n.length>0?R(e):"dropdown"===t.kind?(async e=>{let{th:r,columnIndex:n,dataRows:t}=e;const i=[],a=[];for(const c of t){const e=c.children[n];e&&(i.push((0,o.qcw)(e)),a.push(e.id))}if("dropdown"!==r.cellType.kind)throw new Error("Dropdown column should have dropdown type");const E=i.map((e=>e?{type:"ref",args:[e]}:(0,T.Wg)(r.cellType)));return{expression:A(...E),errors:[],columnName:(0,o.qcw)(r),elementId:r.id}})(e):(async e=>{let{computer:r,th:n,columnIndex:t,dataRows:i}=e;const a=[],E=[],c=[];for(const d of i){const e=d.children[t];e&&(E.push((0,o.qcw)(e)),c.push(e.id))}const l=n.cellType&&"anything"!==n.cellType.kind?n.cellType:await(0,T.$F)(r,E,{userType:n.cellType}),s=await Promise.all(E.map((async(e,n)=>{let t=await(0,T.B1)(r,l,e);return t||a.push(b(c[n],"Invalid ".concat(l.kind))),t instanceof Error&&(a.push(b(c[n],t.message)),t=null),t||(t=(0,T.Wg)(l)),t})));return{expression:A(...s),errors:a,columnName:(0,o.qcw)(n),elementId:n.id}})(e)},P=async(e,r,n)=>{const[t,i,...a]=n.children,E=(0,o.qcw)(t.children[0]),c=await Promise.all(i.children.map((async(e,t)=>{const o=await B({computer:r,th:e,columnIndex:t,tableName:E,table:n,dataRows:a});return((e,r,n)=>{var t;return{blockId:null!==(t=n.elementId)&&void 0!==t?t:e,column:n.expression&&I("table-column-assign",I("tablepartialdef",r),I("coldef",n.columnName),n.expression),errors:n.errors}})(n.id,E,o)})));return{id:n.id,name:E,expression:I("table",I("tabledef",E)),columnAssigns:c}},O={type:i.L7,getParsedBlockFromElement:s((async(e,r,n)=>{(0,p.I)(n,i.L7);const{id:t,expression:o,columnAssigns:a}=await P(0,r,n),l=c(t,o),s=(0,E.ZP)(l.block.args[0])||void 0;return[l,...a.flatMap((e=>[...e.column?[c(e.blockId,e.column,s,(0,v.qY)(e.column))]:[],...e.errors]))]}))},x={type:i.VE,isStructural:!0},q={type:i.tW,getParsedBlockFromElement:s((async(e,r,n)=>{var t,o;(0,p.I)(n,i.tW);const a="%"===n.unit?{kind:"number",unit:null,numberFormat:"percentage"}:{kind:"number",unit:"string"===typeof n.unit?await r.getUnitFromText(null!==(t=n.unit)&&void 0!==t?t:""):null!==(o=n.unit)&&void 0!==o?o:null},E=await(0,T.B1)(r,a,n.children[1].children[0].text);return _(n.id,n.children[0].children[0].text,E instanceof Error||null===E?"":E)}))},F={type:i.qu,getParsedBlockFromElement:s((async(e,r,n)=>{if((0,p.I)(n,i.qu),n.children.length<2)return[];const{id:t,children:a}=n,c=(0,o.qcw)(a[0]);let l=(0,o.qcw)(a[1]);if("expression"===n.variant||"date"===n.variant||"toggle"===n.variant||"dropdown"===n.variant){const{type:e,coerced:o}=await(0,T.O3)(r,l,{type:n.coerceToType});if(l="anything"===e.kind||"nothing"===e.kind?{type:"noop",args:[]}:o||"","dropdown"===n.variant){return[..._(t,c,l),...(await Promise.all(n.children[1].options.map((async e=>{let t;const o=await(0,T.O3)(r,e.value,{type:n.coerceToType});return t="anything"===o.type.kind||"nothing"===o.type.kind?{type:"noop",args:[]}:(0,C.m0)(o.coerced),_(e.id,(0,E.v5)(e.id),t)})))).flat()]}}return _(t,c,l)}))},U={type:i.cL,getParsedBlockFromElement:s((async(e,r,n)=>{(0,p.I)(n,i.cL);const t=(0,o.qcw)(n.children[0]),{id:a}=n,E={type:"externalref",args:[a]};return _(n.id,t,E)}))},V=(()=>{const e=[];for(const r of Object.values(t))for(const n of[r.type].flat())e.push([n,r]);return new Map(e)})(),W=async(e,r,n)=>{const t=V.get(n.type);if(!t)return null;const i=[];if(t.isStructural)for(const c of n.children){var a;if((0,o.kKo)(c))i.push(...null!==(a=await W(e,r,c))&&void 0!==a?a:[])}if(t.getParsedBlockFromElement)try{i.push(...await t.getParsedBlockFromElement(e,r,n))}catch(E){console.error("Error getting parsed block from element",E),console.error("Error happened on element",n)}return i},S=async(e,r)=>{const n=[];for(const t of e.children){if(!("type"in t)||!("id"in t))continue;const o=await W(e,r,t);o&&n.push(...o)}return{program:n}}},51923:(e,r,n)=>{n.r(r),n.d(r,{DEPRECATED_ELEMENT_CODE_BLOCK:()=>t.sTz,DEPRECATED_ELEMENT_INPUT:()=>f,DEPRECATED_ELEMENT_TABLE_INPUT:()=>w,ELEMENT_BLOCKQUOTE:()=>t.ahg,ELEMENT_CALLOUT:()=>o,ELEMENT_CAPTION:()=>Y,ELEMENT_CODE_LINE:()=>t.Zvw,ELEMENT_CODE_LINE_V2:()=>d,ELEMENT_CODE_LINE_V2_CODE:()=>p,ELEMENT_COLUMNS:()=>i,ELEMENT_DATA_VIEW:()=>D,ELEMENT_DATA_VIEW_CAPTION:()=>R,ELEMENT_DATA_VIEW_NAME:()=>B,ELEMENT_DATA_VIEW_TH:()=>O,ELEMENT_DATA_VIEW_TR:()=>P,ELEMENT_DIAMOND:()=>S,ELEMENT_DISPLAY:()=>y,ELEMENT_DRAW:()=>U,ELEMENT_DRAW_IMAGE:()=>X,ELEMENT_DROPDOWN:()=>T,ELEMENT_ELLIPSE:()=>H,ELEMENT_EVAL:()=>h,ELEMENT_EXPRESSION:()=>m,ELEMENT_FETCH:()=>E,ELEMENT_FREEDRAW:()=>Z,ELEMENT_H1:()=>t.GDC,ELEMENT_H2:()=>t.oGK,ELEMENT_H3:()=>t.o3Y,ELEMENT_HR:()=>a,ELEMENT_IMAGE:()=>t.IVr,ELEMENT_IMPORT:()=>c,ELEMENT_INLINE_NUMBER:()=>M,ELEMENT_LI:()=>t.f86,ELEMENT_LIC:()=>t.wl8,ELEMENT_LINE:()=>G,ELEMENT_LINEAR:()=>J,ELEMENT_LINK:()=>t.uJg,ELEMENT_LIVE_CONNECTION:()=>x,ELEMENT_LIVE_CONNECTION_VARIABLE_NAME:()=>q,ELEMENT_MEDIA_EMBED:()=>t.vdJ,ELEMENT_OL:()=>t.kN6,ELEMENT_PARAGRAPH:()=>t.JBe,ELEMENT_PLOT:()=>l,ELEMENT_RECTANGLE:()=>W,ELEMENT_SELECTION:()=>V,ELEMENT_SLIDER:()=>_,ELEMENT_SMART_REF:()=>F,ELEMENT_STRUCTURED_IN:()=>L,ELEMENT_STRUCTURED_IN_CHILD:()=>N,ELEMENT_STRUCTURED_VARNAME:()=>u,ELEMENT_TABLE:()=>g,ELEMENT_TABLE_CAPTION:()=>v,ELEMENT_TABLE_COLUMN_FORMULA:()=>C,ELEMENT_TABLE_VARIABLE_NAME:()=>b,ELEMENT_TD:()=>k,ELEMENT_TEXT:()=>K,ELEMENT_TH:()=>A,ELEMENT_TR:()=>I,ELEMENT_UL:()=>t.HtX,ELEMENT_VARIABLE_DEF:()=>s});var t=n(74673);const o="callout",i="columns",a="divider",E="fetch-data",c="import",l="plot",s="def",d="code_line_v2",u="structured_varname",p="code_line_v2_code",m="exp",T="dropdown",_="slider",L="structured_input",N="structured_input_child",y="display",f="input",h="eval",M="inline-number",w="table-input",g="table",v="table-caption",I="tr",A="th",k="td",C="table-column-formula",b="table-var-name",D="data-view",R="data-view-caption",B="data-view-name",P="data-view-tr",O="data-view-th",x="live-conn",q="live-var-name",F="smart-ref",U="draw",V="selection",W="rectangle",S="diamond",H="ellipse",K="text",J="linear",G="line",Z="freedraw",X="image",Y="caption"},24217:(e,r,n)=>{n.d(r,{I:()=>o});var t=n(74673);function o(e,r){if(!(0,t.kKo)(e)||e.type!==r)throw new Error("Expected element type to be ".concat(r))}},84529:(e,r,n)=>{n.d(r,{c:()=>E});var t=n(74673),o=n(85663),i=n(13986),a=n(61294);const E=e=>{const r=e.children.length;return e.children.map(((n,E)=>{if((0,a.M)(n,o.bM)){const o=E>=1&&(!(0,t.GsE)(e.children[E-1])||!(0,t.qcw)(e.children[E-1]).endsWith(" ")),a=E<r-1&&(!(0,t.GsE)(e.children[E+1])||!(0,t.qcw)(e.children[E+1]).startsWith(" "))?" ":"";return(o?" ":"")+(0,i.v5)(n.blockId)+a}return(0,t.qcw)(n)})).join("")}},61294:(e,r,n)=>{n.d(r,{M:()=>o});var t=n(74673);const o=(e,r)=>(0,t.kKo)(e)&&e.type===r},98672:(e,r,n)=>{n.d(r,{b:()=>t});const t=(e,r)=>"".concat(e.id,"-").concat(r)}};
//# sourceMappingURL=6896.82550df3.chunk.js.map