/* eslint-disable no-irregular-whitespace */
import { verbalizeDoc } from './verbalizeDoc';
import textOnly from './__fixtures__/text-only.json';
import someCode from './__fixtures__/some-code.json';
import uiComponents from './__fixtures__/simple-ui-components.json';
import mostComponents from './__fixtures__/most-components.json';
import { ElementKind, RootDocument } from '@decipad/editor-types';
import { getRemoteComputer } from '@decipad/remote-computer';

describe('verbalizeDoc', () => {
  it('verbalizes text documents into the text itself', () => {
    const doc = textOnly as RootDocument;
    const { document, verbalized } = verbalizeDoc(doc, getRemoteComputer());
    expect(document).toMatchObject(doc);
    expect(verbalized.map((v) => v.element)).toMatchObject(doc.children);
    expect(verbalized.map((v) => v.verbalized)).toMatchInlineSnapshot(`
      [
        "# üïØStarting a Candle Business",
        "During the pandemic, many people thought of starting a side business, so I decided to see if my candle-making hobby could be profitable!",
        "It looks like I could make a profit and some side income based on my assumptions below. Feedback welcome!",
      ]
    `);
  });

  it('verbalizes code lines', () => {
    const doc = someCode as RootDocument;
    const { document, verbalized } = verbalizeDoc(doc, getRemoteComputer());
    expect(document).toMatchObject(doc);
    expect(verbalized.map((v) => v.verbalized)).toMatchInlineSnapshot(`
      [
        "# üïØStarting a Candle Business",
        "During the pandemic, many people thought of starting a side business, so I decided to see if my candle-making hobby could be profitable!",
        "It looks like I could make a profit and some side income based on my assumptions below. Feedback welcome!",
        "\`\`\`deci
      VarName1 = 3 / 4
      \`\`\`",
        "It looks like I could make a profit and some side income based on my assumptions below. Feedback welcome!",
        "\`\`\`deci
      VarName2 = cos(PI)
      \`\`\`",
        "## üí∏ How much will I pay for the act of candle-making and inflation?",
      ]
    `);
    expect(verbalized.map((v) => v.tags)).toMatchInlineSnapshot(`
      [
        Set {},
        Set {
          "p",
        },
        Set {
          "p",
        },
        Set {
          "code_line_v2_code",
        },
        Set {
          "p",
        },
        Set {
          "code_line_v2_code",
        },
        Set {},
      ]
    `);

    expect(
      verbalized
        .map((v) => [v.element.id, v.varName])
        .filter(([, varname]) => varname != null)
    ).toMatchInlineSnapshot(`
      [
        [
          "FDSffDfa3refdsFsdf",
          "VarName1",
        ],
        [
          "fjsdfdofsd3-e3dsdcj",
          "VarName2",
        ],
      ]
    `);
  });

  it('verbalizes some simple UI components', () => {
    const doc = uiComponents as RootDocument;
    const { document, verbalized } = verbalizeDoc(doc, getRemoteComputer());
    expect(document).toMatchObject(doc);
    expect(verbalized.map((v) => v.verbalized)).toMatchInlineSnapshot(`
      [
        "# üïØStarting a Candle Business",
        "During the pandemic, many people thought of starting a side business, so I decided to see if my candle-making hobby could be profitable!",
        "Slider with variable named \`Slider\`, value of "5", minimum = 0, maximum = 10, step = 1.",
        "It looks like I could make a profit and some side income based on my assumptions below. Feedback welcome!",
        "\`\`\`deci
      UnitCostGrowth = -2%
      \`\`\`",
        "## ü§î So, what's the verdict? Should I start?",
        "\`\`\`deci
      StartDate = date(2020-10-15)
      \`\`\`",
        "Dropdown list that exposes a variable named \`Dropdown1\`, with selected value of "A", and options of: \`["A", "B", "C"]\`.",
        "\`\`\`deci
      Historicals = {
        Year = ["2018", "2019", "2020", "2021", "2022"]
        Revenue = ["$265.59  B", "$260.17 B", "$274.51  B", "$365.81 B", "$394.32 B"]
        EBITDA = [$81.80  B, $76.47 B, $77.34 B, $120.23 B, $130.54 B]
        Capex = ["$13.3 B", "$10.4 B", "$7.3 B", "$11 B", "$10.7  B"]
        Acquistions = ["$721 M", "$624 M", "$1.52 B", "$33 M", "$306 M"]
        CashTax = ["$10.41 B", "$15.26 B", "$9.50 B", "$25.38 B", "$19.57 B"]
        EBITDAMargin =  EBITDA / Revenue in %
        FreeCashFlows =  EBITDA - Capex - Acquistions - CashTax 
        CashTaxRate =  CashTax / EBITDA in %
      }
      \`\`\`",
      ]
    `);
    expect(verbalized.map((v) => v.tags)).toMatchInlineSnapshot(`
      [
        Set {},
        Set {
          "p",
        },
        Set {
          "caption",
          "exp",
        },
        Set {
          "p",
        },
        Set {
          "caption",
          "exp",
        },
        Set {},
        Set {
          "caption",
          "exp",
        },
        Set {
          "caption",
          "dropdown",
        },
        Set {
          "td",
          "table-var-name",
          "table-column-formula",
          "smart-ref",
        },
      ]
    `);

    expect(
      verbalized
        .map((v) => [v.element.id, v.varName])
        .filter(([, varname]) => varname != null)
    ).toMatchInlineSnapshot(`
      [
        [
          "QeyklnGhr7iEZvZ1ntElO",
          "Slider",
        ],
        [
          "OcOgbmVNoCfO01wmhFkKO",
          "UnitCostGrowth",
        ],
        [
          "OcOgbmVNoCfO01wmhFkKO",
          "StartDate",
        ],
        [
          "nDm8PqFEVkHrR9uLsOQqT",
          "Dropdown1",
        ],
        [
          "c9z4Gq_NFAzSQjEzufgxt",
          "Historicals",
        ],
      ]
    `);
  });

  it('verbalizes most components', () => {
    const doc = mostComponents as RootDocument;
    const { document, verbalized } = verbalizeDoc(doc, getRemoteComputer());
    expect(document).toMatchObject(doc);
    expect(verbalized.map((v) => v.verbalized)).toMatchInlineSnapshot(`
      [
        "# Everything, everywhere, all at once",
        "üçî = 3",
        "variable = 4",
        "variable2 = 4+1",
        "isTrue= true and true ",
        "isFalse = false and false",
        "string = "This is a string" + """,
        "string2= "string"",
        "err = 1/0",
        "units = 1km/s",
        "food = 1 üçä/üçé",
        " food units isTrue isFalse err ",
        "\`\`\`deci
      Table3 = {
        Column1 = [1, 2, 3]
        Column2 = Column1 + 5
        Column3 = [true, false, true]
      }
      \`\`\`",
        "\`\`\`deci
      üî• = {
        Column1 = ["1999", "2000", "20001"]
        Column2 = ["1999-01", "2000-01", "2001-01"]
        üéâ = ["1999-01-01", "2000-01-01", "2001-01-01"]
        Column4 =  Column2 + 1
        Column5 =  Column2 - date(1970-01) in weeks
        Column6 = ["", "", ""]
        Column7 = ["", "", ""]
        Column8 = ["", "", ""]
        Column9 = ["", "", ""]
        Column10 = ["", "", ""]
        Column11 = ["", "", ""]
        Column12 = ["", "", ""]
        Column13 = ["", "", ""]
      }
      \`\`\`",
        "\`\`\`deci
      Table2 = {
        Column1 = ["1", "2", "3", "4", "5", "6", "-0.3", "0.8", "9.4", "1045345345454534545"]
        Column2 = [true, false, false, false, true, true, false, true, true, true]
        Column3 = ["words with sape", "üòÑ", "c", "d", "e", "f", "longstringheretestthis", "a", "b", "c"]
        Column4 = ["date(2020-02-03)", "2030-02-03", "3000-03-01", "30-04-01", "2020-02-03", "2020-02-03", "2020-02-03", "2020-02-03", "2020-02-03", "2020-02-03"]
        Column5 = [1, 2, 3, 4, 5, 6, -0.3, 0.8, 9.4, 45453453453453453534534]
        Property6 =  Column5 * 10
      }
      \`\`\`",
        "<data-view expandedGroups=["25e37b5ac63a7ecbac6e0f2d53756972b353986e333493ef08b295a2563d64c0"] varName="xXsaBPgqRXdE1DCd6r5qE">",
        "Table2",
        "üî•",
        "Table3",
        "<plot title="Chart" sourceVarName="Table3" xColumnName="Column1" yColumnName="Column2" markType="circle" thetaColumnName="" sizeColumnName="" colorColumnName="" colorScheme="" y2ColumnName="">",
        "<plot title="Chart" sourceVarName="Table3" xColumnName="Column1" yColumnName="Column1" markType="line" thetaColumnName="" sizeColumnName="" colorColumnName="" colorScheme="" y2ColumnName="">",
        "<plot title="Chart" sourceVarName="Table2" xColumnName="Column1" yColumnName="Column1" markType="bar" thetaColumnName="" sizeColumnName="" colorColumnName="" colorScheme="" y2ColumnName="">",
        "\`\`\`deci
       = 
      \`\`\`",
        "\`\`\`deci
       = 
      \`\`\`",
        "\`\`\`deci
       = 
      \`\`\`",
        "\`\`\`deci
      Variable = 10 km
      \`\`\`",
        "\`\`\`deci
      VariableColor = 1+1
      \`\`\`",
        "\`\`\`deci
      VariableColor2 = "Yes"
      \`\`\`",
        "\`\`\`deci
      VariableDate = date(2020-02-03)
      \`\`\`",
        "\`\`\`deci
      VariableNumber = 1
      \`\`\`",
        "\`\`\`deci
      üëó = 10%
      \`\`\`",
        "Dropdown list that exposes a variable named \`Dropdown\`, with selected value of "10%", and options of: \`["10%", "20%", "30%"]\`.",
        "Dropdown list that exposes a variable named \`Positions\`, with selected value of "\\"Software Dev\\"", and options of: \`["\\"Software Dev\\"", "\\"Designer\\""]\`.",
        "\`\`\`deci
      Input1 = 100$ &
      \`\`\`",
        "\`\`\`deci
      Input2 = 100$ + "a"
      \`\`\`",
        "Slider with variable named \`Slider1\`, value of "4 + \\"a\\"", minimum = 0, maximum = 10, step = 1.",
        "Slider with variable named \`Slider2\`, value of "5 &", minimum = 0, maximum = 10, step = 1.",
        "",
        "",
        "",
        "\`\`\`deci
      Input = date(2022-11-03)
      \`\`\`",
        "\`\`\`deci
      InputCopyCopy = date(2022-11)
      \`\`\`",
        "\`\`\`deci
      InputCopy = date(2022-11-03)
      \`\`\`",
        "\`\`\`deci
      StructuredDollars = $100
      \`\`\`",
        "\`\`\`deci
      StructuredDollarsCopy1 = 100%
      \`\`\`",
        "\`\`\`deci
      StructuredDollarsCopy1Copy1 = 100 kilometer
      \`\`\`",
        "\`\`\`deci
      StructuredDollarsCopy1Copy1Copy1 = 100 second
      \`\`\`",
        "\`\`\`deci
      StructuredDollarsCopy1Copy1Copy1Copy1 = 100 $ per hour
      \`\`\`",
        "\`\`\`deci
      OneMoreStructuredDollarForTheRoad = StructuredDollars + 1
      \`\`\`",
        "\`\`\`deci
      BigRef = OneMoreStructuredDollarForTheRoad 
      \`\`\`",
        "\`\`\`deci
      BigRefCopy1 = StructuredDollars + OneMoreStructuredDollarForTheRoad
      \`\`\`",
        "\`\`\`deci
      BigRefCopy1Copy1 = StructuredDollars + OneMoreStructuredDollarForTheRoad+ 
      \`\`\`",
        "\`\`\`deci
      BigBunber = 3e200
      \`\`\`",
        " exprRef_uqKFbC_Q62uYo03FMSdpiexprRef_sTyUI7bAdmn0_OyxJz_Oj ",
        "\`\`\`deci
      LoanRate = (pmt( LoanInterest , 5, FundsLoan )/12) per month
      \`\`\`",
        "\`\`\`deci
      LoanRepay = LoanRate * 5 years
      \`\`\`",
        "\`\`\`deci
      LoanInterest = 100$
      \`\`\`",
        "\`\`\`deci
      FundsLoan = 100$
      \`\`\`",
        "LongVariableNameLiveConnections",
        "## Heading #1",
        "### Heading #2",
        "",
        "",
        "",
        "",
        "",
        "",
        "üíÄ",
        "
      Long quote underline bold italics crossed highlight
      üíÄ



      ",
        "\`\`\`deci
      Table1 = {
        Column1 = ["", "", ""]
        Column2 = ["", "", ""]
        Column3 = ["", "", ""]
        Column4 = ["", "", ""]
        Column5 = ["", "", ""]
      }
      \`\`\`",
        "\`\`\`deci
      tableislongtitlesdjasiodjasidsdsdsdsdasdsdadasdasdasddfsdfdfsdfdfdsfsdfsdfdfsdfsdfsddfsdfsdfdfasndasnd = {
        tablewithlongjsdsjdhasjhdsjkdsjdhasjhd = ["", "", ""]
        Column2 = 1
        Column3 = 2
        Column4 = [AqD22IuRny6JIpMe9o7Zm, RF8aRVCm2fJJZ4zfi6H59, ]
      }
      \`\`\`",
        "Dropdown list that exposes a variable named \`Dropdown1\`, with selected value of "A", and options of: \`["A", "B", "C"]\`.",
        "Dropdown list that exposes a variable named \`Dropdown2\`, with selected value of "Select", and options of: \`[]\`.",
        "Long quote underline bold italics crossed highlightüíÄ  code",
        "Long quote underline bold italics crossed highlightcode

      ",
        "Long quote underline bold italics crossed highlightcode",
        "Long quote underline bold italics crossed highlightcode",
        "",
        " string ",
        " isTrue ",
        " variable ",
        " variable2 ",
        " units 

      Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.

      Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.

      Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.

      Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.

      Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.",
        "Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.",
        "Ÿä ÿßŸÑÿπÿßÿ¥ÿ± ŸÑŸäŸàŸÜŸäŸÉŸàÿØ (Unicode Conference)ÿå ÿßŸÑÿ∞Ÿä ÿ≥ŸäÿπŸÇÿØ¬†ŸÅŸä 10-12 ÿ¢ÿ∞ÿßÿ±¬†1997¬†ÿ®ŸÖÿØŸäŸÜÿ© ŸÖŸéÿßŸäŸêŸÜŸíÿ™Ÿíÿ≥ÿå ÿ£ŸÑŸÖÿßŸÜŸäÿß. Ÿà¬†ÿ≥Ÿäÿ¨ŸÖÿπ¬†ÿßŸÑŸÖÿ§ÿ™ŸÖÿ±¬†ÿ®ŸäŸÜ ÿÆÿ®ÿ±ÿßÿ°¬†ŸÖŸÜ ŸÉÿßŸÅÿ© ŸÇÿ∑ÿßÿπÿßÿ™ ÿßŸÑÿµŸÜÿßÿπÿ© ÿπŸÑŸâ ÿßŸÑÿ¥ÿ®ŸÉÿ© ÿßŸÑÿπÿßŸÑŸÖŸäÿ© ÿßŸÜÿ™ÿ±ŸÜŸäÿ™ ŸàŸäŸàŸÜŸäŸÉŸàÿØÿå ÿ≠Ÿäÿ´ ÿ≥ÿ™ÿ™ŸÖÿå¬†ÿπŸÑŸâ¬†ÿßŸÑÿµÿπŸäÿØŸäŸÜ ÿßŸÑÿØŸàŸÑŸä ŸàÿßŸÑŸÖÿ≠ŸÑŸä ÿπŸÑŸâ ÿ≠ÿØ ÿ≥Ÿàÿßÿ° ŸÖŸÜÿßŸÇÿ¥ÿ© ÿ≥ÿ®ŸÑ ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ŸäŸàŸÜŸÉŸàÿØ ŸÅŸä ÿßŸÑŸÜÿ∏ŸÖ ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ŸàŸÅŸäŸÖÿß ŸäÿÆÿµ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇÿßÿ™ ÿßŸÑÿ≠ÿßÿ≥Ÿàÿ®Ÿäÿ©ÿå ÿßŸÑÿÆÿ∑Ÿàÿ∑ÿå ÿ™ÿµŸÖŸäŸÖ ÿßŸÑŸÜÿµŸàÿµ ŸàÿßŸÑÿ≠Ÿàÿ≥ÿ®ÿ©¬†ŸÖÿ™ÿπÿØ",
        "‰ΩúÈï∑ÂæåËÄ≥Â†ÖÈñìÁî®ÂïÜÊåáÊ®©Áï™‰∏ÄË°åÊú´„ÄÇÈõ£ÈÉ®Ë≥º‰∫ãË∫´ÊúàÂ¶ªÈÄ£ÂïÜÊ•ΩÂ∫úÊñáËÅ∑„ÄÇËàûÂçäÂõ≤Êá≤Ëäù‰∫¨ÊÉëÊááÂè∞ÂÉèÊ≠¢Ë¨ùÁäØÂ∫úÂõΩÈöõÁÑ°„ÄÇÂÖâËàà‰∫ãÂΩ±Â∞èÁº∂Èï∑Ë¶ñÂ†±ÊâãÊ®©ÂèäÊ£ãÊú¨Ê∞¥Êô¥„ÄÇËºâÂÆπË∂≥ËÅûËÉΩ‰ΩúÁé≤ÂºÅ‰ºùÂá∫ÂÆπËëâÂæóÂ¥éË≤¨„ÄÇÁÑ°ÈÉéÈö†ÂïèÂ±ûÂ§ßÊñ∞ÂåñÊñ∞Á§∫ÊØíÊµ∑ÊîªË°å‰∏ñÂ∑ù‰∏ªÈ®ì„ÄÇÂ§úÂïèÂ†¥ÈáéÂΩ¢Â±ïÂ∑¶Â±ÄÈÉ®ÂèóÁü•Ê±∫„ÄÇËæûÂ∫ÉÁ®úÊõøÂ¥é‰∏≠‰æõÊõ∏ÊÄßÊöÆ‰∫ãÂ§©ÁßëÂ∏´Ë™áËÅû„ÄÇÊñáÂÖ®ËøëÂπ¥È°çË©±ÊÑèÂ≠óÊ¥ãÂßî‰ΩúÊúÄÊ∞∑ÈÅî„ÄÇ‰ΩøÊ†πËæûË¶ßÂçÉËÄÖÈ§äÁ•âË©±ÈΩ¢Â∫óÂÆü„ÄÇ",
        "",
        "ÊÄùËà™Â≥∂Ê†™Âä†‰∫§Ë∂≥ËÉΩÂûãÊ§úÈ≠öË¶öË¶ãÊôÇËæû‰∫∫ÂèñÁÇ∫Ë≥áÊú¨„ÄÇÊÉÖË©±Âá∫‰∏ªÊù±ÈñãÂπ¥Á¥ôÂÅ¥Âú∞Ê•≠ÂØæÂ≠¶Êñ∞ÂçîÈÅ∫„ÄÇÂÖê‰ª∂ËÅ∑Á∂≤ÂãüÂã¢Ââ≤Âõ≥ÊºîÂàùÈóòÊäï„ÄÇÁµåÊ§úËëóÊïôÂ±ïÊòéÂïèËÅûÂëäÊúàÊôÆÂÄô„ÄÇÈÄÆÊ®©ÂÖ¨ÊåÅ‰ΩêÈï∑Âø´ËºâÊé≤Âº∑ÊïëÊ≥ïÂéª‰∫ÜÂà∏‰∏â„ÄÇË∂äÂÆüÁóáÁøíÊ•≠Ë™çÁô∫È£õÁî≥ËÄÖÊ≥ïÊ¨†Ëø´Âåñ„ÄÇÂ¢úÈáëÈñìÈô¢ÂíåÊü¥ÁöÑË≥ûÂì°Âá∫Âì°Ê•≠ÂêÑÊñ∞Ê≤πÂÆè„ÄÇÁ∂ö‰æøÂäõÂ∫¶Ê•≠ËÅ¥È¶ñÊù°Ëª¢Ê®©‰∫àÈà¥„ÄÇÂπ¥Èô∏Â§öÂ°ÅÁü≥ÂäõÂ†±Áä†Á¥öÈÅî‰ΩµÂç≥Â†Ä„ÄÇÂ†ÇÂõûÊôÆÁ£êÈ°åÂ∏∏È†≠Ë≥™Ë©±Â§±Ëß£Â∫ÉÂè∞Âõ≥Ëâ≤ÊûúË¶ßËªä„ÄÇ",
        "–í–µ–ª–∏–∫–∞ —á–∞—Å—Ç–∏–Ω–∞ –π–æ–≥–æ —Ç–µ–∫—Å—Ç—É —Å–∫–ª–∞–¥–∞—î—Ç—å—Å—è –∑ —Ä–æ–∑–¥—ñ–ª—ñ–≤ 1.10.32-3 –∑ –¶–∏—Ü–µ—Ä–æ–Ω–∞ De finibus bonorum —ñ–Ω malorum ( –Ω–∞ –∫–æ—Ä–¥–æ–Ω–∞—Ö –¥–æ–±—Ä–∞ —ñ –∑–ª–∞ ; finibus –º–æ–∂–µ alspo –ø–µ—Ä–µ–∫–ª–∞—Å—Ç–∏ —è–∫ —Ü—ñ–ª–µ–π). Neque –ü–æ—Ä—Ä–æ quisquam –ü–µ—Ä–µ–¥–±–∞—á—É–≤–∞–Ω–µ –ö–≤–∞–π dolorem Ipsum Quia Dolor —Å–∏–¥—ñ—Ç–∏ –ê–º–µ—Ç, consectetur, adipisci –≤–µ–ª–∏—Ç—å —î –ø–µ—Ä—à–∏–º –≤—ñ–¥–æ–º–∏–º –≤–µ—Ä—Å—ñ—è ("–Ü –Ω–µ–º–∞—î –Ω—ñ —Ç–∏—Ö, —Ö—Ç–æ –ª—é–±–∏—Ç—å –≥–æ—Ä–µ —Å–µ–±–µ, —Ç–∞–∫ —è–∫ —Ü–µ –≥–æ—Ä–µ —ñ, —Ç–∞–∫–∏–º —á–∏–Ω–æ–º, —Ö–æ—á–µ –æ—Ç—Ä–∏–º–∞—Ç–∏ –π–æ–≥–æ " ‚Äã‚Äã). –ë—É–ª–æ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ, –†—ñ—á–∞—Ä–¥ –ú–∞–∫–ö–ª—ñ–Ω—Ç–æ–∫, —Ñ—ñ–ª–æ–ª–æ–≥, –¥–∏—Ä–µ–∫—Ç–æ—Ä –≤–∏–¥–∞–Ω—å –≤ –•–µ–º–ø–¥–µ–Ω - Sydney College –≤ —à—Ç–∞—Ç—ñ –í—ñ—Ä–¥–∂–∏–Ω—ñ—è; –≤—ñ–Ω —à—É–∫–∞–≤ citings –∑ consectetur " –≤ –∫–ª–∞—Å–∏—á–Ω—ñ–π –ª–∞—Ç–∏–Ω—Å—å–∫–æ—ó –ª—ñ—Ç–µ—Ä–∞—Ç—É—Ä–∏, –≤ —Ç–µ—Ä–º—ñ–Ω –¥–∏–≤–Ω–æ –Ω–∏–∑—å–∫–æ—ó —á–∞—Å—Ç–æ—Ç–∏ –≤ —Ü—å–æ–º—É –∫–æ—Ä–ø—É—Å—É –ª—ñ—Ç–µ—Ä–∞—Ç—É—Ä–∏. Lorem Ipsum —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó",
        "◊©◊¢◊® ◊ë◊©◊§◊ï◊™ ◊ê◊ô◊ò◊ú◊ô◊î ◊í◊ù. ◊ë◊ô◊ï◊ú◊ô ◊û◊ì◊ï◊ô◊ß◊ô◊ù ◊õ◊™◊ë ◊ê◊™, ◊ï◊û◊ì◊¢◊ô◊ù ◊ê◊ó◊®◊ï◊†◊ô◊ù ◊°◊ò◊ò◊ô◊°◊ò◊ô◊ß◊î ◊ì◊™ ◊ñ◊õ◊®. ◊î◊ô◊ê ◊í◊ù ◊°◊®◊ë◊ï◊ú ◊î◊ó◊ï◊§◊©◊ô◊™, ◊í◊ù ◊©◊û◊ï ◊õ◊ô◊¶◊ì ◊ë◊ó◊ô◊®◊ï◊™. ◊ê◊ù ◊©◊õ◊ú ◊ì◊§◊ô◊ù ◊¶◊®◊§◊™◊ô◊™. ◊û◊ô◊ñ◊û◊ô ◊†◊ï◊°◊ó◊ê◊ï◊™ ◊û◊ô◊™◊ï◊ú◊ï◊í◊ô◊î ◊ê◊®◊• ◊û◊î.",
        "",
        "◊ì◊™ ◊î◊ß◊î◊ô◊ú◊î ◊ú◊û◊ê◊û◊®◊ô◊ù ◊©◊û◊ï, ◊ê◊ú ◊î◊®◊ï◊ó ◊®◊ê◊©◊ô ◊©◊ê◊ú◊ï◊™ ◊©◊¢◊®. ◊ô◊ô◊ì◊ô◊© ◊ó◊ï◊§◊©◊ô◊™ ◊ì◊™ ◊õ◊ú◊ú, ◊ê◊ï ◊ê◊ó◊® ◊î◊ó◊ë◊®◊î ◊û◊û◊ï◊†◊®◊õ◊ô◊î, ◊û◊™◊ï◊ö ◊§◊†◊ê◊ô ◊¢◊ú ◊ñ◊õ◊®. ◊¢◊ñ◊î ◊ë◊î◊ë◊†◊î ◊ò◊ë◊ú◊ê◊ï◊™ ◊û◊î. ◊û◊ï◊í◊© ◊î◊°◊ë◊ô◊ë◊î ◊ê◊ù ◊™◊†◊ö. ◊©◊ú ◊ú◊û◊™◊ó◊ô◊ú◊ô◊ù ◊ê◊†◊™◊®◊ï◊§◊ï◊ú◊ï◊í◊ô◊î ◊¶'◊ò, ◊ê◊ó◊®◊ô◊ù ◊ï◊ô◊ß◊ô◊§◊ì◊ô◊î ◊ú◊ï◊ó ◊ë, ◊ê◊®◊• ◊ê◊™ ◊ì◊®◊õ◊î ◊®◊ï◊°◊ô◊™.",
        "",
        "◊ï◊ô◊© ◊©◊ú ◊§◊ô◊°◊ï◊ú ◊™◊ë◊†◊ô◊ï◊™, ◊ê◊ú ◊™◊†◊ö ◊°◊®◊ë◊ï◊ú ◊ë◊î◊©◊ó◊™◊î ◊ë◊î◊ô◊°◊ò◊ï◊®◊ô◊î. ◊ì◊™ ◊ê◊®◊• ◊†◊ô◊ï◊ï◊ò ◊ï◊ë◊û◊™◊ü, ◊û◊î ◊õ◊ô◊û◊ô◊î ◊ï◊û◊ì◊¢◊ô◊ù ◊ß◊¶◊®◊û◊®◊ô◊ù ◊ë◊ì◊£. ◊û◊ô◊ñ◊ù ◊ê◊°◊§◊®◊†◊ò◊ï ◊ï◊ô◊ß◊ô◊û◊ì◊ô◊î ◊í◊ù ◊®◊ë◊î, ◊©◊ì◊®◊ï◊™ ◊ï◊ê◊ú◊ß◊ò◊®◊ï◊†◊ô◊ß◊î ◊ê◊ù ◊¢◊ï◊ì. ◊¢◊ú ◊ë◊ß◊® ◊û◊™◊ï◊ö ◊ó◊®◊ò◊ï◊û◊ô◊ù.",
        "## ◊ù ◊¢◊ï◊ì. ◊¢◊ú ◊ë◊ß◊®",
        "",
        "",
        "",
        "",
      ]
    `);
  });
});

it('can filter elements paragraph elements', () => {
  const doc = uiComponents as RootDocument;

  const elementType = new Set<ElementKind>(['p', 'tab', 'columns']);

  const { verbalized } = verbalizeDoc(doc, getRemoteComputer(), elementType);

  expect(
    verbalized.filter((el) => !elementType.has(el.element.type))
  ).toHaveLength(0);

  expect(verbalized.map((v) => v.verbalized)).toMatchInlineSnapshot(`
    [
      "During the pandemic, many people thought of starting a side business, so I decided to see if my candle-making hobby could be profitable!",
      "It looks like I could make a profit and some side income based on my assumptions below. Feedback welcome!",
    ]
  `);
});

it('can filter for code lines', () => {
  const doc = someCode as RootDocument;

  const elementType = new Set<ElementKind>(['code_line_v2']);

  const { verbalized } = verbalizeDoc(doc, getRemoteComputer(), elementType);

  expect(
    verbalized.filter((el) => !elementType.has(el.element.type))
  ).toHaveLength(0);

  expect(verbalized.map((v) => v.verbalized)).toMatchInlineSnapshot(`
    [
      "\`\`\`deci
    VarName1 = 3 / 4
    \`\`\`",
      "\`\`\`deci
    VarName2 = cos(PI)
    \`\`\`",
    ]
  `);
});
